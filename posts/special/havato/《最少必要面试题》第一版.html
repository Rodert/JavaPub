<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.47" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/posts/special/havato/%E3%80%8A%E6%9C%80%E5%B0%91%E5%BF%85%E8%A6%81%E9%9D%A2%E8%AF%95%E9%A2%98%E3%80%8B%E7%AC%AC%E4%B8%80%E7%89%88.html"><meta property="og:site_name" content="JavaPub"><meta property="og:title" content="ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ"><meta property="og:description" content="ç›¸ä¿¡å¤§å®¶éƒ½ä¼šæœ‰ç§åŠçœ¼ç†Ÿåˆé™Œç”Ÿçš„æ„Ÿè§‰ã€çœ‹è¿‡å¯èƒ½åœ¨çŸ­æš‚çš„é¢è¯•ååˆé©¬ä¸Šå¿˜è®°äº†ã€‚JavaPub åœ¨è¿™é‡Œæ•´ç†è¿™äº›å®¹æ˜“å¿˜è®°çš„é‡ç‚¹çŸ¥è¯†åŠ è§£ç­”ï¼Œå»ºè®®æ”¶è—ï¼Œç»å¸¸æ¸©ä¹ æŸ¥é˜…ã€‚ ç‚¹å‡»åœ¨çº¿é˜…è¯»ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ Your Image Description [toc] ç¼“å­˜ 1. ä»€ä¹ˆæ˜¯ç¼“å­˜ï¼Ÿ ç¼“å­˜ï¼Œå°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒºï¼Œé’ˆå¯¹æœåŠ¡å¯¹è±¡çš„ä¸åŒï¼ˆæœ¬è´¨å°±æ˜¯ä¸åŒçš„ç¡¬ä»¶ï¼‰éƒ½å¯ä»¥æ„å»ºç¼“å­˜..."><meta property="og:type" content="article"><meta property="og:image" content="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F05%2F25%2F20240525-230741.webp"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-07-03T14:35:52.000Z"><meta property="article:author" content="Mr.Wang"><meta property="article:modified_time" content="2024-07-03T14:35:52.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ","image":["https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F05%2F25%2F20240525-230741.webp","https://tva3.sinaimg.cn/large/007F3CC8ly1h0niy8fcitj30ku09d3zr.jpg","https://tva2.sinaimg.cn/large/007F3CC8ly1h0niv378zsj30lh08z75i.jpg","https://tva3.sinaimg.cn/large/007F3CC8ly1h0niuhpty3j30ka08mdh1.jpg","https://tvax4.sinaimg.cn/large/007F3CC8ly1h0nitw2kjwj30nk0l5goe.jpg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092054.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092044.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092410.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092418.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093600.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093602.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093612.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-094024.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093625.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093135.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093155.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093204.png","https://tva4.sinaimg.cn/large/007F3CC8ly1h3uz7jfq18j30rx0bytdd.jpg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093211.png","https://tvax1.sinaimg.cn/large/007F3CC8ly1h11l1b6ykaj30x50kl46x.jpg","https://tva2.sinaimg.cn/large/007F3CC8ly1h11l1p8888j30te07oacq.jpg","https://tvax1.sinaimg.cn/large/007F3CC8ly1h11l1ykqpsj30vx08o14v.jpg","https://tvax2.sinaimg.cn/large/007F3CC8ly1h11l29871ij30is07h76f.jpg","https://tva4.sinaimg.cn/large/007F3CC8ly1h11l2qpppoj30se08sgq4.jpg","https://tvax1.sinaimg.cn/large/007F3CC8ly1h11l35h3jfj30pd097764.jpg","https://tvax4.sinaimg.cn/large/007F3CC8ly1h11l3rzpgsj30mb0883ze.jpg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093217.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093220.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093223.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093225.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093228.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093230.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093232.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093235.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093237.png","https://tvax1.sinaimg.cn/large/007F3CC8ly1h3dl7rqe24j313c0nm7ik.jpg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093240.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093244.png","https://tvax2.sinaimg.cn/large/007F3CC8ly1h3i5df8ddbj30l90ir0uj.jpg","https://tvax3.sinaimg.cn/large/007F3CC8ly1h391syfw1qj30hs0c2t9m.jpg","https://tvax4.sinaimg.cn/large/007F3CC8ly1h3923wycklj30oq0hwtbl.jpg","https://tvax3.sinaimg.cn/large/007F3CC8ly1h39277u34pj30py0nojxa.jpg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093254.jpeg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093256.jpeg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093300.jpeg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093302.jpeg","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093306.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093328.png","https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093313.png"],"dateModified":"2024-07-03T14:35:52.000Z","author":[{"@type":"Person","name":"Mr.Wang","url":"https://javapub.net.cn"}]}</script><script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?47a97d05ef9382d85d5a910de6b07c46";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script><style>
      /* ä¾§è¾¹æ‚¬æµ®äºŒç»´ç å®¹å™¨ */
      .floating-qrcode {
        position: fixed;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 999;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }

      /* æ‚¬æµ®æŒ‰é’® */
      .floating-qrcode-btn {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        color: white;
        font-size: 24px;
        margin-bottom: 10px;
      }

      .floating-qrcode-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      }

      /* äºŒç»´ç å®¹å™¨ */
      .floating-qrcode-popup {
        position: absolute;
        right: 60px;
        top: 50%;
        transform: translateY(-50%);
        width: 210px;
        padding: 10px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.18);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        pointer-events: none;
        max-height: 85vh;
        overflow-y: auto;
        overflow-x: hidden;
      }

      /* ç‚¹å‡»æ‰“å¼€ï¼šä½¿ç”¨ active ç±»æ§åˆ¶æ˜¾ç¤º */
      .floating-qrcode.active .floating-qrcode-popup {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transform: translateY(-50%) translateX(-10px);
      }

      /* äºŒç»´ç é¡¹ç›®å®¹å™¨ */
      .floating-qrcode-popup .qrcode-item {
        margin: 8px 0;
        padding: 0;
        border: none;
      }

      .floating-qrcode-popup .qrcode-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }

      /* å±•å¼€èœå•æŒ‰é’®ï¼ˆSpeed Dialï¼‰ */
      .floating-qrcode-popup .qrcode-action {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.06);
        background: rgba(255, 255, 255, 0.95);
        cursor: pointer;
        user-select: none;
        box-shadow: 0 10px 22px rgba(0, 0, 0, 0.10);
        transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      }

      .floating-qrcode-popup .qrcode-action:hover {
        transform: translateX(-2px);
        box-shadow: 0 14px 30px rgba(0, 0, 0, 0.14);
        border-color: rgba(102, 126, 234, 0.35);
      }

      .floating-qrcode-popup .qrcode-icon {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        display: grid;
        place-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        font-size: 16px;
        font-weight: 700;
        flex: 0 0 auto;
      }

      .floating-qrcode-popup .qrcode-text {
        display: flex;
        flex-direction: column;
        line-height: 1.15;
        min-width: 0;
      }

      .floating-qrcode-popup .qrcode-text .title {
        font-size: 13px;
        font-weight: 700;
        color: #222;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .floating-qrcode-popup .qrcode-text .desc {
        margin-top: 3px;
        font-size: 12px;
        color: #666;
      }

      /* äºŒç»´ç é¢„è§ˆå¡ç‰‡ï¼ˆç‚¹å‡»æŒ‰é’®åæ˜¾ç¤ºï¼‰ */
      .floating-qrcode-preview {
        position: fixed;
        right: 90px;
        top: 50%;
        transform: translateY(-50%);
        width: 230px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 14px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.22);
        z-index: 1000;
        backdrop-filter: blur(6px);
      }

      .floating-qrcode-preview img {
        width: 100%;
        height: auto;
        border-radius: 12px;
        display: block;
        background: #fff;
      }

      .floating-qrcode-preview .preview-title {
        margin-top: 8px;
        text-align: center;
        font-size: 12px;
        color: #555;
        font-weight: 600;
      }

      /* äºŒç»´ç ç®­å¤´ */
      .floating-qrcode-popup::after {
        content: '';
        position: absolute;
        right: -8px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 8px 0 8px 8px;
        border-color: transparent transparent transparent white;
      }

      /* ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ */
      @media (max-width: 768px) {
        /* æŒ‰é’®ä½ç½®æ”¹ä¸ºå³ä¸‹è§’ */
        .floating-qrcode {
          right: 15px;
          bottom: 80px;
          top: auto;
          transform: none;
        }

        /* æŒ‰é’®å¤§å°ç¨å° */
        .floating-qrcode-btn {
          width: 48px;
          height: 48px;
          font-size: 22px;
          margin-bottom: 0;
        }

        /* ç§»åŠ¨ç«¯å¼¹çª—ä»åº•éƒ¨å¼¹å‡º */
        .floating-qrcode-popup {
          position: fixed;
          right: auto;
          left: 50%;
          bottom: 140px;
          top: auto;
          transform: translateX(-50%) translateY(20px);
          width: calc(100vw - 40px);
          max-width: 280px;
          max-height: 70vh;
          padding: 14px;
          z-index: 999;
        }

        .floating-qrcode-preview {
          left: 50%;
          right: auto;
          top: auto;
          bottom: 120px;
          transform: translateX(-50%);
          width: min(260px, calc(100vw - 40px));
        }

        /* ç§»åŠ¨ç«¯é€šè¿‡ç‚¹å‡»æ˜¾ç¤ºï¼ˆä½¿ç”¨ active ç±»ï¼‰ */
        .floating-qrcode.active .floating-qrcode-popup {
          opacity: 1;
          visibility: visible;
          pointer-events: auto;
          transform: translateX(-50%) translateY(0);
        }

        /* ç®­å¤´åœ¨ç§»åŠ¨ç«¯éšè—æˆ–è°ƒæ•´ä½ç½® */
        .floating-qrcode-popup::after {
          display: none;
        }

        /* æ·»åŠ é®ç½©å±‚ */
        .floating-qrcode-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.5);
          z-index: 998;
          opacity: 0;
          visibility: hidden;
          transition: all 0.3s ease;
          pointer-events: none;
        }

        .floating-qrcode.active .floating-qrcode-overlay {
          opacity: 1;
          visibility: visible;
          pointer-events: auto;
        }

        /* ä¼˜åŒ–è§¦æ‘¸ä½“éªŒ */
        .floating-qrcode-btn {
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
        }
      }
      </style><script>
      (function() {
        // ç­‰å¾… DOM åŠ è½½å®Œæˆ
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initFloatingQRCode);
        } else {
          initFloatingQRCode();
        }

        function initFloatingQRCode() {
          // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨
          if (document.getElementById('floating-qrcode')) {
            return;
          }

          // åˆ›å»ºæ‚¬æµ®äºŒç»´ç å®¹å™¨
          const container = document.createElement('div');
          container.className = 'floating-qrcode';
          container.id = 'floating-qrcode';

          // åˆ›å»ºé®ç½©å±‚ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰
          const overlay = document.createElement('div');
          overlay.className = 'floating-qrcode-overlay';

          // åˆ›å»ºäºŒç»´ç å¼¹çª—
          const popup = document.createElement('div');
          popup.className = 'floating-qrcode-popup';

          // é¢„è§ˆå¼¹çª—ï¼ˆç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºäºŒç»´ç ï¼‰
          let previewEl = null;

          function showPreview(data) {
            if (!previewEl) {
              previewEl = document.createElement('div');
              previewEl.className = 'floating-qrcode-preview';
              document.body.appendChild(previewEl);
            }
            previewEl.innerHTML =
              '<img src="' + data.imgSrc + '" alt="' + data.title + '">' +
              '<div class="preview-title">' + data.title + '</div>';
          }

          function hidePreview() {
            if (previewEl) previewEl.remove();
            previewEl = null;
          }

          function makeAction(data) {
            const item = document.createElement('div');
            item.className = 'qrcode-item';

            const action = document.createElement('div');
            action.className = 'qrcode-action';
            action.innerHTML =
              '<div class="qrcode-icon">' + data.icon + '</div>' +
              '<div class="qrcode-text">' +
                '<div class="title">' + data.title + '</div>' +
                '<div class="desc">' + data.desc + '</div>' +
              '</div>';

            action.addEventListener('click', function(e) {
              e.stopPropagation();
              showPreview({ title: data.title, imgSrc: data.imgSrc });
            });

            item.appendChild(action);
            return item;
          }

          // èœå•é‡Œæ”¾â€œæŒ‰é’®â€ï¼Œç‚¹å‡»åå†å±•ç¤ºäºŒç»´ç é¢„è§ˆ
          popup.appendChild(makeAction({
            icon: 'å°',
            title: 'å°ç¨‹åº',
            desc: 'ç‚¹å‡»æŸ¥çœ‹äºŒç»´ç ',
            imgSrc: 'https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/202502071711977.png',
          }));

          popup.appendChild(makeAction({
            icon: 'å¾®',
            title: 'å¾®ä¿¡',
            desc: 'ç‚¹å‡»æŸ¥çœ‹äºŒç»´ç ',
            imgSrc: '/img/me-wechat.png',
          }));

          popup.appendChild(makeAction({
            icon: 'å…¬',
            title: 'å…¬ä¼—å·',
            desc: 'ç‚¹å‡»æŸ¥çœ‹äºŒç»´ç ',
            imgSrc: '/img/qrcode_for_gh_e4925da5b058_258.jpg',
          }));

          // åˆ›å»ºæ‚¬æµ®æŒ‰é’®
          const btn = document.createElement('div');
          btn.className = 'floating-qrcode-btn';
          btn.innerHTML = '<span>ğŸ‘†</span>';

          // ç»„è£…å…ƒç´ 
          container.appendChild(overlay);
          container.appendChild(popup);
          container.appendChild(btn);

          function setOpen(open) {
            container.classList.toggle('active', open);
            // å¼¹çª—æ‰“å¼€æ—¶é¿å…é¡µé¢æ»šåŠ¨ï¼ˆç§»åŠ¨ç«¯æ›´é‡è¦ï¼Œæ¡Œé¢ç«¯ä¹Ÿä¸å½±å“ï¼‰
            document.body.style.overflow = open ? 'hidden' : '';
            if (!open) hidePreview();
          }

          function toggleOpen() {
            setOpen(!container.classList.contains('active'));
          }

          // æ‰€æœ‰ç«¯ï¼šç‚¹å‡»æŒ‰é’®æ‰“å¼€/å…³é—­
          btn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleOpen();
          });

          // ç‚¹å‡»å¼¹çª—å†…å®¹åŒºåŸŸä¸å…³é—­
          popup.addEventListener('click', function(e) {
            e.stopPropagation();
          });

          // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹çª—ï¼ˆé®ç½©å±‚ä¸»è¦åœ¨ç§»åŠ¨ç«¯å¯è§ï¼‰
          overlay.addEventListener('click', function() {
            setOpen(false);
          });

          // ç‚¹å‡»é¡µé¢ç©ºç™½åŒºåŸŸå…³é—­ï¼ˆæ¡Œé¢ç«¯ä¹Ÿç”Ÿæ•ˆï¼‰
          document.addEventListener('click', function() {
            setOpen(false);
          });

          // æ·»åŠ åˆ°é¡µé¢
          document.body.appendChild(container);

          // å“åº”çª—å£å¤§å°å˜åŒ–
          let resizeTimer;
          window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
              // å°ºå¯¸å˜åŒ–æ—¶ï¼Œå¦‚æœå¼¹çª—æ˜¯æ‰“å¼€çš„ï¼Œç›´æ¥å…³é—­ï¼Œé¿å…å¸ƒå±€åˆ‡æ¢å¸¦æ¥çš„å®šä½é”™ä¹±
              if (container.classList.contains('active')) setOpen(false);
            }, 250);
          });
        }
      })();
      </script><title>ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ | JavaPub</title><meta name="description" content="ç›¸ä¿¡å¤§å®¶éƒ½ä¼šæœ‰ç§åŠçœ¼ç†Ÿåˆé™Œç”Ÿçš„æ„Ÿè§‰ã€çœ‹è¿‡å¯èƒ½åœ¨çŸ­æš‚çš„é¢è¯•ååˆé©¬ä¸Šå¿˜è®°äº†ã€‚JavaPub åœ¨è¿™é‡Œæ•´ç†è¿™äº›å®¹æ˜“å¿˜è®°çš„é‡ç‚¹çŸ¥è¯†åŠ è§£ç­”ï¼Œå»ºè®®æ”¶è—ï¼Œç»å¸¸æ¸©ä¹ æŸ¥é˜…ã€‚ ç‚¹å‡»åœ¨çº¿é˜…è¯»ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ Your Image Description [toc] ç¼“å­˜ 1. ä»€ä¹ˆæ˜¯ç¼“å­˜ï¼Ÿ ç¼“å­˜ï¼Œå°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒºï¼Œé’ˆå¯¹æœåŠ¡å¯¹è±¡çš„ä¸åŒï¼ˆæœ¬è´¨å°±æ˜¯ä¸åŒçš„ç¡¬ä»¶ï¼‰éƒ½å¯ä»¥æ„å»ºç¼“å­˜...">
    <link rel="preload" href="/assets/style-DZv-2Raw.css" as="style"><link rel="stylesheet" href="/assets/style-DZv-2Raw.css">
    <link rel="modulepreload" href="/assets/app-BqsiRDZw.js"><link rel="modulepreload" href="/assets/ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ.html-BGU2qwLb.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DMP2-L2S.js" as="script"><link rel="prefetch" href="/assets/portfolio.html-D2r8qimC.js" as="script"><link rel="prefetch" href="/assets/Java.html-tH3PJQD0.js" as="script"><link rel="prefetch" href="/assets/index.html-C4mXCt0Q.js" as="script"><link rel="prefetch" href="/assets/æˆé•¿.html-DzNlOQdD.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®åº“.html-DWXyktX8.js" as="script"><link rel="prefetch" href="/assets/index.html-DOnUNzdC.js" as="script"><link rel="prefetch" href="/assets/disable.html-Crt1tITA.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-RQd-jVEd.js" as="script"><link rel="prefetch" href="/assets/layout.html-DAbM3dMQ.js" as="script"><link rel="prefetch" href="/assets/markdown.html-Cz4zuoYa.js" as="script"><link rel="prefetch" href="/assets/page.html-ipxpXjN1.js" as="script"><link rel="prefetch" href="/assets/index.html-c8CjAw09.js" as="script"><link rel="prefetch" href="/assets/index.html-C8OkfbIK.js" as="script"><link rel="prefetch" href="/assets/index.html-CgUf1LDz.js" as="script"><link rel="prefetch" href="/assets/index.html-CoSxR37j.js" as="script"><link rel="prefetch" href="/assets/index.html-CkD2NPxJ.js" as="script"><link rel="prefetch" href="/assets/2025æ¨èä¹¦å•.html-B5DcbagR.js" as="script"><link rel="prefetch" href="/assets/index.html-DaHLJj7y.js" as="script"><link rel="prefetch" href="/assets/baz.html-sDLNyMFw.js" as="script"><link rel="prefetch" href="/assets/index.html-BQDPjdWH.js" as="script"><link rel="prefetch" href="/assets/ray.html-B0k6HHkm.js" as="script"><link rel="prefetch" href="/assets/index.html-CJB0lMnG.js" as="script"><link rel="prefetch" href="/assets/wukong_build_code.html-B7xhCOv-.js" as="script"><link rel="prefetch" href="/assets/index.html-CIRoZhS-.js" as="script"><link rel="prefetch" href="/assets/index.html-BWLcpQI-.js" as="script"><link rel="prefetch" href="/assets/index.html-BmDlrJew.js" as="script"><link rel="prefetch" href="/assets/index.html-7fOS4-n6.js" as="script"><link rel="prefetch" href="/assets/index.html-Cm79f2ZY.js" as="script"><link rel="prefetch" href="/assets/redis_once_bugfix.html-Bu3JzcXu.js" as="script"><link rel="prefetch" href="/assets/index.html-Dtj4t1Z7.js" as="script"><link rel="prefetch" href="/assets/index.html-i0fUxs5H.js" as="script"><link rel="prefetch" href="/assets/singleton.html-5KwfhDFe.js" as="script"><link rel="prefetch" href="/assets/index.html-D2K7V6bK.js" as="script"><link rel="prefetch" href="/assets/http_to_https.html-B6XG8Xga.js" as="script"><link rel="prefetch" href="/assets/index.html-CRAQiJCQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CuTVkg8Q.js" as="script"><link rel="prefetch" href="/assets/shell_command_basic.html-C76BO84H.js" as="script"><link rel="prefetch" href="/assets/shell_command_basic_2.html-jxogZycX.js" as="script"><link rel="prefetch" href="/assets/index.html-IXuFmjUO.js" as="script"><link rel="prefetch" href="/assets/common-problem.html-CAf20ZNd.js" as="script"><link rel="prefetch" href="/assets/operating-guide.html-DlpWzl-f.js" as="script"><link rel="prefetch" href="/assets/index.html-Be6Eyg0_.js" as="script"><link rel="prefetch" href="/assets/network_interview_9.html-CmILM5hR.js" as="script"><link rel="prefetch" href="/assets/index.html-DoteJGNG.js" as="script"><link rel="prefetch" href="/assets/nginx_conf.html-C_2sAJIF.js" as="script"><link rel="prefetch" href="/assets/nginx_tcp.html-Fr-bzDp1.js" as="script"><link rel="prefetch" href="/assets/prometheus_grafana_install.html-OoVxeXEZ.js" as="script"><link rel="prefetch" href="/assets/index.html-Dsz1BBui.js" as="script"><link rel="prefetch" href="/assets/drawio_ai.html-D-7M91AS.js" as="script"><link rel="prefetch" href="/assets/etcd.html-Cdfhg_1L.js" as="script"><link rel="prefetch" href="/assets/ffmpeg_learn.html-DvW14DHI.js" as="script"><link rel="prefetch" href="/assets/rocketmq_intro.html-Dsp53JyU.js" as="script"><link rel="prefetch" href="/assets/zookeeper_learn.html-CzZ2ODFt.js" as="script"><link rel="prefetch" href="/assets/index.html-D_lT0_3G.js" as="script"><link rel="prefetch" href="/assets/index.html-Xump7ngY.js" as="script"><link rel="prefetch" href="/assets/clear_if_else.html-DHD7NkhC.js" as="script"><link rel="prefetch" href="/assets/interface_design_11.html-Cp6b-O2M.js" as="script"><link rel="prefetch" href="/assets/log_11_suggest.html-DHBVrvkW.js" as="script"><link rel="prefetch" href="/assets/index.html-BwYnPjao.js" as="script"><link rel="prefetch" href="/assets/index.html-BzCja2zI.js" as="script"><link rel="prefetch" href="/assets/index.html-BWdCOWCj.js" as="script"><link rel="prefetch" href="/assets/index.html-D7Njj8ZL.js" as="script"><link rel="prefetch" href="/assets/cloud_server.html-CUbHZv1X.js" as="script"><link rel="prefetch" href="/assets/index.html-cxAcveDx.js" as="script"><link rel="prefetch" href="/assets/resource-get.html-BEP0xqE9.js" as="script"><link rel="prefetch" href="/assets/star-introduce.html-Dyd2tdc-.js" as="script"><link rel="prefetch" href="/assets/index.html-DHdHAG1m.js" as="script"><link rel="prefetch" href="/assets/connection.html-CmjPX27_.js" as="script"><link rel="prefetch" href="/assets/introduce.html-CdhV35K1.js" as="script"><link rel="prefetch" href="/assets/portfolio.html-e2iD_zrD.js" as="script"><link rel="prefetch" href="/assets/2024.html-SpmpkUpi.js" as="script"><link rel="prefetch" href="/assets/index.html-BYZNBhJQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CPc2oZLS.js" as="script"><link rel="prefetch" href="/assets/website-record.html-BZc5v2bW.js" as="script"><link rel="prefetch" href="/assets/index.html-CVIznZP3.js" as="script"><link rel="prefetch" href="/assets/openclaw-Clawbotæ•™ç¨‹.html-BbQgiIIC.js" as="script"><link rel="prefetch" href="/assets/index.html-DztRpr6S.js" as="script"><link rel="prefetch" href="/assets/deepseek.html-BC5wTnqS.js" as="script"><link rel="prefetch" href="/assets/deepseek_to_idea.html-CSBLUHto.js" as="script"><link rel="prefetch" href="/assets/index.html-B_9wqHGw.js" as="script"><link rel="prefetch" href="/assets/gemini_vscode.html-DvlISRCK.js" as="script"><link rel="prefetch" href="/assets/index.html-D4RYPsdO.js" as="script"><link rel="prefetch" href="/assets/langchain.html-BvP1eWAm.js" as="script"><link rel="prefetch" href="/assets/index.html-CGagzDTP.js" as="script"><link rel="prefetch" href="/assets/lm_studio.html-CT8rEXFH.js" as="script"><link rel="prefetch" href="/assets/index.html-CjY9uhXU.js" as="script"><link rel="prefetch" href="/assets/ollama.html-kM74oqcf.js" as="script"><link rel="prefetch" href="/assets/ollama_deepseek_mac.html-D6-ZvvEl.js" as="script"><link rel="prefetch" href="/assets/ollama_deepseek_windows.html-DTKeUne3.js" as="script"><link rel="prefetch" href="/assets/ollama_download.html-DH-ESpA_.js" as="script"><link rel="prefetch" href="/assets/index.html-MMSedWTM.js" as="script"><link rel="prefetch" href="/assets/cas.html-BsVq4mFm.js" as="script"><link rel="prefetch" href="/assets/math_problem.html-CZ1BdTm2.js" as="script"><link rel="prefetch" href="/assets/raft.html-HKF-mDLM.js" as="script"><link rel="prefetch" href="/assets/index.html-CRREpERh.js" as="script"><link rel="prefetch" href="/assets/bVSb_.html-D51MT7KF.js" as="script"><link rel="prefetch" href="/assets/basics_data_structure.html-Bme-hk3a.js" as="script"><link rel="prefetch" href="/assets/bloom_filter.html-CTHS73-T.js" as="script"><link rel="prefetch" href="/assets/bucket_sort.html-ohx5Q8ih.js" as="script"><link rel="prefetch" href="/assets/counting_sort.html-Brc-LPdI.js" as="script"><link rel="prefetch" href="/assets/heapsort.html-C7MDY3j-.js" as="script"><link rel="prefetch" href="/assets/radix_sorting.html-ivzFkZMD.js" as="script"><link rel="prefetch" href="/assets/snowflake_id.html-BKr9thRu.js" as="script"><link rel="prefetch" href="/assets/index.html-Ch2ZxHKE.js" as="script"><link rel="prefetch" href="/assets/Springboot_ElasticSearch_0.html-uEPlYolv.js" as="script"><link rel="prefetch" href="/assets/Springboot_ElasticSearch_1.html-CRbKApBQ.js" as="script"><link rel="prefetch" href="/assets/Springboot_ElasticSearch_2.html-R9cmB7WI.js" as="script"><link rel="prefetch" href="/assets/Springboot_ElasticSearch_3.html-Bmu1kkM_.js" as="script"><link rel="prefetch" href="/assets/Springboot_ElasticSearch_4.html-61eJyWx-.js" as="script"><link rel="prefetch" href="/assets/index.html-Ces6L9om.js" as="script"><link rel="prefetch" href="/assets/air_drop_contract.html-U9vLieNH.js" as="script"><link rel="prefetch" href="/assets/index.html-BZ5ReaSa.js" as="script"><link rel="prefetch" href="/assets/telegram_bot_auto_response.html-D3UxZaUR.js" as="script"><link rel="prefetch" href="/assets/index.html-DonowyFh.js" as="script"><link rel="prefetch" href="/assets/hbase_intro.html-CnsS7ZOJ.js" as="script"><link rel="prefetch" href="/assets/index.html-B3cK7Ykh.js" as="script"><link rel="prefetch" href="/assets/mysql_index_18_topic.html-DN9GKqfo.js" as="script"><link rel="prefetch" href="/assets/sharding.html-BTZ_IlNs.js" as="script"><link rel="prefetch" href="/assets/slow_sql_23.html-CfElrb_-.js" as="script"><link rel="prefetch" href="/assets/sql_lock_13_topic.html-BFwtfdRw.js" as="script"><link rel="prefetch" href="/assets/transaction_level.html-CN4cVP5U.js" as="script"><link rel="prefetch" href="/assets/index.html-qzrP4Zya.js" as="script"><link rel="prefetch" href="/assets/learn_redis_01.html-DHHbpUuK.js" as="script"><link rel="prefetch" href="/assets/learn_redis_02.html-CYZFSB23.js" as="script"><link rel="prefetch" href="/assets/learn_redis_03.html-DluUooj_.js" as="script"><link rel="prefetch" href="/assets/redis_apply_15_topic.html-bUdEJDa-.js" as="script"><link rel="prefetch" href="/assets/redis_basic_data_type.html-BasccN4D.js" as="script"><link rel="prefetch" href="/assets/redis_distributed_lock.html-B5NZMlxe.js" as="script"><link rel="prefetch" href="/assets/redis_install_to_linux.html-BxavM7T9.js" as="script"><link rel="prefetch" href="/assets/index.html-GHu8VrUH.js" as="script"><link rel="prefetch" href="/assets/annotation_aop_log.html-MLHscYNw.js" as="script"><link rel="prefetch" href="/assets/volatile.html-B9X4G4wA.js" as="script"><link rel="prefetch" href="/assets/index.html-DkQM2dr1.js" as="script"><link rel="prefetch" href="/assets/maven_learn.html-Df6c9zVJ.js" as="script"><link rel="prefetch" href="/assets/index.html-AopFg_BE.js" as="script"><link rel="prefetch" href="/assets/mybatis_batch_update.html-AfGKNDyS.js" as="script"><link rel="prefetch" href="/assets/mybatis_learn.html-B9thnfji.js" as="script"><link rel="prefetch" href="/assets/index.html-BxbMT6Rc.js" as="script"><link rel="prefetch" href="/assets/ssm_helloworld.html-CVLAvZ-f.js" as="script"><link rel="prefetch" href="/assets/index.html-Bgrad7ca.js" as="script"><link rel="prefetch" href="/assets/create_springboot_3.html-CoasLnvP.js" as="script"><link rel="prefetch" href="/assets/pomxml_basic.html-C1APerYC.js" as="script"><link rel="prefetch" href="/assets/springboot_docker_start.html-BjV2LqFz.js" as="script"><link rel="prefetch" href="/assets/springboot_flowable.html-CyTVJINK.js" as="script"><link rel="prefetch" href="/assets/springboot_generate_qr_code.html-DwS70eMR.js" as="script"><link rel="prefetch" href="/assets/springboot_prometheus_grafana.html-GnfKlxSF.js" as="script"><link rel="prefetch" href="/assets/index.html-CrgbQcJE.js" as="script"><link rel="prefetch" href="/assets/beego_learn.html-_hhUIMyR.js" as="script"><link rel="prefetch" href="/assets/echo_learn.html-Z1TyUQq4.js" as="script"><link rel="prefetch" href="/assets/index.html-R13_v7-2.js" as="script"><link rel="prefetch" href="/assets/python_cv2_install.html-sZ34HSBf.js" as="script"><link rel="prefetch" href="/assets/index.html-C7h6-r9E.js" as="script"><link rel="prefetch" href="/assets/rust_learn.html-B8mEsm_D.js" as="script"><link rel="prefetch" href="/assets/index.html-f1qQIrm2.js" as="script"><link rel="prefetch" href="/assets/build_website.html-BTs3Ksf0.js" as="script"><link rel="prefetch" href="/assets/git_command.html-b4d0df50.js" as="script"><link rel="prefetch" href="/assets/0.kaipian.html-BN4E0q9g.js" as="script"><link rel="prefetch" href="/assets/1.hashmap.html-CxYEcUpc.js" as="script"><link rel="prefetch" href="/assets/10.volatile.html-BST6yr26.js" as="script"><link rel="prefetch" href="/assets/11.xianchengchi.html-Du6QBpwN.js" as="script"><link rel="prefetch" href="/assets/12.ThreadLocal.html-CmcYlBt9.js" as="script"><link rel="prefetch" href="/assets/13.JVM_neicunmoxing.html-DysN1puC.js" as="script"><link rel="prefetch" href="/assets/14.CountDownLatch_CyclicBarrier.html-F992i7Ib.js" as="script"><link rel="prefetch" href="/assets/15.leijiazaiguocheng.html-Cmk_vqVG.js" as="script"><link rel="prefetch" href="/assets/16.lajihuishoujizhi.html-C44b8lSn.js" as="script"><link rel="prefetch" href="/assets/17.CMS_lajihuishouqi.html-DOvWgg8e.js" as="script"><link rel="prefetch" href="/assets/18.G1_lajihuishouqi.html-Dohqmrel.js" as="script"><link rel="prefetch" href="/assets/19.JVM_tiaoyou.html-D_wSCbnu.js" as="script"><link rel="prefetch" href="/assets/2.java_zhujie.html-DfdzOW7V.js" as="script"><link rel="prefetch" href="/assets/20.List.html-cgvf8EW6.js" as="script"><link rel="prefetch" href="/assets/21.Map.html-CUDHfh2I.js" as="script"><link rel="prefetch" href="/assets/22.Spring_jichu.html-CmsCOSHu.js" as="script"><link rel="prefetch" href="/assets/23.SpringBean_shengmingzhouqi.html-Cji71RDM.js" as="script"><link rel="prefetch" href="/assets/24.Spring_xunhuanyilai.html-D3K85XEY.js" as="script"><link rel="prefetch" href="/assets/25.SpringMVC.html-1bcYIXBb.js" as="script"><link rel="prefetch" href="/assets/26.MyBatis.html-BPUXmo5z.js" as="script"><link rel="prefetch" href="/assets/27.Redis_jichu.html-BhSiMXxR.js" as="script"><link rel="prefetch" href="/assets/28.Redis_chijiuhua.html-DHbBCsoa.js" as="script"><link rel="prefetch" href="/assets/29.Redis_zhucongjiagou.html-CWtByvzp.js" as="script"><link rel="prefetch" href="/assets/3.java_fanxing.html-D74Ug30_.js" as="script"><link rel="prefetch" href="/assets/30.Redis_fenpianjiqun.html-Dhhk1FWx.js" as="script"><link rel="prefetch" href="/assets/31.Redis_fenbushisuo.html-BzWIr7KG.js" as="script"><link rel="prefetch" href="/assets/32.Redis_neicunyouhua.html-bgnV3WAk.js" as="script"><link rel="prefetch" href="/assets/33.Kafka_jichu.html-oJjWOXpi.js" as="script"><link rel="prefetch" href="/assets/34.Kafka_shiyongchangjing.html-BfjqGr8c.js" as="script"><link rel="prefetch" href="/assets/35.Kafka_youquedian.html-DJyCEfWM.js" as="script"><link rel="prefetch" href="/assets/36.Kafka_xingnengyoushi.html-zuFZeddE.js" as="script"><link rel="prefetch" href="/assets/37.ruhetigaotuntuliang.html-BeamaCzf.js" as="script"><link rel="prefetch" href="/assets/38.kafka_huodezhunquexinxi.html-BYX_tEPv.js" as="script"><link rel="prefetch" href="/assets/39.Kafka_jiagousheji.html-DechnUbA.js" as="script"><link rel="prefetch" href="/assets/4.java_duoxiancheng.html-C-bn_hSu.js" as="script"><link rel="prefetch" href="/assets/40.Kafka_caiyongpush_or_pull.html-ZLuwG571.js" as="script"><link rel="prefetch" href="/assets/41.Kafka_chuantongxiaoxiqubie.html-DP_SKGiU.js" as="script"><link rel="prefetch" href="/assets/42.Kafka_ack_jizhi.html-BNxbYyOB.js" as="script"><link rel="prefetch" href="/assets/43.Kafka_midengxing.html-CeI79Fnq.js" as="script"><link rel="prefetch" href="/assets/44.ElasticSearch_jichu.html-Ba5Ev4E8.js" as="script"><link rel="prefetch" href="/assets/45.ElasticSearch_lucene.html-DuSUEcG2.js" as="script"><link rel="prefetch" href="/assets/46.ElasticSearch_jiagousheji.html-CRkjOvqp.js" as="script"><link rel="prefetch" href="/assets/47.ElasticSearch_jiqunsuoyinfenpian.html-Ctp1x188.js" as="script"><link rel="prefetch" href="/assets/48.ElasticSearch_daopaisuoyin.html-Dfb1hxQl.js" as="script"><link rel="prefetch" href="/assets/49.ElasticSearch_xuanzhu.html-whQi-dgu.js" as="script"><link rel="prefetch" href="/assets/5.java_fanshe.html-Db-Wrlje.js" as="script"><link rel="prefetch" href="/assets/50.ElasticSearch_suoyinwendangguocheng.html-CXieOFKQ.js" as="script"><link rel="prefetch" href="/assets/51.ElasticSearch_suoyinwendangguocheng.html-CNVisVOi.js" as="script"><link rel="prefetch" href="/assets/6.dongtaidaili.html-BW0hjijv.js" as="script"><link rel="prefetch" href="/assets/7.CAS.html-Dzn9kYJi.js" as="script"><link rel="prefetch" href="/assets/8.java_NIO.html-CahPsIgf.js" as="script"><link rel="prefetch" href="/assets/9.synchronized.html-Bixvtea6.js" as="script"><link rel="prefetch" href="/assets/index.html-zUVEF7SF.js" as="script"><link rel="prefetch" href="/assets/0-http-interview-must.html-CwqOFbdy.js" as="script"><link rel="prefetch" href="/assets/0-netty-interview-must.html-DL5P-bA8.js" as="script"><link rel="prefetch" href="/assets/index.html-Cnuwf3XI.js" as="script"><link rel="prefetch" href="/assets/cache-interview-must.html-Dy29XNDX.js" as="script"><link rel="prefetch" href="/assets/docker-interview-must.html-XzF4I-cM.js" as="script"><link rel="prefetch" href="/assets/elasticsearch-interview-must.html-D1-m3SCR.js" as="script"><link rel="prefetch" href="/assets/java-basics-interview-must.html-B8TBCYDJ.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-interview-must.html-7PNgrSkd.js" as="script"><link rel="prefetch" href="/assets/java-container-interview-must.html-sLanP-zl.js" as="script"><link rel="prefetch" href="/assets/javaee-interview-must.html-tOPAulY0.js" as="script"><link rel="prefetch" href="/assets/jvm-interview-must.html-Bgzkab0d.js" as="script"><link rel="prefetch" href="/assets/kafka-interview-must.html-CPxg-upr.js" as="script"><link rel="prefetch" href="/assets/mybatis-interview-must.html-C-Fh3p2w.js" as="script"><link rel="prefetch" href="/assets/mysql-interview-must.html-CbZmcD9c.js" as="script"><link rel="prefetch" href="/assets/redis-interview-must.html-Cb8z48gm.js" as="script"><link rel="prefetch" href="/assets/spring-interview-must.html-O0W542yx.js" as="script"><link rel="prefetch" href="/assets/springboot-interview-must.html-ClYvXVQo.js" as="script"><link rel="prefetch" href="/assets/zookeeper-interview-must.html-BK3aCSHs.js" as="script"><link rel="prefetch" href="/assets/2025_go_interview.html-D6DuSh3r.js" as="script"><link rel="prefetch" href="/assets/index.html-DPBKfreE.js" as="script"><link rel="prefetch" href="/assets/index.html-So9exPzn.js" as="script"><link rel="prefetch" href="/assets/drissionPage.html-ck77yURK.js" as="script"><link rel="prefetch" href="/assets/index.html-C4--RLEU.js" as="script"><link rel="prefetch" href="/assets/docs.html-CZ7j8gkQ.js" as="script"><link rel="prefetch" href="/assets/index.html-C8LLWgjJ.js" as="script"><link rel="prefetch" href="/assets/api_return_value.html-DR31-6V0.js" as="script"><link rel="prefetch" href="/assets/docs.html-DCSSVSaY.js" as="script"><link rel="prefetch" href="/assets/requirement-analysis.html-ByRfb9QJ.js" as="script"><link rel="prefetch" href="/assets/springboot_mybatis_plus.html-DzXMYp38.js" as="script"><link rel="prefetch" href="/assets/springboot_to_docker.html-CMLBl6QS.js" as="script"><link rel="prefetch" href="/assets/springboot_to_jar.html-EDc8ofN0.js" as="script"><link rel="prefetch" href="/assets/404.html-Ct_O9Png.js" as="script"><link rel="prefetch" href="/assets/index.html-BAmRZMuP.js" as="script"><link rel="prefetch" href="/assets/index.html-BSfe2bFW.js" as="script"><link rel="prefetch" href="/assets/index.html-BPY3C7vK.js" as="script"><link rel="prefetch" href="/assets/index.html-Dtac_sll.js" as="script"><link rel="prefetch" href="/assets/index.html-B1d1_c4Q.js" as="script"><link rel="prefetch" href="/assets/index.html-BOiJm1wJ.js" as="script"><link rel="prefetch" href="/assets/index.html-WshUduwI.js" as="script"><link rel="prefetch" href="/assets/index.html-BqC2jwfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-CcWZ2_E9.js" as="script"><link rel="prefetch" href="/assets/index.html--IbwCZtP.js" as="script"><link rel="prefetch" href="/assets/index.html-CUyKs3fa.js" as="script"><link rel="prefetch" href="/assets/index.html-Tc1HvUTQ.js" as="script"><link rel="prefetch" href="/assets/index.html-mfMlSEER.js" as="script"><link rel="prefetch" href="/assets/index.html-tUIweqb5.js" as="script"><link rel="prefetch" href="/assets/index.html-eCcPhRz3.js" as="script"><link rel="prefetch" href="/assets/index.html-C4l8cqTz.js" as="script"><link rel="prefetch" href="/assets/index.html-DGUQChBZ.js" as="script"><link rel="prefetch" href="/assets/index.html-u6tznBNu.js" as="script"><link rel="prefetch" href="/assets/index.html-DuElHVvt.js" as="script"><link rel="prefetch" href="/assets/index.html-Dbj7uH9X.js" as="script"><link rel="prefetch" href="/assets/index.html-qNM4Nl0b.js" as="script"><link rel="prefetch" href="/assets/index.html-Db2Ld7KM.js" as="script"><link rel="prefetch" href="/assets/index.html-DtCWYfBf.js" as="script"><link rel="prefetch" href="/assets/index.html-Dc8Ctobw.js" as="script"><link rel="prefetch" href="/assets/index.html-ChsHzsqP.js" as="script"><link rel="prefetch" href="/assets/index.html-Dr_3YYij.js" as="script"><link rel="prefetch" href="/assets/index.html-DsjO2KOe.js" as="script"><link rel="prefetch" href="/assets/index.html-C2IYMhN2.js" as="script"><link rel="prefetch" href="/assets/index.html-B_wPjbKg.js" as="script"><link rel="prefetch" href="/assets/index.html-CYcDHF9F.js" as="script"><link rel="prefetch" href="/assets/index.html-DOlb_cgK.js" as="script"><link rel="prefetch" href="/assets/index.html-C6mrgodp.js" as="script"><link rel="prefetch" href="/assets/index.html-DEofjeVT.js" as="script"><link rel="prefetch" href="/assets/index.html-MkhMM6Q_.js" as="script"><link rel="prefetch" href="/assets/index.html-4oP6UBDk.js" as="script"><link rel="prefetch" href="/assets/index.html-C2cF7Omk.js" as="script"><link rel="prefetch" href="/assets/index.html-MWahns0s.js" as="script"><link rel="prefetch" href="/assets/index.html-dn2s3BIr.js" as="script"><link rel="prefetch" href="/assets/index.html-DfPo3Poq.js" as="script"><link rel="prefetch" href="/assets/index.html-B98fVcRN.js" as="script"><link rel="prefetch" href="/assets/index.html-DYt-bVUS.js" as="script"><link rel="prefetch" href="/assets/index.html-CNixLYCb.js" as="script"><link rel="prefetch" href="/assets/index.html-D8953_yK.js" as="script"><link rel="prefetch" href="/assets/index.html-8SQ-RHRO.js" as="script"><link rel="prefetch" href="/assets/index.html-C43faFIE.js" as="script"><link rel="prefetch" href="/assets/index.html-8WD3fy0a.js" as="script"><link rel="prefetch" href="/assets/index.html-pN6uSTEx.js" as="script"><link rel="prefetch" href="/assets/index.html-D99S9TE_.js" as="script"><link rel="prefetch" href="/assets/index.html-CyjFkpbQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DUERhJ89.js" as="script"><link rel="prefetch" href="/assets/index.html-D2eVewmp.js" as="script"><link rel="prefetch" href="/assets/index.html-D8UmtgUs.js" as="script"><link rel="prefetch" href="/assets/index.html-yTm2I8Hc.js" as="script"><link rel="prefetch" href="/assets/index.html-D9iIH11l.js" as="script"><link rel="prefetch" href="/assets/index.html-BIhSA9co.js" as="script"><link rel="prefetch" href="/assets/index.html-BqAWqpPi.js" as="script"><link rel="prefetch" href="/assets/index.html-U0ZSSbI_.js" as="script"><link rel="prefetch" href="/assets/index.html-bGo3gBGU.js" as="script"><link rel="prefetch" href="/assets/index.html-C9qyr9-x.js" as="script"><link rel="prefetch" href="/assets/index.html-DV6VpYGA.js" as="script"><link rel="prefetch" href="/assets/index.html-Bf3COgPQ.js" as="script"><link rel="prefetch" href="/assets/index.html-dXxUY104.js" as="script"><link rel="prefetch" href="/assets/index.html-DdBFmQxE.js" as="script"><link rel="prefetch" href="/assets/index.html-C1XKlzMm.js" as="script"><link rel="prefetch" href="/assets/index.html-CiTxJTmr.js" as="script"><link rel="prefetch" href="/assets/index.html-CoOXSmjE.js" as="script"><link rel="prefetch" href="/assets/index.html-m3Drbhu5.js" as="script"><link rel="prefetch" href="/assets/index.html-wAHDxUPu.js" as="script"><link rel="prefetch" href="/assets/index.html-3LPu_-oN.js" as="script"><link rel="prefetch" href="/assets/index.html-DFJTGmqJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DFJTGmqJ.js" as="script"><link rel="prefetch" href="/assets/index.html-CJ0GwYZF.js" as="script"><link rel="prefetch" href="/assets/index.html-C6uZjXKM.js" as="script"><link rel="prefetch" href="/assets/index.html-CJ0GwYZF.js" as="script"><link rel="prefetch" href="/assets/index.html-CUJYywgx.js" as="script"><link rel="prefetch" href="/assets/index.html-Dbzu9k0Z.js" as="script"><link rel="prefetch" href="/assets/index.html-lvlQkuS8.js" as="script"><link rel="prefetch" href="/assets/index.html-Bna4HycN.js" as="script"><link rel="prefetch" href="/assets/index.html-CIVLvPWt.js" as="script"><link rel="prefetch" href="/assets/index.html-Ba1z74Uh.js" as="script"><link rel="prefetch" href="/assets/index.html-BnIBkkN1.js" as="script"><link rel="prefetch" href="/assets/index.html-qIG9cPkJ.js" as="script"><link rel="prefetch" href="/assets/index.html--jN5lyKX.js" as="script"><link rel="prefetch" href="/assets/index.html-CXuX9ikB.js" as="script"><link rel="prefetch" href="/assets/index.html-C54sh1UX.js" as="script"><link rel="prefetch" href="/assets/index.html-9MsNz8Dg.js" as="script"><link rel="prefetch" href="/assets/index.html-Die9ucU6.js" as="script"><link rel="prefetch" href="/assets/index.html-DCvusH6f.js" as="script"><link rel="prefetch" href="/assets/index.html-BbtL-E9_.js" as="script"><link rel="prefetch" href="/assets/index.html-D-AWBHLe.js" as="script"><link rel="prefetch" href="/assets/index.html-BhPXvtuL.js" as="script"><link rel="prefetch" href="/assets/index.html-AlPnGzAB.js" as="script"><link rel="prefetch" href="/assets/index.html-74NQfAKi.js" as="script"><link rel="prefetch" href="/assets/index.html-BmUvmC8S.js" as="script"><link rel="prefetch" href="/assets/index.html-CHR-0JMb.js" as="script"><link rel="prefetch" href="/assets/index.html-CovL1pl3.js" as="script"><link rel="prefetch" href="/assets/index.html-CNFwdItv.js" as="script"><link rel="prefetch" href="/assets/index.html-r1akz42v.js" as="script"><link rel="prefetch" href="/assets/index.html-JKEJR8kD.js" as="script"><link rel="prefetch" href="/assets/index.html-De06lHcf.js" as="script"><link rel="prefetch" href="/assets/index.html-Dlm_v0jg.js" as="script"><link rel="prefetch" href="/assets/index.html-DqpmDM6w.js" as="script"><link rel="prefetch" href="/assets/index.html-D3da5EjW.js" as="script"><link rel="prefetch" href="/assets/index.html-CtzP66LV.js" as="script"><link rel="prefetch" href="/assets/index.html-7NeMSBw6.js" as="script"><link rel="prefetch" href="/assets/index.html-CNoSxIHD.js" as="script"><link rel="prefetch" href="/assets/index.html-CFlDJykw.js" as="script"><link rel="prefetch" href="/assets/index.html-CV0fwxu0.js" as="script"><link rel="prefetch" href="/assets/index.html-NyPIWdJC.js" as="script"><link rel="prefetch" href="/assets/index.html-o587jufB.js" as="script"><link rel="prefetch" href="/assets/index.html-04TrGA-b.js" as="script"><link rel="prefetch" href="/assets/index.html-DpCZ74QJ.js" as="script"><link rel="prefetch" href="/assets/index.html-B-Upx8jz.js" as="script"><link rel="prefetch" href="/assets/index.html-DAjTpa5R.js" as="script"><link rel="prefetch" href="/assets/index.html-VY-ARJBS.js" as="script"><link rel="prefetch" href="/assets/index.html-Du8NKP1M.js" as="script"><link rel="prefetch" href="/assets/index.html-DfQKLTSn.js" as="script"><link rel="prefetch" href="/assets/index.html-CcLBPKmP.js" as="script"><link rel="prefetch" href="/assets/index.html-CQvymtmN.js" as="script"><link rel="prefetch" href="/assets/index.html-BhGDWHYp.js" as="script"><link rel="prefetch" href="/assets/index.html-ChF_Xniz.js" as="script"><link rel="prefetch" href="/assets/index.html-Dw2KvKoM.js" as="script"><link rel="prefetch" href="/assets/index.html-BCnbMwxQ.js" as="script"><link rel="prefetch" href="/assets/index.html-ODU_DsyV.js" as="script"><link rel="prefetch" href="/assets/index.html-DZ32xZGV.js" as="script"><link rel="prefetch" href="/assets/index.html-BwIAefpm.js" as="script"><link rel="prefetch" href="/assets/index.html-BUFpnQO9.js" as="script"><link rel="prefetch" href="/assets/index.html-B8SY_vNB.js" as="script"><link rel="prefetch" href="/assets/index.html-CzoOVL4Q.js" as="script"><link rel="prefetch" href="/assets/index.html-BttVEWaG.js" as="script"><link rel="prefetch" href="/assets/index.html-DNknZOWq.js" as="script"><link rel="prefetch" href="/assets/index.html-M2mL6xeq.js" as="script"><link rel="prefetch" href="/assets/index.html-BpuuxFFk.js" as="script"><link rel="prefetch" href="/assets/index.html-z30Q8AN4.js" as="script"><link rel="prefetch" href="/assets/index.html-COIJU1ig.js" as="script"><link rel="prefetch" href="/assets/index.html-BXaCvCtn.js" as="script"><link rel="prefetch" href="/assets/index.html-CKPxZUS8.js" as="script"><link rel="prefetch" href="/assets/index.html-C48DL-Bq.js" as="script"><link rel="prefetch" href="/assets/index.html-CCt-5xMO.js" as="script"><link rel="prefetch" href="/assets/index.html-VAd8niV-.js" as="script"><link rel="prefetch" href="/assets/index.html-B66SA0Ee.js" as="script"><link rel="prefetch" href="/assets/index.html-4nEEzGwg.js" as="script"><link rel="prefetch" href="/assets/index.html-tOLUPh90.js" as="script"><link rel="prefetch" href="/assets/index.html-DOu7MRMw.js" as="script"><link rel="prefetch" href="/assets/index.html-CrxDXJle.js" as="script"><link rel="prefetch" href="/assets/index.html-B5hG0dwe.js" as="script"><link rel="prefetch" href="/assets/index.html-tKVS5pV0.js" as="script"><link rel="prefetch" href="/assets/index.html-BGekLF0L.js" as="script"><link rel="prefetch" href="/assets/index.html-Y_3Rw43Y.js" as="script"><link rel="prefetch" href="/assets/index.html-CXCW3PWt.js" as="script"><link rel="prefetch" href="/assets/index.html-DEsc8M5O.js" as="script"><link rel="prefetch" href="/assets/index.html-DhIC04BT.js" as="script"><link rel="prefetch" href="/assets/index.html-KO0Bfnbw.js" as="script"><link rel="prefetch" href="/assets/index.html-BLIdXs87.js" as="script"><link rel="prefetch" href="/assets/index.html-C_JQ2xAr.js" as="script"><link rel="prefetch" href="/assets/index.html-fFuspOGs.js" as="script"><link rel="prefetch" href="/assets/index.html-6bzt5iKI.js" as="script"><link rel="prefetch" href="/assets/index.html-BqIIDUUt.js" as="script"><link rel="prefetch" href="/assets/index.html-bU5PUMNk.js" as="script"><link rel="prefetch" href="/assets/index.html-C4Bjiw8K.js" as="script"><link rel="prefetch" href="/assets/index.html-BTOlDlJ2.js" as="script"><link rel="prefetch" href="/assets/index.html-6lifpQpn.js" as="script"><link rel="prefetch" href="/assets/index.html-2Mgkn3ae.js" as="script"><link rel="prefetch" href="/assets/index.html-C2yFoNz7.js" as="script"><link rel="prefetch" href="/assets/index.html-DSzFdIWg.js" as="script"><link rel="prefetch" href="/assets/index.html-CQGtf-Cs.js" as="script"><link rel="prefetch" href="/assets/index.html-Cg-aDCK7.js" as="script"><link rel="prefetch" href="/assets/index.html-CViqbH8H.js" as="script"><link rel="prefetch" href="/assets/index.html-BFwH6EBO.js" as="script"><link rel="prefetch" href="/assets/index.html-Zm4EfX2e.js" as="script"><link rel="prefetch" href="/assets/index.html-DHlFeDnG.js" as="script"><link rel="prefetch" href="/assets/index.html-DM7zChGh.js" as="script"><link rel="prefetch" href="/assets/index.html-D2zXakFC.js" as="script"><link rel="prefetch" href="/assets/index.html-DZAYeFKO.js" as="script"><link rel="prefetch" href="/assets/index.html-ChuTM0NM.js" as="script"><link rel="prefetch" href="/assets/index.html-CR515wBl.js" as="script"><link rel="prefetch" href="/assets/index.html-b7nxhLs3.js" as="script"><link rel="prefetch" href="/assets/index.html-DuoVoi8d.js" as="script"><link rel="prefetch" href="/assets/index.html-xt3DqQQh.js" as="script"><link rel="prefetch" href="/assets/index.html-CKPxZUS8.js" as="script"><link rel="prefetch" href="/assets/index.html-B4J3oZIA.js" as="script"><link rel="prefetch" href="/assets/index.html-DThbthXh.js" as="script"><link rel="prefetch" href="/assets/index.html-CwB02srl.js" as="script"><link rel="prefetch" href="/assets/index.html-DodTqSQd.js" as="script"><link rel="prefetch" href="/assets/index.html-DgnHg1Ua.js" as="script"><link rel="prefetch" href="/assets/index.html-CoSxR37j.js" as="script"><link rel="prefetch" href="/assets/giscus--_FS5kYt.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/SearchResult-g8dGmuvr.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/202406041727899.png" alt><!----><span class="vp-site-name hide-in-pad">JavaPub</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç¼–ç¨‹æŒ‡å—"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>ç¼–ç¨‹æŒ‡å—<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å¿…çœ‹</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/must-see/operating-guide.html" aria-label="ä½¿ç”¨æŒ‡å—"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->ä½¿ç”¨æŒ‡å—<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/must-see/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">é¢è¯•ä¸“é¢˜åˆé›†</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/posts/special/" aria-label="é¢è¯•ä¸“é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->é¢è¯•ä¸“é¢˜<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/posts/special/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/book/" aria-label="æŠ€æœ¯ä¹¦ç±"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->æŠ€æœ¯ä¹¦ç±<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="çŸ¥è¯†æ˜Ÿçƒ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-globe" style=""></span>çŸ¥è¯†æ˜Ÿçƒ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">é¡¹ç›®å®æˆ˜</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/star/project/" aria-label="å®æˆ˜é¡¹ç›®ç»„"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->å®æˆ˜é¡¹ç›®ç»„<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/star/project/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ˜Ÿçƒä»‹ç»</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/star/star-introduce/star-introduce.html" aria-label="æ˜Ÿçƒä»‹ç»"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span><!--]-->æ˜Ÿçƒä»‹ç»<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/star/star-introduce/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç½‘ç«™ä¿¡æ¯"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-message" style=""></span>ç½‘ç«™ä¿¡æ¯<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å…³äºä½œè€…</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/system/about-me/introduce.html" aria-label="ä½œè€…ä¿¡æ¯"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span><!--]-->ä½œè€…ä¿¡æ¯<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/system/about-me/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ›´æ–°å†å²</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/system/website-record/website-record.html" aria-label="ç½‘ç«™æ›´æ–°æ—¶é—´çº¿"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span><!--]-->ç½‘ç«™æ›´æ–°æ—¶é—´çº¿<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/system/website-record/" aria-label="..."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-ellipsis" style=""></span><!--]-->...<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/timeline/" aria-label="æ›´æ–°å†å²"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-history" style=""></span><!--]-->æ›´æ–°å†å²<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://code-route-h3xxxsggd-roderts-projects.vercel.app" aria-label="å­¦ä¹ è·¯çº¿å›¾" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-route" style=""></span><!--]-->å­¦ä¹ è·¯çº¿å›¾<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/Rodert/JavaPub" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/" aria-label="ç¼–ç¨‹æŒ‡å—"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->ç¼–ç¨‹æŒ‡å—<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">Bugä¿®å¤æ‰‹å†Œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-http" style=""></span><span class="vp-sidebar-title">http</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-java" style=""></span><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-linux" style=""></span><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">äººå·¥æ™ºèƒ½</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">å…¶ä»–</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">å…¶ä»–ç¼–ç¨‹è¯­è¨€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">åŒºå—é“¾</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">å¤§æ•°æ®</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span><span class="vp-sidebar-title">å¿…çœ‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span><span class="vp-sidebar-title">æ•°æ®åº“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">çˆ¬è™«</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">ç®—æ³•ä¸æ•°æ®ç»“æ„</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">ç¼–ç¨‹è§„èŒƒ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">ç½‘ç»œ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">è®¾è®¡æ¨¡å¼</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-wrench" style=""></span><span class="vp-sidebar-title">è¿ç»´Operations</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-calendar-days" style=""></span><span class="vp-sidebar-title">é¢è¯•ä¸“é¢˜åˆé›†</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/" aria-label="ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/posts/special/havato/%E3%80%8A%E6%9C%80%E5%B0%91%E5%BF%85%E8%A6%81%E9%9D%A2%E8%AF%95%E9%A2%98%E3%80%8B%E7%AC%AC%E4%B8%80%E7%89%88.html" aria-label="ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/docker-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ Docker é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ Docker é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/0-http-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ Http é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ Http é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/javaee-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ JavaEE é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ JavaEE é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/kafka-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ Kafka é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ Kafka é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/mybatis-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ MyBatis é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ MyBatis é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/0-netty-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ Netty é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ Netty é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/springboot-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ SpringBoot é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ SpringBoot é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/zookeeper-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ Zookeeper é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ Zookeeper é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/elasticsearch-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ElasticSearché¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ElasticSearché¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/java-basics-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„JavaåŸºç¡€é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„JavaåŸºç¡€é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/java-container-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„Javaå®¹å™¨é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„Javaå®¹å™¨é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/java-concurrent-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„Javaå¹¶å‘åŸºç¡€é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„Javaå¹¶å‘åŸºç¡€é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/jvm-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„JVMé¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„JVMé¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/mysql-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„MySQLåŸºç¡€é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„MySQLåŸºç¡€é¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/redis-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„Redisé¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„Redisé¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/spring-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„Springé¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„Springé¢è¯•é¢˜<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/posts/special/havato/cache-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ç¼“å­˜é¢è¯•é¢˜"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span><!--]-->10é“ä¸å¾—ä¸ä¼šçš„ç¼“å­˜é¢è¯•é¢˜<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">ã€Šé¢è¯•1v1ã€‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><span class="vp-sidebar-title">é¢è¯•ä¸“é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://javapub.net.cn" target="_blank" rel="noopener noreferrer">Mr.Wang</a></span><span property="author" content="Mr.Wang"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-05T10:19:06.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 157 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT157M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color4 clickable" role="navigation">ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹</span><!--]--><meta property="articleSection" content="ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼“å­˜">ç¼“å­˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯ç¼“å­˜">1. ä»€ä¹ˆæ˜¯ç¼“å­˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜">2. ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-è¯·è¯´è¯´æœ‰å“ªäº›ç¼“å­˜ç®—æ³•-æ˜¯å¦èƒ½æ‰‹å†™ä¸€ä¸‹-lru-ä»£ç çš„å®ç°">3. è¯·è¯´è¯´æœ‰å“ªäº›ç¼“å­˜ç®—æ³•ï¼Ÿæ˜¯å¦èƒ½æ‰‹å†™ä¸€ä¸‹ LRU ä»£ç çš„å®ç°ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-å¸¸è§çš„å¸¸è§çš„ç¼“å­˜å·¥å…·å’Œæ¡†æ¶æœ‰å“ªäº›">4. å¸¸è§çš„å¸¸è§çš„ç¼“å­˜å·¥å…·å’Œæ¡†æ¶æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-ç”¨äº†ç¼“å­˜ä¹‹å-æœ‰å“ªäº›å¸¸è§é—®é¢˜">5. ç”¨äº†ç¼“å­˜ä¹‹åï¼Œæœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-å¦‚ä½•å¤„ç†ç¼“å­˜ç©¿é€çš„é—®é¢˜">6. å¦‚ä½•å¤„ç†ç¼“å­˜ç©¿é€çš„é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-å¦‚ä½•å¤„ç†ç¼“å­˜é›ªå´©çš„é—®é¢˜">7. å¦‚ä½•å¤„ç†ç¼“å­˜é›ªå´©çš„é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-å¦‚ä½•å¤„ç†ç¼“å­˜å‡»ç©¿çš„é—®é¢˜">8. å¦‚ä½•å¤„ç†ç¼“å­˜å‡»ç©¿çš„é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-ç¼“å­˜å’Œ-db-çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯">9. ç¼“å­˜å’Œ DB çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­-å¦‚ä½•å®ç°ç¼“å­˜é¢„çƒ­">10. ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­ï¼Ÿå¦‚ä½•å®ç°ç¼“å­˜é¢„çƒ­ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‹“å±•-ç¼“å­˜æ•°æ®çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›">æ‹“å±•ï¼šç¼“å­˜æ•°æ®çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#docker">Docker</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯-docker-å®¹å™¨">1. ä»€ä¹ˆæ˜¯ Docker å®¹å™¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-docker-å’Œè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆä¸åŒ">2. Docker å’Œè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä»€ä¹ˆæ˜¯-dockerfile">3. ä»€ä¹ˆæ˜¯ DockerFileï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ä½¿ç”¨docker-composeæ—¶å¦‚ä½•ä¿è¯å®¹å™¨aå…ˆäºå®¹å™¨bè¿è¡Œ">4. ä½¿ç”¨Docker Composeæ—¶å¦‚ä½•ä¿è¯å®¹å™¨Aå…ˆäºå®¹å™¨Bè¿è¡Œï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-ä¸€ä¸ªå®Œæ•´çš„dockerç”±å“ªäº›éƒ¨åˆ†ç»„æˆ">5. ä¸€ä¸ªå®Œæ•´çš„Dockerç”±å“ªäº›éƒ¨åˆ†ç»„æˆ?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-dockerå¸¸ç”¨å‘½ä»¤">6. dockerå¸¸ç”¨å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-æè¿°-docker-å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚">7. æè¿° Docker å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-dockerå®¹å™¨ä¹‹é—´æ€ä¹ˆéš”ç¦»">8. dockerå®¹å™¨ä¹‹é—´æ€ä¹ˆéš”ç¦»?</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#elasticsearch">ElasticSearch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è¯´è¯´ä½ ä»¬å…¬å¸-es-çš„é›†ç¾¤æ¶æ„-ç´¢å¼•æ•°æ®å¤§å°-åˆ†ç‰‡æœ‰å¤šå°‘-ä»¥åŠä¸€äº›è°ƒä¼˜æ‰‹æ®µ-ã€‚">1. è¯´è¯´ä½ ä»¬å…¬å¸ es çš„é›†ç¾¤æ¶æ„ï¼Œç´¢å¼•æ•°æ®å¤§å°ï¼Œåˆ†ç‰‡æœ‰å¤šå°‘ï¼Œä»¥åŠä¸€äº›è°ƒä¼˜æ‰‹æ®µ ã€‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-elasticsearch-çš„å€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆ">2. elasticsearch çš„å€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-elasticsearch-æ˜¯å¦‚ä½•å®ç°-master-é€‰ä¸¾çš„">3. elasticsearch æ˜¯å¦‚ä½•å®ç° master é€‰ä¸¾çš„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-æè¿°ä¸€ä¸‹-elasticsearch-ç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹">5. æè¿°ä¸€ä¸‹ Elasticsearch ç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-è¯¦ç»†æè¿°ä¸€ä¸‹-elasticsearch-æœç´¢çš„è¿‡ç¨‹">4. è¯¦ç»†æè¿°ä¸€ä¸‹ Elasticsearch æœç´¢çš„è¿‡ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-elasticsearch-åœ¨éƒ¨ç½²æ—¶-å¯¹-linux-çš„è®¾ç½®æœ‰å“ªäº›ä¼˜åŒ–æ–¹æ³•">5. Elasticsearch åœ¨éƒ¨ç½²æ—¶ï¼Œå¯¹ Linux çš„è®¾ç½®æœ‰å“ªäº›ä¼˜åŒ–æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-elasticsearch-ä¸­çš„èŠ‚ç‚¹-æ¯”å¦‚å…±-20-ä¸ª-å…¶ä¸­çš„-10-ä¸ªé€‰äº†ä¸€ä¸ª-master-å¦å¤–-10-ä¸ªé€‰äº†å¦ä¸€ä¸ª-master-æ€ä¹ˆåŠ">6. Elasticsearch ä¸­çš„èŠ‚ç‚¹ï¼ˆæ¯”å¦‚å…± 20 ä¸ªï¼‰ï¼Œå…¶ä¸­çš„ 10 ä¸ªé€‰äº†ä¸€ä¸ª masterï¼Œå¦å¤– 10 ä¸ªé€‰äº†å¦ä¸€ä¸ª masterï¼Œæ€ä¹ˆåŠï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-å®¢æˆ·ç«¯åœ¨å’Œé›†ç¾¤è¿æ¥æ—¶-å¦‚ä½•é€‰æ‹©ç‰¹å®šçš„èŠ‚ç‚¹æ‰§è¡Œè¯·æ±‚çš„">7. å®¢æˆ·ç«¯åœ¨å’Œé›†ç¾¤è¿æ¥æ—¶ï¼Œå¦‚ä½•é€‰æ‹©ç‰¹å®šçš„èŠ‚ç‚¹æ‰§è¡Œè¯·æ±‚çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-è¯¦ç»†æè¿°ä¸€ä¸‹-elasticsearch-æ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹ã€‚">8. è¯¦ç»†æè¿°ä¸€ä¸‹ Elasticsearch æ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹ã€‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-elasticsearch-å¯¹äºå¤§æ•°æ®é‡-ä¸Šäº¿é‡çº§-çš„èšåˆå¦‚ä½•å®ç°">9. Elasticsearch å¯¹äºå¤§æ•°æ®é‡ï¼ˆä¸Šäº¿é‡çº§ï¼‰çš„èšåˆå¦‚ä½•å®ç°ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-åœ¨å¹¶å‘æƒ…å†µä¸‹-elasticsearch-å¦‚æœä¿è¯è¯»å†™ä¸€è‡´">10. åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼ŒElasticsearch å¦‚æœä¿è¯è¯»å†™ä¸€è‡´ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_11-ä»‹ç»ä¸€ä¸‹ä½ ä»¬çš„ä¸ªæ€§åŒ–æœç´¢æ–¹æ¡ˆ">11. ä»‹ç»ä¸€ä¸‹ä½ ä»¬çš„ä¸ªæ€§åŒ–æœç´¢æ–¹æ¡ˆï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#javaåŸºç¡€">JavaåŸºç¡€</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-instanceof-å…³é”®å­—çš„ä½œç”¨">1. instanceof å…³é”®å­—çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-javaè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±">2. Javaè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-é‡è½½å’Œé‡å†™åŒºåˆ«">3. é‡è½½å’Œé‡å†™åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-equalsä¸-åŒºåˆ«">4. equalsä¸==åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-è°ˆè°ˆnioå’ŒbioåŒºåˆ«">5. è°ˆè°ˆNIOå’ŒBIOåŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-stringã€stringbufferã€stringbuilder-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ">6. Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-æ³›å‹æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆç‰¹ç‚¹">7. æ³›å‹æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆç‰¹ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-final-æœ‰å“ªäº›ç”¨æ³•">8. final æœ‰å“ªäº›ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-è¯´ä¸€ä¸‹javaæ³¨è§£">9. è¯´ä¸€ä¸‹Javaæ³¨è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-javaåˆ›å»ºå¯¹è±¡æœ‰å‡ ç§æ–¹å¼">10. Javaåˆ›å»ºå¯¹è±¡æœ‰å‡ ç§æ–¹å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#javaå¹¶å‘">Javaå¹¶å‘</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-start-æ–¹æ³•å’Œrun-æ–¹æ³•çš„åŒºåˆ«">1. start()æ–¹æ³•å’Œrun()æ–¹æ³•çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-volatileå…³é”®å­—çš„ä½œç”¨">2. volatileå…³é”®å­—çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-sleepæ–¹æ³•å’Œwaitæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«">3. sleepæ–¹æ³•å’Œwaitæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹">4. å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-javaå¦‚ä½•å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„é€šè®¯å’Œåä½œ-å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®">5. javaå¦‚ä½•å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„é€šè®¯å’Œåä½œï¼Ÿ(å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®ï¼Ÿ)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-ä»€ä¹ˆæ˜¯threadlocal">6. ä»€ä¹ˆæ˜¯ThreadLocal?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-java-ä¸­-countdownlatch-å’Œ-cyclicbarrier-æœ‰ä»€ä¹ˆä¸åŒ">7. Java ä¸­ CountDownLatch å’Œ CyclicBarrier æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-å¦‚ä½•é¿å…æ­»é”">8. å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-java-ä¸­-synchronized-å’Œ-reentrantlock-æœ‰ä»€ä¹ˆä¸åŒ">9. Java ä¸­ synchronized å’Œ ReentrantLock æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-æœ‰ä¸‰ä¸ªçº¿ç¨‹-t1-t2-t3-æ€ä¹ˆç¡®ä¿å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œ">10. æœ‰ä¸‰ä¸ªçº¿ç¨‹ T1ï¼ŒT2ï¼ŒT3ï¼Œæ€ä¹ˆç¡®ä¿å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#java-å®¹å™¨">Java å®¹å™¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è¯·è¯´ä¸€ä¸‹javaå®¹å™¨é›†åˆçš„åˆ†ç±»-å„è‡ªçš„ç»§æ‰¿ç»“æ„">1. è¯·è¯´ä¸€ä¸‹Javaå®¹å™¨é›†åˆçš„åˆ†ç±»ï¼Œå„è‡ªçš„ç»§æ‰¿ç»“æ„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-collection-å’Œ-collections-æœ‰ä»€ä¹ˆåŒºåˆ«">2. Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-listã€setã€map-ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ">3. Listã€Setã€Map ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-hashmap-å’Œ-hashtable-æœ‰ä»€ä¹ˆåŒºåˆ«">4. HashMap å’Œ Hashtable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-è¯´ä¸€ä¸‹-hashmap-çš„å®ç°åŸç†">5. è¯´ä¸€ä¸‹ HashMap çš„å®ç°åŸç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-è°ˆè°ˆ-arraylist-å’Œ-linkedlist-çš„åŒºåˆ«">6. è°ˆè°ˆ ArrayList å’Œ LinkedList çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-è°ˆè°ˆarraylistå’Œvectorçš„åŒºåˆ«">7. è°ˆè°ˆArrayListå’ŒVectorçš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-è¯·è°ˆä¸€è°ˆ-java-é›†åˆä¸­çš„-fail-fast-å’Œ-fail-safe-æœºåˆ¶">8. è¯·è°ˆä¸€è°ˆ Java é›†åˆä¸­çš„ fail-fast å’Œ fail-safe æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-hashmapæ˜¯æ€æ ·ç¡®å®škeyå­˜æ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®çš„-jdk1-8">9. HashMapæ˜¯æ€æ ·ç¡®å®škeyå­˜æ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®çš„ï¼ŸJDK1.8</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-ä¸ºä»€ä¹ˆè¦æŠŠé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘-é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8">10. ä¸ºä»€ä¹ˆè¦æŠŠé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œé˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‹“å±•é¢˜-ä¸ºä»€ä¹ˆ-hashmap-æ•°ç»„çš„é•¿åº¦æ˜¯2çš„å¹‚æ¬¡æ–¹">æ‹“å±•é¢˜. ä¸ºä»€ä¹ˆ HashMap æ•°ç»„çš„é•¿åº¦æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#javaee">JavaEE</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-jsp-æœ‰å“ªäº›å†…ç½®å¯¹è±¡-ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ">1. JSP æœ‰å“ªäº›å†…ç½®å¯¹è±¡ï¼Ÿä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä»‹ç»ä¸€ä¸‹-servlet-ç”Ÿå‘½å‘¨æœŸ">2. ä»‹ç»ä¸€ä¸‹ Servlet ç”Ÿå‘½å‘¨æœŸ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-servletå’Œjspçš„åŒºåˆ«å’Œè”ç³»">3. Servletå’ŒJSPçš„åŒºåˆ«å’Œè”ç³»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-jspçš„æ‰§è¡Œè¿‡ç¨‹">4. JSPçš„æ‰§è¡Œè¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-sessionå’Œcookieçš„åŒºåˆ«å’Œè”ç³»-è¯´æ˜åœ¨è‡ªå·±é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨">5. Sessionå’ŒCookieçš„åŒºåˆ«å’Œè”ç³»ï¼›è¯´æ˜åœ¨è‡ªå·±é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-è½¬å‘å’Œé‡å®šå‘çš„è”ç³»å’ŒåŒºåˆ«">6. è½¬å‘å’Œé‡å®šå‘çš„è”ç³»å’ŒåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«">7. æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹">8. ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-tcpå’Œudpçš„åŒºåˆ«">9. TCPå’ŒUDPçš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜">10. å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_11-ä»€ä¹ˆæ˜¯-csrf-æ”»å‡»-å¦‚ä½•é˜²å¾¡csrf-æ”»å‡»">11. ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»ï¼Ÿå¦‚ä½•é˜²å¾¡CSRF æ”»å‡»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_12-http1-0å’Œhttp1-1å’Œhttp2-0çš„åŒºåˆ«">12. HTTP1.0å’ŒHTTP1.1å’ŒHTTP2.0çš„åŒºåˆ«</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#jvm">JVM</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è¯´ä¸€è¯´jvmçš„ä¸»è¦ç»„æˆéƒ¨åˆ†">1. è¯´ä¸€è¯´JVMçš„ä¸»è¦ç»„æˆéƒ¨åˆ†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-è¯´ä¸€ä¸‹-jvm-çš„ä½œç”¨">2. è¯´ä¸€ä¸‹ JVM çš„ä½œç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«">3. è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-javaå†…å­˜æ³„æ¼">4. Javaå†…å­˜æ³„æ¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•">5. JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-è¯´ä¸€ä¸‹-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨">6. è¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-è¯´ä¸€ä¸‹ç±»åŠ è½½çš„æ‰§è¡Œè¿‡ç¨‹">7. è¯´ä¸€ä¸‹ç±»åŠ è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹">8. ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-cmsåƒåœ¾æ¸…ç†çš„è¿‡ç¨‹">9. CMSåƒåœ¾æ¸…ç†çš„è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-å¸¸ç”¨çš„-jvm-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›">10. å¸¸ç”¨çš„ JVM è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#kafka">Kafka</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æœ¯è¯­0-kafkaä¸­çš„isrã€aråˆä»£è¡¨ä»€ä¹ˆ-isrçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆ">æœ¯è¯­0. Kafkaä¸­çš„ISRã€ARåˆä»£è¡¨ä»€ä¹ˆï¼ŸISRçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æœ¯è¯­0-kafkaä¸­çš„hwã€leoã€lsoã€lwç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆ">æœ¯è¯­0. Kafkaä¸­çš„HWã€LEOã€LSOã€LWç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-kafka-æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆä½œç”¨">1. kafka æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-kafka-çš„æ¶æ„æ˜¯æ€ä¹ˆæ ·çš„">2. kafka çš„æ¶æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-kafka-replicasæ˜¯æ€ä¹ˆç®¡ç†çš„">3. Kafka Replicasæ˜¯æ€ä¹ˆç®¡ç†çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-å¦‚ä½•ç¡®å®šå½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯">4. å¦‚ä½•ç¡®å®šå½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-å‘é€æ¶ˆæ¯çš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›">5. å‘é€æ¶ˆæ¯çš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-kafka-çš„å¯é æ€§æ˜¯æ€ä¹ˆä¿è¯çš„">6. Kafka çš„å¯é æ€§æ˜¯æ€ä¹ˆä¿è¯çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„-è§£å†³äº†ä»€ä¹ˆé—®é¢˜">7. åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„ï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-kafka-partition-å‰¯æœ¬-leader-æ˜¯æ€ä¹ˆé€‰ä¸¾çš„">8. Kafka Partition å‰¯æœ¬ leader æ˜¯æ€ä¹ˆé€‰ä¸¾çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—-ååé‡å°±ä¼šè¶Šé«˜å—">9. åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—ï¼Ÿååé‡å°±ä¼šè¶Šé«˜å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-kafka-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«">10. kafka ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mybatis">MyBatis</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯mybatis">1. ä»€ä¹ˆæ˜¯MyBatis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-mybatisçš„ä¼˜ç‚¹">2. MyBatisçš„ä¼˜ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ">3. #{}å’Œ${}çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ä¸€ä¸ª-xml-æ˜ å°„æ–‡ä»¶-éƒ½ä¼šå†™ä¸€ä¸ª-dao-æ¥å£ä¸ä¹‹å¯¹åº”-è¿™ä¸ª-dao-æ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ">4. ä¸€ä¸ª Xml æ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šå†™ä¸€ä¸ª Dao æ¥å£ä¸ä¹‹å¯¹åº”ï¼Œè¿™ä¸ª Dao æ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„-ä¸»-é”®å€¼">5. å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„(ä¸»)é”®å€¼?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-mybatis-åŠ¨æ€-sql-æœ‰ä»€ä¹ˆç”¨-æœ‰å“ªäº›åŠ¨æ€-sql-æ‰§è¡ŒåŸç†">6. Mybatis åŠ¨æ€ sql æœ‰ä»€ä¹ˆç”¨ï¼Ÿæœ‰å“ªäº›åŠ¨æ€ sqlï¼Ÿæ‰§è¡ŒåŸç†ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-ä»€ä¹ˆæ˜¯mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜">7. ä»€ä¹ˆæ˜¯Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-mybatisçš„å·¥ä½œåŸç†">8. MyBatisçš„å·¥ä½œåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-ä»€ä¹ˆæ˜¯mybatisçš„æ¥å£ç»‘å®š-æœ‰å“ªäº›å®ç°æ–¹å¼">9. ä»€ä¹ˆæ˜¯MyBatisçš„æ¥å£ç»‘å®šï¼Ÿæœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-mybatisçš„åˆ†é¡µåŸç†">10. Mybatisçš„åˆ†é¡µåŸç†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mysql">MySQL</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-mysqlæœ‰å“ªå‡ ç§log">1. mysqlæœ‰å“ªå‡ ç§log</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-mysqlçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹">2. MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-äº‹ç‰©çš„4ç§éš”ç¦»çº§åˆ«">3. äº‹ç‰©çš„4ç§éš”ç¦»çº§åˆ«</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-ç›¸å…³æ¦‚å¿µ">4. ç›¸å…³æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-mysqlæ•°æ®åº“å‡ ä¸ªåŸºæœ¬çš„ç´¢å¼•ç±»å‹">5. MySQLæ•°æ®åº“å‡ ä¸ªåŸºæœ¬çš„ç´¢å¼•ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-dropã€deleteä¸truncateçš„åŒº">6. dropã€deleteä¸truncateçš„åŒº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆ">7. æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-sqlä¼˜åŒ–æ–¹å¼">8. SQLä¼˜åŒ–æ–¹å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-ä»é”çš„ç±»åˆ«ä¸Šåˆ†mysqléƒ½æœ‰å“ªäº›é”å‘¢">9. ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#redis">Redis</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-redisæ˜¯ä»€ä¹ˆ">1. Redisæ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-ä½ åœ¨å“ªäº›åœºæ™¯ä½¿ç”¨redis">2. ä½ åœ¨å“ªäº›åœºæ™¯ä½¿ç”¨redis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä¸ºä»€ä¹ˆredisæ˜¯å•çº¿ç¨‹çš„">3. ä¸ºä»€ä¹ˆRedisæ˜¯å•çº¿ç¨‹çš„?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-redisæŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼">4. RedisæŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€-æ€ä¹ˆè§£å†³">5. ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©">6. ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-redisä½¿ç”¨ä¸Šå¦‚ä½•åšå†…å­˜ä¼˜åŒ–">7. Redisä½¿ç”¨ä¸Šå¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-ä½ ä»¬redisä½¿ç”¨å“ªç§éƒ¨ç½²æ–¹å¼">8. ä½ ä»¬redisä½¿ç”¨å“ªç§éƒ¨ç½²æ–¹å¼ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-rediså®ç°åˆ†å¸ƒå¼é”è¦æ³¨æ„ä»€ä¹ˆ">9. rediså®ç°åˆ†å¸ƒå¼é”è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#spring">Spring</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯-spring-æ¡†æ¶-spring-æ¡†æ¶æœ‰å“ªäº›ä¸»è¦æ¨¡å—">1. ä»€ä¹ˆæ˜¯ Spring æ¡†æ¶ï¼ŸSpring æ¡†æ¶æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-spring-iocã€aopä¸¾ä¾‹è¯´æ˜">2. Spring IOCã€AOPä¸¾ä¾‹è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬-ioc-ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥-di">3. ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬(IOC)ï¼Ÿä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-æè¿°ä¸€ä¸‹-spring-bean-çš„ç”Ÿå‘½å‘¨æœŸ">4. æè¿°ä¸€ä¸‹ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-spring-bean-çš„ä½œç”¨åŸŸä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«">5. Spring Bean çš„ä½œç”¨åŸŸä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-springä¸­éƒ½åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼">6. Springä¸­éƒ½åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-spring-aopé‡Œé¢çš„å‡ ä¸ªåè¯çš„æ¦‚å¿µ">7. Spring AOPé‡Œé¢çš„å‡ ä¸ªåè¯çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-beanfactoryå’Œapplicationcontextæœ‰ä»€ä¹ˆåŒºåˆ«">8. BeanFactoryå’ŒApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜">9. Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-springäº‹åŠ¡çš„å®ç°æ–¹å¼å’Œå®ç°åŸç†">10. Springäº‹åŠ¡çš„å®ç°æ–¹å¼å’Œå®ç°åŸç†ï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#springboot">SpringBoot</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä¸ºä»€ä¹ˆè¦ç”¨-spring-boot">1. ä¸ºä»€ä¹ˆè¦ç”¨ spring bootï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-spring-boot-æœ‰å“ªäº›ä¼˜ç‚¹">2. spring boot æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-spring-boot-æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆ">3. spring boot æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-spring-bootçš„æ ¸å¿ƒæ³¨è§£æ˜¯ä»€ä¹ˆ-ç”±é‚£äº›æ³¨è§£ç»„æˆ">4. spring bootçš„æ ¸å¿ƒæ³¨è§£æ˜¯ä»€ä¹ˆï¼Ÿç”±é‚£äº›æ³¨è§£ç»„æˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-è¯´ä¸€ä¸‹springbootçš„è‡ªåŠ¨è£…é…åŸç†">5. è¯´ä¸€ä¸‹springbootçš„è‡ªåŠ¨è£…é…åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-springbootã€spring-mvcå’Œspringæœ‰ä»€ä¹ˆåŒºåˆ«">6. SpringBootã€Spring MVCå’ŒSpringæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-springbootå¯åŠ¨æ—¶éƒ½åšäº†ä»€ä¹ˆ">7. SpringBootå¯åŠ¨æ—¶éƒ½åšäº†ä»€ä¹ˆ?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-springboot-ä¸­çš„ç›‘è§†å™¨æ˜¯ä»€ä¹ˆ">8. SpringBoot ä¸­çš„ç›‘è§†å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-springboot-ä¸­çš„starteråˆ°åº•æ˜¯ä»€ä¹ˆ">9. SpringBoot ä¸­çš„starteråˆ°åº•æ˜¯ä»€ä¹ˆ ?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_10-å¾®æœåŠ¡ä¸­å¦‚ä½•å®ç°-session-å…±äº«">10. å¾®æœåŠ¡ä¸­å¦‚ä½•å®ç° session å…±äº«?</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#zookeeper">Zookeeper</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ä»€ä¹ˆæ˜¯-zookeeper">1. ä»€ä¹ˆæ˜¯ Zookeeper</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-zk-çš„èŠ‚ç‚¹ç±»å‹">2. ZK çš„èŠ‚ç‚¹ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-zookeeper-ä¸‹-server-å·¥ä½œçŠ¶æ€æœ‰å“ªäº›">3. Zookeeper ä¸‹ Server å·¥ä½œçŠ¶æ€æœ‰å“ªäº›ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-zookeeperæ˜¯cpè¿˜æ˜¯ap">4. zookeeperæ˜¯cpè¿˜æ˜¯ap?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-è¯´å‡ ä¸ª-zookeeper-å¸¸ç”¨çš„å‘½ä»¤ã€‚">5. è¯´å‡ ä¸ª zookeeper å¸¸ç”¨çš„å‘½ä»¤ã€‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_6-ä»‹ç»ä¸€ä¸‹zabåè®®">6. ä»‹ç»ä¸€ä¸‹ZABåè®®ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_7-zab-å’Œ-paxos-ç®—æ³•çš„è”ç³»ä¸åŒºåˆ«">7. ZAB å’Œ Paxos ç®—æ³•çš„è”ç³»ä¸åŒºåˆ«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_8-zookeeper-çš„å…¸å‹åº”ç”¨åœºæ™¯">8. Zookeeper çš„å…¸å‹åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_9-chrootç‰¹æ€§">9. Chrootç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ‹“å±•">æ‹“å±•</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><!----><p>ç›¸ä¿¡å¤§å®¶éƒ½ä¼šæœ‰ç§åŠçœ¼ç†Ÿåˆé™Œç”Ÿçš„æ„Ÿè§‰ã€çœ‹è¿‡å¯èƒ½åœ¨çŸ­æš‚çš„é¢è¯•ååˆé©¬ä¸Šå¿˜è®°äº†ã€‚<strong>JavaPub</strong> åœ¨è¿™é‡Œæ•´ç†è¿™äº›å®¹æ˜“å¿˜è®°çš„é‡ç‚¹çŸ¥è¯†åŠ <strong>è§£ç­”</strong>ï¼Œ<code>å»ºè®®æ”¶è—ï¼Œç»å¸¸æ¸©ä¹ æŸ¥é˜…</code>ã€‚</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzNDUyOTY0Nw==&amp;action=getalbum&amp;album_id=2344061143381508097#wechat_redirect" target="_blank" rel="noopener noreferrer">ç‚¹å‡»åœ¨çº¿é˜…è¯»ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹</a></p><div align="center"><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F05%2F25%2F20240525-231117.png" alt="Your Image Description"></div><!----><p>[toc]</p><h2 id="ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜"><span>ç¼“å­˜</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯ç¼“å­˜"><span>1. ä»€ä¹ˆæ˜¯ç¼“å­˜ï¼Ÿ</span></a></h3><p>ç¼“å­˜ï¼Œå°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒºï¼Œé’ˆå¯¹æœåŠ¡å¯¹è±¡çš„ä¸åŒï¼ˆæœ¬è´¨å°±æ˜¯ä¸åŒçš„ç¡¬ä»¶ï¼‰éƒ½å¯ä»¥æ„å»ºç¼“å­˜ã€‚è€Œæˆ‘ä»¬å¹³æ—¶è¯´çš„ç¼“å­˜ï¼Œå¤§å¤šæ˜¯æŒ‡å†…å­˜ã€‚</p><p>ç›®çš„æ˜¯ï¼Œ <strong>æŠŠè¯»å†™é€Ÿåº¦ã€æ…¢ã€‘çš„ä»‹è´¨çš„æ•°æ®ä¿å­˜åœ¨è¯»å†™é€Ÿåº¦ã€å¿«ã€‘çš„ä»‹è´¨ä¸­ï¼Œä»è€Œæé«˜è¯»å†™é€Ÿåº¦ï¼Œå‡å°‘æ—¶é—´æ¶ˆè€—ã€‚</strong> ä¾‹å¦‚ï¼š</p><ul><li>CPU é«˜é€Ÿç¼“å­˜ ï¼šé«˜é€Ÿç¼“å­˜çš„è¯»å†™é€Ÿåº¦è¿œé«˜äºå†…å­˜ã€‚ <ul><li>CPU è¯»æ•°æ®æ—¶ï¼Œå¦‚æœåœ¨é«˜é€Ÿç¼“å­˜ä¸­æ‰¾åˆ°æ‰€éœ€æ•°æ®ï¼Œå°±ä¸éœ€è¦è¯»å†…å­˜</li><li>CPU å†™æ•°æ®æ—¶ï¼Œå…ˆå†™åˆ°é«˜é€Ÿç¼“å­˜ï¼Œå†å›å†™åˆ°å†…å­˜ã€‚</li></ul></li><li>ç£ç›˜ç¼“å­˜ï¼šç£ç›˜ç¼“å­˜å…¶å®å°±æŠŠå¸¸ç”¨çš„ç£ç›˜æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜è¯»å†™é€Ÿåº¦ä¹Ÿæ˜¯è¿œé«˜äºç£ç›˜çš„ã€‚ <ul><li>è¯»æ•°æ®ï¼Œæ—¶ä»å†…å­˜è¯»å–ã€‚</li><li>å†™æ•°æ®æ—¶ï¼Œå¯å…ˆå†™åˆ°å†…å­˜ï¼Œå®šæ—¶æˆ–å®šé‡å›å†™åˆ°ç£ç›˜ï¼Œæˆ–è€…æ˜¯åŒæ­¥å›å†™ã€‚</li></ul></li></ul><h3 id="_2-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜"><span>2. ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ</span></a></h3><p>ä½¿ç”¨ç¼“å­˜çš„ç›®çš„ï¼Œå°±æ˜¯æå‡è¯»å†™æ€§èƒ½ã€‚è€Œå®é™…ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ›´å¤šçš„æ˜¯ä¸ºäº†æå‡è¯»æ€§èƒ½ï¼Œå¸¦æ¥æ›´å¥½çš„æ€§èƒ½ï¼Œæ›´é«˜çš„å¹¶å‘é‡ã€‚</p><p>æ—¥å¸¸ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒå¤šçš„æ•°æ®åº“æ˜¯ MySQL ï¼Œç¼“å­˜æ˜¯ Redis ã€‚Redis æ¯” MySQL çš„è¯»å†™æ€§èƒ½å¥½å¾ˆå¤šã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°† MySQL çš„çƒ­ç‚¹æ•°æ®ï¼Œç¼“å­˜åˆ° Redis ä¸­ï¼Œæå‡è¯»å–æ€§èƒ½ï¼Œä¹Ÿå‡å° MySQL çš„è¯»å–å‹åŠ›ã€‚ä¾‹å¦‚è¯´ï¼š</p><ul><li>è®ºå›å¸–å­çš„è®¿é—®é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œä¸”è¦å®æ—¶æ›´æ–°é˜…è¯»é‡ï¼Œä½¿ç”¨ Redis è®°å½•å¸–å­çš„é˜…è¯»é‡ï¼Œå¯ä»¥æå‡æ€§èƒ½å’Œå¹¶å‘ã€‚</li><li>å•†å“ä¿¡æ¯ï¼Œæ•°æ®æ›´æ–°çš„é¢‘ç‡ä¸é«˜ï¼Œä½†æ˜¯è¯»å–çš„é¢‘ç‡å¾ˆé«˜ï¼Œç‰¹åˆ«æ˜¯çƒ­é—¨å•†å“ã€‚</li></ul><h3 id="_3-è¯·è¯´è¯´æœ‰å“ªäº›ç¼“å­˜ç®—æ³•-æ˜¯å¦èƒ½æ‰‹å†™ä¸€ä¸‹-lru-ä»£ç çš„å®ç°" tabindex="-1"><a class="header-anchor" href="#_3-è¯·è¯´è¯´æœ‰å“ªäº›ç¼“å­˜ç®—æ³•-æ˜¯å¦èƒ½æ‰‹å†™ä¸€ä¸‹-lru-ä»£ç çš„å®ç°"><span>3. è¯·è¯´è¯´æœ‰å“ªäº›ç¼“å­˜ç®—æ³•ï¼Ÿæ˜¯å¦èƒ½æ‰‹å†™ä¸€ä¸‹ LRU ä»£ç çš„å®ç°ï¼Ÿ</span></a></h3><p>ç¼“å­˜ç®—æ³•ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯ä¸‰ç§ï¼š</p><ul><li>LRUï¼ˆleast recently used ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨)</li><li>LFUï¼ˆLeast Frequently used ï¼Œæœ€ä¸ç»å¸¸ä½¿ç”¨)</li><li>FIFOï¼ˆfirst in first out ï¼Œå…ˆè¿›å…ˆå‡º)</li></ul><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© LinkedHashMap å®ç°</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> LRULinkedMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">V</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * æœ€å¤§ç¼“å­˜å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cacheSize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LinkedHashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">V</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cacheMap </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> LRULinkedMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> cacheSize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cacheSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cacheSize;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        cacheMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> LinkedHashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0.75F</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> removeEldestEntry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> eldest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (cacheSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cacheMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">V</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        cacheMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key,value) ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> V</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cacheMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(key) ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Collection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> V</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">V</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt;(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cacheMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">entrySet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨æ¡ˆä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> put</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">() throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        LRULinkedMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> map </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> LRULinkedMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> e </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; : &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> e </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getAll</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; : &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	2</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	3</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">	</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	3</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	4</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-å¸¸è§çš„å¸¸è§çš„ç¼“å­˜å·¥å…·å’Œæ¡†æ¶æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_4-å¸¸è§çš„å¸¸è§çš„ç¼“å­˜å·¥å…·å’Œæ¡†æ¶æœ‰å“ªäº›"><span>4. å¸¸è§çš„å¸¸è§çš„ç¼“å­˜å·¥å…·å’Œæ¡†æ¶æœ‰å“ªäº›ï¼Ÿ</span></a></h3><p>åœ¨ Java åç«¯å¼€å‘ä¸­ï¼Œå¸¸è§çš„ç¼“å­˜å·¥å…·å’Œæ¡†æ¶åˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ul><li><p>æœ¬åœ°ç¼“å­˜ï¼šGuava LocalCacheã€Ehcacheã€Caffeine ã€‚</p><p>Ehcache çš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼ŒCaffeine çš„æ€§èƒ½è¦æ¯” Guava LocalCache å¥½ã€‚</p></li><li><p>åˆ†å¸ƒå¼ç¼“å­˜ï¼šRedisã€Memcachedã€Tair ã€‚</p><p>Redis æœ€ä¸ºä¸»æµå’Œå¸¸ç”¨ã€‚</p></li></ul><h3 id="_5-ç”¨äº†ç¼“å­˜ä¹‹å-æœ‰å“ªäº›å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_5-ç”¨äº†ç¼“å­˜ä¹‹å-æœ‰å“ªäº›å¸¸è§é—®é¢˜"><span>5. ç”¨äº†ç¼“å­˜ä¹‹åï¼Œæœ‰å“ªäº›å¸¸è§é—®é¢˜ï¼Ÿ</span></a></h3><p>å¸¸è§çš„é—®é¢˜ï¼Œå¯åˆ—ä¸¾å¦‚ä¸‹ï¼š</p><p><strong>å†™å…¥é—®é¢˜</strong></p><ul><li>ç¼“å­˜ä½•æ—¶å†™å…¥ï¼Ÿå¹¶ä¸”å†™æ—¶å¦‚ä½•é¿å…å¹¶å‘é‡å¤å†™å…¥ï¼Ÿ</li><li>ç¼“å­˜å¦‚ä½•å¤±æ•ˆï¼Ÿ</li><li>ç¼“å­˜å’Œ DB çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ</li></ul><p><strong>ç»å…¸ä¸‰è¿é—®</strong></p><ul><li>å¦‚ä½•é¿å…ç¼“å­˜ç©¿é€çš„é—®é¢˜ï¼Ÿ</li><li>å¦‚ä½•é¿å…ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Ÿ</li><li>å¦‚æœé¿å…ç¼“å­˜é›ªå´©çš„é—®é¢˜ï¼Ÿ</li></ul><h3 id="_6-å¦‚ä½•å¤„ç†ç¼“å­˜ç©¿é€çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_6-å¦‚ä½•å¤„ç†ç¼“å­˜ç©¿é€çš„é—®é¢˜"><span>6. å¦‚ä½•å¤„ç†ç¼“å­˜ç©¿é€çš„é—®é¢˜</span></a></h3><p>ç¼“å­˜ç©¿é€ï¼Œæ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™ï¼Œå¹¶ä¸”å¤„äºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä» DB æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ° DB å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚</p><p>åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½ DB å°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„ key é¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚å¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F05%2F25%2F20240525-230741.webp" alt="ç¼“å­˜ç©¿é€" tabindex="0" loading="lazy"><figcaption>ç¼“å­˜ç©¿é€</figcaption></figure><p><strong>å¦‚ä½•è§£å†³</strong></p><p>æœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ï¼š</p><ol><li><p>æ–¹æ¡ˆä¸€ï¼Œç¼“å­˜ç©ºå¯¹è±¡ã€‚ å½“ä» DB æŸ¥è¯¢æ•°æ®ä¸ºç©ºï¼Œæˆ‘ä»¬ä»ç„¶å°†è¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œå…·ä½“çš„å€¼éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æ ‡è¯†ï¼Œèƒ½å’ŒçœŸæ­£ç¼“å­˜çš„æ•°æ®åŒºåˆ†å¼€ã€‚å¦å¤–ï¼Œéœ€è¦è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œä¸€èˆ¬å»ºè®®ä¸è¦è¶…è¿‡ 5 åˆ†é’Ÿã€‚</p></li><li><p>æ–¹æ¡ˆäºŒï¼ŒBloomFilter å¸ƒéš†è¿‡æ»¤å™¨ã€‚ åœ¨ç¼“å­˜æœåŠ¡çš„åŸºç¡€ä¸Šï¼Œæ„å»º BloomFilter æ•°æ®ç»“æ„ï¼Œåœ¨ BloomFilter ä¸­å­˜å‚¨å¯¹åº”çš„ KEY æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜è¯¥ KEY å¯¹åº”çš„å€¼ä¸ä¸ºç©ºã€‚</p></li></ol><p><strong>å¦‚ä½•é€‰æ‹©</strong></p><p>è¿™ä¸¤ä¸ªæ–¹æ¡ˆï¼Œå„æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚</p><table><thead><tr><th></th><th>ç¼“å­˜ç©ºå¯¹è±¡</th><th>BloomFilter å¸ƒéš†è¿‡æ»¤å™¨</th></tr></thead><tbody><tr><td>é€‚ç”¨åœºæ™¯</td><td>1ã€æ•°æ®å‘½ä¸­ä¸é«˜ 2ã€ä¿è¯ä¸€è‡´æ€§</td><td>1ã€æ•°æ®å‘½ä¸­ä¸é«˜, 2ã€æ•°æ®ç›¸å¯¹å›ºå®šã€å®æ—¶æ€§ä½</td></tr><tr><td>ç»´æŠ¤æˆæœ¬</td><td>1ã€ä»£ç ç»´æŠ¤ç®€å• 2ã€éœ€è¦è¿‡å¤šçš„ç¼“å­˜ç©ºé—´ 3ã€æ•°æ®ä¸ä¸€è‡´</td><td>1ã€ä»£ç ç»´æŠ¤å¤æ‚ï¼Œ2ã€ç¼“å­˜ç©ºé—´å ç”¨å°</td></tr></tbody></table><p>å®é™…æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ–¹æ¡ˆäºŒæ¯”è¾ƒå¤šã€‚å› ä¸ºï¼Œç›¸æ¯”æ–¹æ¡ˆä¸€æ¥è¯´ï¼Œæ›´åŠ èŠ‚çœå†…å®¹ï¼Œå¯¹ç¼“å­˜çš„è´Ÿè·æ›´å°ã€‚</p><h3 id="_7-å¦‚ä½•å¤„ç†ç¼“å­˜é›ªå´©çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_7-å¦‚ä½•å¤„ç†ç¼“å­˜é›ªå´©çš„é—®é¢˜"><span>7. å¦‚ä½•å¤„ç†ç¼“å­˜é›ªå´©çš„é—®é¢˜</span></a></h3><p>ç¼“å­˜é›ªå´©ï¼Œæ˜¯æŒ‡ç¼“å­˜ç”±äºæŸäº›åŸå› æ— æ³•æä¾›æœåŠ¡( ä¾‹å¦‚ï¼Œç¼“å­˜æŒ‚æ‰äº† )ï¼Œæ‰€æœ‰è¯·æ±‚å…¨éƒ¨è¾¾åˆ° DB ä¸­ï¼Œå¯¼è‡´ DB è´Ÿè·å¤§å¢ï¼Œæœ€ç»ˆæŒ‚æ‰çš„æƒ…å†µã€‚</p><p><strong>å¦‚ä½•è§£å†³</strong></p><p>é¢„é˜²å’Œè§£å†³ç¼“å­˜é›ªå´©çš„é—®é¢˜ï¼Œå¯ä»¥ä»ä»¥ä¸‹å¤šä¸ªæ–¹é¢è¿›è¡Œå…±åŒç€æ‰‹ã€‚</p><ol><li><p>ç¼“å­˜é«˜å¯ç”¨ï¼šé€šè¿‡æ­å»ºç¼“å­˜çš„é«˜å¯ç”¨ï¼Œé¿å…ç¼“å­˜æŒ‚æ‰å¯¼è‡´æ— æ³•æä¾›æœåŠ¡çš„æƒ…å†µï¼Œä»è€Œé™ä½å‡ºç°ç¼“å­˜é›ªå´©çš„æƒ…å†µã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨ Redis ä½œä¸ºç¼“å­˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ Redis Sentinel æˆ– Redis Cluster å®ç°é«˜å¯ç”¨ã€‚</p></li><li><p>æœ¬åœ°ç¼“å­˜ï¼šå¦‚æœä½¿ç”¨æœ¬åœ°ç¼“å­˜æ—¶ï¼Œå³ä½¿åˆ†å¸ƒå¼ç¼“å­˜æŒ‚äº†ï¼Œä¹Ÿå¯ä»¥å°† DB æŸ¥è¯¢åˆ°çš„ç»“æœç¼“å­˜åˆ°æœ¬åœ°ï¼Œé¿å…åç»­è¯·æ±‚å…¨éƒ¨åˆ°è¾¾ DB ä¸­ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ JVM ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ Ehcacheã€Guava Cache å®ç°æœ¬åœ°ç¼“å­˜çš„åŠŸèƒ½ã€‚</p></li></ol><blockquote><p>å½“ç„¶ï¼Œå¼•å…¥æœ¬åœ°ç¼“å­˜ä¹Ÿä¼šæœ‰ç›¸åº”çš„é—®é¢˜ï¼Œä¾‹å¦‚è¯´ï¼š</p><p>æœ¬åœ°ç¼“å­˜çš„å®æ—¶æ€§æ€ä¹ˆä¿è¯ï¼Ÿ æ–¹æ¡ˆä¸€ï¼Œå¯ä»¥å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚åœ¨æ•°æ®æ›´æ–°æ—¶ï¼Œå‘å¸ƒæ•°æ®æ›´æ–°çš„æ¶ˆæ¯ï¼›è€Œè¿›&gt;ç¨‹ä¸­æœ‰ç›¸åº”çš„æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯ï¼Œä»è€Œæ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚ æ–¹æ¡ˆäºŒï¼Œè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¯·æ±‚æ—¶ä» DB é‡æ–°æ‹‰å–ã€‚ æ–¹æ¡ˆä¸‰ï¼Œæ‰‹åŠ¨è¿‡æœŸã€‚</p></blockquote><ol start="3"><li><p>è¯·æ±‚ DB é™æµ: é€šè¿‡é™åˆ¶ DB çš„æ¯ç§’è¯·æ±‚æ•°ï¼Œé¿å…æŠŠ DB ä¹Ÿæ‰“æŒ‚äº†ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Java ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ Guava RateLimiterã€Sentinelã€Hystrix å®ç°é™æµçš„åŠŸèƒ½ã€‚è¿™æ ·è‡³å°‘èƒ½æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li>å¯èƒ½æœ‰ä¸€éƒ¨åˆ†ç”¨æˆ·ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ï¼Œç³»ç»Ÿè¿˜æ²¡æ­»é€ã€‚</li><li>æœªæ¥ç¼“å­˜æœåŠ¡æ¢å¤åï¼Œç³»ç»Ÿç«‹å³å°±å·²ç»æ¢å¤ï¼Œæ— éœ€å†å¤„ç† DB ä¹ŸæŒ‚æ‰çš„æƒ…å†µã€‚</li></ul></li><li><p>æå‰æ¼”ç»ƒï¼šåœ¨é¡¹ç›®ä¸Šçº¿å‰ï¼Œæ¼”ç»ƒç¼“å­˜å®•æ‰åï¼Œåº”ç”¨ä»¥åŠåç«¯çš„è´Ÿè½½æƒ…å†µä»¥åŠå¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šåšä¸€äº›é¢„æ¡ˆè®¾å®šã€‚</p></li></ol><h3 id="_8-å¦‚ä½•å¤„ç†ç¼“å­˜å‡»ç©¿çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_8-å¦‚ä½•å¤„ç†ç¼“å­˜å‡»ç©¿çš„é—®é¢˜"><span>8. å¦‚ä½•å¤„ç†ç¼“å­˜å‡»ç©¿çš„é—®é¢˜</span></a></h3><p>ç¼“å­˜å‡»ç©¿ï¼Œæ˜¯æŒ‡æŸä¸ªæåº¦â€œçƒ­ç‚¹â€æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸæ—¶ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ª KEY æœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä» DB åŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´ DB å‹å®ã€‚</p><ul><li>å¯¹äºä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ KEY ï¼Œå¦‚æœè¿™äº› KEY å¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸â€œçƒ­ç‚¹â€çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚</li><li>åŒºåˆ«ï¼š <ul><li>å’Œç¼“å­˜â€œé›ªå´©â€œâ€çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…é’ˆå¯¹æŸä¸€ KEY ç¼“å­˜ï¼Œåè€…åˆ™æ˜¯å¾ˆå¤š KEY ã€‚</li><li>å’Œç¼“å­˜â€œç©¿é€â€œâ€çš„åŒºåˆ«åœ¨äºï¼Œè¿™ä¸ª KEY æ˜¯çœŸå®å­˜åœ¨å¯¹åº”çš„å€¼çš„ã€‚</li></ul></li></ul><p><strong>å¦‚ä½•è§£å†³</strong></p><p>æœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥è§£å†³ï¼š</p><ol><li><p>æ–¹æ¡ˆä¸€ï¼Œä½¿ç”¨äº’æ–¥é”ã€‚è¯·æ±‚å‘ç°ç¼“å­˜ä¸å­˜åœ¨åï¼Œå»æŸ¥è¯¢ DB å‰ï¼Œä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œä¿è¯æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æŸ¥è¯¢ DB ï¼Œå¹¶æ›´æ–°åˆ°ç¼“å­˜ã€‚</p></li><li><p>æ–¹æ¡ˆäºŒï¼Œæ‰‹åŠ¨è¿‡æœŸã€‚ç¼“å­˜ä¸Šä»ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ŒåŠŸèƒ½ä¸Šå°†è¿‡æœŸæ—¶é—´å­˜åœ¨ KEY å¯¹åº”çš„ VALUE é‡Œã€‚æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>è·å–ç¼“å­˜ã€‚é€šè¿‡ VALUE çš„è¿‡æœŸæ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚å¦‚æœæœªè¿‡æœŸï¼Œåˆ™ç›´æ¥è¿”å›ï¼›å¦‚æœå·²è¿‡æœŸï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</li><li>é€šè¿‡ä¸€ä¸ªåå°çš„å¼‚æ­¥çº¿ç¨‹è¿›è¡Œç¼“å­˜çš„æ„å»ºï¼Œä¹Ÿå°±æ˜¯â€œæ‰‹åŠ¨â€è¿‡æœŸã€‚é€šè¿‡åå°çš„å¼‚æ­¥çº¿ç¨‹ï¼Œä¿è¯æœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æŸ¥è¯¢ DBã€‚</li><li>åŒæ—¶ï¼Œè™½ç„¶ VALUE å·²ç»è¿‡æœŸï¼Œè¿˜æ˜¯ç›´æ¥è¿”å›ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ï¼Œè™½ç„¶æŸå¤±äº†ä¸€å®šçš„æ—¶æ•ˆæ€§ã€‚</li></ol></li></ol><p><strong>é€‰æ‹©</strong></p><p>è¿™ä¸¤ä¸ªæ–¹æ¡ˆï¼Œå„æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚</p><table><thead><tr><th></th><th>ä½¿ç”¨äº’æ–¥é”</th><th>æ‰‹åŠ¨è¿‡æœŸ</th></tr></thead><tbody><tr><td>ä¼˜ç‚¹</td><td>1ã€æ€è·¯ç®€å• 2ã€ä¿è¯ä¸€è‡´æ€§</td><td>1ã€æ€§ä»·æœ€ä½³ï¼Œç”¨æˆ·æ— éœ€ç­‰å¾…</td></tr><tr><td>ç¼ºç‚¹</td><td>1ã€ä»£ç å¤æ‚åº¦å¢å¤§ 2ã€å­˜åœ¨æ­»é”çš„é£é™©</td><td>1ã€æ— æ³•ä¿è¯ç¼“å­˜ä¸€è‡´æ€§</td></tr></tbody></table><h3 id="_9-ç¼“å­˜å’Œ-db-çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯" tabindex="-1"><a class="header-anchor" href="#_9-ç¼“å­˜å’Œ-db-çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯"><span>9. ç¼“å­˜å’Œ DB çš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ</span></a></h3><p><strong>äº§ç”ŸåŸå› </strong></p><p>ä¸»è¦æœ‰ä¸¤ç§æƒ…å†µï¼Œä¼šå¯¼è‡´ç¼“å­˜å’Œ DB çš„ä¸€è‡´æ€§é—®é¢˜ï¼š</p><ol><li>å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå¯¼è‡´è¯»å–è€çš„ DB æ•°æ®ï¼Œæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚</li></ol><blockquote><p>ä¸»è¦æŒ‡çš„æ˜¯ï¼Œæ›´æ–° DB æ•°æ®ä¹‹å‰ï¼Œå…ˆåˆ é™¤ Cache çš„æ•°æ®ã€‚åœ¨ä½å¹¶å‘é‡ä¸‹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘ä¸‹ï¼Œå°±ä¼šå­˜åœ¨é—®é¢˜ã€‚åœ¨(åˆ é™¤ Cache çš„æ•°æ®, å’Œæ›´æ–° DB æ•°æ®)æ—¶é—´ä¹‹é—´ï¼Œæ°å¥½æœ‰ä¸€ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¦‚æœä½¿ç”¨è¢«åŠ¨è¯»ï¼Œå› ä¸ºæ­¤æ—¶ DB æ•°æ®è¿˜æ˜¯è€çš„ï¼Œåˆä¼šå°†è€çš„æ•°æ®å†™å…¥åˆ° Cache ä¸­ã€‚</p></blockquote><ol start="2"><li>ç¼“å­˜å’Œ DB çš„æ“ä½œï¼Œä¸åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¯èƒ½åªæœ‰ä¸€ä¸ª DB æ“ä½œæˆåŠŸï¼Œè€Œå¦ä¸€ä¸ª Cache æ“ä½œå¤±è´¥ï¼Œå¯¼è‡´ä¸ä¸€è‡´ã€‚</li></ol><p>å½“ç„¶ï¼Œæœ‰ä¸€ç‚¹æˆ‘ä»¬è¦æ³¨æ„ï¼Œç¼“å­˜å’Œ DB çš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬æŒ‡çš„æ›´å¤šçš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚æˆ‘ä»¬ä½¿ç”¨ç¼“å­˜åªè¦æ˜¯æé«˜è¯»æ“ä½œçš„æ€§èƒ½ï¼ŒçœŸæ­£åœ¨å†™æ“ä½œçš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿˜æ˜¯ä»¥æ•°æ®åº“ä¸ºå‡†ã€‚ä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬å¯èƒ½ç¼“å­˜ç”¨æˆ·é’±åŒ…çš„ä½™é¢åœ¨ç¼“å­˜ä¸­ï¼Œåœ¨å‰ç«¯æŸ¥è¯¢é’±åŒ…ä½™é¢æ—¶ï¼Œè¯»å–ç¼“å­˜ï¼Œåœ¨ä½¿ç”¨é’±åŒ…ä½™é¢æ—¶ï¼Œè¯»å–æ•°æ®åº“ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>åœ¨å¼€å§‹è¯´è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œèƒ–å‹å…ˆçœ‹çœ‹å¦‚ä¸‹å‡ ç¯‡æ–‡ç« ï¼Œå¯èƒ½æœ‰ä¸€ä¸¢ä¸¢å¤šï¼Œä¿æŒè€å¿ƒã€‚</p><p>å½“ç„¶æ— è®ºå“ªç§æ–¹æ¡ˆï¼Œæ¯”è¾ƒé‡è¦çš„å°±æ˜¯è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><ol><li>å°†ç¼“å­˜å¯èƒ½å­˜åœ¨çš„å¹¶è¡Œå†™ï¼Œå®ç°ä¸²è¡Œå†™ã€‚</li></ol></li><li><ol start="2"><li>å®ç°æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ol></li></ul><ol><li>å…ˆæ·˜æ±°ç¼“å­˜ï¼Œå†å†™æ•°æ®åº“ å› ä¸ºå…ˆæ·˜æ±°ç¼“å­˜ï¼Œæ‰€ä»¥æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§æ˜¯å¯ä»¥å¾—åˆ°æœ‰æ•ˆçš„ä¿è¯çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…ˆæ·˜æ±°ç¼“å­˜ï¼Œå³ä½¿å†™æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ¬¡ç¼“å­˜è¯»å–æ—¶ï¼Œå¤šè¯»å–ä¸€æ¬¡æ•°æ®åº“ã€‚</li></ol><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦è§£å†³ç¼“å­˜å¹¶è¡Œå†™ï¼Œå®ç°ä¸²è¡Œå†™ã€‚æ¯”è¾ƒç®€å•çš„æ–¹å¼ï¼Œå¼•å…¥åˆ†å¸ƒå¼é”ã€‚</p><ul><li>åœ¨å†™è¯·æ±‚æ—¶ï¼Œå…ˆæ·˜æ±°ç¼“å­˜ä¹‹å‰ï¼Œå…ˆè·å–è¯¥åˆ†å¸ƒå¼é”ã€‚</li><li>åœ¨è¯»è¯·æ±‚æ—¶ï¼Œå‘ç°ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œå…ˆè·å–åˆ†å¸ƒå¼é”ã€‚</li></ul><ol start="2"><li>å…ˆå†™æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</li></ol><p>æŒ‰ç…§ â€œå…ˆå†™æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜â€ï¼Œæˆ‘ä»¬è¦ä¿è¯ DB å’Œç¼“å­˜çš„æ“ä½œï¼Œèƒ½å¤Ÿåœ¨ â€œåŒä¸€ä¸ªäº‹åŠ¡â€ä¸­ï¼Œä»è€Œå®ç°æœ€ç»ˆä¸€è‡´æ€§</p><h3 id="_10-ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­-å¦‚ä½•å®ç°ç¼“å­˜é¢„çƒ­" tabindex="-1"><a class="header-anchor" href="#_10-ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­-å¦‚ä½•å®ç°ç¼“å­˜é¢„çƒ­"><span>10. ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­ï¼Ÿå¦‚ä½•å®ç°ç¼“å­˜é¢„çƒ­ï¼Ÿ</span></a></h3><p><strong>ç¼“å­˜é¢„çƒ­</strong></p><p>åœ¨åˆšå¯åŠ¨çš„ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œå¦‚æœä¾é ç”¨æˆ·è¯·æ±‚çš„æ–¹å¼é‡å»ºç¼“å­˜æ•°æ®ï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“çš„å‹åŠ›éå¸¸å¤§ï¼Œè€Œä¸”ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚</p><p>æ­¤æ—¶ï¼Œæœ€å¥½çš„ç­–ç•¥æ˜¯å¯åŠ¨æ—¶å°±æŠŠçƒ­ç‚¹æ•°æ®åŠ è½½å¥½ã€‚è¿™æ ·ï¼Œç”¨æˆ·è¯·æ±‚æ—¶ï¼Œç›´æ¥è¯»å–çš„å°±æ˜¯ç¼“å­˜çš„æ•°æ®ï¼Œè€Œæ— éœ€å»è¯»å– DB é‡å»ºç¼“å­˜æ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œçƒ­é—¨çš„æˆ–è€…æ¨èçš„å•†å“ï¼Œéœ€è¦æå‰é¢„çƒ­åˆ°ç¼“å­˜ä¸­ã€‚</p><p><strong>å¦‚ä½•å®ç°</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°ï¼š</p><ul><li>æ•°æ®é‡ä¸å¤§æ—¶ï¼Œé¡¹ç›®å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>å†™ä¸ªä¿®å¤æ•°æ®è„šæœ¬ï¼Œæ‰‹åŠ¨æ‰§è¡Œè¯¥è„šæœ¬ã€‚</li><li>å†™ä¸ªç®¡ç†ç•Œé¢ï¼Œå¯ä»¥æ‰‹åŠ¨ç‚¹å‡»ï¼Œé¢„çƒ­å¯¹åº”çš„æ•°æ®åˆ°ç¼“å­˜ä¸­ã€‚</li></ul><h3 id="æ‹“å±•-ç¼“å­˜æ•°æ®çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#æ‹“å±•-ç¼“å­˜æ•°æ®çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›"><span>æ‹“å±•ï¼šç¼“å­˜æ•°æ®çš„æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</span></a></h3><p>é™¤äº†ç¼“å­˜æœåŠ¡å™¨è‡ªå¸¦çš„ç¼“å­˜è‡ªåŠ¨å¤±æ•ˆç­–ç•¥ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰çš„â€œæ‰‹åŠ¨â€ç¼“å­˜æ·˜æ±°ï¼Œå¸¸è§çš„ç­–ç•¥æœ‰ä¸¤ç§ï¼š</p><ol><li>å®šæ—¶å»æ¸…ç†è¿‡æœŸçš„ç¼“å­˜ã€‚</li><li>å½“æœ‰ç”¨æˆ·è¯·æ±‚è¿‡æ¥æ—¶ï¼Œå†åˆ¤æ–­è¿™ä¸ªè¯·æ±‚æ‰€ç”¨åˆ°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯å°±å»åº•å±‚ç³»ç»Ÿå¾—åˆ°æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚</li></ol><p>ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œç¬¬ä¸€ç§çš„ç¼ºç‚¹æ˜¯ç»´æŠ¤å¤§é‡ç¼“å­˜çš„ key æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œç¬¬äºŒç§çš„ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¿‡æ¥éƒ½è¦åˆ¤æ–­ç¼“å­˜å¤±æ•ˆï¼Œé€»è¾‘ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Redis çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥å°±æ˜¯å¾ˆå¥½çš„å®è·µæ–¹å¼ã€‚</p><p>å…·ä½“ç”¨å“ªç§æ–¹æ¡ˆï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯æ¥æƒè¡¡ã€‚</p><h2 id="docker" tabindex="-1"><a class="header-anchor" href="#docker"><span>Docker</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯-docker-å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯-docker-å®¹å™¨"><span>1. ä»€ä¹ˆæ˜¯ Docker å®¹å™¨ï¼Ÿ</span></a></h3><p>Docker æ˜¯ä¸€ç§æµè¡Œçš„å¼€æºè½¯ä»¶å¹³å°ï¼Œå¯ç®€åŒ–åˆ›å»ºã€ç®¡ç†ã€è¿è¡Œå’Œåˆ†å‘åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ã€‚å®ƒä½¿ç”¨å®¹å™¨æ¥æ‰“åŒ…åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®¹å™¨è§†ä¸º Docker é•œåƒçš„è¿è¡Œæ—¶å®ä¾‹ã€‚</p><h3 id="_2-docker-å’Œè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆä¸åŒ" tabindex="-1"><a class="header-anchor" href="#_2-docker-å’Œè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆä¸åŒ"><span>2. Docker å’Œè™šæ‹Ÿæœºæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span></a></h3><p>Docker æ˜¯è½»é‡çº§çš„æ²™ç›’ï¼Œåœ¨å…¶ä¸­è¿è¡Œçš„åªæ˜¯åº”ç”¨ï¼Œè™šæ‹Ÿæœºé‡Œé¢è¿˜æœ‰é¢å¤–çš„ç³»ç»Ÿã€‚</p><h3 id="_3-ä»€ä¹ˆæ˜¯-dockerfile" tabindex="-1"><a class="header-anchor" href="#_3-ä»€ä¹ˆæ˜¯-dockerfile"><span>3. ä»€ä¹ˆæ˜¯ DockerFileï¼Ÿ</span></a></h3><p>Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬éœ€è¦è¿è¡Œä»¥æ„å»º Docker é•œåƒçš„æ‰€æœ‰å‘½ä»¤ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚Docker ä½¿ç”¨ Dockerfile ä¸­çš„æŒ‡ä»¤è‡ªåŠ¨æ„å»ºé•œåƒã€‚æˆ‘ä»¬å¯ä»¥ <code>docker build</code> ç”¨æ¥åˆ›å»ºæŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªå‘½ä»¤è¡ŒæŒ‡ä»¤çš„è‡ªåŠ¨æ„å»ºã€‚</p><p><strong>ä¸€äº›æœ€å¸¸ç”¨çš„æŒ‡ä»¤å¦‚ä¸‹ï¼š</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ï¼šä½¿ç”¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä¸ºåç»­çš„æŒ‡ä»¤å»ºç«‹åŸºç¡€æ˜ åƒã€‚åœ¨æ‰€æœ‰æœ‰æ•ˆçš„</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Dockerfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä¸­ï¼Œ</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LABELï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> LABEL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æŒ‡ä»¤ç”¨äºç»„ç»‡é¡¹ç›®æ˜ åƒï¼Œæ¨¡å—ï¼Œè®¸å¯ç­‰ã€‚åœ¨è‡ªåŠ¨åŒ–å¸ƒç½²æ–¹é¢</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> LABEL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä¹Ÿæœ‰å¾ˆå¤§ç”¨é€”ã€‚åœ¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> LABEL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä¸­æŒ‡å®šä¸€ç»„é”®å€¼å¯¹ï¼Œå¯ç”¨äºç¨‹åºåŒ–é…ç½®æˆ–å¸ƒç½²</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUNï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æŒ‡ä»¤å¯åœ¨æ˜ åƒå½“å‰å±‚æ‰§è¡Œä»»ä½•å‘½ä»¤å¹¶åˆ›å»ºä¸€ä¸ªæ–°å±‚ï¼Œç”¨äºåœ¨æ˜ åƒå±‚ä¸­æ·»åŠ åŠŸèƒ½å±‚ï¼Œä¹Ÿè®¸æœ€æ¥çš„å±‚ä¼šä¾èµ–å®ƒã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMDï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä½¿ç”¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CMD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æŒ‡ä»¤ä¸ºæ‰§è¡Œçš„å®¹å™¨æä¾›é»˜è®¤å€¼ã€‚åœ¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Dockerfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æ–‡ä»¶ä¸­ï¼Œè‹¥æ·»åŠ å¤šä¸ª</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CMD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æŒ‡ä»¤ï¼Œåªæœ‰æœ€åçš„</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CMD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æŒ‡ä»¤è¿è¡Œã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-ä½¿ç”¨docker-composeæ—¶å¦‚ä½•ä¿è¯å®¹å™¨aå…ˆäºå®¹å™¨bè¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#_4-ä½¿ç”¨docker-composeæ—¶å¦‚ä½•ä¿è¯å®¹å™¨aå…ˆäºå®¹å™¨bè¿è¡Œ"><span>4. ä½¿ç”¨Docker Composeæ—¶å¦‚ä½•ä¿è¯å®¹å™¨Aå…ˆäºå®¹å™¨Bè¿è¡Œï¼Ÿ</span></a></h3><blockquote><p>Docker Compose æ˜¯ä¸€ä¸ªç”¨æ¥å®šä¹‰å’Œè¿è¡Œå¤æ‚åº”ç”¨çš„Dockerå·¥å…·ã€‚ä¸€ä¸ªä½¿ç”¨Dockerå®¹å™¨çš„åº”ç”¨ï¼Œé€šå¸¸ç”±å¤šä¸ªå®¹å™¨ç»„æˆã€‚ä½¿ç”¨Docker Composeä¸å†éœ€è¦ä½¿ç”¨shellè„šæœ¬æ¥å¯åŠ¨å®¹å™¨ã€‚Compose é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥ç®¡ç†å¤šä¸ªDockerå®¹å™¨ã€‚ç®€å•ç†è§£ï¼šDocker Compose æ˜¯dockerçš„ç®¡ç†å·¥å…·ã€‚</p></blockquote><p>Docker Compose åœ¨ç»§ç»­ä¸‹ä¸€ä¸ªå®¹å™¨ä¹‹å‰ä¸ä¼šç­‰å¾…å®¹å™¨å‡†å¤‡å°±ç»ªã€‚ä¸ºäº†æ§åˆ¶æˆ‘ä»¬çš„æ‰§è¡Œé¡ºåºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ<strong>å–å†³äº</strong>â€æ¡ä»¶ï¼Œ<code>depends_on</code> ã€‚è¿™æ˜¯åœ¨ docker-compose.yml æ–‡ä»¶ä¸­ä½¿ç”¨çš„ç¤ºä¾‹</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;2.4&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;"> backend</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">   build</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">.</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # æ„å»ºè‡ªå®šä¹‰é•œåƒ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">   depends_on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">     - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">db</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;"> db</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">   image</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨ <code>docker-compose up</code> å‘½ä»¤å°†æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„ä¾èµ–é¡ºåºå¯åŠ¨å’Œè¿è¡ŒæœåŠ¡ã€‚</p><h3 id="_5-ä¸€ä¸ªå®Œæ•´çš„dockerç”±å“ªäº›éƒ¨åˆ†ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#_5-ä¸€ä¸ªå®Œæ•´çš„dockerç”±å“ªäº›éƒ¨åˆ†ç»„æˆ"><span>5. ä¸€ä¸ªå®Œæ•´çš„Dockerç”±å“ªäº›éƒ¨åˆ†ç»„æˆ?</span></a></h3><ul><li>DockerClient å®¢æˆ·ç«¯</li><li>Docker Daemon å®ˆæŠ¤è¿›ç¨‹</li><li>Docker Image é•œåƒ</li><li>DockerContainer å®¹å™¨</li></ul><h3 id="_6-dockerå¸¸ç”¨å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_6-dockerå¸¸ç”¨å‘½ä»¤"><span>6. dockerå¸¸ç”¨å‘½ä»¤</span></a></h3><blockquote><p>å‘½ä»¤å»ºè®®åœ¨æœ¬åœ°å®‰è£…åšä¸€ä¸ªå®æ“ï¼Œè®°å¿†ä¼šæ›´æ·±åˆ»ã€‚ ä¹Ÿå¯ä»¥å…‹éš†åŸºäºdockerçš„ä¿©ä¸‡ï¼ˆspringboot+vueï¼‰é¡¹ç›®ç»ƒæ‰‹ï¼Œæä¾›è§†é¢‘+å®Œå–„æ–‡æ¡£ã€‚åœ°å€ï¼š<a href="https://gitee.com/rodert/liawan-vue" target="_blank" rel="noopener noreferrer">https://gitee.com/rodert/liawan-vue</a></p></blockquote><ol><li>æŸ¥çœ‹æœ¬åœ°ä¸»æœºçš„æ‰€ç”¨é•œåƒï¼š`docker images``</li><li>æœç´¢é•œåƒï¼š`docker search mysql``</li><li>ä¸‹è½½é•œåƒï¼š<code>docker pull mysql</code>ï¼Œæ²¡å†™ tag å°±é»˜è®¤ä¸‹è½½æœ€æ–°çš„ lastest</li><li>ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼š`docker pull mysql:5.7``</li><li>åˆ é™¤é•œåƒï¼š`docker rmi -f é•œåƒid é•œåƒid é•œåƒid``</li></ol><h3 id="_7-æè¿°-docker-å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚" tabindex="-1"><a class="header-anchor" href="#_7-æè¿°-docker-å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚"><span>7. æè¿° Docker å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</span></a></h3><p>Docker å®¹å™¨ç»å†ä»¥ä¸‹é˜¶æ®µï¼š</p><ul><li>åˆ›å»ºå®¹å™¨</li><li>è¿è¡Œå®¹å™¨</li><li>æš‚åœå®¹å™¨ï¼ˆå¯é€‰ï¼‰</li><li>å–æ¶ˆæš‚åœå®¹å™¨ï¼ˆå¯é€‰ï¼‰</li><li>å¯åŠ¨å®¹å™¨</li><li>åœæ­¢å®¹å™¨</li><li>é‡å¯å®¹å™¨</li><li>æ€æ­»å®¹å™¨</li><li>é”€æ¯å®¹å™¨</li></ul><h3 id="_8-dockerå®¹å™¨ä¹‹é—´æ€ä¹ˆéš”ç¦»" tabindex="-1"><a class="header-anchor" href="#_8-dockerå®¹å™¨ä¹‹é—´æ€ä¹ˆéš”ç¦»"><span>8. dockerå®¹å™¨ä¹‹é—´æ€ä¹ˆéš”ç¦»?</span></a></h3><blockquote><p>è¿™æ˜¯ä¸€é“æ¶‰çŒå¾ˆå¹¿æ³›çš„é¢˜ç›®ï¼Œç†è§£æ€§é˜…è¯»ã€‚</p></blockquote><p>Linuxä¸­çš„PIDã€IPCã€ç½‘ç»œç­‰èµ„æºæ˜¯å…¨å±€çš„ï¼Œè€ŒLinuxçš„NameSpaceæœºåˆ¶æ˜¯ä¸€ç§èµ„æºéš”ç¦»æ–¹æ¡ˆï¼Œåœ¨è¯¥æœºåˆ¶ä¸‹è¿™äº›èµ„æºå°±ä¸å†æ˜¯å…¨å±€çš„äº†ï¼Œè€Œæ˜¯å±äºæŸä¸ªç‰¹å®šçš„NameSpaceï¼Œå„ä¸ªNameSpaceä¸‹çš„èµ„æºäº’ä¸å¹²æ‰°ã€‚</p><p>**Namespaceå®é™…ä¸Šä¿®æ”¹äº†åº”ç”¨è¿›ç¨‹çœ‹å¾…æ•´ä¸ªè®¡ç®—æœºâ€œè§†å›¾â€ï¼Œå³å®ƒçš„â€œè§†çº¿â€è¢«æ“ä½œç³»ç»Ÿåšäº†é™åˆ¶ï¼Œåªèƒ½â€œçœ‹åˆ°â€æŸäº›æŒ‡å®šçš„å†…å®¹â€‹â€‹ã€‚**å¯¹äºå®¿ä¸»æœºæ¥è¯´ï¼Œè¿™äº›è¢«â€œéš”ç¦»â€äº†çš„è¿›ç¨‹è·Ÿå…¶ä»–è¿›ç¨‹å¹¶æ²¡æœ‰åŒºåˆ«ã€‚</p><p>è™½ç„¶æœ‰äº†NameSpaceæŠ€æœ¯å¯ä»¥å®ç°èµ„æºéš”ç¦»ï¼Œä½†è¿›ç¨‹è¿˜æ˜¯å¯ä»¥ä¸å—æ§çš„è®¿é—®ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰ï¼Œä¸ºäº†æ§åˆ¶å®¹å™¨ä¸­è¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®ï¼ŒDockeré‡‡ç”¨control groupsæŠ€æœ¯(ä¹Ÿå°±æ˜¯cgroup)ï¼Œæœ‰äº†cgroupå°±å¯ä»¥æ§åˆ¶å®¹å™¨ä¸­è¿›ç¨‹å¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—äº†ï¼Œæ¯”å¦‚ä½ å¯ä»¥é™åˆ¶æŸä¸ªå®¹å™¨ä½¿ç”¨å†…å­˜çš„ä¸Šé™ã€å¯ä»¥åœ¨å“ªäº›CPUä¸Šè¿è¡Œç­‰ç­‰ã€‚</p><p>æœ‰äº†è¿™ä¸¤é¡¹æŠ€æœ¯ï¼Œå®¹å™¨çœ‹èµ·æ¥å°±çœŸçš„åƒæ˜¯ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿäº†ã€‚</p><blockquote><p>å¼ºçƒˆå»ºè®®å¤§å®¶å®æ“ï¼Œæ‰èƒ½æ›´å¥½çš„ç†è§£dockerã€‚</p></blockquote><p>ä½è°·è“„åŠ›</p><h2 id="elasticsearch" tabindex="-1"><a class="header-anchor" href="#elasticsearch"><span>ElasticSearch</span></a></h2><h3 id="_1-è¯´è¯´ä½ ä»¬å…¬å¸-es-çš„é›†ç¾¤æ¶æ„-ç´¢å¼•æ•°æ®å¤§å°-åˆ†ç‰‡æœ‰å¤šå°‘-ä»¥åŠä¸€äº›è°ƒä¼˜æ‰‹æ®µ-ã€‚" tabindex="-1"><a class="header-anchor" href="#_1-è¯´è¯´ä½ ä»¬å…¬å¸-es-çš„é›†ç¾¤æ¶æ„-ç´¢å¼•æ•°æ®å¤§å°-åˆ†ç‰‡æœ‰å¤šå°‘-ä»¥åŠä¸€äº›è°ƒä¼˜æ‰‹æ®µ-ã€‚"><span>1. è¯´è¯´ä½ ä»¬å…¬å¸ es çš„é›†ç¾¤æ¶æ„ï¼Œç´¢å¼•æ•°æ®å¤§å°ï¼Œåˆ†ç‰‡æœ‰å¤šå°‘ï¼Œä»¥åŠä¸€äº›è°ƒä¼˜æ‰‹æ®µ ã€‚</span></a></h3><p>èŠ‚ç‚¹æ•°ã€åˆ†ç‰‡æ•°ã€å‰¯æœ¬æ•°ï¼Œå°½é‡æ ¹æ®è‡ªå·±å…¬å¸ä½¿ç”¨æƒ…å†µå›ç­”ï¼Œå½“ç„¶é€‚å½“æ”¾å¤§ä¹Ÿå¯è¡Œã€‚</p><p>è°ƒä¼˜æ‰‹æ®µæ˜¯ç°åœ¨å¾ˆå¸¸è§çš„é¢è¯•é¢˜ï¼Œä¸‹é¢è¿™å‡ ç§è°ƒä¼˜æ‰‹æ®µä¸€å®šè¦äº†è§£æ‡‚ã€‚å½“ç„¶ï¼Œä¸‹é¢çš„æ¯ä¸€æ¡éƒ½å¯ä»¥å½“åšè°ƒä¼˜çš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>è®¾è®¡è°ƒä¼˜</strong></p><p>å‚è€ƒï¼š https://www.cnblogs.com/sanduzxcvbnm/p/12084012.html</p><p>a. æ ¹æ®ä¸šåŠ¡å¢é‡éœ€æ±‚ï¼Œé‡‡å–åŸºäºæ—¥æœŸæ¨¡æ¿åˆ›å»ºç´¢å¼•ï¼Œé€šè¿‡ <code>rollover API</code> æ»šåŠ¨ç´¢å¼•ï¼›(rollover APIæˆ‘ä¼šå•ç‹¬å†™ä¸€ä¸ªä»£ç æ¡ˆä¾‹åšè®²è§£ï¼Œå…¬ä¼—å·ï¼šJavaPub) b. ä½¿ç”¨åˆ«åè¿›è¡Œç´¢å¼•ç®¡ç†ï¼›ï¼ˆesçš„ç´¢å¼•åä¸èƒ½æ”¹å˜ï¼Œæä¾›çš„åˆ«åæœºåˆ¶ä½¿ç”¨éå¸¸å¹¿æ³›ã€‚ï¼‰ c. æ¯å¤©å‡Œæ™¨å®šæ—¶å¯¹ç´¢å¼•åšforce_mergeæ“ä½œï¼Œä»¥é‡Šæ”¾ç©ºé—´ï¼› d. é‡‡å–å†·çƒ­åˆ†ç¦»æœºåˆ¶ï¼Œçƒ­æ•°æ®å­˜å‚¨åˆ°SSDï¼Œæé«˜æ£€ç´¢æ•ˆç‡ï¼›å†·æ•°æ®å®šæœŸè¿›è¡Œshrinkæ“ä½œï¼Œä»¥ç¼©å‡å­˜å‚¨ï¼› e. é‡‡å–curatorè¿›è¡Œç´¢å¼•çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼› f. ä»…é’ˆå¯¹éœ€è¦åˆ†è¯çš„å­—æ®µï¼Œåˆç†çš„è®¾ç½®åˆ†è¯å™¨ï¼› g. Mappingé˜¶æ®µå……åˆ†ç»“åˆå„ä¸ªå­—æ®µçš„å±æ€§ï¼Œæ˜¯å¦éœ€è¦æ£€ç´¢ã€æ˜¯å¦éœ€è¦å­˜å‚¨ç­‰ã€‚</p><p>è¿›100+åŸåˆ›æ–‡ç« ï¼šhttps://gitee.com/rodert/JavaPub</p><p><strong>å†™å…¥è°ƒä¼˜</strong></p><ol><li>å†™å…¥å‰å‰¯æœ¬æ•°è®¾ç½®ä¸º0ï¼›</li><li>å†™å…¥å‰å…³é—­refresh_intervalè®¾ç½®ä¸º-1ï¼Œç¦ç”¨åˆ·æ–°æœºåˆ¶ï¼›</li><li>å†™å…¥è¿‡ç¨‹ä¸­ï¼šé‡‡å–bulkæ‰¹é‡å†™å…¥ï¼›</li><li>å†™å…¥åæ¢å¤å‰¯æœ¬æ•°å’Œåˆ·æ–°é—´éš”ï¼›</li><li>å°½é‡ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„idã€‚</li></ol><p><strong>æŸ¥è¯¢è°ƒä¼˜</strong></p><ol><li>ç¦ç”¨wildcardï¼›ï¼ˆé€šé…ç¬¦æ¨¡å¼ï¼Œç±»ä¼¼äº%like%ï¼‰</li><li>ç¦ç”¨æ‰¹é‡termsï¼ˆæˆç™¾ä¸Šåƒçš„åœºæ™¯ï¼‰ï¼›</li><li>å……åˆ†åˆ©ç”¨å€’æ’ç´¢å¼•æœºåˆ¶ï¼Œèƒ½keywordç±»å‹å°½é‡keywordï¼›</li><li>æ•°æ®é‡å¤§æ—¶å€™ï¼Œå¯ä»¥å…ˆåŸºäºæ—¶é—´æ•²å®šç´¢å¼•å†æ£€ç´¢ï¼›</li><li>è®¾ç½®åˆç†çš„è·¯ç”±æœºåˆ¶ã€‚</li></ol><h3 id="_2-elasticsearch-çš„å€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_2-elasticsearch-çš„å€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆ"><span>2. elasticsearch çš„å€’æ’ç´¢å¼•æ˜¯ä»€ä¹ˆ</span></a></h3><p>å€’æ’ç´¢å¼•ä¹Ÿå°±æ˜¯å•è¯åˆ°æ–‡æ¡£çš„æ˜ å°„ï¼Œå½“ç„¶ä¸åªæ˜¯å­˜é‡Œæ–‡æ¡£idè¿™ä¹ˆç®€å•ã€‚è¿˜åŒ…æ‹¬ï¼šè¯é¢‘ï¼ˆTFï¼ŒTerm Frequencyï¼‰ã€åç§»é‡ï¼ˆoffsetï¼‰ã€ä½ç½®ï¼ˆPostingï¼‰ã€‚</p><h3 id="_3-elasticsearch-æ˜¯å¦‚ä½•å®ç°-master-é€‰ä¸¾çš„" tabindex="-1"><a class="header-anchor" href="#_3-elasticsearch-æ˜¯å¦‚ä½•å®ç°-master-é€‰ä¸¾çš„"><span>3. elasticsearch æ˜¯å¦‚ä½•å®ç° master é€‰ä¸¾çš„</span></a></h3><blockquote><p>ElasticSearch çš„é€‰ä¸»æ˜¯ ZenDiscovery æ¨¡å—è´Ÿè´£ï¼Œæºç åˆ†æå°†é¦–å‘åœ¨ã€‚ https://gitee.com/rodert/JavaPub</p></blockquote><ol><li>å¯¹æ‰€æœ‰å¯ä»¥æˆä¸º Master çš„èŠ‚ç‚¹ï¼ˆnode.master: trueï¼‰æ ¹æ® nodeId æ’åºï¼Œæ¯æ¬¡é€‰ä¸¾æ¯ä¸ªèŠ‚ç‚¹éƒ½æŠŠè‡ªå·±æ‰€çŸ¥é“èŠ‚ç‚¹æ’ä¸€æ¬¡åºï¼Œç„¶åé€‰å‡ºç¬¬ä¸€ä¸ªï¼ˆç¬¬0ä½ï¼‰èŠ‚ç‚¹ï¼Œæš‚ä¸”è®¤ä¸ºå®ƒæ˜¯ Master èŠ‚ç‚¹ã€‚</li><li>å¦‚æœå¯¹æŸä¸ªèŠ‚ç‚¹çš„æŠ•ç¥¨æ•°è¾¾åˆ°ä¸€å®šçš„å€¼ï¼ˆå¯ä»¥æˆä¸ºmasterèŠ‚ç‚¹æ•°n/2+1ï¼‰å¹¶ä¸”è¯¥èŠ‚ç‚¹è‡ªå·±ä¹Ÿé€‰ä¸¾è‡ªå·±ï¼Œé‚£è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯masterã€‚å¦åˆ™é‡æ–°é€‰ä¸¾ã€‚ (å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±è®¾å®šä¸€ä¸ªå€¼ï¼Œæœ€å°å€¼è®¾å®šä¸ºè¶…è¿‡èƒ½æˆä¸ºMasterèŠ‚ç‚¹çš„n/2+1ï¼Œå¦åˆ™ä¼šå‡ºç°è„‘è£‚é—®é¢˜ã€‚discovery.zen.minimum_master_nodes)</li></ol><h3 id="_5-æè¿°ä¸€ä¸‹-elasticsearch-ç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_5-æè¿°ä¸€ä¸‹-elasticsearch-ç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹"><span>5. æè¿°ä¸€ä¸‹ Elasticsearch ç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹</span></a></h3><figure><img src="https://tva3.sinaimg.cn/large/007F3CC8ly1h0niy8fcitj30ku09d3zr.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><ol><li>å®¢æˆ·ç«¯å‘ Node 1 å‘é€æ–°å»ºã€ç´¢å¼•æˆ–è€…åˆ é™¤è¯·æ±‚ã€‚</li><li>èŠ‚ç‚¹ä½¿ç”¨æ–‡æ¡£çš„ _id ç¡®å®šæ–‡æ¡£å±äºåˆ†ç‰‡ 0 ã€‚è¯·æ±‚ä¼šè¢«è½¬å‘åˆ° Node 3ï¼Œå› ä¸ºåˆ†ç‰‡ 0 çš„ä¸»åˆ†ç‰‡ç›®å‰è¢«åˆ†é…åœ¨ Node 3 ä¸Šã€‚</li><li>Node 3 åœ¨ä¸»åˆ†ç‰‡ä¸Šé¢æ‰§è¡Œè¯·æ±‚ã€‚å¦‚æœæˆåŠŸäº†ï¼Œå®ƒå°†è¯·æ±‚å¹¶è¡Œè½¬å‘åˆ° Node 1 å’Œ Node 2 çš„å‰¯æœ¬åˆ†ç‰‡ä¸Šã€‚ä¸€æ—¦æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æŠ¥å‘ŠæˆåŠŸ, Node 3 å°†å‘åè°ƒèŠ‚ç‚¹æŠ¥å‘ŠæˆåŠŸï¼Œåè°ƒèŠ‚ç‚¹å‘å®¢æˆ·ç«¯æŠ¥å‘ŠæˆåŠŸã€‚</li></ol><p><strong>ä¸€å›¾èƒœåƒæ–‡ï¼Œè®°ä½è¿™å¹…å›¾ï¼Œä¸Šé¢æ˜¯æ–‡æ¡£åœ¨èŠ‚ç‚¹é—´åˆ†å‘çš„è¿‡ç¨‹ï¼Œæ¥ç€è¯´ä¸€ä¸‹æ–‡æ¡£ä»æ¥æ”¶åˆ°å†™å…¥ç£ç›˜è¿‡ç¨‹ã€‚</strong> åè°ƒèŠ‚ç‚¹é»˜è®¤ä½¿ç”¨æ–‡æ¡£ ID å‚ä¸è®¡ç®—ï¼ˆä¹Ÿæ”¯æŒé€šè¿‡ routingï¼‰ï¼Œä»¥ä¾¿ä¸ºè·¯ç”±æä¾›åˆé€‚çš„åˆ†ç‰‡ã€‚</p><blockquote><p>shard = hash(document_id) % (num_of_primary_shards)</p></blockquote><ol><li>å½“åˆ†ç‰‡æ‰€åœ¨çš„èŠ‚ç‚¹æ¥æ”¶åˆ°æ¥è‡ªåè°ƒèŠ‚ç‚¹çš„è¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚å†™å…¥åˆ° MemoryBufferï¼Œç„¶åå®šæ—¶ï¼ˆé»˜è®¤æ˜¯æ¯éš” 1 ç§’ï¼‰å†™å…¥åˆ° Filesystem Cacheï¼Œè¿™ä¸ªä» MomeryBuffer åˆ° Filesystem Cache çš„è¿‡ç¨‹å°±å«åš refreshï¼›</li><li>å½“ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå­˜åœ¨ Momery Buffer å’Œ Filesystem Cache çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼ŒES æ˜¯é€šè¿‡ translog çš„æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å¯é æ€§çš„ã€‚å…¶å®ç°æœºåˆ¶æ˜¯æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒåŒæ—¶ä¹Ÿä¼šå†™å…¥åˆ° translog ä¸­ï¼Œå½“ Filesystem cache ä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­æ—¶ï¼Œæ‰ä¼šæ¸…é™¤æ‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš flushï¼›</li><li>åœ¨ flush è¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸­çš„ç¼“å†²å°†è¢«æ¸…é™¤ï¼Œå†…å®¹è¢«å†™å…¥ä¸€ä¸ªæ–°æ®µï¼Œæ®µçš„ fsyncå°†åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ç‚¹ï¼Œå¹¶å°†å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ—§çš„ translog å°†è¢«åˆ é™¤å¹¶å¼€å§‹ä¸€ä¸ªæ–°çš„ translogã€‚</li><li>flush è§¦å‘çš„æ—¶æœºæ˜¯å®šæ—¶è§¦å‘ï¼ˆé»˜è®¤ 30 åˆ†é’Ÿï¼‰æˆ–è€… translog å˜å¾—å¤ªå¤§ï¼ˆé»˜è®¤ä¸º 512Mï¼‰æ—¶ï¼›</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> translog</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸€ç›´è¿½åŠ ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MemoryBuffer</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> åº”ç”¨ç¼“å­˜ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Filesystem</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Cache</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ç³»ç»Ÿç¼“å†²åŒºã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å»¶ä¼¸é˜…è¯»ï¼šLucene çš„ <code>Segement</code>:</p><blockquote><ol><li>Lucene ç´¢å¼•æ˜¯ç”±å¤šä¸ªæ®µç»„æˆï¼Œæ®µæœ¬èº«æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„å€’æ’ç´¢å¼•ã€‚</li><li>æ®µæ˜¯ä¸å¯å˜çš„ï¼Œå…è®¸ Lucene å°†æ–°çš„æ–‡æ¡£å¢é‡åœ°æ·»åŠ åˆ°ç´¢å¼•ä¸­ï¼Œè€Œä¸ç”¨ä»å¤´é‡å»ºç´¢å¼•ã€‚</li><li>å¯¹äºæ¯ä¸€ä¸ªæœç´¢è¯·æ±‚è€Œè¨€ï¼Œç´¢å¼•ä¸­çš„æ‰€æœ‰æ®µéƒ½ä¼šè¢«æœç´¢ï¼Œå¹¶ä¸”æ¯ä¸ªæ®µä¼šæ¶ˆè€—CPU çš„æ—¶é’Ÿå‘¨ã€æ–‡ä»¶å¥æŸ„å’Œå†…å­˜ã€‚è¿™æ„å‘³ç€æ®µçš„æ•°é‡è¶Šå¤šï¼Œæœç´¢æ€§èƒ½ä¼šè¶Šä½ã€‚</li><li>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒElasticsearch ä¼šåˆå¹¶å°æ®µåˆ°ä¸€ä¸ªè¾ƒå¤§çš„æ®µï¼Œæäº¤æ–°çš„åˆå¹¶æ®µåˆ°ç£ç›˜ï¼Œå¹¶åˆ é™¤é‚£äº›æ—§çš„å°æ®µã€‚</li></ol></blockquote><h3 id="_4-è¯¦ç»†æè¿°ä¸€ä¸‹-elasticsearch-æœç´¢çš„è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-è¯¦ç»†æè¿°ä¸€ä¸‹-elasticsearch-æœç´¢çš„è¿‡ç¨‹"><span>4. è¯¦ç»†æè¿°ä¸€ä¸‹ Elasticsearch æœç´¢çš„è¿‡ç¨‹ï¼Ÿ</span></a></h3><blockquote><p>esä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼çš„å­˜å‚¨å’Œæ£€ç´¢ç³»ç»Ÿï¼Œæ¯ä¸ªæ–‡æ¡£æ ¹æ® _id å­—æ®µåšè·¯ç”±åˆ†å‘è¢«è½¬å‘åˆ°å¯¹åº”çš„shardä¸Šã€‚</p></blockquote><p>æœç´¢æ‰§è¡Œé˜¶æ®µè¿‡ç¨‹åˆ†ä¿©ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Query Then Fetchã€‚</p><p><strong>4.1 query-æŸ¥è¯¢é˜¶æ®µ</strong></p><p>å½“ä¸€ä¸ªsearchè¯·æ±‚å‘å‡ºçš„æ—¶å€™ï¼Œè¿™ä¸ªqueryä¼šè¢«å¹¿æ’­åˆ°ç´¢å¼•é‡Œé¢çš„æ¯ä¸€ä¸ªshardï¼ˆä¸»shardæˆ–å‰¯æœ¬shardï¼‰ï¼Œæ¯ä¸ªshardä¼šåœ¨æœ¬åœ°æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚åä¼šç”Ÿæˆä¸€ä¸ªå‘½ä¸­æ–‡æ¡£çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><p>è¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸€ä¸ªæ’åºå¥½çš„top Næ•°æ®çš„åˆ—è¡¨ï¼Œå®ƒçš„sizeç­‰äºfrom+sizeçš„å’Œï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ çš„fromæ˜¯10ï¼Œsizeæ˜¯10ï¼Œé‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—çš„sizeå°±æ˜¯20ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ·±åº¦åˆ†é¡µä¸èƒ½ç”¨from+sizeè¿™ç§æ–¹å¼ï¼Œå› ä¸ºfromè¶Šå¤§ï¼Œæ€§èƒ½å°±è¶Šä½ã€‚</p><p>esé‡Œé¢åˆ†å¸ƒå¼searchçš„æŸ¥è¯¢æµç¨‹å¦‚ä¸‹ï¼š</p><figure><img src="https://tva2.sinaimg.cn/large/007F3CC8ly1h0niv378zsj30lh08z75i.jpg" alt="esé‡Œé¢åˆ†å¸ƒå¼searchçš„æŸ¥è¯¢æµç¨‹" tabindex="0" loading="lazy"><figcaption>esé‡Œé¢åˆ†å¸ƒå¼searchçš„æŸ¥è¯¢æµç¨‹</figcaption></figure><p>æŸ¥è¯¢é˜¶æ®µåŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤:</p><ol><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª search è¯·æ±‚åˆ° Node 3 ï¼Œ Node 3 ä¼šåˆ›å»ºä¸€ä¸ªå¤§å°ä¸º from + size çš„ç©ºä¼˜å…ˆé˜Ÿåˆ—ã€‚</li><li>Node 3 å°†æŸ¥è¯¢è¯·æ±‚è½¬å‘åˆ°ç´¢å¼•çš„æ¯ä¸ªä¸»åˆ†ç‰‡æˆ–å‰¯æœ¬åˆ†ç‰‡ä¸­ã€‚æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡ŒæŸ¥è¯¢å¹¶æ·»åŠ ç»“æœåˆ°å¤§å°ä¸º from + size çš„æœ¬åœ°æœ‰åºä¼˜å…ˆé˜Ÿåˆ—ä¸­ã€‚</li><li>æ¯ä¸ªåˆ†ç‰‡è¿”å›å„è‡ªä¼˜å…ˆé˜Ÿåˆ—ä¸­æ‰€æœ‰æ–‡æ¡£çš„ ID å’Œæ’åºå€¼ç»™åè°ƒèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ Node 3 ï¼Œå®ƒåˆå¹¶è¿™äº›å€¼åˆ°è‡ªå·±çš„ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ¥äº§ç”Ÿä¸€ä¸ªå…¨å±€æ’åºåçš„ç»“æœåˆ—è¡¨ã€‚</li></ol><p><strong>4.2 fetch - è¯»å–é˜¶æ®µ / å–å›é˜¶æ®µ</strong></p><figure><img src="https://tva3.sinaimg.cn/large/007F3CC8ly1h0niuhpty3j30ka08mdh1.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><p>åˆ†å¸ƒå¼é˜¶æ®µç”±ä»¥ä¸‹æ­¥éª¤æ„æˆï¼š</p><ol><li>åè°ƒèŠ‚ç‚¹è¾¨åˆ«å‡ºå“ªäº›æ–‡æ¡£éœ€è¦è¢«å–å›å¹¶å‘ç›¸å…³çš„åˆ†ç‰‡æäº¤å¤šä¸ª GET è¯·æ±‚ã€‚</li><li>æ¯ä¸ªåˆ†ç‰‡åŠ è½½å¹¶ ä¸°å¯Œ æ–‡æ¡£ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæ¥ç€è¿”å›æ–‡æ¡£ç»™åè°ƒèŠ‚ç‚¹ã€‚</li><li>ä¸€æ—¦æ‰€æœ‰çš„æ–‡æ¡£éƒ½è¢«å–å›äº†ï¼Œåè°ƒèŠ‚ç‚¹è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚</li></ol><p>åè°ƒèŠ‚ç‚¹é¦–å…ˆå†³å®šå“ªäº›æ–‡æ¡£ ç¡®å® éœ€è¦è¢«å–å›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„æŸ¥è¯¢æŒ‡å®šäº† { &quot;from&quot;: 90, &quot;size&quot;: 10 } ï¼Œæœ€åˆçš„90ä¸ªç»“æœä¼šè¢«ä¸¢å¼ƒï¼Œåªæœ‰ä»ç¬¬91ä¸ªå¼€å§‹çš„10ä¸ªç»“æœéœ€è¦è¢«å–å›ã€‚è¿™äº›æ–‡æ¡£å¯èƒ½æ¥è‡ªå’Œæœ€åˆæœç´¢è¯·æ±‚æœ‰å…³çš„ä¸€ä¸ªã€å¤šä¸ªç”šè‡³å…¨éƒ¨åˆ†ç‰‡ã€‚</p><p>åè°ƒèŠ‚ç‚¹ç»™æŒæœ‰ç›¸å…³æ–‡æ¡£çš„æ¯ä¸ªåˆ†ç‰‡åˆ›å»ºä¸€ä¸ª multi-get request ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åŒæ ·å¤„ç†æŸ¥è¯¢é˜¶æ®µçš„åˆ†ç‰‡å‰¯æœ¬ã€‚</p><p>åˆ†ç‰‡åŠ è½½æ–‡æ¡£ä½“-- _source å­—æ®µâ€”â€‹å¦‚æœæœ‰éœ€è¦ï¼Œç”¨å…ƒæ•°æ®å’Œ search snippet highlighting ä¸°å¯Œç»“æœæ–‡æ¡£ã€‚ ä¸€æ—¦åè°ƒèŠ‚ç‚¹æ¥æ”¶åˆ°æ‰€æœ‰çš„ç»“æœæ–‡æ¡£ï¼Œå®ƒå°±ç»„è£…è¿™äº›ç»“æœä¸ºå•ä¸ªå“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">æ‹“å±•é˜…è¯»ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">æ·±ç¿»é¡µï¼ˆDeep</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Paginationï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">å…ˆæŸ¥åå–çš„è¿‡ç¨‹æ”¯æŒç”¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å’Œ</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> size</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å‚æ•°åˆ†é¡µï¼Œä½†æ˜¯è¿™æ˜¯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æœ‰é™åˆ¶çš„</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ã€‚</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è¦è®°ä½éœ€è¦ä¼ é€’ä¿¡æ¯ç»™åè°ƒèŠ‚ç‚¹çš„æ¯ä¸ªåˆ†ç‰‡å¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ª</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> size</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> é•¿åº¦çš„é˜Ÿåˆ—ï¼Œåè°ƒèŠ‚ç‚¹éœ€è¦æ ¹æ®</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> number_of_shards</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (from </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) æ’åºæ–‡æ¡£ï¼Œæ¥æ‰¾åˆ°è¢«åŒ…å«åœ¨ size é‡Œçš„æ–‡æ¡£ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">å–å†³äºä½ çš„æ–‡æ¡£çš„å¤§å°ï¼Œåˆ†ç‰‡çš„æ•°é‡å’Œä½ ä½¿ç”¨çš„ç¡¬ä»¶ï¼Œç»™</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 10,000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> åˆ°</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 50,000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> çš„ç»“æœæ–‡æ¡£æ·±åˆ†é¡µï¼ˆ</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 1,000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> åˆ°</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 5,000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> é¡µï¼‰æ˜¯å®Œå…¨å¯è¡Œçš„ã€‚ä½†æ˜¯ä½¿ç”¨è¶³å¤Ÿå¤§çš„</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å€¼ï¼Œæ’åºè¿‡ç¨‹å¯èƒ½ä¼šå˜å¾—éå¸¸æ²‰é‡ï¼Œä½¿ç”¨å¤§é‡çš„CPUã€å†…å­˜å’Œå¸¦å®½ã€‚å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ä¸è¦ä½¿ç”¨æ·±åˆ†é¡µã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">å®é™…ä¸Šï¼Œ</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> â€œæ·±åˆ†é¡µâ€</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å¾ˆå°‘ç¬¦åˆäººçš„è¡Œä¸ºã€‚å½“2åˆ°3é¡µè¿‡å»ä»¥åï¼Œäººä¼šåœæ­¢ç¿»é¡µï¼Œå¹¶ä¸”æ”¹å˜æœç´¢æ ‡å‡†ã€‚ä¼šä¸çŸ¥ç–²å€¦åœ°ä¸€é¡µä¸€é¡µçš„è·å–ç½‘é¡µç›´åˆ°ä½ çš„æœåŠ¡å´©æºƒçš„ç½ªé­ç¥¸é¦–ä¸€èˆ¬æ˜¯æœºå™¨äººæˆ–è€…web</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> spiderã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">å¦‚æœä½ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ç¡®å®</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> éœ€è¦ä»ä½ çš„é›†ç¾¤å–å›å¤§é‡çš„æ–‡æ¡£ï¼Œä½ å¯ä»¥é€šè¿‡ç”¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> scroll</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æŸ¥è¯¢ç¦ç”¨æ’åºä½¿è¿™ä¸ªå–å›è¡Œä¸ºæ›´æœ‰æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šåœ¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> later</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chapter</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è¿›è¡Œè®¨è®ºã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">æ³¨ï¼šhttps://www.elastic.co/guide/cn/elasticsearch/guide/current/scroll.html</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-elasticsearch-åœ¨éƒ¨ç½²æ—¶-å¯¹-linux-çš„è®¾ç½®æœ‰å“ªäº›ä¼˜åŒ–æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_5-elasticsearch-åœ¨éƒ¨ç½²æ—¶-å¯¹-linux-çš„è®¾ç½®æœ‰å“ªäº›ä¼˜åŒ–æ–¹æ³•"><span>5. Elasticsearch åœ¨éƒ¨ç½²æ—¶ï¼Œå¯¹ Linux çš„è®¾ç½®æœ‰å“ªäº›ä¼˜åŒ–æ–¹æ³•</span></a></h3><ol><li>å…³é—­ç¼“å­˜swap;</li></ol><blockquote><p>åŸå› ï¼šå¤§å¤šæ•°æ“ä½œç³»ç»Ÿä¼šå°†å†…å­˜ä½¿ç”¨åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œä¼šå°†åº”ç”¨ç¨‹åºæœªç”¨åˆ°çš„å†…å­˜äº¤æ¢å‡ºå»ã€‚ä¼šå¯¼è‡´jvmçš„å †å†…å­˜äº¤æ¢åˆ°ç£ç›˜ä¸Šã€‚äº¤æ¢ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä¼šå¯¼è‡´å†…å­˜åƒåœ¾å›æ”¶å»¶é•¿ã€‚ä¼šå¯¼è‡´é›†ç¾¤èŠ‚ç‚¹å“åº”æ—¶é—´å˜æ…¢ï¼Œæˆ–è€…ä»é›†ç¾¤ä¸­æ–­å¼€ã€‚</p></blockquote><ol start="2"><li><p>å †å†…å­˜è®¾ç½®ä¸ºï¼šMinï¼ˆèŠ‚ç‚¹å†…å­˜/2, 32GBï¼‰;</p></li><li><p>è®¾ç½®æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°ï¼›</p></li></ol><p><strong>åä¿©ç‚¹ä¸æ‡‚å¯ä»¥å…ˆè¯´æœ‰ä¸€å®šäº†è§£ï¼Œå…³æ³¨JavaPubä¼šåšè¯¦ç»†è®²è§£ã€‚</strong></p><ol start="4"><li><p>è°ƒæ•´çº¿ç¨‹æ± å’Œé˜Ÿåˆ—å¤§å°</p></li><li><p>ç£ç›˜å­˜å‚¨ raid æ–¹å¼â€”â€”å­˜å‚¨æœ‰æ¡ä»¶ä½¿ç”¨ RAID6ï¼Œå¢åŠ å•èŠ‚ç‚¹æ€§èƒ½ä»¥åŠé¿å…å•èŠ‚ç‚¹å­˜å‚¨æ•…éšœã€‚</p></li></ol><blockquote><p>https://www.elastic.co/cn/blog/how-to-design-your-elasticsearch-data-storage-architecture-for-scale#raid56</p></blockquote><h3 id="_6-elasticsearch-ä¸­çš„èŠ‚ç‚¹-æ¯”å¦‚å…±-20-ä¸ª-å…¶ä¸­çš„-10-ä¸ªé€‰äº†ä¸€ä¸ª-master-å¦å¤–-10-ä¸ªé€‰äº†å¦ä¸€ä¸ª-master-æ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#_6-elasticsearch-ä¸­çš„èŠ‚ç‚¹-æ¯”å¦‚å…±-20-ä¸ª-å…¶ä¸­çš„-10-ä¸ªé€‰äº†ä¸€ä¸ª-master-å¦å¤–-10-ä¸ªé€‰äº†å¦ä¸€ä¸ª-master-æ€ä¹ˆåŠ"><span>6. Elasticsearch ä¸­çš„èŠ‚ç‚¹ï¼ˆæ¯”å¦‚å…± 20 ä¸ªï¼‰ï¼Œå…¶ä¸­çš„ 10 ä¸ªé€‰äº†ä¸€ä¸ª masterï¼Œå¦å¤– 10 ä¸ªé€‰äº†å¦ä¸€ä¸ª masterï¼Œæ€ä¹ˆåŠï¼Ÿ</span></a></h3><ol><li><p>å½“é›†ç¾¤ master å€™é€‰æ•°é‡ä¸å°äº 3 ä¸ªæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æœ€å°‘æŠ•ç¥¨é€šè¿‡æ•°é‡ï¼ˆdiscovery.zen.minimum_master_nodesï¼‰è¶…è¿‡æ‰€æœ‰å€™é€‰èŠ‚ç‚¹ä¸€åŠä»¥ä¸Šæ¥è§£å†³è„‘è£‚é—®é¢˜ï¼›</p></li><li><p>å½“å€™é€‰æ•°é‡ä¸ºä¸¤ä¸ªæ—¶ï¼Œåªèƒ½ä¿®æ”¹ä¸ºå”¯ä¸€çš„ä¸€ä¸ª master å€™é€‰ï¼Œå…¶ä»–ä½œä¸º dataèŠ‚ç‚¹ï¼Œé¿å…è„‘è£‚é—®é¢˜ã€‚</p></li></ol><h3 id="_7-å®¢æˆ·ç«¯åœ¨å’Œé›†ç¾¤è¿æ¥æ—¶-å¦‚ä½•é€‰æ‹©ç‰¹å®šçš„èŠ‚ç‚¹æ‰§è¡Œè¯·æ±‚çš„" tabindex="-1"><a class="header-anchor" href="#_7-å®¢æˆ·ç«¯åœ¨å’Œé›†ç¾¤è¿æ¥æ—¶-å¦‚ä½•é€‰æ‹©ç‰¹å®šçš„èŠ‚ç‚¹æ‰§è¡Œè¯·æ±‚çš„"><span>7. å®¢æˆ·ç«¯åœ¨å’Œé›†ç¾¤è¿æ¥æ—¶ï¼Œå¦‚ä½•é€‰æ‹©ç‰¹å®šçš„èŠ‚ç‚¹æ‰§è¡Œè¯·æ±‚çš„ï¼Ÿ</span></a></h3><p>client è¿œç¨‹è¿æ¥è¿æ¥ä¸€ä¸ª elasticsearch é›†ç¾¤ã€‚å®ƒå¹¶ä¸åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œåªæ˜¯è·å¾—ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆå§‹åŒ–çš„åœ°å€ï¼Œå¹¶ä»¥è½®è¯¢çš„æ–¹å¼ä¸è¿™äº›åœ°å€è¿›è¡Œé€šä¿¡ã€‚</p><h3 id="_8-è¯¦ç»†æè¿°ä¸€ä¸‹-elasticsearch-æ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹ã€‚" tabindex="-1"><a class="header-anchor" href="#_8-è¯¦ç»†æè¿°ä¸€ä¸‹-elasticsearch-æ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹ã€‚"><span>8. è¯¦ç»†æè¿°ä¸€ä¸‹ Elasticsearch æ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹ã€‚</span></a></h3><ol><li>åˆ é™¤å’Œæ›´æ–°ä¹Ÿéƒ½æ˜¯å†™æ“ä½œï¼Œä½†æ˜¯ Elasticsearch ä¸­çš„æ–‡æ¡£æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ä¸èƒ½è¢«åˆ é™¤æˆ–è€…æ”¹åŠ¨ä»¥å±•ç¤ºå…¶å˜æ›´ï¼›(æ ¹æœ¬åŸå› æ˜¯åº•å±‚luceneçš„segmentæ®µæ–‡ä»¶ä¸å¯æ›´æ–°åˆ é™¤)</li><li>ç£ç›˜ä¸Šçš„æ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„ .del æ–‡ä»¶ã€‚å½“åˆ é™¤è¯·æ±‚å‘é€åï¼Œæ–‡æ¡£å¹¶æ²¡æœ‰çœŸ çš„è¢«åˆ é™¤ï¼Œè€Œæ˜¯åœ¨ <code>.del</code> æ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ã€‚è¯¥æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚å½“æ®µåˆå¹¶æ—¶ï¼Œåœ¨.del æ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤çš„æ–‡æ¡£å°†ä¸ä¼šè¢«å†™å…¥ æ–°æ®µã€‚</li><li>åœ¨æ–°çš„æ–‡æ¡£è¢«åˆ›å»ºæ—¶ï¼ŒElasticsearch ä¼šä¸ºè¯¥æ–‡æ¡£æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå½“æ‰§è¡Œæ›´æ–° æ—¶ï¼Œæ—§ç‰ˆæœ¬çš„æ–‡æ¡£åœ¨.del æ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œæ–°ç‰ˆæœ¬çš„æ–‡æ¡£è¢«ç´¢å¼•åˆ°ä¸€ä¸ªæ–°æ®µã€‚</li></ol><p>æ—§ç‰ˆæœ¬çš„æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚</p><h3 id="_9-elasticsearch-å¯¹äºå¤§æ•°æ®é‡-ä¸Šäº¿é‡çº§-çš„èšåˆå¦‚ä½•å®ç°" tabindex="-1"><a class="header-anchor" href="#_9-elasticsearch-å¯¹äºå¤§æ•°æ®é‡-ä¸Šäº¿é‡çº§-çš„èšåˆå¦‚ä½•å®ç°"><span>9. Elasticsearch å¯¹äºå¤§æ•°æ®é‡ï¼ˆä¸Šäº¿é‡çº§ï¼‰çš„èšåˆå¦‚ä½•å®ç°ï¼Ÿ</span></a></h3><blockquote><p>è¿™é“é¢˜ç›®è¾ƒéš¾ï¼Œç›¸ä¿¡å¤§å®¶çœ‹åˆ°å¾ˆå¤šç±»ä¼¼è¿™ç§å›ç­”</p></blockquote><p>Elasticsearch æä¾›çš„é¦–ä¸ªè¿‘ä¼¼èšåˆæ˜¯cardinality åº¦é‡ã€‚å®ƒæä¾›ä¸€ä¸ªå­—æ®µçš„åŸºæ•°ï¼Œå³è¯¥å­—æ®µçš„distinctæˆ–è€…uniqueå€¼çš„æ•°ç›®ã€‚å®ƒæ˜¯åŸºäºHLLç®—æ³•çš„ã€‚HLL ä¼šå…ˆå¯¹æˆ‘ä»¬çš„è¾“å…¥ä½œå“ˆå¸Œè¿ç®—ï¼Œç„¶åæ ¹æ®å“ˆå¸Œè¿ç®—çš„ç»“æœä¸­çš„ bits åšæ¦‚ç‡ä¼°ç®—ä»è€Œå¾—åˆ°åŸºæ•°ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼šå¯é…ç½®çš„ç²¾åº¦ï¼Œç”¨æ¥æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼ˆæ›´ç²¾ç¡® ï¼ æ›´å¤šå†…å­˜ï¼‰ï¼›å°çš„æ•°æ®é›†ç²¾åº¦æ˜¯éå¸¸é«˜çš„ï¼›æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥è®¾ç½®å»é‡éœ€è¦çš„å›ºå®šå†…å­˜ä½¿ç”¨é‡ã€‚æ— è®ºæ•°åƒè¿˜æ˜¯æ•°åäº¿çš„å”¯ä¸€å€¼ï¼Œå†…å­˜ä½¿ç”¨é‡åªä¸ä½ é…ç½®çš„ç²¾ç¡®åº¦ç›¸å…³ã€‚</p><p><strong>ç§‘æ™®&amp;æ‹“å±•</strong>ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">HyperLogLogï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ä¸‹é¢ç®€ç§°ä¸ºHLLï¼Œå®ƒæ˜¯</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> LogLog</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ç®—æ³•çš„å‡çº§ç‰ˆï¼Œä½œç”¨æ˜¯èƒ½å¤Ÿæä¾›ä¸ç²¾ç¡®çš„å»é‡è®¡æ•°ã€‚å­˜åœ¨ä»¥ä¸‹çš„ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> èƒ½å¤Ÿä½¿ç”¨æå°‘çš„å†…å­˜æ¥ç»Ÿè®¡å·¨é‡çš„æ•°æ®ï¼Œåœ¨</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Redis</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä¸­å®ç°çš„</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> HyperLogLogï¼Œåªéœ€è¦12Kå†…å­˜å°±èƒ½ç»Ÿè®¡2^64ä¸ªæ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è®¡æ•°å­˜åœ¨ä¸€å®šçš„è¯¯å·®ï¼Œè¯¯å·®ç‡æ•´ä½“è¾ƒä½ã€‚æ ‡å‡†è¯¯å·®ä¸º</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 0.81%</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è¯¯å·®å¯ä»¥è¢«è®¾ç½®è¾…åŠ©è®¡ç®—å› å­è¿›è¡Œé™ä½ã€‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">åº”ç”¨åœºæ™¯ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> åŸºæ•°ä¸å¤§ï¼Œæ•°æ®é‡ä¸å¤§å°±ç”¨ä¸ä¸Šï¼Œä¼šæœ‰ç‚¹å¤§æå°ç”¨æµªè´¹ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æœ‰å±€é™æ€§ï¼Œå°±æ˜¯åªèƒ½ç»Ÿè®¡åŸºæ•°æ•°é‡ï¼Œè€Œæ²¡åŠæ³•å»çŸ¥é“å…·ä½“çš„å†…å®¹æ˜¯ä»€ä¹ˆ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å’Œbitmapç›¸æ¯”ï¼Œå±äºä¸¤ç§ç‰¹å®šç»Ÿè®¡æƒ…å†µï¼Œç®€å•æ¥è¯´ï¼ŒHyperLogLog</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å»é‡æ¯”</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bitmap</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æ–¹ä¾¿å¾ˆå¤š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä¸€èˆ¬å¯ä»¥bitmapå’Œhyperloglogé…åˆä½¿ç”¨ï¼Œbitmapæ ‡è¯†å“ªäº›ç”¨æˆ·æ´»è·ƒï¼Œhyperloglogè®¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">åº”ç”¨åœºæ™¯ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> åŸºæ•°ä¸å¤§ï¼Œæ•°æ®é‡ä¸å¤§å°±ç”¨ä¸ä¸Šï¼Œä¼šæœ‰ç‚¹å¤§æå°ç”¨æµªè´¹ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æœ‰å±€é™æ€§ï¼Œå°±æ˜¯åªèƒ½ç»Ÿè®¡åŸºæ•°æ•°é‡ï¼Œè€Œæ²¡åŠæ³•å»çŸ¥é“å…·ä½“çš„å†…å®¹æ˜¯ä»€ä¹ˆ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å’Œbitmapç›¸æ¯”ï¼Œå±äºä¸¤ç§ç‰¹å®šç»Ÿè®¡æƒ…å†µï¼Œç®€å•æ¥è¯´ï¼ŒHyperLogLog</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å»é‡æ¯”</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bitmap</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> æ–¹ä¾¿å¾ˆå¤š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">4.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ä¸€èˆ¬å¯ä»¥bitmapå’Œhyperloglogé…åˆä½¿ç”¨ï¼Œbitmapæ ‡è¯†å“ªäº›ç”¨æˆ·æ´»è·ƒï¼Œhyperloglogè®¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">æ¥æºï¼šåˆ·åˆ·é¢è¯•</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-åœ¨å¹¶å‘æƒ…å†µä¸‹-elasticsearch-å¦‚æœä¿è¯è¯»å†™ä¸€è‡´" tabindex="-1"><a class="header-anchor" href="#_10-åœ¨å¹¶å‘æƒ…å†µä¸‹-elasticsearch-å¦‚æœä¿è¯è¯»å†™ä¸€è‡´"><span>10. åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼ŒElasticsearch å¦‚æœä¿è¯è¯»å†™ä¸€è‡´ï¼Ÿ</span></a></h3><blockquote><p>é¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€šè¿‡CPAç†è®ºåˆ†æã€‚</p></blockquote><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚ <img src="https://tvax4.sinaimg.cn/large/007F3CC8ly1h0nitw2kjwj30nk0l5goe.jpg" alt="åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚" loading="lazy"></p><ol><li>å¯ä»¥é€šè¿‡ç‰ˆæœ¬å·ä½¿ç”¨ä¹è§‚å¹¶å‘æ§åˆ¶ï¼Œä»¥ç¡®ä¿æ–°ç‰ˆæœ¬ä¸ä¼šè¢«æ—§ç‰ˆæœ¬è¦†ç›–ï¼Œç”±åº”ç”¨å±‚æ¥å¤„ç†å…·ä½“çš„å†²çªï¼›</li><li>å¦å¤–å¯¹äºå†™æ“ä½œï¼Œä¸€è‡´æ€§çº§åˆ«æ”¯æŒ quorum/one/allï¼Œé»˜è®¤ä¸º quorumï¼Œå³åªæœ‰å½“å¤§å¤šæ•°åˆ†ç‰‡å¯ç”¨æ—¶æ‰å…è®¸å†™æ“ä½œã€‚ä½†å³ä½¿å¤§å¤šæ•°å¯ç”¨ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å› ä¸ºç½‘ç»œç­‰åŸå› å¯¼è‡´å†™å…¥å‰¯æœ¬å¤±è´¥ï¼Œè¿™æ ·è¯¥å‰¯æœ¬è¢«è®¤ä¸ºæ•…éšœï¼Œåˆ†ç‰‡å°†ä¼šåœ¨ä¸€ä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šé‡å»ºã€‚</li><li>å¯¹äºè¯»æ“ä½œï¼Œå¯ä»¥è®¾ç½® replication ä¸º sync(é»˜è®¤)ï¼Œè¿™ä½¿å¾—æ“ä½œåœ¨ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å®Œæˆåæ‰ä¼šè¿”å›ï¼›å¦‚æœè®¾ç½® replication ä¸º async æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æœç´¢è¯·æ±‚å‚æ•°_preference ä¸º primary æ¥æŸ¥è¯¢ä¸»åˆ†ç‰‡ï¼Œç¡®ä¿æ–‡æ¡£æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚</li></ol><h3 id="_11-ä»‹ç»ä¸€ä¸‹ä½ ä»¬çš„ä¸ªæ€§åŒ–æœç´¢æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_11-ä»‹ç»ä¸€ä¸‹ä½ ä»¬çš„ä¸ªæ€§åŒ–æœç´¢æ–¹æ¡ˆ"><span>11. ä»‹ç»ä¸€ä¸‹ä½ ä»¬çš„ä¸ªæ€§åŒ–æœç´¢æ–¹æ¡ˆï¼Ÿ</span></a></h3><blockquote><p>å¦‚æœä½ æ²¡æœ‰å¾ˆå¤šå®æˆ˜ç»éªŒï¼Œå¯ä»¥åŸºäº word2vec åšä¸€äº›ç»ƒä¹ ï¼Œæˆ‘çš„åšå®¢æä¾›äº† word2vec Javaç‰ˆçš„ä¸€äº›Demoã€‚</p></blockquote><p>åŸºäº word2vec å’Œ Elasticsearch å®ç°ä¸ªæ€§åŒ–æœç´¢ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>åŸºäºword2vecçš„å•†å“å‘é‡è¿˜æœ‰ä¸€ä¸ªå¯ç”¨ä¹‹å¤„ï¼Œå°±æ˜¯å¯ä»¥ç”¨æ¥å®ç°ç›¸ä¼¼å•†å“çš„æ¨èï¼›</li></ol><h2 id="javaåŸºç¡€" tabindex="-1"><a class="header-anchor" href="#javaåŸºç¡€"><span>JavaåŸºç¡€</span></a></h2><h3 id="_1-instanceof-å…³é”®å­—çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_1-instanceof-å…³é”®å­—çš„ä½œç”¨"><span>1. instanceof å…³é”®å­—çš„ä½œç”¨</span></a></h3><p>instanceof æ˜¯ Java çš„ä¿ç•™å…³é”®å­—ã€‚å®ƒçš„ä½œç”¨æ˜¯æµ‹è¯•å®ƒå·¦è¾¹çš„å¯¹è±¡æ˜¯å¦æ˜¯å®ƒå³è¾¹çš„ç±»çš„å®ä¾‹ï¼Œè¿”å› boolean çš„æ•°æ®ç±»å‹ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> result </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> class</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ obj ä¸º Class çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯å…¶ç›´æ¥æˆ–é—´æ¥å­ç±»ï¼Œæˆ–è€…æ˜¯å…¶æ¥å£çš„å®ç°ç±»ï¼Œç»“æœresult éƒ½è¿”å› trueï¼Œå¦åˆ™è¿”å›falseã€‚</p><p>æ³¨æ„ä¸€ç‚¹ï¼šç¼–è¯‘å™¨ä¼šæ£€æŸ¥ obj æ˜¯å¦èƒ½è½¬æ¢æˆå³è¾¹çš„classç±»å‹ï¼Œå¦‚æœä¸èƒ½è½¬æ¢åˆ™ç›´æ¥æŠ¥é”™ï¼Œå¦‚æœä¸èƒ½ç¡®å®šç±»å‹ï¼Œåˆ™é€šè¿‡ç¼–è¯‘ï¼Œå…·ä½“çœ‹è¿è¡Œæ—¶å®šã€‚</p><p>obj å¿…é¡»ä¸ºå¼•ç”¨ç±»å‹ï¼Œåªèƒ½ä½œä¸ºå¯¹è±¡çš„åˆ¤æ–­ï¼Œä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(i </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> Integer);</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//ç¼–è¯‘ä¸é€šè¿‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(i </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> Object);</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//ç¼–è¯‘ä¸é€šè¿‡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æºç å‚è€ƒï¼šJavaSE 8 instanceof çš„å®ç°ç®—æ³•ï¼šhttps://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.instanceof</p><h3 id="_2-javaè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±" tabindex="-1"><a class="header-anchor" href="#_2-javaè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±"><span>2. Javaè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±</span></a></h3><p>ä»€ä¹ˆæ˜¯è£…ç®±æ‹†ç®±ï¼Œè¿™é‡Œä¸åšæºç å±‚é¢è§£è¯»ï¼Œæºç è§£è¯»åœ¨JavaPubå…¬ä¼—å·å‘å‡ºã€‚è¿™é‡Œé€šè¿‡è®²è§£ int å’Œ Interger åŒºåˆ«ï¼Œè§£ç­”Javaè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ã€‚</p><blockquote><p>è‡ªåŠ¨è£…ç®± ----- åŸºæœ¬ç±»å‹çš„å€¼ â†’ åŒ…è£…ç±»çš„å®ä¾‹</p><p>è‡ªåŠ¨æ‹†ç®± ----- åŸºæœ¬ç±»å‹çš„å€¼ â† åŒ…è£…ç±»çš„å®ä¾‹</p></blockquote><ol><li>Integerå˜é‡å¿…é¡»å®ä¾‹åŒ–åæ‰èƒ½ä½¿ç”¨ï¼Œè€Œintå˜é‡ä¸éœ€è¦</li><li>Integerå®é™…æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œå½“newä¸€ä¸ªIntegeræ—¶ï¼Œå®é™…ä¸Šæ˜¯ç”Ÿæˆä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ­¤å¯¹è±¡ï¼›è€Œintåˆ™æ˜¯ç›´æ¥å­˜å‚¨æ•°æ®å€¼ ã€‚</li><li>Integerçš„é»˜è®¤å€¼æ˜¯nullï¼Œintçš„é»˜è®¤å€¼æ˜¯0</li></ol><p>Javaä¸­8ç§åŸºæœ¬æ•°æ®ç±»å‹ã€‚å·¦è¾¹åŸºæœ¬ç±»å‹ï¼Œå³è¾¹åŒ…è£…ç±»å‹ã€‚ <img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092054.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p><strong>åœ¨é¢è¯•ä¸­ï¼š</strong></p><p>ä¸‹é¢è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i3</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i4</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">         </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(i1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">i2);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(i3</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">i4);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœè¡¨æ˜i1å’Œi2æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œi3å’Œi4æŒ‡å‘çš„æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚æ­¤æ—¶åªéœ€ä¸€çœ‹æºç ä¾¿çŸ¥ç©¶ç«Ÿï¼Œä¸‹é¢è¿™æ®µä»£ç æ˜¯Integerçš„valueOfæ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> valueOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;=</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IntegerCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">high</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> IntegerCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">[i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 128</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">]</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(i)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> IntegerCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> high</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> cache[]</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        static</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            final</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> low </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // high value may be configured by property</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> h </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 127</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (integerCacheHighPropValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // Use Long.decode here to avoid invoking methods that</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // require Integer&#39;s autoboxing cache to be initialized</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Long</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(integerCacheHighPropValue).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">intValue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(i, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">127</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                // Maximum array size is Integer.MAX_VALUE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                h </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">min</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(i, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MAX_VALUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">low);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            high </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> h</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">[(high </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> low) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">]</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> j </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> low</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> k </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> k </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> k</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                cache[k] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(j</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> IntegerCache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ä»è¿™2æ®µä»£ç å¯ä»¥çœ‹å‡ºï¼Œåœ¨é€šè¿‡<strong>valueOfæ–¹æ³•åˆ›å»ºIntegerå¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœæ•°å€¼åœ¨[-128,127]ä¹‹é—´ï¼Œä¾¿è¿”å›æŒ‡å‘IntegerCache.cacheä¸­å·²ç»å­˜åœ¨çš„å¯¹è±¡çš„å¼•ç”¨ï¼›å¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„Integerå¯¹è±¡ã€‚</strong></p></blockquote><p><strong>ä¸Šé¢çš„ä»£ç ä¸­i1å’Œi2çš„æ•°å€¼ä¸º100ï¼Œå› æ­¤ä¼šç›´æ¥ä»cacheä¸­å–å·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼Œæ‰€ä»¥i1å’Œi2æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œi3å’Œi4åˆ™æ˜¯åˆ†åˆ«æŒ‡å‘ä¸åŒçš„å¯¹è±¡ã€‚</strong></p><p><code>æ³¨æ„ï¼ŒIntegerã€Shortã€Byteã€Characterã€Longè¿™å‡ ä¸ªç±»çš„valueOfæ–¹æ³•çš„å®ç°æ˜¯ç±»ä¼¼çš„ã€‚ Doubleã€Floatçš„valueOfæ–¹æ³•çš„å®ç°æ˜¯ç±»ä¼¼çš„ï¼ˆæ²¡æœ‰ç¼“å­˜æ•°å€¼ï¼Œè¿™é‡Œçš„æ•°å€¼æƒ³æƒ³éƒ½æœ‰å¾ˆå¤šï¼Œä¸é€‚åˆç¼“å­˜ï¼‰ã€‚</code></p><hr><h3 id="_3-é‡è½½å’Œé‡å†™åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_3-é‡è½½å’Œé‡å†™åŒºåˆ«"><span>3. é‡è½½å’Œé‡å†™åŒºåˆ«</span></a></h3><p>é‡è½½å’Œé‡å†™æ˜¯ä¸€ä¸ªç‰¹åˆ«å¥½ç†è§£çš„æ¦‚å¿µï¼Œè¿™é‡Œè¯´ä¸€ä¸ªé€šä¿—çš„è§£ç­”æ–¹å¼</p><p><strong>é‡è½½ï¼ˆOverloadï¼‰</strong>:é¦–å…ˆæ˜¯ä½äºä¸€ä¸ªç±»ä¹‹ä¸­æˆ–è€…å…¶å­ç±»ä¸­ï¼Œå…·æœ‰ç›¸åŒçš„æ–¹æ³•åï¼Œä½†æ˜¯æ–¹æ³•çš„å‚æ•°ä¸åŒï¼Œè¿”å›å€¼ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚</p><ol><li>æ–¹æ³•åå¿…é¡»ç›¸åŒ</li><li>æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸€å®šä¸ä¸€æ ·ã€‚</li><li>è®¿é—®ä¿®é¥°ç¬¦å’Œè¿”å›å€¼ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚</li></ol><p>å…¶å®ç®€å•è€Œè¨€ï¼šé‡è½½å°±æ˜¯å¯¹äºä¸åŒçš„æƒ…å†µå†™ä¸åŒçš„æ–¹æ³•ã€‚ æ¯”å¦‚ï¼ŒåŒä¸€ä¸ªç±»ä¸­ï¼Œå†™ä¸åŒçš„æ„é€ å‡½æ•°ç”¨äºåˆå§‹åŒ–ä¸åŒçš„å‚æ•°ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> JavaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‚æ•°&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //å‚æ•°æ•°ç›®ä¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‚æ•°&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //å‚æ•°ç±»å‹ä¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‚æ•°&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‚æ•°&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //å‚æ•°é¡ºåºä¸åŒ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‚æ•°&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">n</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        JavaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> javaPubTest</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> JavaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        javaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        javaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        javaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        javaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        javaPubTest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**é‡å†™ï¼ˆOverridingï¼‰**å‘ç”Ÿåœ¨çˆ¶ç±»å­ç±»ä¹‹é—´ï¼Œæ¯”å¦‚æ‰€æœ‰ç±»éƒ½æ˜¯ç»§æ‰¿ä¸Objectç±»çš„ï¼ŒObjectç±»ä¸­æœ¬èº«å°±æœ‰equalsã€hashcodeã€toStringæ–¹æ³•ç­‰ã€‚åœ¨ä»»æ„å­ç±»ä¸­å®šä¹‰äº†é‡åå’ŒåŒæ ·çš„å‚æ•°åˆ—è¡¨å°±æ„æˆæ–¹æ³•é‡å†™ã€‚</p><ol><li>æ–¹æ³•åå¿…é¡»ç›¸åŒï¼Œè¿”å›å€¼ç±»å‹å¿…é¡»ç›¸åŒã€‚</li><li>å‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒã€‚</li><li>è®¿é—®æƒé™ä¸èƒ½æ¯”çˆ¶ç±»ä¸­è¢«é‡å†™çš„æ–¹æ³•çš„è®¿é—®æƒé™æ›´ä½ã€‚ä¾‹å¦‚ï¼šå¦‚æœçˆ¶ç±»çš„ä¸€ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸ºpublicï¼Œé‚£ä¹ˆåœ¨å­ç±»ä¸­é‡å†™è¯¥æ–¹æ³•å°±ä¸èƒ½å£°æ˜ä¸ºprotectedã€‚</li><li>å­ç±»å’Œçˆ¶ç±»åœ¨åŒä¸€ä¸ªåŒ…ä¸­ï¼Œé‚£ä¹ˆå­ç±»å¯ä»¥é‡å†™çˆ¶ç±»æ‰€æœ‰æ–¹æ³•ï¼Œé™¤äº†å£°æ˜ä¸ºprivateå’Œfinalçš„æ–¹æ³•ã€‚</li><li>æ„é€ æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚</li></ol><hr><h3 id="_4-equalsä¸-åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_4-equalsä¸-åŒºåˆ«"><span>4. equalsä¸==åŒºåˆ«</span></a></h3><p><strong>&quot;==&quot;æ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ˜¯ä¸æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚</strong><strong>&quot;equals&quot;æ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒã€‚</strong></p><p>é™¤äº†è¿™ä¿©ç‚¹ï¼Œè¿™ä¸ªé—®é¢˜å¤§æ¦‚ç‡ä¼šå¼•å‡ºä»¥ä¸‹é—®é¢˜ï¼š</p><blockquote><p>ä¸ºä»€ä¹ˆé‡å†™equalsè¿˜è¦é‡å†™hashcode?</p></blockquote><p>é€šè¿‡ä¸Šé¢ä¿©æ¡æˆ‘ä»¬çŸ¥é“ <strong>&quot;equals&quot;æ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒã€‚</strong> ä½†æ˜¯ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯”ä¿©ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œä¾‹å¦‚ï¼š<code>User user1 = new User();</code> <code>User user2 = new User();</code> user1 å’Œ user2 å¯¹æ¯”ã€‚è¿™æ˜¯æˆ‘ä»¬å°±éœ€è¦é‡å†™ equals æ–¹æ³•ã€‚</p><p>æ‰€ä»¥å¯ä»¥é€šè¿‡é‡å†™equals()æ–¹æ³•æ¥åˆ¤æ–­å¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè¦æ±‚ï¼š<strong>equals()æ–¹æ³•å®ç°äº†ç­‰ä»·å…³ç³»</strong>ï¼Œå³ï¼š</p><ul><li>è‡ªåæ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨xï¼Œx.equals(x)åº”è¯¥è¿”å›trueï¼›</li><li>å¯¹ç§°æ€§ï¼šå¯¹äºä»»ä½•å¼•ç”¨xå’Œyï¼Œå¦‚æœx.equals(y)è¿”å›trueï¼Œé‚£ä¹ˆy.equals(x)ä¹Ÿåº”è¯¥è¿”å›trueï¼›</li><li>ä¼ é€’æ€§ï¼šå¯¹äºä»»ä½•å¼•ç”¨xã€yå’Œzï¼Œå¦‚æœx.equals(y)è¿”å›trueï¼Œy.equals(z)è¿”å›trueï¼Œé‚£ä¹ˆx.equals(z)ä¹Ÿåº”è¯¥è¿”å›trueï¼›</li><li>ä¸€è‡´æ€§ï¼šå¦‚æœxå’Œyå¼•ç”¨çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆåå¤è°ƒç”¨x.equals(y)åº”è¯¥è¿”å›åŒæ ·çš„ç»“æœï¼›</li><li>éç©ºæ€§ï¼šå¯¹äºä»»æ„éç©ºå¼•ç”¨xï¼Œx.equals(null)åº”è¯¥è¿”å›falseï¼›</li></ul><p>åˆ°è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæ­£å¸¸çš„æ“ä½œï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¦ç”¨åˆ° HashSet ç­‰é›†åˆæ—¶ã€‚å­˜å‚¨çš„å¯¹è±¡æˆ‘ä»¬éœ€è¦ç”¨ <code>hashcode åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜åœ¨</code>ï¼Œå¦‚æœä½¿ç”¨ Object é»˜è®¤çš„hashcodeæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬åŒæ ·å±æ€§çš„ä¿©ä¸ªç”¨æˆ·ä¸€å®šæ˜¯ä¸ç›¸ç­‰çš„(ä¾‹å¦‚ä¸‹é¢user3ã€user4)ï¼Œå› ä¸ºå†…å­˜åœ°å€ä¸åŒï¼Œè¿™å¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„ä¸šåŠ¡ï¼Œæ‰€ä»¥å†³å®šäº†é‡å†™ hashcode çš„å¿…è¦æ€§ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> user3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JavaPub&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;man&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;1996-08-28&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">User user4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JavaPub&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;man&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;1996-08-28&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_5-è°ˆè°ˆnioå’ŒbioåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_5-è°ˆè°ˆnioå’ŒbioåŒºåˆ«"><span>5. è°ˆè°ˆNIOå’ŒBIOåŒºåˆ«</span></a></h3><p>è‡´åŠ›äºå¤§ç™½è¯è¯´æ¸…æ¥šã€‚NIOå’ŒBIOæ˜¯ä¸€ä¸ªç›¸å¯¹æœ‰ç‚¹æŠ½è±¡çš„æ¦‚å¿µï¼Œå¦‚æœä½ å¯¹ç½‘ç»œæœ‰ç‚¹äº†è§£ï¼Œç†è§£èµ·æ¥å¯èƒ½ä¼šæ›´é¡ºç•…ã€‚é¦–å…ˆè¯´ä¸€ä¸‹åŸºæœ¬</p><p><strong>BIO</strong>ï¼šåŒæ­¥é˜»å¡IOï¼Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼ŒæœåŠ¡ç«¯éƒ½ä¼šå¯¹åº”ä¸€ä¸ªå¤„ç†çº¿ç¨‹ï¼Œå¯¹äºæ²¡æœ‰åˆ†é…åˆ°å¤„ç†çº¿ç¨‹çš„è¿æ¥å°±ä¼šè¢«é˜»å¡æˆ–è€…æ‹’ç»ã€‚ç›¸å½“äºæ˜¯<code>ä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹</code>ã€‚</p><p><strong>NIO</strong>ï¼šåŒæ­¥éé˜»å¡IOï¼ŒåŸºäºReactoræ¨¡å‹ï¼Œå®¢æˆ·ç«¯å’Œchannelè¿›è¡Œé€šä¿¡ï¼Œchannelå¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œé€šè¿‡å¤šè·¯å¤ç”¨å™¨selectoræ¥è½®è¯¢æ³¨å†Œåœ¨å…¶ä¸Šçš„channelï¼Œè€Œåå†è¿›è¡ŒIOæ“ä½œã€‚è¿™æ ·çš„è¯ï¼Œåœ¨è¿›è¡ŒIOæ“ä½œçš„æ—¶å€™å†ç”¨ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†å°±å¯ä»¥äº†ï¼Œä¹Ÿå°±æ˜¯<code>ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹</code>ã€‚</p><blockquote><p>Reactoræ¨¡å‹æ˜¯ä»€ä¹ˆ?</p><ol><li>åŸºäºæ± åŒ–æ€æƒ³ï¼Œé¿å…ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè¿æ¥å®Œæˆåå°†ä¸šåŠ¡å¤„ç†äº¤ç»™çº¿ç¨‹æ± å¤„ç†</li><li>åŸºäºIOå¤ç”¨æ¨¡å‹ï¼Œå¤šä¸ªè¿æ¥å…±ç”¨åŒä¸€ä¸ªé˜»å¡å¯¹è±¡ï¼Œä¸ç”¨ç­‰å¾…æ‰€æœ‰çš„è¿æ¥ã€‚éå†åˆ°æœ‰æ–°æ•°æ®å¯ä»¥å¤„ç†æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç¨‹åºï¼Œçº¿ç¨‹è·³å‡ºé˜»å¡çŠ¶æ€ï¼Œè¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç† .</li></ol><p>ç®€å•æ¥è¯´ï¼šReactorçº¿ç¨‹æ¨¡å‹çš„æ€æƒ³å°±æ˜¯åŸºäºIOå¤ç”¨å’Œçº¿ç¨‹æ± çš„ç»“åˆã€‚</p></blockquote><p><strong>AIO</strong>ï¼šï¼ˆä¸€èˆ¬éƒ½ä¼šæŠŠAIOå’ŒNIOã€BIOæ”¾ä¸€å—æ¯”è¾ƒï¼Œè¿™é‡Œç®€å•æä¸€ä¸‹ã€‚ï¼‰å¼‚æ­¥éé˜»å¡IOï¼Œç›¸æ¯”NIOæ›´è¿›ä¸€æ­¥ï¼Œå®Œå…¨ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆè¯·æ±‚çš„å¤„ç†ï¼Œç„¶åé€šçŸ¥æœåŠ¡ç«¯å¼€å¯çº¿ç¨‹å»è¿›è¡Œå¤„ç†ï¼Œå› æ­¤æ˜¯<code>ä¸€ä¸ªæœ‰æ•ˆè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹</code>ã€‚</p><p><strong>é‚£ä¹ˆæ€ä¹ˆç†è§£åŒæ­¥å’Œé˜»å¡ï¼Ÿ</strong></p><p>é¦–å…ˆï¼Œå¯ä»¥è®¤ä¸ºä¸€ä¸ªIOæ“ä½œåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>å‘èµ·IOè¯·æ±‚</li><li>å®é™…çš„IOè¯»å†™æ“ä½œ</li></ol><p>åŒæ­¥å’Œå¼‚æ­¥åœ¨äºç¬¬äºŒä¸ªï¼Œå®é™…çš„IOè¯»å†™æ“ä½œï¼Œå¦‚æœæ“ä½œç³»ç»Ÿå¸®ä½ å®Œæˆäº†å†é€šçŸ¥ä½ ï¼Œé‚£å°±æ˜¯å¼‚æ­¥ï¼Œå¦åˆ™éƒ½å«åšåŒæ­¥ã€‚</p><p>é˜»å¡å’Œéé˜»å¡åœ¨äºç¬¬ä¸€ä¸ªï¼Œå‘èµ·IOè¯·æ±‚ï¼Œå¯¹äºNIOæ¥è¯´é€šè¿‡channelå‘èµ·IOæ“ä½œè¯·æ±‚åï¼Œå…¶å®å°±è¿”å›äº†ï¼Œæ‰€ä»¥æ˜¯éé˜»å¡ã€‚</p><p>NIOå’ŒBIOæ˜¯éå¸¸é‡è¦çš„è®¡ç®—æœºçŸ¥è¯†ï¼Œå­¦ä¹ åä¼šå¯¹æ•´ä¸ªè®¡ç®—æœºçš„ç†è§£æ›´è¿‘ä¸€æ­¥ï¼Œä¸€æ¬¡å­¦ä¼šç»ˆèº«å—ç›Šã€‚JavaPubä¼šå•ç‹¬å†™ä¸€ç¯‡æ·±å…¥å›¾è§£NIOå’ŒBIOã€‚</p><p>ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªä¾‹å­ï¼ˆä¸€å®šè¦çœ‹ï¼Œä¼šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼‰ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ä¸€è¾†ä» A å¼€å¾€ B çš„å…¬å…±æ±½è½¦ä¸Šï¼Œè·¯ä¸Šæœ‰å¾ˆå¤šç‚¹å¯èƒ½ä¼šæœ‰äººä¸‹è½¦ã€‚å¸æœºä¸çŸ¥é“å“ªäº›ç‚¹ä¼šæœ‰å“ªäº›äººä¼šä¸‹è½¦ï¼Œå¯¹äºéœ€è¦ä¸‹è½¦çš„äººï¼Œå¦‚ä½•å¤„ç†æ›´å¥½ï¼Ÿ   </span></span>
<span class="line"><span></span></span>
<span class="line"><span>1. å¸æœºè¿‡ç¨‹ä¸­å®šæ—¶è¯¢é—®æ¯ä¸ªä¹˜å®¢æ˜¯å¦åˆ°è¾¾ç›®çš„åœ°ï¼Œè‹¥æœ‰äººè¯´åˆ°äº†ï¼Œé‚£ä¹ˆå¸æœºåœè½¦ï¼Œä¹˜å®¢ä¸‹è½¦ã€‚ ( ç±»ä¼¼é˜»å¡å¼ )   </span></span>
<span class="line"><span></span></span>
<span class="line"><span>2. æ¯ä¸ªäººå‘Šè¯‰å”®ç¥¨å‘˜è‡ªå·±çš„ç›®çš„åœ°ï¼Œç„¶åç¡è§‰ï¼Œå¸æœºåªå’Œå”®ç¥¨å‘˜äº¤äº’ï¼Œåˆ°äº†æŸä¸ªç‚¹ç”±å”®ç¥¨å‘˜é€šçŸ¥ä¹˜å®¢ä¸‹è½¦ã€‚ ( ç±»ä¼¼éé˜»å¡ )     </span></span>
<span class="line"><span></span></span>
<span class="line"><span>å¾ˆæ˜¾ç„¶ï¼Œæ¯ä¸ªäººè¦åˆ°è¾¾æŸä¸ªç›®çš„åœ°å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¸æœºå¯ä»¥è®¤ä¸ºæ˜¯ CPU ã€‚åœ¨é˜»å¡å¼é‡Œé¢ï¼Œæ¯ä¸ªçº¿ç¨‹éœ€è¦ä¸æ–­çš„è½®è¯¢ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥è¾¾åˆ°æ‰¾åˆ°ç›®çš„åœ°çš„ç»“æœã€‚è€Œåœ¨éé˜»å¡æ–¹å¼é‡Œï¼Œæ¯ä¸ªä¹˜å®¢ ( çº¿ç¨‹ ) éƒ½åœ¨ç¡è§‰ ( ä¼‘çœ  ) ï¼Œåªåœ¨çœŸæ­£å¤–éƒ¨ç¯å¢ƒå‡†å¤‡å¥½äº†æ‰å”¤é†’ï¼Œè¿™æ ·çš„å”¤é†’è‚¯å®šä¸ä¼šé˜»å¡ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å»ºè®®é˜…è¯»ï¼š https://www.cnblogs.com/aspirant/p/6877350.html https://www.cnblogs.com/shoshana-kong/p/11228555.html</p><hr><h3 id="_6-stringã€stringbufferã€stringbuilder-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_6-stringã€stringbufferã€stringbuilder-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><span>6. Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p><strong>String</strong>æ˜¯Immutableç±»çš„å…¸å‹å®ç°ï¼Œè¢«å£°æ˜ä¸º final classï¼Œé™¤äº†hashè¿™ä¸ªå±æ€§å…¶å®ƒå±æ€§éƒ½å£°æ˜ä¸ºfinalã€‚å®ƒçš„ä¸å¯å˜æ€§ï¼Œæ‰€ä»¥ä¾‹å¦‚æ‹¼æ¥å­—ç¬¦ä¸²æ—¶å€™ä¼šäº§ç”Ÿå¾ˆå¤šæ— ç”¨çš„ä¸­é—´å¯¹è±¡ï¼Œå¦‚æœé¢‘ç¹çš„è¿›è¡Œè¿™æ ·çš„æ“ä½œå¯¹æ€§èƒ½æœ‰æ‰€å½±å“ã€‚</p><p>StringBufferã€StringBuilderå°±æ˜¯è§£å†³Stringçš„è¿™ä¸ªæ€§èƒ½é—®é¢˜ã€‚</p><p><strong>StringBuffer</strong> æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å¯ä¿®æ”¹çš„å­—ç¬¦åºåˆ—ï¼ŒæŠŠæ‰€æœ‰ä¿®æ”¹æ•°æ®çš„æ–¹æ³•éƒ½åŠ ä¸Šsynchronizedã€‚</p><p><strong>StringBuffer</strong> çº¿ç¨‹ä¸å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½æ›´å¥½ã€‚</p><hr><h3 id="_7-æ³›å‹æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#_7-æ³›å‹æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆç‰¹ç‚¹"><span>7. æ³›å‹æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆç‰¹ç‚¹</span></a></h3><p>æ³›å‹åœ¨ç¼–ç ä¸­æœ‰éå¸¸å¹¿æ³›çš„ä½¿ç”¨ï¼ˆjdk5å¼•å…¥ï¼‰ï¼Œä½ ä¸€å®šç»å¸¸èƒ½è§åˆ°ç±»ä¼¼è¿™ç§å†™æ³• <code>&lt;T&gt;</code> ã€‚</p><p>æ³›å‹æä¾›äº†ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨æ£€æµ‹æœºåˆ¶ï¼Œå…è®¸åœ¨ç¼–è¯‘æ—¶æ£€æµ‹åˆ°éæ³•çš„ç±»å‹ã€‚<strong>æœ¬è´¨</strong>æ˜¯å‚æ•°åŒ–ç±»å‹ã€‚</p><ol><li>æŠŠç±»å‹å½“ä½œæ˜¯å‚æ•°ä¸€æ ·ä¼ é€’</li><li>&lt;æ•°æ®ç±»å‹&gt;åªèƒ½æ˜¯å¼•ç”¨ç±»å‹</li></ol><p>æ³›å‹ï¼šå°±æ˜¯ä¸€ç§ä¸ç¡®å®šçš„æ•°æ®ç±»å‹ã€‚</p><p>æ³›å‹çš„å¥½å¤„ï¼š</p><ol><li>çœç•¥äº†å¼ºè½¬çš„ä»£ç ã€‚</li><li>å¯ä»¥æŠŠè¿è¡Œæ—¶çš„é—®é¢˜æå‰åˆ°ç¼–è¯‘æ—¶æœŸã€‚</li></ol><blockquote><p>å¼•å…¥æ³›å‹ä¸»è¦æƒ³å®ç°ä¸€ä¸ªé€šç”¨çš„ã€å¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„æ–¹æ³•</p></blockquote><p><strong>æ³›å‹æ“¦é™¤:</strong></p><p>æ³›å‹æ—¶æä¾›ç»™javacç¼–è¯‘å™¨ä½¿ç”¨çš„ï¼Œç”¨äºé™å®šé›†åˆçš„è¾“å…¥ç±»å‹ï¼Œè®©ç¼–è¯‘å™¨åœ¨æºä»£ç çº§åˆ«ä¸Šï¼Œé¿å…å‘é›†åˆä¸­æ’å…¥éæ³•æ•°æ®ã€‚ä½†ç¼–è¯‘å™¨ç¼–è¯‘å®Œå¸¦æœ‰æ³›å‹çš„javaç¨‹åºåï¼Œç”Ÿæˆçš„classæ–‡ä»¶ä¸­ä¸å†å¸¦æœ‰æ³›å‹ä¿¡æ¯ï¼Œä»¥æ­¤ä½¿ç¨‹åºè¿è¡Œæ•ˆç‡ä¸å—å½±å“ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ“¦é™¤ã€‚</p><p>JVMå¹¶ä¸çŸ¥é“æ³›å‹çš„å­˜åœ¨ï¼Œå› ä¸ºæ³›å‹åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»è¢«å¤„ç†æˆæ™®é€šçš„ç±»å’Œæ–¹æ³•ï¼› å¤„ç†æœºåˆ¶æ˜¯é€šè¿‡ç±»å‹æ“¦é™¤ï¼Œæ“¦é™¤è§„åˆ™ï¼š</p><ul><li><p>è‹¥æ³›å‹ç±»å‹æ²¡æœ‰æŒ‡å®šå…·ä½“ç±»å‹ï¼Œç”¨Objectä½œä¸ºåŸå§‹ç±»å‹ï¼›</p></li><li><p>è‹¥æœ‰é™å®šç±»å‹&lt; T exnteds XClass &gt;ï¼Œä½¿ç”¨XClassä½œä¸ºåŸå§‹ç±»å‹ï¼›</p></li><li><p>è‹¥æœ‰å¤šä¸ªé™å®š&lt; T exnteds XClass1 &amp; XClass2 &gt;ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªè¾¹ç•Œç±»å‹XClass1ä½œä¸ºåŸå§‹ç±»å‹ï¼›</p></li></ul><hr><h3 id="_8-final-æœ‰å“ªäº›ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#_8-final-æœ‰å“ªäº›ç”¨æ³•"><span>8. final æœ‰å“ªäº›ç”¨æ³•</span></a></h3><p>finalå…³é”®å­—æœ‰å››ä¸ªå¸¸è§ç”¨æ³•ã€‚</p><p><strong>finalä¿®é¥°ä¸€ä¸ªç±»</strong></p><p>å½“ final å…³é”®å­—ç”¨æ¥ä¿®é¥°ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½æœ‰ä»»ä½•çš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚</p><p>finalç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºfinalæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç±»å¦‚æœæ˜¯finalçš„ï¼Œé‚£ä¹ˆå…¶ä¸­æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•éƒ½æ— æ³•è¿›è¡Œè¦†ç›–é‡å†™ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">     public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ç±»åç§°</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      ã€€ã€€// ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>finalä¿®é¥°ä¸€ä¸ªæ–¹æ³•</strong></p><p>å½“ final å…³é”®å­—ç”¨æ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æœ€ç»ˆæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è¢«è¦†ç›–é‡å†™ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    ä¿®é¥°ç¬¦ </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> è¿”å›å€¼ç±»å‹ æ–¹æ³•åç§°(å‚æ•°åˆ—è¡¨) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     ã€€ã€€// æ–¹æ³•ä½“</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">     }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå¯¹äºç±»ã€æ–¹æ³•æ¥è¯´ï¼Œabstract å…³é”®å­—å’Œ final å…³é”®å­—ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œå› ä¸ºçŸ›ç›¾ã€‚</p><p><strong>finalä¿®é¥°ä¸€ä¸ªå±€éƒ¨å˜é‡</strong></p><p>ä¸€æ—¦ä½¿ç”¨ final ç”¨æ¥ä¿®é¥°å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¸èƒ½è¿›è¡Œæ›´æ”¹ã€Œä¸€æ¬¡èµ‹å€¼ï¼Œç»ˆç”Ÿä¸å˜ã€ã€‚</p><ol><li>å¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´ï¼Œä¸å¯å˜è¯´çš„æ˜¯å˜é‡å½“ä¸­çš„æ•°æ®ä¸å¯æ”¹å˜ï¼›</li><li>å¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´ï¼Œä¸å¯å˜è¯´çš„æ˜¯å˜é‡å½“ä¸­çš„åœ°å€å€¼ä¸å¯æ”¹å˜ã€‚</li></ol><p><strong>finalä¿®é¥°ä¸€ä¸ªæˆå‘˜å˜é‡</strong></p><p>å¯¹äºæˆå‘˜å˜é‡æ¥è¯´ï¼Œå¦‚æœä½¿ç”¨ final å…³é”®å­—ä¿®é¥°ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¹Ÿç…§æ ·æ˜¯ä¸å¯å˜ã€‚</p><ol><li>ç”±äºæˆå‘˜å˜é‡å…·æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥ç”¨äº† final ä¹‹å<strong>å¿…é¡»</strong>æ‰‹åŠ¨èµ‹å€¼ï¼Œä¸ä¼šå†ç»™é»˜è®¤å€¼äº†ï¼›</li><li>å¯¹äº final çš„æˆå‘˜å˜é‡ï¼Œè¦ä¹ˆä½¿ç”¨ç›´æ¥èµ‹å€¼ï¼Œè¦ä¹ˆé€šè¿‡æ„é€ æ–¹æ³•èµ‹å€¼ï¼Œ<strong>å¿…é¡»</strong>äºŒè€…é€‰å…¶ä¸€ï¼›</li><li><strong>å¿…é¡»</strong>ä¿è¯ç±»å½“ä¸­æ‰€æœ‰é‡è½½çš„æ„é€ æ–¹æ³•éƒ½æœ€ç»ˆä¼šå¯¹ final çš„æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼ã€‚</li></ol><hr><h3 id="_9-è¯´ä¸€ä¸‹javaæ³¨è§£" tabindex="-1"><a class="header-anchor" href="#_9-è¯´ä¸€ä¸‹javaæ³¨è§£"><span>9. è¯´ä¸€ä¸‹Javaæ³¨è§£</span></a></h3><p>åœ¨Javaç¼–ç¨‹ä¸­ï¼Œæ³¨è§£éå¸¸å¸¸è§ï¼Œæ³¨è§£çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ³¨è§£å¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p><ol><li><p>JavaåŸç”Ÿæ³¨è§£ å¦‚@Overrideï¼Œ@Deprecated ç­‰ã€‚å¤§å¤šç”¨äº [æ ‡è®°] å’Œ [æ£€æŸ¥] ã€‚</p></li><li><p>ç¬¬ä¸‰æ–¹æ³¨è§£ï¼Œå¦‚ Springã€Mybatisç­‰å®šä¹‰çš„æ³¨è§£ï¼ˆ@Controllerï¼Œ@Dataï¼‰ã€‚</p></li><li><p>è‡ªå®šä¹‰æ³¨è§£ã€‚</p></li></ol><p>JavaåŸç”Ÿé™¤äº†æä¾›åŸºæœ¬æ³¨è§£ï¼Œè¿˜æä¾›äº† meta-annotationï¼ˆå…ƒæ³¨è§£ï¼‰ã€‚è¿™äº›ç±»å‹å’Œå®ƒä»¬æ‰€æ”¯æŒçš„ç±»åœ¨java.lang.annotationåŒ…ä¸­å¯ä»¥æ‰¾åˆ°ã€‚</p><ol><li>@Target</li><li>@Retention</li><li>@Documented</li><li>@Inherited</li></ol><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092044.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><p>ä¸€èˆ¬æ¯”è¾ƒå¸¸ç”¨çš„æœ‰ @Targetï¼Œ@Retentionã€‚<code>@Target</code>è¡¨ç¤ºè¿™ä¸ªæ³¨è§£å¯ä»¥ä¿®é¥°é‚£äº›åœ°æ–¹ï¼ˆæ¯”å¦‚ç±»ã€æ–¹æ³•ã€æˆå‘˜å˜é‡ï¼‰ï¼Œ<code>@Retention</code> ä¸»è¦æ˜¯è®¾ç½®æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><blockquote><p>è¿™æ˜¯ä½ ä¸€å®šä¼šè¢«é—®ï¼Œ</p><ol><li>æœ‰ä½¿ç”¨è¿‡æ³¨è§£å—ï¼Ÿ</li><li>ä½ æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Ÿ</li></ol></blockquote><p>æ³¨è§£æœ‰ä¸€ä¸ªéå¸¸å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œå¤§å®¶å¯ä»¥ç”¨è¿™ä¸ªæ¥ç†è§£å­¦ä¹ ã€‚</p><p><strong>åœºæ™¯ä¸€ï¼šè‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨ å®ç°ç™»å½•æ ¡éªŒ</strong></p><p>å®ç°åŠŸèƒ½ï¼š</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨springbootæ‹¦æˆªå™¨å®ç°è¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼Œå¦‚æœæ–¹æ³•ä¸ŠåŠ äº†@LoginRequiredï¼Œåˆ™æç¤ºç”¨æˆ·è¯¥æ¥å£éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ï¼Œå¦åˆ™ä¸éœ€è¦ç™»å½•ã€‚</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªLoginRequiredæ³¨è§£</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Target</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ElementType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">METHOD</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Retention</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">RetentionPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">RUNTIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> LoginRequired</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå†™ä¸¤ä¸ªç®€å•çš„æ¥å£ï¼Œè®¿é—®sourceAï¼ŒsourceBèµ„æº</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> IndexController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/sourceA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sourceA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä½ æ­£åœ¨è®¿é—®sourceAèµ„æº&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/sourceB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sourceB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä½ æ­£åœ¨è®¿é—®sourceBèµ„æº&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆç®€å•çš„ä¿©ä¸ªæ¥å£ï¼Œæ²¡æ·»åŠ æ‹¦æˆªå™¨ä¹‹å‰æˆåŠŸè®¿é—®</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092410.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><p>å®ç° spring çš„ HandlerInterceptor ç±»å…ˆå®ç°æ‹¦æˆªå™¨ï¼Œä½†ä¸æ‹¦æˆªï¼Œåªæ˜¯ç®€å•æ‰“å°æ—¥å¿—ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SourceAccessInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿›å…¥æ‹¦æˆªå™¨äº†&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> postHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ModelAndView</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> modelAndView</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> afterCompletion</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ç°springç±» WebMvcConfigurerï¼Œåˆ›å»ºé…ç½®ç±»æŠŠæ‹¦æˆªå™¨æ·»åŠ åˆ°æ‹¦æˆªå™¨é“¾ä¸­</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> InterceptorTrainConfigurer</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> WebMvcConfigurer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> addInterceptors</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterceptorRegistry</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> registry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SourceAccessInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addPathPatterns</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‹¦æˆªæˆåŠŸå¦‚ä¸‹</p><p><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-092418.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"> åœ¨ sourceB æ–¹æ³•ä¸Šæ·»åŠ æˆ‘ä»¬çš„ç™»å½•æ³¨è§£ @LoginRequired</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> IndexController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/sourceA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sourceA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä½ æ­£åœ¨è®¿é—®sourceAèµ„æº&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">LoginRequired</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/sourceB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sourceB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä½ æ­£åœ¨è®¿é—®sourceBèµ„æº&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€å•å®ç°ç™»å½•æ‹¦æˆªé€»è¾‘</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> HttpServletResponse</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> handler) throws Exception {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿›å…¥æ‹¦æˆªå™¨äº†&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åå°„è·å–æ–¹æ³•ä¸Šçš„LoginRequredæ³¨è§£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        HandlerMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> handlerMethod </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (HandlerMethod)handler</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        LoginRequired</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> loginRequired </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> handlerMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getAnnotation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">LoginRequired</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(loginRequired </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æœ‰LoginRequiredæ³¨è§£è¯´æ˜éœ€è¦ç™»å½•ï¼Œæç¤ºç”¨æˆ·ç™»å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setContentType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;application/json; charset=utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä½ è®¿é—®çš„èµ„æºéœ€è¦ç™»å½•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡ŒæˆåŠŸï¼Œè®¿é—®sourceBæ—¶éœ€è¦ç™»å½•äº†ï¼Œè®¿é—®sourceAåˆ™ä¸ç”¨ç™»å½•ã€‚ <img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093600.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093602.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p><strong>åœºæ™¯äºŒï¼šè‡ªå®šä¹‰æ³¨è§£+AOP å®ç°æ—¥å¿—æ‰“å°</strong></p><p>å…ˆå¯¼å…¥åˆ‡é¢éœ€è¦çš„ä¾èµ–åŒ…</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">     &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-aop&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ä¸€ä¸ªæ³¨è§£@MyLog</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Target</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ElementType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">METHOD</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Retention</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">RetentionPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">RUNTIME</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;"> MyLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®šä¹‰ä¸€ä¸ªåˆ‡é¢ç±»ï¼Œè§å¦‚ä¸‹ä»£ç æ³¨é‡Šç†è§£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Aspect</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> // 1.è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyLogAspect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 2. PointCutè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåˆ‡ç‚¹ï¼Œ@annotationè¡¨ç¤ºè¿™ä¸ªåˆ‡ç‚¹åˆ‡åˆ°ä¸€ä¸ªæ³¨è§£ä¸Šï¼Œåé¢å¸¦è¯¥æ³¨è§£çš„å…¨ç±»å</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆ‡é¢æœ€ä¸»è¦çš„å°±æ˜¯åˆ‡ç‚¹ï¼Œæ‰€æœ‰çš„æ•…äº‹éƒ½å›´ç»•åˆ‡ç‚¹å‘ç”Ÿ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // logPointCut()ä»£è¡¨åˆ‡ç‚¹åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Pointcut</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;@annotation(com.javapub.blog.MyLog)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> logPointCut</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(){};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 3. ç¯ç»•é€šçŸ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Around</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;logPointCut()&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> logAround</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ProceedingJoinPoint</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> joinPoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è·å–æ–¹æ³•åç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> methodName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> joinPoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getSignature</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è·å–å…¥å‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">        Object</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">param</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> joinPoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getArgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        StringBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sb</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> StringBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> o</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> param){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            sb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(o </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿›å…¥[&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> methodName </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;]æ–¹æ³•,å‚æ•°ä¸º:&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> sb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ç»§ç»­æ‰§è¡Œæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            joinPoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">proceed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Throwable</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> throwable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            throwable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(methodName </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æ–¹æ³•æ‰§è¡Œç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¥éª¤äºŒä¸­çš„IndexControllerå†™ä¸€ä¸ªsourceCè¿›è¡Œæµ‹è¯•ï¼ŒåŠ ä¸Šæˆ‘ä»¬çš„è‡ªå®šä¹‰æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">MyLog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/sourceC/{source_name}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sourceC</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sourceName){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä½ æ­£åœ¨è®¿é—®sourceCèµ„æº&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨springboot webé¡¹ç›®ï¼Œè¾“å…¥è®¿é—®åœ°å€</p><p><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093612.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-094024.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p>æœ‰äº›é¢è¯•å®˜å–œæ¬¢é—®ï¼Œæ³¨è§£ä¸‰è¦ç´ æ˜¯å“ªäº›ï¼š</p><ol><li>æ³¨è§£å£°æ˜ã€</li><li>ä½¿ç”¨æ³¨è§£çš„å…ƒç´ ã€</li><li>æ“ä½œæ³¨è§£ä½¿å…¶èµ·ä½œç”¨(æ³¨è§£å¤„ç†å™¨)</li></ol><hr><h3 id="_10-javaåˆ›å»ºå¯¹è±¡æœ‰å‡ ç§æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_10-javaåˆ›å»ºå¯¹è±¡æœ‰å‡ ç§æ–¹å¼"><span>10. Javaåˆ›å»ºå¯¹è±¡æœ‰å‡ ç§æ–¹å¼</span></a></h3><p>Javaä¸­æœ‰5ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œä¸‹é¢ç»™å‡ºå®ƒä»¬çš„ä¾‹å­</p><p><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093625.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><strong>ä½¿ç”¨newå…³é”®å­—</strong></p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨Classç±»çš„newInstanceæ–¹æ³•</strong></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Classç±»çš„newInstanceæ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚è¿™ä¸ªnewInstanceæ–¹æ³•è°ƒç”¨æ— å‚çš„æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> emp </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (Employee) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;org.javapub.blog.Employee&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">æˆ–è€…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> emp2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨Constructorç±»çš„newInstanceæ–¹æ³•</strong></p><p>å’ŒClassç±»çš„newInstanceæ–¹æ³•å¾ˆåƒï¼Œ java.lang.reflect.Constructorç±»é‡Œä¹Ÿæœ‰ä¸€ä¸ªnewInstanceæ–¹æ³•å¯ä»¥åˆ›å»ºå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªnewInstanceæ–¹æ³•è°ƒç”¨æœ‰å‚æ•°çš„å’Œç§æœ‰çš„æ„é€ å‡½æ•°ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> constructor </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getConstructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> emp3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">newInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨cloneæ–¹æ³•</strong></p><p>æ— è®ºä½•æ—¶æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„cloneæ–¹æ³•ï¼Œjvmå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå°†å‰é¢å¯¹è±¡çš„å†…å®¹å…¨éƒ¨æ‹·è´è¿›å»ã€‚ç”¨cloneæ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶ä¸ä¼šè°ƒç”¨ä»»ä½•æ„é€ å‡½æ•°ã€‚</p><p>è¦ä½¿ç”¨cloneæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®ç°Cloneableæ¥å£å¹¶å®ç°å…¶å®šä¹‰çš„cloneæ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> emp4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (Employee) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">emp3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clone</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨ååºåˆ—åŒ–</strong></p><p>å½“æˆ‘ä»¬åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œjvmä¼šç»™æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼Œjvmåˆ›å»ºå¯¹è±¡å¹¶ä¸ä¼šè°ƒç”¨ä»»ä½•æ„é€ å‡½æ•°ã€‚</p><p>ä¸ºäº†ååºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„ç±»å®ç°Serializableæ¥å£</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ObjectInputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> in </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ObjectInputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> FileInputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data.obj&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">))</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Employee</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> emp5 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (Employee) </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="javaå¹¶å‘" tabindex="-1"><a class="header-anchor" href="#javaå¹¶å‘"><span>Javaå¹¶å‘</span></a></h2><h3 id="_1-start-æ–¹æ³•å’Œrun-æ–¹æ³•çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_1-start-æ–¹æ³•å’Œrun-æ–¹æ³•çš„åŒºåˆ«"><span>1. start()æ–¹æ³•å’Œrun()æ–¹æ³•çš„åŒºåˆ«</span></a></h3><p>å¦‚æœåªæ˜¯è°ƒç”¨ run() æ–¹æ³•ï¼Œé‚£ä¹ˆä»£ç è¿˜æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå¿…é¡»ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„run()æ–¹æ³•é‡Œé¢çš„ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰å¯ä»¥æ‰§è¡Œå…¶run()æ–¹æ³•é‡Œé¢çš„ä»£ç ã€‚</p><p>åªæœ‰è°ƒç”¨äº†start()æ–¹æ³•ï¼Œæ‰ä¼šè¡¨ç°å‡ºå¤šçº¿ç¨‹çš„ç‰¹æ€§ï¼Œä¸åŒçº¿ç¨‹çš„run()æ–¹æ³•é‡Œé¢çš„ä»£ç äº¤æ›¿æ‰§è¡Œã€‚</p><p>å‚è€ƒå›¾ï¼š</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093135.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><hr><h3 id="_2-volatileå…³é”®å­—çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_2-volatileå…³é”®å­—çš„ä½œç”¨"><span>2. volatileå…³é”®å­—çš„ä½œç”¨</span></a></h3><p>volatile <code>è‹± [ËˆvÉ’lÉ™taÉªl]</code> ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„ä¸€å®šæ˜¯<strong>ä¿è¯å†…å­˜å¯è§æ€§</strong>ï¼ˆMemory Visibilityï¼‰ã€‚å¯è§æ€§æ˜¯æ€§å¯¹äºçº¿ç¨‹è€Œè¨€ã€‚</p><p><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093155.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"> ä¸Šå›¾æ˜¯Javaå†…å­˜æ¨¡å‹ï¼Œæ‰€æœ‰çº¿ç¨‹çš„å…±äº«å˜é‡éƒ½æ”¾åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬æœ‰çš„å·¥ä½œå†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸ç›´æ¥æ“ä½œåœ¨ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œè€Œæ˜¯å°†ä¸»å†…å­˜ä¸Šå˜é‡çš„å‰¯æœ¬æ”¾è¿›è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼Œåªæ“ä½œå·¥ä½œå†…å­˜ä¸­çš„æ•°æ®ã€‚å½“ä¿®æ”¹å®Œæ¯•åï¼Œå†æŠŠä¿®æ”¹åçš„ç»“æœæ”¾å›åˆ°ä¸»å†…å­˜ä¸­ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½åªæ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p><p>å¾ˆæ˜æ˜¾ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ä¸€å®šä¼šå‘ç”Ÿè„æ•°æ®é—®é¢˜ã€‚</p><p>ä½¿ç”¨volatileå˜é‡èƒ½å¤Ÿä¿è¯:</p><ol><li>æ¯æ¬¡è¯»å–å‰å¿…é¡»å…ˆä»ä¸»å†…å­˜åˆ·æ–°æœ€æ–°çš„å€¼ã€‚</li><li>æ¯æ¬¡å†™å…¥åå¿…é¡»ç«‹å³åŒæ­¥å›ä¸»å†…å­˜å½“ä¸­ã€‚</li></ol><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œvolatileå…³é”®å­—ä¿®é¥°çš„å˜é‡çœ‹åˆ°çš„éšæ—¶æ˜¯è‡ªå·±çš„æœ€æ–°å€¼ã€‚</p></blockquote><p><strong>é˜²æ­¢æŒ‡ä»¤é‡æ’</strong></p><p>åœ¨åŸºäºååºå…³ç³»çš„Happens-Beforeå†…å­˜æ¨¡å‹ä¸­ï¼ŒæŒ‡ä»¤é‡æ’æŠ€æœ¯å¤§å¤§æé«˜äº†ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚ä½†æ˜¯ä¹Ÿå¼•å…¥ä¸€ä¸ªæ–°é—®é¢˜ï¼šè¢«éƒ¨åˆ†åˆå§‹åŒ–çš„å¯¹è±¡</p><p>ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">åˆ›å»ºä¸€ä¸ªå¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Singleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚äº‹å®ä¸Šï¼Œå®ƒå¯ä»¥â€æŠ½è±¡â€œä¸ºä¸‹é¢å‡ æ¡JVMæŒ‡ä»¤ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">memory </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> allocate</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">initInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(memory)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   //2ï¼šåˆå§‹åŒ–å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> memory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      //3ï¼šè®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢æ“ä½œ2ä¾èµ–äºæ“ä½œ1ï¼Œä½†æ˜¯æ“ä½œ3å¹¶ä¸ä¾èµ–äºæ“ä½œ2ï¼Œæ‰€ä»¥JVMå¯ä»¥ä»¥â€œä¼˜åŒ–â€ä¸ºç›®çš„å¯¹å®ƒä»¬è¿›è¡Œé‡æ’åºï¼Œç»è¿‡é‡æ’åºåå¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">memory </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> allocate</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    //1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> memory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      //3ï¼šè®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€ï¼ˆæ­¤æ—¶å¯¹è±¡è¿˜æœªåˆå§‹åŒ–ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">initInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(memory)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   //2ï¼šåˆå§‹åŒ–å¯¹è±¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°æŒ‡ä»¤é‡æ’ä¹‹åï¼Œæ“ä½œ 3 æ’åœ¨äº†æ“ä½œ 2 ä¹‹å‰ï¼Œå³å¼•ç”¨instanceæŒ‡å‘å†…å­˜memoryæ—¶ï¼Œè¿™æ®µå´­æ–°çš„å†…å­˜è¿˜æ²¡æœ‰åˆå§‹åŒ–ã€‚ç”±äºinstanceå·²ç»æŒ‡å‘äº†ä¸€å—å†…å­˜ç©ºé—´ï¼Œä»è€Œè¿”å› instance!=nullï¼Œç”¨æˆ·å¾—åˆ°äº†æ²¡æœ‰å®Œæˆåˆå§‹åŒ–çš„â€œåŠä¸ªâ€å•ä¾‹ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ç‚¹ï¼švolatileä¸ä¿è¯åŸå­æ€§ã€‚</p><blockquote><p>è¿™é‡Œæœ‰ä¸€ç¯‡ç”Ÿäº§ç¯å¢ƒä½¿ç”¨volatileçš„ä¾‹å­ï¼šhttps://mp.weixin.qq.com/s/s1cwut9WvUSrMYw_6UK3sg</p></blockquote><hr><h3 id="_3-sleepæ–¹æ³•å’Œwaitæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_3-sleepæ–¹æ³•å’Œwaitæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«"><span>3. sleepæ–¹æ³•å’Œwaitæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</span></a></h3><p>è¦äº†è§£sleepå’Œwaitï¼Œé¦–å…ˆéœ€è¦äº†è§£Javaçº¿ç¨‹çš„6ç§çŠ¶æ€ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">#ä¸‹é¢æ˜¯Javaçº¿ç¨‹çš„6ç§çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> åˆå§‹(NEW)ï¼šæ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œä½†è¿˜æ²¡æœ‰è°ƒç”¨</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()æ–¹æ³•ã€‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> è¿è¡Œ(RUNNABLE)ï¼šJavaçº¿ç¨‹ä¸­å°†å°±ç»ªï¼ˆreadyï¼‰å’Œè¿è¡Œä¸­ï¼ˆrunningï¼‰ä¸¤ç§çŠ¶æ€ç¬¼ç»Ÿçš„ç§°ä¸ºâ€œè¿è¡Œâ€ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">çº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹(æ¯”å¦‚mainçº¿ç¨‹ï¼‰è°ƒç”¨äº†è¯¥å¯¹è±¡çš„</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºå¯è¿è¡Œçº¿ç¨‹æ± ä¸­ï¼Œç­‰å¾…è¢«çº¿ç¨‹è°ƒåº¦é€‰ä¸­ï¼Œè·å–CPUçš„ä½¿ç”¨æƒï¼Œæ­¤æ—¶å¤„äºå°±ç»ªçŠ¶æ€ï¼ˆreadyï¼‰ã€‚å°±ç»ªçŠ¶æ€çš„çº¿ç¨‹åœ¨è·å¾—CPUæ—¶é—´ç‰‡åå˜ä¸ºè¿è¡Œä¸­çŠ¶æ€ï¼ˆrunningï¼‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> é˜»å¡(BLOCKED)ï¼šè¡¨ç¤ºçº¿ç¨‹é˜»å¡äºé”ã€‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ç­‰å¾…(WAITING)ï¼šè¿›å…¥è¯¥çŠ¶æ€çš„çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹åšå‡ºä¸€äº›ç‰¹å®šåŠ¨ä½œï¼ˆé€šçŸ¥æˆ–ä¸­æ–­ï¼‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> è¶…æ—¶ç­‰å¾…(TIMED_WAITING)ï¼šè¯¥çŠ¶æ€ä¸åŒäºWAITINGï¼Œå®ƒå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´åè‡ªè¡Œè¿”å›ã€‚</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">6.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ç»ˆæ­¢(TERMINATED)ï¼šè¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>sleep</strong> ä¼‘çœ æ–¹æ³•</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">long</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ms)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¯¥æ–¹æ³•ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€æŒ‡å®šæ¯«ç§’ï¼Œå½“é˜»å¡æŒ‡å®šæ¯«ç§’åï¼Œå½“å‰çº¿ç¨‹ä¼šé‡æ–°è¿›å…¥RunnableçŠ¶æ€ï¼Œç­‰å¾…åˆ’åˆ†æ—¶é—´ç‰‡ã€‚</p><p>sleepæ–¹æ³•å±äºThreadç±»ä¸­æ–¹æ³•ï¼Œè¡¨ç¤ºè®©ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç­‰å¾…ä¸€å®šçš„æ—¶é—´ä¹‹åï¼Œè‡ªåŠ¨é†’æ¥è¿›å…¥åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä¸ä¼šé©¬ä¸Šè¿›å…¥è¿è¡ŒçŠ¶æ€ï¼Œå› ä¸ºçº¿ç¨‹è°ƒåº¦æœºåˆ¶æ¢å¤çº¿ç¨‹çš„è¿è¡Œä¹Ÿéœ€è¦æ—¶é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹è±¡è°ƒç”¨äº†sleepæ–¹æ³•ä¹‹åï¼Œå¹¶ä¸ä¼šé‡Šæ”¾ä»–æ‰€æŒæœ‰çš„æ‰€æœ‰å¯¹è±¡é”ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹å¯¹è±¡çš„è¿è¡Œã€‚</p><p><strong>wait</strong> æ–¹æ³•ä¸€èˆ¬æ˜¯è·Ÿnotifyæ–¹æ³•è¿ç”¨çš„</p><p>å¤šçº¿ç¨‹ä¹‹é—´éœ€è¦åè°ƒå·¥ä½œã€‚å¦‚æœæ¡ä»¶ä¸æ»¡è¶³åˆ™ç­‰å¾…ã€‚å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œç­‰å¾…è¯¥æ¡ä»¶çš„çº¿ç¨‹å°†è¢«å”¤é†’ã€‚åœ¨Javaä¸­ï¼Œè¿™ä¸ªæœºåˆ¶å®ç°ä¾èµ–äºwait/notifyæˆ–wait/notifyAllã€‚</p><p>object.wait()è®©å½“å‰çº¿ç¨‹è¿›å…¥ä¸å¯è¿è¡ŒçŠ¶æ€ï¼Œå¦‚sleep()ä¸€æ ·ï¼Œä½†ä¸åŒçš„æ˜¯waitæ–¹æ³•ä»ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ï¼Œè€Œä¸æ˜¯ä»ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ï¼›æˆ‘ä»¬ç§°è¿™ä¸ªå¯¹è±¡ä¸ºâ€œé”å®šå¯¹è±¡ï¼ˆlockObjï¼‰â€ã€‚åœ¨lockObj.wait()è¢«è°ƒç”¨ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹å¿…é¡»åœ¨lockObjä¸ŠåŒæ­¥ï¼ˆsynchronizeï¼‰ï¼›ç„¶åè°ƒç”¨wait()åé‡Šæ”¾è¿™ä¸ªé”ï¼Œå¹¶å°†çº¿ç¨‹å¢åŠ åˆ°ä¸lockObjç›¸å…³çš„â€œç­‰å¾…åå•ï¼ˆwait listï¼‰â€ã€‚ç„¶åï¼Œå¦ä¸€ä¸ªåœ¨åŒä¸€ä¸ªlockObjé”å®šï¼ˆsynchronizeï¼‰çš„æ–¹æ³•å¯ä»¥è°ƒç”¨lockObj.nofity()ã€‚è¿™ä¼šå”¤é†’åŸæ¥ç­‰å¾…çš„çº¿ç¨‹ã€‚åŸºæœ¬ä¸Šï¼Œwait() / notify()å°±åƒsleep() / interrupt()ï¼Œåªæ˜¯æ´»åŠ¨çº¿ç¨‹ä¸éœ€è¦ç›´æ¥æŒ‡å‘ä¸€ä¸ªç¡çœ çº¿ç¨‹ï¼Œä»–ä»¬åªéœ€è¦å…±äº«é”å¯¹è±¡ï¼ˆlockObjï¼‰ã€‚</p><p>åˆ°è¿™é‡Œä½ æ˜¯å¦æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸æ˜ç™½æ¥JavaPubï¼Œåç»­ä¸€ç¯‡ä»£ç åˆ†æï¼Œé©¬ä¸Šå®‰æ’ã€‚</p><hr><h3 id="_4-å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹"><span>4. å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ</span></a></h3><p>æœ€ç›´è§‚çš„ä¸€å®šæ˜¯ Thread.stopï¼Œä½†æ˜¯å®ƒæ˜¯ä¸æ¨èçš„ï¼Œå¹¶ä¸”å·²ç»åºŸå¼ƒã€‚çœ‹ä¸€ä¸‹å®˜æ–¹è¯´æ˜ https://docs.oracle.com/javase/8/docs/technotes/guides/concurrency/threadPrimitiveDeprecation.html</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">   	This</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> method is inherently </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">unsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">   Stopping</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a thread with </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">       Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> causes it to unlock all of the monitors that it </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       has </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">locked</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (as a natural consequence of the unchecked </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">       &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ThreadDeath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> exception propagating up the stack)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">   If</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       any of the objects previously </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> by these monitors were in </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       an inconsistent state</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> the damaged objects become visible to </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       other threads</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> potentially resulting in arbitrary </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">behavior</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">   Many</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       uses of </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stop</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> should be replaced by code that simply </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       modifies some variable to indicate that the target thread should </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       stop </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">running</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">   The</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> target thread should check </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> variable </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       regularly</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> and </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> from its run method in an orderly fashion </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> the variable indicates that it is to stop </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">running</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">   If</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> the </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       target thread waits </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> long</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> periods</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (on a condition variable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">       for</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> example)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> the </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">interrupt</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> method should be used to </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">       interrupt the wait</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°ç»“ï¼š ç®€å•æ¥è¯´ï¼ŒThread.stop()ä¸å®‰å…¨ï¼Œå·²ä¸å†å»ºè®®ä½¿ç”¨ã€‚</p><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><p>ä½¿ç”¨ interrupt æ–¹æ³•ä¸­æ–­çº¿ç¨‹ã€‚</p><p>interrupt()æ–¹æ³•çš„ä½¿ç”¨æ•ˆæœå¹¶ä¸åƒfor+breakè¯­å¥é‚£æ ·ï¼Œé©¬ä¸Šå°±åœæ­¢å¾ªç¯ã€‚è°ƒç”¨interruptæ–¹æ³•æ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰“äº†ä¸€ä¸ªåœæ­¢æ ‡å¿—ï¼Œå¹¶ä¸æ˜¯çœŸçš„åœæ­¢çº¿ç¨‹ã€‚</p><p>éœ€è¦ this.isInterrupted(): æµ‹è¯•çº¿ç¨‹æ˜¯å¦çœŸçš„å·²ç»ä¸­æ–­ã€‚</p><p><strong>æ–¹æ³•äºŒï¼š</strong></p><p>æœ€å¥½çš„ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨æ ‡å¿—ä½åœæ­¢ã€‚</p><p>run() æ–¹æ³•ä¸­åšæ ‡è¯†ç¬¦ï¼Œä¿è¯ä¼˜é›…çš„åœæ­¢æœåŠ¡ã€‚</p><hr><h3 id="_5-javaå¦‚ä½•å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„é€šè®¯å’Œåä½œ-å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_5-javaå¦‚ä½•å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„é€šè®¯å’Œåä½œ-å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®"><span>5. javaå¦‚ä½•å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„é€šè®¯å’Œåä½œï¼Ÿ(å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´å…±äº«æ•°æ®ï¼Ÿ)</span></a></h3><p><strong>volatileå…³é”®å­—æ–¹å¼</strong></p><p>volatileæœ‰ä¸¤å¤§ç‰¹æ€§ï¼Œä¸€æ˜¯å¯è§æ€§ï¼ŒäºŒæ˜¯æœ‰åºæ€§ï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œå…¶ä¸­å¯è§æ€§å°±æ˜¯å¯ä»¥è®©çº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</p><p><strong>ç­‰å¾…/é€šçŸ¥æœºåˆ¶</strong></p><p>ç­‰å¾…é€šçŸ¥æœºåˆ¶æ˜¯åŸºäºwaitå’Œnotifyæ–¹æ³•æ¥å®ç°çš„ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹å†…è°ƒç”¨è¯¥çº¿ç¨‹é”å¯¹è±¡çš„waitæ–¹æ³•ï¼Œçº¿ç¨‹å°†è¿›å…¥ç­‰å¾…é˜Ÿåˆ—è¿›è¡Œç­‰å¾…ç›´åˆ°è¢«é€šçŸ¥æˆ–è€…è¢«å”¤é†’ã€‚</p><p>ä¹Ÿå°±æ˜¯é€šè¿‡<strong>ç­‰å¾…/é€šçŸ¥æœºåˆ¶</strong> è®©å¤šä¸ªçº¿ç¨‹åä½œ</p><p><strong>joinæ–¹å¼</strong></p><p>joinå…¶å®åˆç†ç†è§£æˆæ˜¯çº¿ç¨‹åˆå¹¶ï¼Œå½“åœ¨ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„joinæ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹é˜»å¡ç­‰å¾…è¢«è°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥joinçš„å¥½å¤„èƒ½å¤Ÿä¿è¯çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çº¿ç¨‹çš„joinæ–¹æ³•å…¶å®å·²ç»å¤±å»äº†å¹¶è¡Œçš„æ„ä¹‰ï¼Œè™½ç„¶å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸²è¡Œçš„ï¼Œæœ€åjoinçš„å®ç°å…¶å®æ˜¯åŸºäºç­‰å¾…é€šçŸ¥æœºåˆ¶çš„ã€‚</p><p><strong>threadLocalæ–¹å¼</strong></p><p>threadLocalæ–¹å¼çš„çº¿ç¨‹é€šä¿¡ï¼Œä¸åƒä»¥ä¸Šä¸‰ç§æ–¹å¼æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨çš„é€šä¿¡ï¼Œå°†å½“å‰çº¿ç¨‹å’Œä¸€ä¸ªmapç»‘å®šï¼Œåœ¨å½“å‰çº¿ç¨‹å†…å¯ä»¥ä»»æ„å­˜å–æ•°æ®ï¼Œå‡çœäº†æ–¹æ³•è°ƒç”¨é—´å‚æ•°çš„ä¼ é€’ã€‚</p><hr><h3 id="_6-ä»€ä¹ˆæ˜¯threadlocal" tabindex="-1"><a class="header-anchor" href="#_6-ä»€ä¹ˆæ˜¯threadlocal"><span>6. ä»€ä¹ˆæ˜¯ThreadLocal?</span></a></h3><p>å®šä¹‰ï¼šçº¿ç¨‹å±€éƒ¨å˜é‡æ˜¯å±€é™äºçº¿ç¨‹å†…çš„å˜é‡ï¼Œå±äºçº¿ç¨‹è‡ªèº«æ‰€æœ‰ï¼Œä¸åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«ã€‚javaæä¾› ThreadLocalç±» æ¥æ”¯æŒçº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œæ˜¯ä¸€ä¸ªå®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ã€‚</p><p>ä½œç”¨ï¼šThreadLocal æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼Œåœ¨æ¯ä¸€ä¸ª Thread é‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ª ThreadLocal.ThreadLocalMap æŠŠæ•°æ®è¿›è¡Œéš”ç¦»ï¼Œæ•°æ®ä¸å…±äº«ï¼Œè‡ªç„¶å°±æ²¡æœ‰çº¿ç¨‹å®‰å…¨æ–¹é¢çš„é—®é¢˜äº†ã€‚</p><hr><h3 id="_7-java-ä¸­-countdownlatch-å’Œ-cyclicbarrier-æœ‰ä»€ä¹ˆä¸åŒ" tabindex="-1"><a class="header-anchor" href="#_7-java-ä¸­-countdownlatch-å’Œ-cyclicbarrier-æœ‰ä»€ä¹ˆä¸åŒ"><span>7. Java ä¸­ CountDownLatch å’Œ CyclicBarrier æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span></a></h3><p><strong>æ¦‚å¿µï¼š</strong></p><p><strong>CountDownLatch</strong> æ˜¯ä¸€ä¸ªåŒæ­¥çš„è¾…åŠ©ç±»ï¼Œå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»–ä¸€ç»„çº¿ç¨‹å®Œæˆæ“ä½œï¼Œå†ç»§ç»­æ‰§è¡Œã€‚ç®€å•æ¥è¯´ï¼šCountDownLatch æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥ä¿è¯çº¿ç¨‹ä¹‹é—´çš„é¡ºåºæ‰§è¡ŒæŠŠçº¿ç¨‹ä»å¹¶å‘çŠ¶æ€è°ƒæ•´ä¸ºä¸²è¡ŒçŠ¶æ€ä¿è¯äº†çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚(åªå¯ä»¥ä½¿ç”¨ä¸€æ¬¡)</p><p><strong>CyclicBarrier</strong> æ˜¯ä¸€ä¸ªåŒæ­¥çš„è¾…åŠ©ç±»ï¼Œå…è®¸ä¸€ç»„çº¿ç¨‹ç›¸äº’ä¹‹é—´ç­‰å¾…ï¼Œè¾¾åˆ°ä¸€ä¸ªå…±åŒç‚¹ï¼Œå†ç»§ç»­æ‰§è¡Œã€‚å…¸å‹åœºæ™¯ï¼šå¯ä»¥ç”¨äºå¤šçº¿ç¨‹è®¡ç®—æ•°æ®ï¼Œæœ€ååˆå¹¶è®¡ç®—ç»“æœã€‚ï¼ˆå¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼‰</p><p>åˆ†äº«ä¸€ä¸ªç›´è§‚çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.javapub.test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.concurrent.CountDownLatch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Author: JavaPub</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @License: https://github.com/Rodert/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Contact: https://javapub.blog.csdn.net/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Date: 2022/1/1 16:50</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Version: 1.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Description: countDownLatch å¯ä»¥ä¿è¯çº¿ç¨‹ä¹‹é—´çš„é¡ºåºæ‰§è¡ŒæŠŠçº¿ç¨‹ä»å¹¶å‘çŠ¶æ€è°ƒæ•´ä¸ºä¸²è¡ŒçŠ¶æ€ä¿è¯äº†çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * demoæ•ˆæœï¼šå½“æ‰“å°å®ŒBï¼Œå†æ‰“å°Cã€‚</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ThreadA</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> CountDownLatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> down</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CountDownLatch</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> down</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">down</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> down;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            down</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//ç›¸å½“äºwait(),è°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå®ƒä¼šç­‰å¾…ç›´åˆ°countå€¼ä¸º0æ‰ç»§ç»­æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;C&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ThreadB</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> CountDownLatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> down</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CountDownLatch</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> down</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">down</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> down;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">down</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        down</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">countDown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//å°†countå€¼å‡1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        CountDownLatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> down</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CountDownLatch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//åˆ›å»º1ä¸ªè®¡æ•°å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(down).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(down).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/*è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">C</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> */</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.roundyuan.fanggateway.test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.concurrent.CyclicBarrier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Author: JavaPub</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @License: https://github.com/Rodert/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Contact: https://javapub.blog.csdn.net/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Date: 2022/1/2 13:42</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Version: 1.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Description: CyclicBarrier</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CyclicBarrierDemo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> TaskThread</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        CyclicBarrier</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> barrier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TaskThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CyclicBarrier</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> barrier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">            this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">barrier</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> barrier;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; åˆ°è¾¾æ …æ  A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                barrier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; å†²ç ´æ …æ  A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; åˆ°è¾¾æ …æ  B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                barrier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; å†²ç ´æ …æ  B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> threadNum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        CyclicBarrier</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> barrier</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CyclicBarrier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(threadNum, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; å®Œæˆæœ€åä»»åŠ¡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> threadNum; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TaskThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(barrier).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-3 åˆ°è¾¾æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-1 åˆ°è¾¾æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-4 åˆ°è¾¾æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-2 åˆ°è¾¾æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-0 åˆ°è¾¾æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-2 å®Œæˆæœ€åä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-2 å†²ç ´æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-0 å†²ç ´æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-4 å†²ç ´æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-3 å†²ç ´æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-1 å†²ç ´æ …æ  A</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-4 åˆ°è¾¾æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-0 åˆ°è¾¾æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-2 åˆ°è¾¾æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-1 åˆ°è¾¾æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-3 åˆ°è¾¾æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-3 å®Œæˆæœ€åä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-3 å†²ç ´æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-0 å†²ç ´æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-4 å†²ç ´æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-1 å†²ç ´æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">Thread-2 å†²ç ´æ …æ  B</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> */</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªæ¯”è¾ƒå½¢è±¡ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CountDownLatchï¼š</span></span>
<span class="line"><span>å®¿ç®¡é˜¿å§¨ï¼Œæ™šä¸Šå…³å®¿èˆå¤§é—¨ç¡è§‰ï¼Œéœ€è¦ç­‰åˆ°æ‰€æœ‰å­¦ç”Ÿå›å¯ï¼Œæ‰èƒ½å…³é—¨ç¡è§‰ï¼Œå­¦ç”Ÿä¹‹é—´ä¸ç”¨ç›¸äº’ç­‰å¾…ï¼Œå›å¯å°±èƒ½ç¡è§‰ã€‚	ï¼ˆå­¦ç”Ÿå°±æ˜¯å„ä¸ªçº¿ç¨‹ï¼Œå®¿ç®¡é˜¿å§¨å°±æ˜¯ç›‘å¬CountDownLatchä¸º0åè¦æ‰§è¡Œçš„ã€‚ï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CyclicBarrierï¼š</span></span>
<span class="line"><span>å®¶åº­èšé¤ï¼Œç­‰å¾…å®¶åº­æˆå‘˜åˆ°é½æ‰èƒ½å¼€é¥­ï¼Œå®¶åº­æˆå‘˜ä¹‹é—´éœ€è¦ç›¸äº’ç­‰å¾…ï¼Œç›´åˆ°æœ€åä¸€ä¸ªåˆ°è¾¾ï¼Œæ‰èƒ½åŒæ—¶å¼€é¥­ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_8-å¦‚ä½•é¿å…æ­»é”" tabindex="-1"><a class="header-anchor" href="#_8-å¦‚ä½•é¿å…æ­»é”"><span>8. å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</span></a></h3><p><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093204.png" alt="" loading="lazy"> ä»ä¸Šå›¾æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œäº§ç”Ÿæ­»é”å°±æ˜¯ä¿©ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åœ¨ç”³è¯·èµ„æºæ—¶ï¼Œè‡ªå·±éœ€è¦çš„èµ„æºåˆ«åˆ«äººæŒæœ‰ã€å¹¶é˜»å¡ã€‚æ‰€ä»¥å¯¼è‡´æ­»é”ã€‚</p><p><strong>å¦‚ä½•è§£å†³ï¼š</strong></p><ol><li>å‡å°é”çš„èŒƒå›´ï¼Œå°½é‡ä¿è¯ä¹‹é”å®šè‡ªå·±éœ€è¦çš„èµ„æºï¼Œå‡å°äº¤å‰æŒæœ‰èµ„æºæƒ…å†µ</li><li>ä½†æ˜¯æœ‰äº›æ—¶å€™ä¸å¾—ä¸æŒæœ‰å¤šä¸ªèµ„æºï¼Œæ¯”å¦‚<strong>é“¶è¡Œè½¬è´¦</strong>ï¼Œæˆ‘ä»¬å¿…é¡»åŒæ—¶è·å¾—ä¸¤ä¸ªè´¦æˆ·ä¸Šçš„é”ï¼Œæ‰èƒ½è¿›è¡Œæ“ä½œï¼Œä¸¤ä¸ªé”çš„ç”³è¯·å¿…é¡»å‘ç”Ÿäº¤å‰ã€‚è¿™æ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰“ç ´æ­»é”çš„é‚£ä¸ªé—­ç¯ï¼Œåœ¨æ¶‰åŠåˆ°è¦åŒæ—¶ç”³è¯·ä¸¤ä¸ªé”çš„æ–¹æ³•ä¸­ï¼Œæ€»æ˜¯ä»¥ç›¸åŒçš„é¡ºåºæ¥ç”³è¯·é”ï¼Œæ¯”å¦‚æ€»æ˜¯å…ˆç”³è¯· id å¤§çš„è´¦æˆ·ä¸Šçš„é” ï¼Œç„¶åå†ç”³è¯· id å°çš„è´¦æˆ·ä¸Šçš„é”ï¼Œè¿™æ ·å°±æ— æ³•å½¢æˆå¯¼è‡´æ­»é”çš„é‚£ä¸ªé—­ç¯ã€‚</li><li>æˆ‘ä»¬çŸ¥é“å¯¼è‡´æ­»é”æœ‰ä¸€ä¸ªå› ç´ æ˜¯é˜»å¡ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨é»˜è®¤é˜»å¡çš„é”ï¼Œä¹Ÿæ˜¯å¯ä»¥é¿å…æ­»é”çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ReentrantLock.tryLock() æ–¹æ³•ï¼Œåœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå¦‚æœ tryLock() è¿”å›å¤±è´¥ï¼Œé‚£ä¹ˆå°±é‡Šæ”¾ä»¥åŠè·å¾—çš„é”ï¼Œå¹¶ç¡çœ ä¸€å°æ®µæ—¶é—´ã€‚è¿™æ ·å°±æ‰“ç ´äº†æ­»é”çš„é—­ç¯ã€‚</li></ol><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.roundyuan.fanggateway.test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.Random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.concurrent.TimeUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.concurrent.locks.Lock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> java.util.concurrent.locks.ReentrantLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Author: JavaPub</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @License: https://github.com/Rodert/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Contact: https://javapub.blog.csdn.net/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Date: 2022/1/2 14:38</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Version: 1.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Description: ReentrantLock</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> DeadLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Lock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lock1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Lock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lock2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> deathLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lock1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tryLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                            //å¦‚æœè·å–æˆåŠŸåˆ™æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œåˆ™é‡Šæ”¾lock1çš„é”ï¼Œè‡ªæ—‹é‡æ–°å°è¯•è·å¾—é”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                            if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lock2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tryLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                                try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Thread1ï¼šå·²æˆåŠŸè·å– lock1 and lock2 ...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                                    break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                                    lock2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                            lock1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Thread1ï¼šè·å–é”å¤±è´¥ï¼Œé‡æ–°è·å–---&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                        //é˜²æ­¢å‘ç”Ÿæ´»é”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                        TimeUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NANOSECONDS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextInt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                        e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lock2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tryLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                            //å¦‚æœè·å–æˆåŠŸåˆ™æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œåˆ™é‡Šæ”¾lock2çš„é”ï¼Œè‡ªæ—‹é‡æ–°å°è¯•è·å¾—é”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                            if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lock1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tryLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                                try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Thread2ï¼šå·²æˆåŠŸè·å– lock2 and lock1 ...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                                    break</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                                    lock1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                            lock2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unlock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Thread2ï¼šè·å–é”å¤±è´¥ï¼Œé‡æ–°è·å–---&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                        //é˜²æ­¢å‘ç”Ÿæ´»é”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                        TimeUnit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NANOSECONDS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextInt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                        e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            deathLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´èµ·æ­»é”ï¼Œé“¶è¡Œå®¶ç®—æ³•éå¸¸æœ‰å¿…è¦äº†è§£ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>é“¶è¡Œå®¶ç®—æ³•ï¼ˆBankerâ€™s Algorithmï¼‰æ˜¯ä¸€ä¸ªé¿å…æ­»é”ï¼ˆDeadlockï¼‰çš„è‘—åç®—æ³•ï¼Œæ˜¯ç”±è‰¾å…¹æ ¼Â·è¿ªæ°æ–¯ç‰¹æ‹‰åœ¨1965å¹´ä¸ºT.H.Eç³»ç»Ÿè®¾è®¡çš„ä¸€ç§é¿å…æ­»é”äº§ç”Ÿçš„ç®—æ³•ã€‚å®ƒä»¥é“¶è¡Œå€Ÿè´·ç³»ç»Ÿçš„åˆ†é…ç­–ç•¥ä¸ºåŸºç¡€ï¼Œåˆ¤æ–­å¹¶ä¿è¯ç³»ç»Ÿçš„å®‰å…¨è¿è¡Œã€‚</span></span>
<span class="line"><span>1ã€æ“ä½œç³»ç»ŸæŒ‰ç…§é“¶è¡Œå®¶æŒ‡å®šçš„è§„åˆ™ä¸ºè¿›ç¨‹åˆ†é…èµ„æºï¼Œå½“è¿›ç¨‹é¦–æ¬¡ç”³è¯·èµ„æºæ—¶ï¼Œéœ€è¦æµ‹è¯•è¯¥è¿›ç¨‹å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚é‡ï¼Œå¦‚æœç³»ç»Ÿç°å­˜çš„èµ„æºå¯ä»¥æ»¡è¶³å®ƒçš„æœ€å¤§éœ€æ±‚é‡åˆ™æŒ‰å½“å‰çš„ç”³è¯·èµ„æºåˆ†é…èµ„æºï¼Œå¦åˆ™å°±æ¨è¿Ÿåˆ†é…ï¼›</span></span>
<span class="line"><span>2ã€å½“è¿›ç¨‹åœ¨æ‰§è¡Œä¸­ç»§ç»­ç”³è¯·èµ„æºæ—¶ï¼Œå…ˆæµ‹è¯•è¯¥è¿›ç¨‹æœ¬æ¬¡ç”³è¯·çš„èµ„æºæ•°ï¼Œæ˜¯å¦è¶…è¿‡äº†è¯¥èµ„æºå‰©ä½™çš„æ€»é‡ï¼Œè‹¥è¶…è¿‡åˆ™æ‹’ç»åˆ†é…èµ„æºï¼Œè‹¥èƒ½æ»¡è¶³åˆ™æŒ‰å½“å‰çš„ç”³è¯·é‡åˆ†é…èµ„æºï¼Œå¦åˆ™ä¹Ÿè¦æ¨è¿Ÿåˆ†é…ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‚è€ƒé˜…è¯»ï¼š</p><p>å¦‚ä½•å¿«é€Ÿæ’æŸ¥æ­»é”ï¼Ÿå¦‚ä½•é¿å…æ­»é”ï¼Ÿ https://zhuanlan.zhihu.com/p/136294283</p><hr><h3 id="_9-java-ä¸­-synchronized-å’Œ-reentrantlock-æœ‰ä»€ä¹ˆä¸åŒ" tabindex="-1"><a class="header-anchor" href="#_9-java-ä¸­-synchronized-å’Œ-reentrantlock-æœ‰ä»€ä¹ˆä¸åŒ"><span>9. Java ä¸­ synchronized å’Œ ReentrantLock æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span></a></h3><p><strong>ç­‰å¾…å¯ä¸­æ–­:</strong></p><p>ä½¿ç”¨synchronizedï¼Œä¸èƒ½è¢«ä¸­æ–­ã€‚synchronized ä¹Ÿå¯ä»¥è¯´æ˜¯Javaæä¾›çš„åŸå­æ€§å†…ç½®é”æœºåˆ¶ã€‚å†…éƒ¨é”æ‰®æ¼”äº†äº’æ–¥é”ï¼ˆmutual exclusion lock ï¼Œmutexï¼‰çš„è§’è‰²ï¼Œä¸€ä¸ªçº¿ç¨‹å¼•ç”¨é”çš„æ—¶å€™ï¼Œåˆ«çš„çº¿ç¨‹é˜»å¡ç­‰å¾…ã€‚</p><p>ä½¿ç”¨ReentrantLockã€‚ç­‰å¾…äº†å¾ˆé•¿æ—¶é—´ä»¥åï¼Œå¯ä»¥ä¸­æ–­ç­‰å¾…ï¼Œè½¬è€Œå»åšåˆ«çš„äº‹æƒ…ã€‚</p><p><strong>å…¬å¹³é”:</strong></p><p>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”ï¼›è€Œéå…¬å¹³é”åˆ™ä¸èƒ½ä¿è¯è¿™ä¸€ç‚¹ã€‚éå…¬å¹³é”åœ¨é”è¢«é‡Šæ”¾æ—¶ï¼Œä»»ä½•ä¸€ä¸ªç­‰å¾…é”çš„çº¿ç¨‹éƒ½æœ‰æœºä¼šè·å¾—é”ã€‚ synchronizedçš„é”æ˜¯éå…¬å¹³é”ï¼ŒReentrantLocké»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³é”ï¼Œä½†å¯ä»¥é€šè¿‡å¸¦å¸ƒå°”å€¼çš„æ„é€ å‡½æ•°è¦æ±‚ä½¿ç”¨å…¬å¹³é”ã€‚</p><p>è¿˜æœ‰å¤§å®¶å·²çŸ¥çš„ä¿©ç‚¹ï¼š</p><ol><li><p>synchronizedæ˜¯ç‹¬å é”ï¼ŒåŠ é”å’Œè§£é”çš„è¿‡ç¨‹è‡ªåŠ¨è¿›è¡Œï¼Œæ˜“äºæ“ä½œï¼Œä½†ä¸å¤Ÿçµæ´»ã€‚ReentrantLockä¹Ÿæ˜¯ç‹¬å é”ï¼ŒåŠ é”å’Œè§£é”çš„è¿‡ç¨‹éœ€è¦æ‰‹åŠ¨è¿›è¡Œï¼Œä¸æ˜“æ“ä½œï¼Œä½†éå¸¸çµæ´»ã€‚</p></li><li><p>synchronizedå¯é‡å…¥ï¼Œå› ä¸ºåŠ é”å’Œè§£é”è‡ªåŠ¨è¿›è¡Œï¼Œä¸å¿…æ‹…å¿ƒæœ€åæ˜¯å¦é‡Šæ”¾é”ï¼›ReentrantLockä¹Ÿå¯é‡å…¥ï¼Œä½†åŠ é”å’Œè§£é”éœ€è¦æ‰‹åŠ¨è¿›è¡Œï¼Œä¸”æ¬¡æ•°éœ€ä¸€æ ·ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”ã€‚</p></li></ol><hr><h3 id="_10-æœ‰ä¸‰ä¸ªçº¿ç¨‹-t1-t2-t3-æ€ä¹ˆç¡®ä¿å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#_10-æœ‰ä¸‰ä¸ªçº¿ç¨‹-t1-t2-t3-æ€ä¹ˆç¡®ä¿å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œ"><span>10. æœ‰ä¸‰ä¸ªçº¿ç¨‹ T1ï¼ŒT2ï¼ŒT3ï¼Œæ€ä¹ˆç¡®ä¿å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ</span></a></h3><p><strong>æ–¹æ³•1ï¼š</strong></p><p>çº¿ç¨‹å†…éƒ¨é¡ºåºè°ƒç”¨ï¼ŒT1ã€T2ã€T3ã€‚è¿™ä¸ªå¯èƒ½ä¸æ˜¯è¦è€ƒå¯Ÿçš„ç‚¹ï¼Œä½†ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ¡ˆã€‚</p><p><strong>æ–¹æ³•2ï¼š</strong></p><p>join()æ–¹æ³•ç”¨äºå°†çº¿ç¨‹ç”± â€å¹¶è¡Œâ€œå˜æˆâ€ä¸²è¡Œâ€œï¼Œå®ƒç”¨äºç­‰å¾…å…¶ä»–çº¿ç¨‹çš„ç»ˆæ­¢ï¼Œåœ¨å½“å‰çº¿ç¨‹æ‰ç”¨äº†join()æ–¹æ³•ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°†è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ç»“æŸï¼Œå½“å‰çº¿ç¨‹å†ç”±é˜»å¡çŠ¶æ€è½¬å˜æˆå°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…CPUçš„ä½¿ç”¨æƒã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#C678DD;"> com.javapub.test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Author: JavaPub</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @License: https://github.com/Rodert/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Contact: https://javapub.blog.csdn.net/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Date: 2022/1/2 15:20</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Version: 1.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> * @Description:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Test1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        ThreadA</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> threadA</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        ThreadB</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> threadB</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(threadA);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        ThreadC</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> threadC</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadC</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(threadB);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        threadA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        threadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        threadC</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ThreadA</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;çº¿ç¨‹A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ThreadB</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> threadA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // dosomething Auto-generated constructor stub</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> threadA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">threadA</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> threadA;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            threadA</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // dosomething Auto-generated catch block</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;çº¿ç¨‹B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ThreadC</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> threadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ThreadC</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> threadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">threadB</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> threadB;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            threadB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            // dosomething Auto-generated catch block</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;çº¿ç¨‹C&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿¡å·é‡æ–¹å¼ java.util.concurrent.Semaphore <code>è‹± [ËˆsemÉ™fÉ”Ë(r)]</code> å¾…ç ”ç©¶</p><h2 id="java-å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#java-å®¹å™¨"><span>Java å®¹å™¨</span></a></h2><h3 id="_1-è¯·è¯´ä¸€ä¸‹javaå®¹å™¨é›†åˆçš„åˆ†ç±»-å„è‡ªçš„ç»§æ‰¿ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_1-è¯·è¯´ä¸€ä¸‹javaå®¹å™¨é›†åˆçš„åˆ†ç±»-å„è‡ªçš„ç»§æ‰¿ç»“æ„"><span>1. è¯·è¯´ä¸€ä¸‹Javaå®¹å™¨é›†åˆçš„åˆ†ç±»ï¼Œå„è‡ªçš„ç»§æ‰¿ç»“æ„</span></a></h3><p>Java å®¹å™¨åˆ†ä¸º Collection å’Œ Map ä¸¤å¤§ç±»ï¼Œå…¶ä¸‹åˆæœ‰å¾ˆå¤šå­ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>CollectionåŒ…æ‹¬ï¼šListã€ArrayListã€LinkedListã€Vectorã€Stackã€Setã€HashSetã€LinkedHashSetã€TreeSet</p><p>MapåŒ…æ‹¬ï¼šHashMapã€LinkedHashMapã€TreeMapã€ConcurrentHashMapã€Hashtable</p><h3 id="_2-collection-å’Œ-collections-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_2-collection-å’Œ-collections-æœ‰ä»€ä¹ˆåŒºåˆ«"><span>2. Collection å’Œ Collections æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><p>Collection æ˜¯ä¸€ä¸ªé›†åˆæ¥å£ï¼Œå®ƒæä¾›äº†å¯¹é›†åˆå¯¹è±¡è¿›è¡ŒåŸºæœ¬æ“ä½œçš„é€šç”¨æ¥å£æ–¹æ³•ï¼Œæ‰€æœ‰é›†åˆéƒ½æ˜¯å®ƒçš„å­ç±»ï¼Œæ¯”å¦‚ Listã€Set ç­‰ã€‚</p><p>Collections æ˜¯ä¸€ä¸ªåŒ…è£…ç±»ï¼ŒåŒ…å«äº†å¾ˆå¤šé™æ€æ–¹æ³•ï¼Œä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œå°±åƒä¸€ä¸ªå·¥å…·ç±»ï¼Œæ¯”å¦‚æä¾›çš„æ’åºæ–¹æ³•ï¼šCollections. sort(list)ã€‚</p><h3 id="_3-listã€setã€map-ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_3-listã€setã€map-ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><span>3. Listã€Setã€Map ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>Listã€Setã€Map çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šå…ƒç´ æ˜¯å¦æœ‰åºã€æ˜¯å¦å…è®¸å…ƒç´ é‡å¤ã€‚</p><h3 id="_4-hashmap-å’Œ-hashtable-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_4-hashmap-å’Œ-hashtable-æœ‰ä»€ä¹ˆåŒºåˆ«"><span>4. HashMap å’Œ Hashtable æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><ul><li>HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ŒHashTable æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>HashMap çš„é”®å’Œå€¼éƒ½å…è®¸æœ‰ null å€¼å­˜åœ¨ï¼Œè€Œ HashTable åˆ™ä¸è¡Œã€‚</li><li>å› ä¸ºçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼ŒHashMap æ•ˆç‡æ¯” HashTable çš„è¦é«˜ã€‚</li><li>Hashtable æ˜¯åŒæ­¥çš„ï¼Œè€Œ HashMap ä¸æ˜¯ã€‚å› æ­¤ï¼ŒHashMap æ›´é€‚åˆäºå•çº¿ç¨‹ç¯å¢ƒï¼Œè€Œ Hashtable é€‚åˆäºå¤šçº¿ç¨‹ç¯å¢ƒã€‚</li><li>ä¸€èˆ¬ç°åœ¨ **ä¸å»ºè®®ç”¨ HashTable **ï¼Œ <ul><li>ä¸€æ–¹é¢æ˜¯å› ä¸º HashTable æ˜¯é—ç•™ç±»ï¼Œå†…éƒ¨å®ç°å¾ˆå¤šæ²¡ä¼˜åŒ–å’Œå†—ä½™ã€‚</li><li>å¦å¤–ï¼Œå³ä½¿åœ¨ <strong>å¤šçº¿ç¨‹</strong> ç¯å¢ƒä¸‹ï¼Œç°åœ¨ä¹Ÿæœ‰åŒæ­¥çš„ <strong>ConcurrentHashMap</strong> æ›¿ä»£ï¼Œæ²¡æœ‰å¿…è¦å› ä¸ºæ˜¯å¤šçº¿ç¨‹è€Œç”¨ HashTableã€‚</li></ul></li></ul><h3 id="_5-è¯´ä¸€ä¸‹-hashmap-çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_5-è¯´ä¸€ä¸‹-hashmap-çš„å®ç°åŸç†"><span>5. è¯´ä¸€ä¸‹ HashMap çš„å®ç°åŸç†ï¼Ÿ</span></a></h3><p>HashMap åŸºäº Hash ç®—æ³•å®ç°çš„ï¼Œæˆ‘ä»¬é€šè¿‡ put(key,value)å­˜å‚¨ï¼Œget(key)æ¥è·å–ã€‚å½“ä¼ å…¥ key æ—¶ï¼ŒHashMap ä¼šæ ¹æ® key. hashCode() è®¡ç®—å‡º hash å€¼ï¼Œæ ¹æ® hash å€¼å°† value ä¿å­˜åœ¨ bucket é‡Œã€‚</p><p>å½“è®¡ç®—å‡ºçš„ hash å€¼ç›¸åŒæ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º hash å†²çªï¼ŒHashMap çš„åšæ³•æ˜¯ç”¨é“¾è¡¨å’Œçº¢é»‘æ ‘å­˜å‚¨ç›¸åŒ hash å€¼çš„ valueã€‚å½“ hash å†²çªçš„ä¸ªæ•°æ¯”è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨é“¾è¡¨å¦åˆ™ä½¿ç”¨çº¢é»‘æ ‘ã€‚</p><h3 id="_6-è°ˆè°ˆ-arraylist-å’Œ-linkedlist-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_6-è°ˆè°ˆ-arraylist-å’Œ-linkedlist-çš„åŒºåˆ«"><span>6. è°ˆè°ˆ ArrayList å’Œ LinkedList çš„åŒºåˆ«</span></a></h3><p>æœ¬è´¨çš„åŒºåˆ«æ¥æºäºä¸¤è€…çš„åº•å±‚å®ç°ï¼šArrayListçš„åº•å±‚æ˜¯æ•°ç»„ï¼ŒLinkedListçš„åº•å±‚æ˜¯åŒå‘é“¾è¡¨ã€‚</p><p>æ•°ç»„æ‹¥æœ‰O(1)çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡ç›´æ¥å®šä½å…ƒç´ ï¼›é“¾è¡¨åœ¨æŸ¥è¯¢å…ƒç´ çš„æ—¶å€™åªèƒ½é€šè¿‡éå†çš„æ–¹å¼æŸ¥è¯¢ï¼Œæ•ˆç‡æ¯”æ•°ç»„ä½ã€‚</p><p>æ•°ç»„å¢åˆ å…ƒç´ çš„æ•ˆç‡æ¯”è¾ƒä½ï¼Œé€šå¸¸è¦ä¼´éšæ‹·è´æ•°ç»„çš„æ“ä½œï¼›é“¾è¡¨å¢åˆ å…ƒç´ çš„æ•ˆç‡å¾ˆé«˜ï¼Œåªéœ€è¦è°ƒæ•´å¯¹åº”ä½ç½®çš„æŒ‡é’ˆå³å¯ã€‚</p><p>ä»¥ä¸Šæ˜¯æ•°ç»„å’Œé“¾è¡¨çš„é€šä¿—å¯¹æ¯”ï¼Œåœ¨æ—¥å¸¸çš„ä½¿ç”¨ä¸­ï¼Œä¸¤è€…éƒ½èƒ½å¾ˆå¥½åœ°åœ¨è‡ªå·±çš„é€‚ç”¨åœºæ™¯å‘æŒ¥ä½œç”¨ã€‚</p><p>æ¯”å¦‚è¯´æˆ‘ä»¬å¸¸å¸¸ç”¨ArrayListä»£æ›¿æ•°ç»„ï¼Œå› ä¸ºå°è£…äº†è®¸å¤šæ˜“ç”¨çš„apiï¼Œè€Œä¸”å®ƒå†…éƒ¨å®ç°äº†è‡ªåŠ¨æ‰©å®¹æœºåˆ¶ï¼Œç”±äºå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå½“å‰å®¹é‡çš„æŒ‡é’ˆsizeï¼Œç›´æ¥å¾€ArrayListä¸­æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)çš„ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚</p><p>è€ŒLinkedListå¸¸å¸¸è¢«ç”¨ä½œQueueé˜Ÿåˆ—çš„å®ç°ç±»ï¼Œç”±äºåº•å±‚æ˜¯åŒå‘é“¾è¡¨ï¼Œèƒ½å¤Ÿè½»æ¾åœ°æä¾›å…ˆå…¥å…ˆå‡ºçš„æ“ä½œã€‚</p><blockquote><p>æˆ‘è§‰å¾—å¯ä»¥åˆ†ä¸¤éƒ¨åˆ†ç­”ï¼Œä¸€ä¸ªæ˜¯æ•°ç»„ä¸é“¾è¡¨åº•å±‚å®ç°çš„ä¸åŒï¼Œå¦ä¸€ä¸ªæ˜¯ç­”ArrayListå’ŒLinkedListçš„å®ç°ç»†èŠ‚ã€‚</p></blockquote><h3 id="_7-è°ˆè°ˆarraylistå’Œvectorçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_7-è°ˆè°ˆarraylistå’Œvectorçš„åŒºåˆ«"><span>7. è°ˆè°ˆArrayListå’ŒVectorçš„åŒºåˆ«</span></a></h3><p>ä¸¤è€…çš„åº•å±‚å®ç°ç›¸ä¼¼ï¼Œå…³é”®çš„ä¸åŒåœ¨äºVectorçš„å¯¹å¤–æä¾›æ“ä½œçš„æ–¹æ³•éƒ½æ˜¯ç”¨synchronizedä¿®é¥°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Vectoråœ¨å¹¶å‘ç¯å¢ƒä¸‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒArrayListåœ¨å¹¶å‘ç¯å¢ƒä¸‹å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>ç”±äºVectorçš„æ–¹æ³•éƒ½æ˜¯åŒæ­¥æ–¹æ³•ï¼Œæ‰§è¡Œèµ·æ¥ä¼šåœ¨åŒæ­¥ä¸Šæ¶ˆè€—ä¸€å®šçš„æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒVectorçš„æ€§èƒ½æ˜¯ä¸å¦‚ArrayListçš„</p><p>é™¤äº†çº¿ç¨‹å®‰å…¨è¿™ç‚¹æœ¬è´¨åŒºåˆ«å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå®ç°ä¸Šçš„å°ç»†èŠ‚åŒºåˆ«ï¼šArrayListæ¯æ¬¡æ‰©å®¹çš„å¤§å°ä¸ºåŸæ¥çš„1.5å€ï¼›Vectorå¯ä»¥æŒ‡å®šæ‰©å®¹çš„å¤§å°ï¼Œé»˜è®¤æ˜¯åŸæ¥å¤§å°çš„ä¸¤å€ã€‚</p><blockquote><p>å¯ä»¥é¡ºå¸¦è°ˆè°ˆå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ArrayListçš„æ›¿ä»£å“ï¼Œæ¯”å¦‚CopyOnWriteArrayListï¼Œä½†æ˜¯è¦è°ˆè°ˆä¼˜ç¼ºç‚¹ã€‚</p></blockquote><h3 id="_8-è¯·è°ˆä¸€è°ˆ-java-é›†åˆä¸­çš„-fail-fast-å’Œ-fail-safe-æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_8-è¯·è°ˆä¸€è°ˆ-java-é›†åˆä¸­çš„-fail-fast-å’Œ-fail-safe-æœºåˆ¶"><span>8. è¯·è°ˆä¸€è°ˆ Java é›†åˆä¸­çš„ fail-fast å’Œ fail-safe æœºåˆ¶</span></a></h3><p>fail-fast æ˜¯ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ï¼ŒJava åœ¨é€‚åˆå•çº¿ç¨‹ä½¿ç”¨çš„é›†åˆå®¹å™¨ä¸­å¾ˆå¥½åœ°å®ç°äº† fail-fast æœºåˆ¶ï¼Œä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šåœ¨å¤šçº¿ç¨‹å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒAçº¿ç¨‹åœ¨é€šè¿‡è¿­ä»£å™¨éå†ä¸€ä¸ª ArrayList é›†åˆï¼ŒBçº¿ç¨‹åŒæ—¶å¯¹è¯¥é›†åˆè¿›è¡Œå¢åˆ å…ƒç´ æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹Aå°±ä¼šæŠ›å‡ºå¹¶å‘ä¿®æ”¹å¼‚å¸¸ï¼Œä¸­æ–­æ­£å¸¸æ‰§è¡Œçš„é€»è¾‘ã€‚</p><p>è€Œfail-safeæœºåˆ¶æ›´åƒæ˜¯ä¸€ç§å¯¹ fail-fast æœºåˆ¶çš„è¡¥å……ï¼Œå®ƒè¢«å¹¿æ³›åœ°å®ç°åœ¨å„ç§å¹¶å‘å®¹å™¨é›†åˆä¸­ã€‚å›å¤´çœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœçº¿ç¨‹Aéå†çš„ä¸æ˜¯ä¸€ä¸ª ArrayListï¼Œè€Œæ˜¯ä¸€ä¸ª CopyOnWriteArrayListï¼Œåˆ™ç¬¦åˆ fail-safe æœºåˆ¶ï¼Œçº¿ç¨‹Bå¯ä»¥åŒæ—¶å¯¹è¯¥é›†åˆçš„å…ƒç´ è¿›è¡Œå¢åˆ æ“ä½œï¼Œçº¿ç¨‹Aä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚</p><p>è¦ç†è§£è¿™ä¸¤ç§æœºåˆ¶çš„è¡¨è±¡ï¼Œæˆ‘ä»¬å¾—äº†è§£è¿™ä¸¤ç§æœºåˆ¶èƒŒåçš„å®ç°åŸç†ï¼š</p><p>æˆ‘ä»¬åŒæ ·ç”¨ ArrayList è§£é‡Š fail-fast èƒŒåçš„åŸç†ï¼šé¦–å…ˆ ArrayList è‡ªèº«ä¼šç»´æŠ¤ä¸€ä¸ª modCount å˜é‡ï¼Œæ¯å½“è¿›è¡Œå¢åˆ å…ƒç´ ç­‰æ“ä½œæ—¶ï¼ŒmodCount å˜é‡éƒ½ä¼šè¿›è¡Œè‡ªå¢ã€‚å½“ä½¿ç”¨è¿­ä»£å™¨éå† ArrayList æ—¶ï¼Œè¿­ä»£å™¨ä¼šæ–°ç»´æŠ¤ä¸€ä¸ªåˆå§‹å€¼ç­‰äº modCount çš„ expectedModCount å˜é‡ï¼Œæ¯æ¬¡è·å–ä¸‹ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™éƒ½ä¼šå»æ£€æŸ¥ expectModCount å’Œ modCount æ˜¯å¦ç›¸ç­‰ã€‚åœ¨ä¸Šé¢ä¸¾çš„ä¾‹å­ä¸­ï¼Œç”±äºBçº¿ç¨‹å¢åˆ å…ƒç´ ä¼šå¯¼è‡´ modCount è‡ªå¢ï¼Œå½“Açº¿ç¨‹éå†å…ƒç´ æ—¶å°±ä¼šå‘ç°ä¸¤ä¸ªå˜é‡ä¸ç­‰ï¼Œä»è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>CopyOnWriteArrayList æ‰€å®ç°çš„ fail-safe åœ¨ä¸Šè¿°æƒ…å†µä¸‹æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œå®ƒçš„åŸç†æ˜¯ï¼šå½“ä½¿ç”¨è¿­ä»£å™¨éå†é›†åˆæ—¶ï¼Œä¼šåŸºäºåŸæ•°ç»„æ‹·è´å‡ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ˆArrayListçš„åº•å±‚æ˜¯æ•°ç»„ï¼‰ï¼Œåç»­çš„éå†è¡Œä¸ºåœ¨æ–°æ•°ç»„ä¸Šè¿›è¡Œã€‚æ‰€ä»¥çº¿ç¨‹BåŒæ—¶è¿›è¡Œå¢åˆ æ“ä½œä¸ä¼šå½±å“åˆ°çº¿ç¨‹Açš„éå†è¡Œä¸ºã€‚</p><h3 id="_9-hashmapæ˜¯æ€æ ·ç¡®å®škeyå­˜æ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®çš„-jdk1-8" tabindex="-1"><a class="header-anchor" href="#_9-hashmapæ˜¯æ€æ ·ç¡®å®škeyå­˜æ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®çš„-jdk1-8"><span>9. HashMapæ˜¯æ€æ ·ç¡®å®škeyå­˜æ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®çš„ï¼ŸJDK1.8</span></a></h3><p>é¦–å…ˆè®¡ç®—keyçš„hashå€¼ï¼Œè®¡ç®—è¿‡ç¨‹æ˜¯ï¼šå…ˆå¾—åˆ°keyçš„hashCodeï¼ˆintç±»å‹ï¼Œ4å­—èŠ‚ï¼‰ï¼Œç„¶åæŠŠhashCodeçš„é«˜16ä½ä¸ä½16ä½è¿›è¡Œå¼‚æˆ–ï¼Œå¾—åˆ°keyçš„hashå€¼ã€‚</p><p>æ¥ä¸‹æ¥ç”¨keyçš„hashå€¼ä¸æ•°ç»„é•¿åº¦å‡ä¸€çš„å€¼è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œï¼Œå¾—åˆ°keyåœ¨æ•°ç»„ä¸­å¯¹åº”çš„ä¸‹æ ‡ã€‚</p><h5 id="_9-1-è¿½é—®-ä¸ºä»€ä¹ˆè®¡ç®—keyçš„hashæ—¶è¦æŠŠhashcodeçš„é«˜16ä½ä¸ä½16ä½è¿›è¡Œå¼‚æˆ–-å˜å¼-ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨keyçš„hashcode" tabindex="-1"><a class="header-anchor" href="#_9-1-è¿½é—®-ä¸ºä»€ä¹ˆè®¡ç®—keyçš„hashæ—¶è¦æŠŠhashcodeçš„é«˜16ä½ä¸ä½16ä½è¿›è¡Œå¼‚æˆ–-å˜å¼-ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨keyçš„hashcode"><span>9.1. è¿½é—®ï¼šä¸ºä»€ä¹ˆè®¡ç®—keyçš„hashæ—¶è¦æŠŠhashCodeçš„é«˜16ä½ä¸ä½16ä½è¿›è¡Œå¼‚æˆ–ï¼Ÿï¼ˆå˜å¼ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨keyçš„hashCodeï¼‰?</span></a></h5><p>è®¡ç®—keyåœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡æ—¶ï¼Œæ˜¯é€šè¿‡hashå€¼ä¸æ•°ç»„é•¿åº¦å‡ä¸€çš„å€¼è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œçš„ã€‚ç”±äºæ•°ç»„çš„é•¿åº¦é€šå¸¸ä¸ä¼šè¶…è¿‡2^16ï¼Œæ‰€ä»¥hashå€¼çš„é«˜16ä½é€šå¸¸å‚ä¸ä¸äº†è¿™ä¸ªæŒ‰ä½ä¸æ“ä½œã€‚</p><p>ä¸ºäº†è®©hashCodeçš„é«˜16ä½èƒ½å¤Ÿå‚ä¸åˆ°æŒ‰ä½ä¸æ“ä½œä¸­ï¼Œæ‰€ä»¥æŠŠhashCodeçš„é«˜16ä½ä¸ä½16ä½è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œä½¿å¾—é«˜16ä½çš„å½±å“èƒ½å¤Ÿå‡åŒ€ç¨€é‡Šåˆ°ä½16ä½ä¸­ï¼Œä½¿å¾—è®¡ç®—keyä½ç½®çš„æ“ä½œèƒ½å¤Ÿå……åˆ†æ•£åˆ—å‡åŒ€ã€‚</p><h3 id="_10-ä¸ºä»€ä¹ˆè¦æŠŠé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘-é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8" tabindex="-1"><a class="header-anchor" href="#_10-ä¸ºä»€ä¹ˆè¦æŠŠé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘-é˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8"><span>10. ä¸ºä»€ä¹ˆè¦æŠŠé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œé˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿ</span></a></h3><p>åœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¯´keyçš„hashCode()è¿”å›çš„å€¼ä¸åˆç†ï¼Œæˆ–è€…å¤šä¸ªå¯†é’¥å…±äº«ä¸€ä¸ªhashCodeï¼Œå¾ˆæœ‰å¯èƒ½ä¼šåœ¨åŒä¸€ä¸ªæ•°ç»„ä½ç½®äº§ç”Ÿä¸¥é‡çš„å“ˆå¸Œå†²çªã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä»ç„¶ä½¿ç”¨ä½¿ç”¨é“¾è¡¨æŠŠå¤šä¸ªå†²çªçš„å…ƒç´ ä¸²èµ·æ¥ï¼Œè¿™äº›å…ƒç´ çš„æŸ¥è¯¢æ•ˆç‡å°±ä¼šä»O(1)ä¸‹é™ä¸ºO(N)ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨è¿™ç§æç«¯æƒ…å†µä¸‹ä»ä¿è¯è¾ƒä¸ºé«˜æ•ˆçš„æŸ¥è¯¢æ•ˆç‡ï¼ŒHashMapé€‰æ‹©æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ç§å¸¸ç”¨çš„å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼Œæ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾å…ƒç´ ç­‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(logN)</p><p>è‡³äºé˜ˆå€¼ä¸ºä»€ä¹ˆæ˜¯8ï¼Œè¿™æ˜¯HashMapçš„ä½œè€…æ ¹æ®æ¦‚ç‡è®ºçš„çŸ¥è¯†å¾—åˆ°çš„ã€‚å½“keyçš„å“ˆå¸Œç åˆ†å¸ƒå‡åŒ€æ—¶ï¼Œæ•°ç»„åŒä¸€ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡æ˜¯æˆæ³Šæ¾åˆ†å¸ƒçš„ï¼ŒåŒä¸€ä¸ªä½ç½®ä¸Šå‡ºç°8ä¸ªå…ƒç´ çš„æ¦‚ç‡å·²ç»æ¥è¿‘åƒåˆ†ä¹‹ä¸€äº†ï¼Œè¿™ä¾§é¢è¯´æ˜å¦‚æœé“¾è¡¨çš„é•¿åº¦è¾¾åˆ°äº†8ï¼Œkeyçš„hashCode()è‚¯å®šæ˜¯å‡ºäº†å¤§é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦çº¢é»‘æ ‘æ¥ä¿è¯æ€§èƒ½ï¼Œæ‰€ä»¥é€‰æ‹©8ä½œä¸ºé˜ˆå€¼ã€‚</p><p><strong>è¿½é—®ï¼šä¸ºä»€ä¹ˆçº¢é»‘æ ‘è½¬æ¢å›é“¾è¡¨çš„é˜ˆå€¼ä¸æ˜¯7è€Œæ˜¯6å‘¢ï¼Ÿ</strong></p><p>å¦‚æœæ˜¯7çš„è¯ï¼Œé‚£ä¹ˆé“¾è¡¨å’Œçº¢é»‘æ ‘ä¹‹é—´çš„åˆ‡æ¢èŒƒå›´å€¼å°±å¤ªå°äº†ã€‚å¦‚æœæˆ‘çš„é“¾è¡¨é•¿åº¦ä¸åœåœ°åœ¨7å’Œ8ä¹‹é—´åˆ‡æ¢ï¼Œé‚£å²‚ä¸æ˜¯å¾—æ¥å›å˜æ¢å½¢æ€ï¼Ÿæ‰€ä»¥é€‰æ‹©6æ˜¯ä¸€ç§æŠ˜ä¸­çš„è€ƒè™‘ã€‚</p><h3 id="æ‹“å±•é¢˜-ä¸ºä»€ä¹ˆ-hashmap-æ•°ç»„çš„é•¿åº¦æ˜¯2çš„å¹‚æ¬¡æ–¹" tabindex="-1"><a class="header-anchor" href="#æ‹“å±•é¢˜-ä¸ºä»€ä¹ˆ-hashmap-æ•°ç»„çš„é•¿åº¦æ˜¯2çš„å¹‚æ¬¡æ–¹"><span>æ‹“å±•é¢˜. ä¸ºä»€ä¹ˆ HashMap æ•°ç»„çš„é•¿åº¦æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Ÿ</span></a></h3><p>å› ä¸ºè¿™æ ·èƒ½å¤Ÿæé«˜æ ¹æ® key è®¡ç®—æ•°ç»„ä½ç½®çš„æ•ˆç‡ã€‚</p><p>HashMap æ ¹æ® key è®¡ç®—æ•°ç»„ä½ç½®çš„ç®—æ³•æ˜¯ï¼šç”¨ key çš„ hash å€¼ä¸æ•°ç»„é•¿åº¦å‡1çš„å€¼è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œã€‚</p><p>åœ¨æˆ‘ä»¬æ­£å¸¸äººçš„æ€ç»´ä¸­ï¼Œè·å–æ•°ç»„çš„æŸä¸ªä½ç½®æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯å¯¹æ•°ç»„çš„é•¿åº¦å–ä½™æ•°ã€‚ä½†æ˜¯å¦‚æœè¢«é™¤æ•°æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹æ•°ç»„é•¿åº¦å–ä½™çš„æ–¹æ³•å°±ç­‰ä»·äºå¯¹æ•°ç»„é•¿åº¦å‡ä¸€çš„å€¼è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œã€‚</p><p>åœ¨è®¡ç®—æœºä¸­ï¼Œä½è¿ç®—çš„æ•ˆç‡è¿œé«˜äºå–æ¨¡è¿ç®—ï¼Œæ‰€ä»¥ä¸ºäº†æé«˜æ•ˆç‡ï¼ŒæŠŠæ•°ç»„çš„é•¿åº¦è®¾ä¸º2çš„å¹‚æ¬¡æ–¹ã€‚</p><blockquote><p>æ‰€ä»¥ä¸€å®šè¦çœ‹ä¸€éæºç ï¼Œç›¸æ¯”äºæ¡†æ¶çš„æºç ï¼Œé›†åˆçš„æºç ç®€ç›´å¤ªå‹å¥½äº†ã€‚åœ¨ç¬”è¯•çš„æ—¶å€™å¯èƒ½è¿˜ä¼šè€ƒä¸€äº›é›†åˆçš„ä½¿ç”¨ï¼Œæ¯”å¦‚éå†ï¼Œæ’åºï¼Œæ¯”è¾ƒç­‰ç­‰ï¼Œè¿™äº›ç®—æ˜¯JavaåŸºç¡€ï¼Œç”¨å¾—å¤šä¹Ÿå°±ç†Ÿäº†ã€‚</p></blockquote><h2 id="javaee" tabindex="-1"><a class="header-anchor" href="#javaee"><span>JavaEE</span></a></h2><h3 id="_1-jsp-æœ‰å“ªäº›å†…ç½®å¯¹è±¡-ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1-jsp-æœ‰å“ªäº›å†…ç½®å¯¹è±¡-ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ"><span>1. JSP æœ‰å“ªäº›å†…ç½®å¯¹è±¡ï¼Ÿä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>JSPæœ‰9ä¸ªå†…ç½®å¯¹è±¡ï¼š</p><ul><li><p>requestï¼šå°è£…å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªGETæˆ–POSTè¯·æ±‚çš„å‚æ•°ï¼›</p></li><li><p>responseï¼šå°è£…æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼›</p></li><li><p>pageContextï¼šé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥è·å–å…¶ä»–å¯¹è±¡ï¼›</p></li><li><p>sessionï¼šå°è£…ç”¨æˆ·ä¼šè¯çš„å¯¹è±¡ï¼›</p></li><li><p>applicationï¼šå°è£…æœåŠ¡å™¨è¿è¡Œç¯å¢ƒçš„å¯¹è±¡ï¼›</p></li><li><p>outï¼šè¾“å‡ºæœåŠ¡å™¨å“åº”çš„è¾“å‡ºæµå¯¹è±¡ï¼›</p></li><li><p>configï¼šwebåº”ç”¨çš„é…ç½®å¯¹è±¡ï¼›</p></li><li><p>pageï¼šjspé¡µé¢æœ¬èº«ï¼ˆç›¸å½“äºJavaç¨‹åºä¸­çš„thisï¼‰ï¼›</p></li><li><p>exceptionï¼šå°è£…é¡µé¢æŠ›å‡ºå¼‚å¸¸çš„å¯¹è±¡ã€‚</p></li></ul><figure><img src="https://tva4.sinaimg.cn/large/007F3CC8ly1h3uz7jfq18j30rx0bytdd.jpg" alt="JSPçš„9å†…ç½®å¯¹è±¡åŠå…¶å«ä¹‰" tabindex="0" loading="lazy"><figcaption>JSPçš„9å†…ç½®å¯¹è±¡åŠå…¶å«ä¹‰</figcaption></figure><h3 id="_2-ä»‹ç»ä¸€ä¸‹-servlet-ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_2-ä»‹ç»ä¸€ä¸‹-servlet-ç”Ÿå‘½å‘¨æœŸ"><span>2. ä»‹ç»ä¸€ä¸‹ Servlet ç”Ÿå‘½å‘¨æœŸ</span></a></h3><p>Servletæ˜¯è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œä»¥å¤šçº¿ç¨‹çš„æ–¹å¼å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„å°ç¨‹åºã€‚æ˜¯sunå…¬å¸æä¾›çš„ä¸€å¥—è§„èŒƒï¼ˆè§„èŒƒçš„å®ç°æ˜¯æ¥å£ï¼‰ã€‚</p><p>servletçš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä»servletå‡ºç°åˆ°æ¶ˆäº¡(é”€æ¯)çš„å…¨è¿‡ç¨‹ã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><p><strong>åŠ è½½ç±»â€”&gt;å®ä¾‹åŒ–(ä¸ºå¯¹è±¡åˆ†é…ç©ºé—´)â€”&gt;åˆå§‹åŒ–(ä¸ºå¯¹è±¡çš„å±æ€§èµ‹å€¼)â€”&gt;è¯·æ±‚å“åº”(æœåŠ¡é˜¶æ®µ)â€”&gt;é”€æ¯</strong></p><p>è¯¦ç»†ä»‹ç»ï¼š</p><ol><li>åŠ è½½</li></ol><p>åœ¨ä¸‹åˆ—æ—¶åˆ»ä¼šåŠ è½½Servletï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š</p><ul><li>å¦‚æœå·²ç»é…ç½®è‡ªåŠ¨åŠ è½½é€‰é¡¹ï¼Œåˆ™åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶è‡ªåŠ¨åŠ è½½ <code>web.xml</code> æ–‡ä»¶ä¸­è®¾ç½®çš„<code>&lt;load-on-start&gt;</code>ï¼›</li><li>æœåŠ¡å™¨å¯åŠ¨ä¹‹åï¼Œå®¢æˆ·æœºé¦–æ¬¡å‘Servletå‘å‡ºè¯·æ±‚æ—¶ä¼šåŠ è½½ï¼›</li><li>é‡æ–°åŠ è½½Servletæ—¶ä¼šè¿›è¡Œä¸€æ¬¡åŠ è½½ï¼›</li></ul><ol start="2"><li>å®ä¾‹åŒ–</li></ol><p>åŠ è½½Servletåï¼ŒæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªServletå®ä¾‹ã€‚ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰</p><ol start="3"><li>åˆå§‹åŒ–</li></ol><ul><li>è°ƒç”¨ Servlet çš„ <code>init()</code> æ–¹æ³•ã€‚åœ¨åˆå§‹åŒ–é˜¶æ®µï¼ŒServlet åˆå§‹åŒ–å‚æ•°è¢«ä¼ é€’ç»™ Servlet é…ç½®å¯¹è±¡ ServletConfigã€‚ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰ï¼›</li></ul><ol start="4"><li>è¯·æ±‚å¤„ç†</li></ol><p>å¯¹äºåˆ°è¾¾æœåŠ¡å™¨çš„å®¢æˆ·æœºè¯·æ±‚ï¼ŒæœåŠ¡å™¨åˆ›å»ºé’ˆå¯¹æ­¤æ¬¡è¯·æ±‚çš„ä¸€ä¸ª&quot;è¯·æ±‚å¯¹è±¡&quot;å’Œä¸€ä¸ª&quot;å“åº”å¯¹è±¡&quot;ã€‚</p><p>æœåŠ¡å™¨è°ƒç”¨ Servlet çš„ <code>service()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºä¼ é€’&quot;è¯·æ±‚&quot;å’Œ&quot;å“åº”&quot;å¯¹è±¡ã€‚</p><p><code>service()</code> æ–¹æ³•ä»&quot;è¯·æ±‚&quot;å¯¹è±¡è·å¾—è¯·æ±‚ä¿¡æ¯ã€å¤„ç†è¯¥è¯·æ±‚å¹¶ç”¨&quot;å“åº”&quot;å¯¹è±¡çš„æ–¹æ³•å°†å“åº”å›ä¼ ç»™å®¢æˆ·ç«¯ã€‚</p><p><code>service()</code> æ–¹æ³•å¯ä»¥è°ƒç”¨å…¶ä»–æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ï¼Œä¾‹å¦‚ <code>doGet()ã€doPost()</code> æˆ–å…¶ä»–æ–¹æ³•ã€‚</p><ol start="5"><li>é”€æ¯</li></ol><p>å½“æœåŠ¡å™¨ä¸éœ€è¦ Servletï¼Œæˆ–é‡æ–°è£…å…¥ Servlet çš„æ–°å®ä¾‹æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè°ƒç”¨ Servlet çš„ <code>destroy()</code> æ–¹æ³•ã€‚ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰ï¼›</p><h3 id="_3-servletå’Œjspçš„åŒºåˆ«å’Œè”ç³»" tabindex="-1"><a class="header-anchor" href="#_3-servletå’Œjspçš„åŒºåˆ«å’Œè”ç³»"><span>3. Servletå’ŒJSPçš„åŒºåˆ«å’Œè”ç³»</span></a></h3><p><strong>åŒºåˆ«ï¼š</strong></p><ol><li><p>JSPæ˜¯åœ¨HTMLä»£ç é‡Œé¢å†™Javaä»£ç ï¼›è€ŒServletæ˜¯åœ¨Javaä»£ç ä¸­å†™HTMLä»£ç ï¼ŒServletæœ¬èº«æ˜¯ä¸ªJavaç±»ï¼›</p></li><li><p>JSPä½¿äººä»¬å°†æ˜¾ç¤ºå’Œé€»è¾‘åˆ†éš”ç§°ä¸ºå¯èƒ½ï¼Œè¿™æ„å‘³ç€ä¸¤è€…çš„å¼€å‘å¯ä»¥å¹¶è¡Œè¿›è¡Œï¼›è€ŒServletå¹¶æ²¡æœ‰å°†ä¸¤è€…åˆ†å¼€ï¼›</p></li><li><p>Servletç‹¬ç«‹åœ°å¤„ç†é™æ€è¡¨ç¤ºé€»è¾‘ä¸åŠ¨æ€ä¸šåŠ¡é€»è¾‘ï¼Œä»»ä½•æ–‡ä»¶çš„å˜åŠ¨éƒ½éœ€è¦å¯¹æ­¤æœåŠ¡ç¨‹åºé‡æ–°ç¼–è¯‘ï¼›JSPå…è®¸ä½¿ç”¨ç‰¹æ®Šæ ‡ç­¾ç›´æ¥åµŒå…¥åˆ°HTMLé¡µé¢ï¼ŒHTMLå†…å®¹ä¸JAVAå†…å®¹ä¹Ÿå¯æ”¾åœ¨å•ç‹¬æ–‡ä»¶ä¸­ï¼ŒHTMLå†…å®¹çš„ä»»ä½•å˜åŠ¨ä¼šè‡ªåŠ¨ç¼–è¯‘è£…å…¥åˆ°æœåŠ¡ç¨‹åºï¼›</p></li><li><p>Servletéœ€è¦åœ¨web.xmlä¸­é…ç½®ï¼›è€ŒJSPæ— éœ€é…ç½®ï¼›</p></li><li><p>ç›®å‰JSPä¸»è¦ç”¨åœ¨è§†å›¾å±‚ï¼Œè´Ÿè´£æ˜¾ç¤ºï¼›è€ŒServletä¸»è¦ç”¨åœ¨æ§åˆ¶å±‚ï¼Œè´Ÿè´£è°ƒåº¦ï¼›</p></li></ol><p><strong>è”ç³»ï¼š</strong></p><ol><li><p>éƒ½æ˜¯SUNå…¬å¸æ¨å‡ºçš„åŠ¨æ€ç½‘é¡µæŠ€æœ¯ï¼›</p></li><li><p>å…ˆæœ‰Servletï¼Œé’ˆå¯¹Servletç¼ºç‚¹æ¨å‡ºJSPã€‚JSPæ˜¯Servletçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œæ¯ä¸ªJSPé¡µé¢å°±æ˜¯ä¸€ä¸ªServletå®ä¾‹ï¼ŒJSPé¡µé¢ç”±ç³»ç»Ÿç¿»è¯‘æˆServletï¼ŒServletå†è´Ÿè´£å“åº”ç”¨æˆ·çš„è¯·æ±‚ã€‚</p></li></ol><h3 id="_4-jspçš„æ‰§è¡Œè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_4-jspçš„æ‰§è¡Œè¿‡ç¨‹"><span>4. JSPçš„æ‰§è¡Œè¿‡ç¨‹</span></a></h3><p>åœ¨JSPè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆç”±å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼ŒWebæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®æŸä¸ªJSPé¡µé¢ï¼ŒWebæœåŠ¡å™¨å¯¹å®ƒè¿›è¡Œä¸€ä¸‹ä¸‰ä¸ªæ“ä½œï¼š</p><ol><li>ç¿»è¯‘</li></ol><p>ç”±.jspå˜ä¸º.javaï¼Œç”±JSPå¼•æ“å®Œæˆã€‚</p><ol start="2"><li>ç¼–è¯‘</li></ol><p>ç”±.javaå˜ä¸º.classï¼Œç”±Javaç¼–è¯‘å™¨å®ç°ã€‚</p><ol start="3"><li>æ‰§è¡Œ</li></ol><p>ç”±.classå˜ä¸º.htmlï¼Œç”¨Javaè™šæ‹Ÿæœºæ‰§è¡Œç¼–è¯‘æ–‡ä»¶ï¼Œç„¶åå°†æ‰§è¡Œç»“æœè¿”å›ç»™WebæœåŠ¡å™¨ï¼Œå¹¶æœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¦‚æœä¸æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®æŸä¸ªJSPé¡µé¢ï¼Œåˆ™åªæ‰§è¡Œç¬¬ä¸‰æ­¥ï¼Œ<strong>æ‰€ä»¥ç¬¬ä¸€æ¬¡è®¿é—®JSPè¾ƒæ…¢</strong>ã€‚</p><h3 id="_5-sessionå’Œcookieçš„åŒºåˆ«å’Œè”ç³»-è¯´æ˜åœ¨è‡ªå·±é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_5-sessionå’Œcookieçš„åŒºåˆ«å’Œè”ç³»-è¯´æ˜åœ¨è‡ªå·±é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨"><span>5. Sessionå’ŒCookieçš„åŒºåˆ«å’Œè”ç³»ï¼›è¯´æ˜åœ¨è‡ªå·±é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ</span></a></h3><p>Session å’Œ Cookie éƒ½æ˜¯ä¼šè¯(Seesion)è·Ÿè¸ªæŠ€æœ¯ã€‚Cookie é€šè¿‡åœ¨å®¢æˆ·ç«¯è®°å½•ä¿¡æ¯ç¡®å®šç”¨æˆ·èº«ä»½ï¼ŒSession é€šè¿‡åœ¨æœåŠ¡å™¨ç«¯è®°å½•ä¿¡æ¯ç¡®å®šç”¨æˆ·èº«ä»½ã€‚ä½†æ˜¯ Session çš„å®ç°ä¾èµ–äº <strong>Cookieï¼ŒsessionId</strong>(sessionçš„å”¯ä¸€æ ‡è¯†éœ€è¦å­˜æ”¾åœ¨å®¢æˆ·ç«¯).</p><ol><li><p>cookieæ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Šï¼Œsessionæ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚</p></li><li><p>cookieä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„cookieå¹¶è¿›è¡Œcookieæ¬ºéª—ï¼Œè€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨sessionã€‚</p></li><li><p>sessionä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œè€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨cookieã€‚</p></li><li><p>å•ä¸ªcookieä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡4Kï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜20ä¸ªcookieã€‚</p></li><li><p>å¯ä»¥è€ƒè™‘å°†ç™»å½•ä¿¡æ¯ç­‰é‡è¦ä¿¡æ¯å­˜æ”¾ä¸ºsessionï¼Œå…¶ä»–ä¿¡æ¯å¦‚æœéœ€è¦ä¿ç•™ï¼Œå¯ä»¥æ”¾åœ¨cookieä¸­ã€‚</p></li><li><p>åœ¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯æ¯æ¬¡ä¸æœåŠ¡å™¨äº¤äº’æ—¶æ£€æŸ¥SessionIDï¼ˆSessionä¸­å±æ€§å€¼ï¼ŒéHttpServletç¯å¢ƒå¼€å‘ä¸­ä¹Ÿå¯ä»¥ç”¨å…¶å®ƒçš„Keyå€¼ä»£æ›¿ï¼‰ï¼Œç”¨äºä¼šè¯ç®¡ç†ã€‚</p></li></ol><ul><li><p>å°†ç™»é™†ä¿¡æ¯ç­‰é‡è¦ä¿¡æ¯å­˜æ”¾ä¸ºSESSION</p></li><li><p>å…¶ä»–ä¿¡æ¯å¦‚æœéœ€è¦ä¿ç•™ï¼Œå¯ä»¥æ”¾åœ¨COOKIEä¸­ï¼Œæ¯”å¦‚è´­ç‰©è½¦</p><p>è´­ç‰©è½¦æœ€å¥½ä½¿ç”¨cookieï¼Œä½†æ˜¯cookieæ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯ç¦ç”¨çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¦ä½¿ç”¨cookie+æ•°æ®åº“çš„æ–¹å¼å®ç°ï¼Œå½“ä»cookieä¸­ä¸èƒ½å–å‡ºæ•°æ®æ—¶ï¼Œå°±ä»æ•°æ®åº“è·å–ã€‚</p></li></ul><h3 id="_6-è½¬å‘å’Œé‡å®šå‘çš„è”ç³»å’ŒåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_6-è½¬å‘å’Œé‡å®šå‘çš„è”ç³»å’ŒåŒºåˆ«"><span>6. è½¬å‘å’Œé‡å®šå‘çš„è”ç³»å’ŒåŒºåˆ«ï¼Ÿ</span></a></h3><ul><li><p><strong>è½¬å‘</strong>ï¼šæœåŠ¡å™¨ç«¯çš„è·³è½¬ï¼Œè·¯å¾„ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼ˆé’ˆå¯¹çš„æ˜¯servletï¼‰ï¼Œæ˜¯æœåŠ¡å™¨å†…éƒ¨çš„å¤„ç†ï¼Œä¸€æ¬¡è¯·æ±‚ï¼Œè¯·æ±‚å¯¹è±¡ä¸ä¼šå˜</p></li><li><p><strong>é‡å®šå‘</strong>ï¼šå®¢æˆ·ç«¯çš„è·³è½¬ï¼Œè·¯å¾„ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå°†è¦è¯·æ±‚çš„è·¯å¾„å’Œ302é‡å®šå‘çš„çŠ¶æ€ç å‘ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨å°†å†æ¬¡å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œä¸æ˜¯åŒä¸ªè¯·æ±‚ï¼Œä¸¤æ¬¡è¯·æ±‚ã€‚</p></li></ul><h3 id="_7-æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_7-æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«"><span>7. æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«</span></a></h3><p>Spring çš„æ‹¦æˆªå™¨ä¸ Servlet çš„ Filter æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œæ¯”å¦‚äºŒè€…éƒ½æ˜¯AOPç¼–ç¨‹æ€æƒ³çš„ä½“ç°ï¼Œéƒ½èƒ½å®ç°æƒé™æ£€æŸ¥ã€æ—¥å¿—è®°å½•ç­‰ã€‚ä¸åŒçš„æ˜¯:</p><ol><li><p>ä½¿ç”¨èŒƒå›´ä¸åŒ: Filter æ˜¯ Servlet è§„èŒƒè§„å®šçš„ï¼Œåªèƒ½ç”¨äºWebç¨‹åºä¸­ã€‚è€Œæ‹¦æˆªå™¨æ—¢å¯ä»¥ç”¨äºWebç¨‹åºï¼Œä¹Ÿå¯ä»¥ç”¨äº Applicationã€Swingç¨‹åºä¸­ã€‚</p></li><li><p>è§„èŒƒä¸åŒ: Filter æ˜¯åœ¨ Servlet è§„èŒƒä¸­å®šä¹‰çš„ï¼Œæ˜¯ Servlet å®¹å™¨æ”¯æŒçš„ã€‚è€Œæ‹¦æˆªå™¨æ˜¯åœ¨ Spring å®¹å™¨å†…çš„ï¼Œæ˜¯ Spring æ¡†æ¶æ”¯æŒçš„ã€‚</p></li><li><p>ä½¿ç”¨çš„èµ„æºä¸åŒ:åŒå…¶ä»–çš„ä»£ç å—ä¸€æ ·ï¼Œæ‹¦æˆªå™¨ä¹Ÿæ˜¯ä¸€ä¸ª Spring çš„ç»„ä»¶ï¼Œå½’ Spring ç®¡ç†ï¼Œé…ç½®åœ¨ Spring æ–‡ä»¶ä¸­ï¼Œå› æ­¤èƒ½ä½¿ç”¨ Spring é‡Œçš„ä»»ä½•èµ„æºã€å¯¹è±¡ï¼Œä¾‹å¦‚ Service å¯¹è±¡ã€æ•°æ®æºã€äº‹åŠ¡ç®¡ç†ç­‰ï¼Œé€šè¿‡ IoC æ³¨å…¥åˆ°æ‹¦æˆªå™¨å³å¯;è€ŒFilteråˆ™ä¸èƒ½ã€‚</p></li><li><p>æ·±åº¦ä¸åŒ: Filter åœ¨åªåœ¨ Servlet å‰åèµ·ä½œç”¨ã€‚è€Œæ‹¦æˆªå™¨èƒ½å¤Ÿæ·±å…¥åˆ°æ–¹æ³•å‰åã€å¼‚å¸¸æŠ›å‡ºå‰åç­‰ï¼Œå› æ­¤æ‹¦æˆªå™¨çš„ä½¿ç”¨å…·æœ‰æ›´å¤§çš„å¼¹æ€§ã€‚æ‰€ä»¥åœ¨ Spring æ„æ¶çš„ç¨‹åºä¸­ï¼Œè¦ä¼˜å…ˆä½¿ç”¨æ‹¦æˆªå™¨ã€‚</p></li></ol><p>ä¸€å¼ ç»å…¸çš„å›¾</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093211.png" alt="è¿‡æ»¤å™¨&amp;æ‹¦æˆªå™¨" tabindex="0" loading="lazy"><figcaption>è¿‡æ»¤å™¨&amp;æ‹¦æˆªå™¨</figcaption></figure><h3 id="_8-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" tabindex="-1"><a class="header-anchor" href="#_8-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"><span>8. ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</span></a></h3><blockquote><p>è¿™é‡Œæ˜¯å­—é¢æè¿°</p></blockquote><p><strong>ä¸‰æ¬¡æ¡æ‰‹:</strong></p><ol><li><p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚ç­‰å¾…æœåŠ¡å™¨ç¡®è®¤</p></li><li><p>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå“åº”å‘Šè¯‰å®¢æˆ·ç«¯æ”¶åˆ°äº†è¯·æ±‚</p></li><li><p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å†æ¬¡å‘å‡ºç¡®è®¤ä¿¡æ¯,æ­¤æ—¶è¿æ¥å»ºç«‹</p></li></ol><p><strong>å››æ¬¡æŒ¥æ‰‹:</strong></p><ol><li><p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºå–æ¶ˆè¿æ¥è¯·æ±‚</p></li><li><p>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå“åº”,è¡¨ç¤ºæ”¶åˆ°å®¢æˆ·ç«¯å–æ¶ˆè¯·æ±‚</p></li><li><p>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘å‡ºç¡®è®¤å–æ¶ˆä¿¡æ¯(å‘å®¢æˆ·ç«¯è¡¨æ˜å¯ä»¥å–æ¶ˆè¿æ¥äº†)</p></li><li><p>å®¢æˆ·ç«¯å†æ¬¡å‘é€ç¡®è®¤æ¶ˆæ¯,æ­¤æ—¶è¿æ¥å–æ¶ˆ</p></li></ol><h3 id="_9-tcpå’Œudpçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_9-tcpå’Œudpçš„åŒºåˆ«"><span>9. TCPå’ŒUDPçš„åŒºåˆ«</span></a></h3><ol><li><p>TCP ï¼šé¢å‘è¿æ¥ï¼ŒUDP ï¼šé¢å‘æ— è¿æ¥</p></li><li><p>TCP ï¼šä¼ è¾“æ•ˆç‡ä½ï¼ŒUDP ï¼šä¼ è¾“æ•ˆç‡é«˜(æœ‰å¤§å°é™åˆ¶ï¼Œä¸€æ¬¡é™å®šåœ¨64kbä¹‹å†…)</p></li><li><p>TCPï¼šå¯é ï¼ŒUDP ï¼šä¸å¯é </p></li></ol><h3 id="_10-å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_10-å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜"><span>10. å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿ</span></a></h3><p>è·¨åŸŸæŒ‡çš„æ˜¯æµè§ˆå™¨ä¸èƒ½æ‰§è¡Œå…¶å®ƒç½‘ç«™çš„è„šæœ¬ï¼Œå®ƒæ˜¯ç”±æµè§ˆå™¨çš„<strong>åŒæºç­–ç•¥</strong>é€ æˆçš„ï¼Œæ˜¯æµè§ˆå™¨å¯¹ JavaScript æ–½åŠ çš„å®‰å…¨é™åˆ¶ã€‚</p><p>æ‰€è°“åŒæºæŒ‡çš„æ˜¯ï¼š<strong>åè®®ã€åŸŸåã€ç«¯å£å·</strong>éƒ½ç›¸åŒï¼Œåªè¦æœ‰ä¸€ä¸ªä¸ç›¸åŒï¼Œé‚£ä¹ˆéƒ½æ˜¯éåŒæºã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><ol><li><p>ä½¿ç”¨ ajax çš„ jsonpã€‚ï¼ˆè¿™ä¸€ç‚¹æœ‰äº›äººæ˜¯ä¸çŸ¥é“çš„ï¼‰</p></li><li><p>nginx è½¬å‘ï¼šåˆ©ç”¨ nginx åå‘ä»£ç†ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°éƒ¨ç½²ç›¸åº”é¡¹ç›®çš„ tomcat æœåŠ¡å™¨ï¼Œå½“ç„¶ä¹Ÿä¸å­˜åœ¨è·¨åŸŸé—®é¢˜ã€‚</p></li><li><p>ä½¿ç”¨ CORSï¼šå†™ä¸€ä¸ªé…ç½®ç±»å®ç° WebMvcConfigurer æ¥å£æˆ–è€…é…ç½® FilterRegistrationBeanã€‚</p></li></ol><p><code>CORSï¼ˆCross-Origin Resource Sharingï¼‰æ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°â€œè·¨åŸŸèµ„æºå…±äº«â€</code></p><h3 id="_11-ä»€ä¹ˆæ˜¯-csrf-æ”»å‡»-å¦‚ä½•é˜²å¾¡csrf-æ”»å‡»" tabindex="-1"><a class="header-anchor" href="#_11-ä»€ä¹ˆæ˜¯-csrf-æ”»å‡»-å¦‚ä½•é˜²å¾¡csrf-æ”»å‡»"><span>11. ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»ï¼Ÿå¦‚ä½•é˜²å¾¡CSRF æ”»å‡»</span></a></h3><p>CSRFï¼ˆCross-site request forgeryï¼‰ è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚CSRF æ”»å‡»æ˜¯åœ¨å—å®³è€…æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œä»¥å—å®³è€…åä¹‰ä¼ªé€ è¯·æ±‚å‘é€ç»™å—æ”»å‡»ç«™ç‚¹ï¼Œä»è€Œåœ¨å—å®³è€…å¹¶æœªæˆæƒçš„æƒ…å†µä¸‹æ‰§è¡Œå—å®³è€…æƒé™ä¸‹çš„å„ç§æ“ä½œã€‚</p><p>CSRF æ”»å‡»ä¸“é—¨é’ˆå¯¹çŠ¶æ€æ”¹å˜è¯·æ±‚ï¼Œè€Œä¸æ˜¯æ•°æ®çªƒå–ï¼Œå› ä¸ºæ”»å‡»è€…æ— æ³•æŸ¥çœ‹å¯¹ä¼ªé€ è¯·æ±‚çš„å“åº”ã€‚</p><p>ç›®å‰é˜²å¾¡ CSRF æ”»å‡»ä¸»è¦æœ‰ä¸‰ç§ç­–ç•¥ï¼š</p><ol><li><p>éªŒè¯ HTTP Referer å­—æ®µ</p></li><li><p>åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ  token å¹¶éªŒè¯</p></li><li><p>åœ¨ HTTP å¤´ä¸­è‡ªå®šä¹‰å±æ€§å¹¶éªŒè¯</p></li></ol><h3 id="_12-http1-0å’Œhttp1-1å’Œhttp2-0çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_12-http1-0å’Œhttp1-1å’Œhttp2-0çš„åŒºåˆ«"><span>12. HTTP1.0å’ŒHTTP1.1å’ŒHTTP2.0çš„åŒºåˆ«</span></a></h3><ol><li><p><strong>HTTP1.0</strong> ï¼šæ— çŠ¶æ€ï¼Œæ— è¿æ¥ã€‚</p></li><li><p><strong>HTTP1.1</strong> ï¼šé•¿è¿æ¥ï¼Œè¯·æ±‚ç®¡é“åŒ–ï¼Œå¢åŠ ç¼“å­˜å¤„ç†ï¼Œå¢åŠ  Host å­—æ®µï¼Œæ”¯æŒæ–­ç‚¹ä¼ è¾“ã€‚</p></li><li><p><strong>HTTP2.0</strong> ï¼šäºŒè¿›åˆ¶åˆ†å¸§ï¼Œå¤šè·¯å¤ç”¨(è¿æ¥å…±äº«)ï¼Œå¤´éƒ¨å‹ç¼©ï¼ŒæœåŠ¡å™¨æ¨é€ã€‚</p></li></ol><h2 id="jvm" tabindex="-1"><a class="header-anchor" href="#jvm"><span>JVM</span></a></h2><h3 id="_1-è¯´ä¸€è¯´jvmçš„ä¸»è¦ç»„æˆéƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#_1-è¯´ä¸€è¯´jvmçš„ä¸»è¦ç»„æˆéƒ¨åˆ†"><span>1. è¯´ä¸€è¯´JVMçš„ä¸»è¦ç»„æˆéƒ¨åˆ†</span></a></h3><p>ç‚¹å‡»æ”¾å¤§çœ‹ï¼Œä¸€å›¾èƒœåƒæ–‡</p><figure><img src="https://tvax1.sinaimg.cn/large/007F3CC8ly1h11l1b6ykaj30x50kl46x.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><ul><li><p>æ–¹æ³•åŒºå’Œå †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼›è€Œè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨çš„è¿è¡Œæ˜¯çº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸï¼Œè¿è¡Œæ—¶æ•°æ®åŒºåŸŸå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„JVMçš„å†…å­˜ã€‚</p></li><li><p>ç±»åŠ è½½å­ç³»ç»Ÿï¼šæ ¹æ®ç»™å®šçš„å…¨é™å®šåç±»å(å¦‚ï¼šjava.lang.Object)æ¥è£…è½½classæ–‡ä»¶åˆ°è¿è¡Œæ—¶æ•°æ®åŒºä¸­çš„æ–¹æ³•åŒºä¸­ã€‚</p></li><li><p>Javaå †æ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œä¹Ÿæ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</p></li><li><p>æ–¹æ³•åŒºä¸Javaå †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p></li><li><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥çœ‹åšæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œç”¨æ¥æŒ‡ç¤ºæ‰§è¡Œå¼•æ“ä¸‹ä¸€æ¡æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ã€‚</p></li><li><p>Javaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€è¿”å›æ–¹æ³•åœ°å€ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p></li><li><p>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰,æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰ä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå…¶åŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™æ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚</p></li><li><p>æ‰§è¡Œå¼•æ“ï¼šæ ¹æ®ç¨‹åºè®¡æ•°å™¨ä¸­å­˜å‚¨çš„æŒ‡ä»¤åœ°å€æ‰§è¡Œclassesä¸­çš„æŒ‡ä»¤ã€‚</p></li><li><p>æœ¬åœ°æ¥å£ï¼šä¸æœ¬åœ°æ–¹æ³•åº“äº¤äº’ï¼Œæ˜¯å…¶å®ƒç¼–ç¨‹è¯­è¨€äº¤äº’çš„æ¥å£ã€‚</p></li></ul><h3 id="_2-è¯´ä¸€ä¸‹-jvm-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_2-è¯´ä¸€ä¸‹-jvm-çš„ä½œç”¨"><span>2. è¯´ä¸€ä¸‹ JVM çš„ä½œç”¨ï¼Ÿ</span></a></h3><p>é¦–å…ˆé€šè¿‡ç¼–è¯‘å™¨æŠŠ Java ä»£ç è½¬æ¢æˆå­—èŠ‚ç ï¼Œç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰å†æŠŠå­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºï¼ˆRuntime data areaï¼‰çš„æ–¹æ³•åŒºå†…ï¼Œè€Œå­—èŠ‚ç æ–‡ä»¶åªæ˜¯ JVM çš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚æ“ä½œç³»ç»Ÿå»æ‰§è¡Œï¼Œå› æ­¤éœ€è¦ç‰¹å®šçš„å‘½ä»¤è§£æå™¨æ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰ï¼Œå°†å­—èŠ‚ç ç¿»è¯‘æˆåº•å±‚ç³»ç»ŸæŒ‡ä»¤ï¼Œå†äº¤ç”± CPU å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨å…¶ä»–è¯­è¨€çš„æœ¬åœ°åº“æ¥å£ï¼ˆNative Interfaceï¼‰æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚</p><h3 id="_3-è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_3-è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«"><span>3. è¯´ä¸€ä¸‹å †æ ˆçš„åŒºåˆ«ï¼Ÿ</span></a></h3><p><strong>ç‰©ç†åœ°å€</strong></p><p>å †çš„ç‰©ç†åœ°å€åˆ†é…å¯¹è±¡æ˜¯ä¸è¿ç»­çš„ã€‚å› æ­¤æ€§èƒ½æ…¢äº›ã€‚åœ¨GCçš„æ—¶å€™ä¹Ÿè¦è€ƒè™‘åˆ°ä¸è¿ç»­çš„åˆ†é…ï¼Œæ‰€ä»¥æœ‰å„ç§ç®—æ³•ã€‚æ¯”å¦‚ï¼Œæ ‡è®°-æ¶ˆé™¤ï¼Œå¤åˆ¶ï¼Œæ ‡è®°-å‹ç¼©ï¼Œåˆ†ä»£ï¼ˆå³æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°â€”â€”å‹ç¼©ï¼‰</p><p>æ ˆä½¿ç”¨çš„æ˜¯æ•°æ®ç»“æ„ä¸­çš„æ ˆï¼Œå…ˆè¿›åå‡ºçš„åŸåˆ™ï¼Œç‰©ç†åœ°å€åˆ†é…æ˜¯è¿ç»­çš„ã€‚æ‰€ä»¥æ€§èƒ½å¿«ã€‚</p><p><strong>å†…å­˜åˆ†åˆ«</strong></p><p>å †å› ä¸ºæ˜¯ä¸è¿ç»­çš„ï¼Œæ‰€ä»¥åˆ†é…çš„å†…å­˜æ˜¯åœ¨è¿è¡ŒæœŸç¡®è®¤çš„ï¼Œå› æ­¤å¤§å°ä¸å›ºå®šã€‚ä¸€èˆ¬å †å¤§å°è¿œè¿œå¤§äºæ ˆã€‚</p><p>æ ˆæ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åˆ†é…çš„å†…å­˜å¤§å°è¦åœ¨ç¼–è¯‘æœŸå°±ç¡®è®¤ï¼Œå¤§å°æ˜¯å›ºå®šçš„ã€‚</p><p><strong>å­˜æ”¾çš„å†…å®¹</strong></p><p>å †å­˜æ”¾çš„æ˜¯å¯¹è±¡çš„å®ä¾‹å’Œæ•°ç»„ã€‚å› æ­¤è¯¥åŒºæ›´å…³æ³¨çš„æ˜¯æ•°æ®çš„å­˜å‚¨</p><p>æ ˆå­˜æ”¾ï¼šå±€éƒ¨å˜é‡ï¼Œæ“ä½œæ•°æ ˆï¼Œè¿”å›ç»“æœã€‚è¯¥åŒºæ›´å…³æ³¨çš„æ˜¯ç¨‹åºæ–¹æ³•çš„æ‰§è¡Œã€‚</p><p><strong>PSï¼š</strong></p><p>é™æ€å˜é‡æ”¾åœ¨æ–¹æ³•åŒº é™æ€çš„å¯¹è±¡è¿˜æ˜¯æ”¾åœ¨å †ã€‚ ç¨‹åºçš„å¯è§åº¦</p><p>å †å¯¹äºæ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½æ˜¯å…±äº«ã€å¯è§çš„ã€‚</p><p>æ ˆåªå¯¹äºçº¿ç¨‹æ˜¯å¯è§çš„ã€‚æ‰€ä»¥ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰ã€‚ä»–çš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒã€‚</p><h3 id="_4-javaå†…å­˜æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#_4-javaå†…å­˜æ³„æ¼"><span>4. Javaå†…å­˜æ³„æ¼</span></a></h3><p>å†…å­˜æ³„æ¼æ˜¯æŒ‡ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡æˆ–è€…å˜é‡ä¸€ç›´è¢«å æ®åœ¨å†…å­˜ä¸­ã€‚</p><p>ä¸¥æ ¼æ¥è¯´ï¼Œåªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯GCåˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚</p><p>ç†è®ºä¸Šæ¥è¯´ï¼ŒJavaæ˜¯æœ‰GCåƒåœ¾å›æ”¶æœºåˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡ï¼Œä¼šè¢«GCè‡ªåŠ¨å›æ”¶æ‰ï¼Œè‡ªåŠ¨ä»å†…å­˜ä¸­æ¸…é™¤ã€‚</p><p>ä½†æ˜¯ï¼Œå³ä½¿è¿™æ ·ï¼ŒJavaä¹Ÿè¿˜æ˜¯å­˜åœ¨ç€å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œjavaå¯¼è‡´å†…å­˜æ³„éœ²çš„åŸå› å¾ˆæ˜ç¡®ï¼šé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨å°±å¾ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å·²ç»ä¸å†éœ€è¦ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«å›æ”¶ï¼Œè¿™å°±æ˜¯javaä¸­å†…å­˜æ³„éœ²çš„å‘ç”Ÿåœºæ™¯ã€‚</p><h3 id="_5-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#_5-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•"><span>5. JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ</span></a></h3><ul><li>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼šæ ‡è®°æœ‰ç”¨å¯¹è±¡ï¼Œç„¶åè¿›è¡Œæ¸…é™¤å›æ”¶ã€‚ç¼ºç‚¹ï¼šæ•ˆç‡ä¸é«˜ï¼Œæ— æ³•æ¸…é™¤åƒåœ¾ç¢ç‰‡ã€‚</li><li>å¤åˆ¶ç®—æ³•ï¼šæŒ‰ç…§å®¹é‡åˆ’åˆ†äºŒä¸ªå¤§å°ç›¸ç­‰çš„å†…å­˜åŒºåŸŸï¼Œå½“ä¸€å—ç”¨å®Œçš„æ—¶å€™å°†æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚ç¼ºç‚¹ï¼šå†…å­˜ä½¿ç”¨ç‡ä¸é«˜ï¼Œåªæœ‰åŸæ¥çš„ä¸€åŠï¼Œæ¶ˆè€—å†…å­˜ã€‚</li><li>æ ‡è®°-æ•´ç†ç®—æ³•ï¼šæ ‡è®°æ— ç”¨å¯¹è±¡ï¼Œè®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…é™¤æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</li><li>åˆ†ä»£ç®—æ³•ï¼šæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£åŸºæœ¬é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•ã€‚</li></ul><h3 id="_6-è¯´ä¸€ä¸‹-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#_6-è¯´ä¸€ä¸‹-jvm-æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨"><span>6. è¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Ÿ</span></a></h3><figure><img src="https://tva2.sinaimg.cn/large/007F3CC8ly1h11l1p8888j30te07oacq.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><figure><img src="https://tvax1.sinaimg.cn/large/007F3CC8ly1h11l1ykqpsj30vx08o14v.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="_7-è¯´ä¸€ä¸‹ç±»åŠ è½½çš„æ‰§è¡Œè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_7-è¯´ä¸€ä¸‹ç±»åŠ è½½çš„æ‰§è¡Œè¿‡ç¨‹"><span>7. è¯´ä¸€ä¸‹ç±»åŠ è½½çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</span></a></h3><ul><li><strong>åŠ è½½</strong>ï¼šæ ¹æ®æŸ¥æ‰¾è·¯å¾„æ‰¾åˆ°ç›¸åº”çš„ class æ–‡ä»¶ç„¶åè£…è½½å…¥å†…å­˜ä¸­ï¼›</li></ul><figure><img src="https://tvax2.sinaimg.cn/large/007F3CC8ly1h11l29871ij30is07h76f.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><ul><li><strong>éªŒè¯</strong>ï¼šæ£€æŸ¥åŠ è½½çš„ class æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼›</li><li><strong>å‡†å¤‡</strong>ï¼šç»™ç±»ä¸­çš„é™æ€å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼›</li><li><strong>è§£æ</strong>ï¼šè™šæ‹Ÿæœºå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢æˆç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±ç†è§£ä¸ºä¸€ä¸ªæ ‡ç¤ºï¼Œè€Œåœ¨ç›´æ¥å¼•ç”¨ç›´æ¥æŒ‡å‘å†…å­˜ä¸­çš„åœ°å€ï¼›</li><li><strong>åˆå§‹åŒ–</strong>ï¼šå¯¹é™æ€å˜é‡å’Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</li></ul><hr><h3 id="_8-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_8-ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹"><span>8. ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</span></a></h3><p><strong>ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹</strong></p><ul><li>å½“éœ€è¦åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå­ç±»åŠ è½½å™¨å¹¶ä¸ä¼šé©¬ä¸Šå»åŠ è½½ï¼Œè€Œæ˜¯ä¾æ¬¡å»è¯·æ±‚çˆ¶ç±»åŠ è½½å™¨åŠ è½½</li><li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼›</li><li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹</strong></p><p>å¯ä»¥é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä»½åŒæ ·çš„å­—èŠ‚ç ï¼Œå¦‚æœæ²¡æœ‰åŒäº²å§”æ´¾æ¨¡å‹è€Œæ˜¯ç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡ŒåŠ è½½çš„è¯ï¼Œå¦‚æœç”¨æˆ·ç¼–å†™äº†ä¸€ä¸ªjava.lang.Objectçš„åŒåç±»å¹¶æ”¾åœ¨ClassPathä¸­ï¼Œå¤šä¸ªç±»åŠ è½½å™¨éƒ½å»åŠ è½½è¿™ä¸ªç±»åˆ°å†…å­˜ä¸­ï¼Œç³»ç»Ÿä¸­å°†ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„Objectç±»ï¼Œé‚£ä¹ˆç±»ä¹‹é—´çš„æ¯”è¾ƒç»“æœåŠç±»çš„å”¯ä¸€æ€§å°†æ— æ³•ä¿è¯ï¼Œè€Œä¸”å¦‚æœä¸ä½¿ç”¨è¿™ç§åŒäº²å§”æ´¾æ¨¡å‹å°†ä¼šç»™è™šæ‹Ÿæœºçš„å®‰å…¨å¸¦æ¥éšæ‚£ã€‚æ‰€ä»¥ï¼Œè¦è®©ç±»å¯¹è±¡è¿›è¡Œæ¯”è¾ƒæœ‰æ„ä¹‰ï¼Œå‰ææ˜¯ä»–ä»¬è¦è¢«åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½ã€‚</p><h3 id="_9-cmsåƒåœ¾æ¸…ç†çš„è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_9-cmsåƒåœ¾æ¸…ç†çš„è¿‡ç¨‹"><span>9. CMSåƒåœ¾æ¸…ç†çš„è¿‡ç¨‹</span></a></h3><figure><img src="https://tva4.sinaimg.cn/large/007F3CC8ly1h11l2qpppoj30se08sgq4.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>CMSæ•´ä¸ªè¿‡ç¨‹æ¯”ä¹‹å‰çš„æ”¶é›†å™¨è¦å¤æ‚ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º4ä¸ªä¸»è¦é˜¶æ®µï¼Œå³åˆå§‹æ ‡è®°é˜¶æ®µã€å¹¶å‘æ ‡è®°é˜¶æ®µã€é‡æ–°æ ‡è®°é˜¶æ®µå’Œå¹¶å‘æ¸…é™¤é˜¶æ®µã€‚(æ¶‰åŠSTWçš„é˜¶æ®µä¸»è¦æ˜¯ï¼šåˆå§‹æ ‡è®° å’Œ é‡æ–°æ ‡è®° stop-the-world)</p><ul><li><p><strong>åˆå§‹æ ‡è®°</strong>ï¼ˆInitial-Markï¼‰é˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½å°†ä¼šå› ä¸ºâ€œstop-the-worldâ€æœºåˆ¶è€Œå‡ºç°çŸ­æš‚çš„æš‚åœï¼Œè¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡ä»…ä»…åªæ˜¯æ ‡è®°å‡º GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ã€‚ä¸€æ—¦æ ‡è®°å®Œæˆä¹‹åå°±ä¼šæ¢å¤ä¹‹å‰è¢«æš‚åœçš„æ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚ç”±äºç›´æ¥å…³è”å¯¹è±¡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™é‡Œçš„é€Ÿåº¦éå¸¸å¿«ã€‚</p></li><li><p><strong>å¹¶å‘æ ‡è®°</strong>ï¼ˆConcurrent-Markï¼‰é˜¶æ®µï¼šä» Gc Roots çš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚</p></li><li><p><strong>é‡æ–°æ ‡è®°</strong>ï¼ˆRemarkï¼‰é˜¶æ®µï¼šç”±äºåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µä¸­ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹ä¼šå’Œåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œï¼Œå› æ­¤ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚</p></li><li><p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼ˆConcurrent-Sweepï¼‰é˜¶æ®µï¼šæ­¤é˜¶æ®µæ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„</p></li></ul><h3 id="_10-å¸¸ç”¨çš„-jvm-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_10-å¸¸ç”¨çš„-jvm-è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›"><span>10. å¸¸ç”¨çš„ JVM è°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›ï¼Ÿ</span></a></h3><figure><img src="https://tvax1.sinaimg.cn/large/007F3CC8ly1h11l35h3jfj30pd097764.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><ul><li>-XX:NewRatio=4ï¼šè®¾ç½®å¹´è½»çš„å’Œè€å¹´ä»£çš„å†…å­˜æ¯”ä¾‹ä¸º 1:4ï¼›</li><li>-XX:SurvivorRatio=8ï¼šè®¾ç½®æ–°ç”Ÿä»£ Eden å’Œ Survivor æ¯”ä¾‹ä¸º 8:2ï¼›</li><li>â€“XX:+UseParNewGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</li><li>-XX:+UseParallelOldGCï¼šæŒ‡å®šä½¿ç”¨ ParNew + ParNew Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</li><li>-XX:+UseConcMarkSweepGCï¼šæŒ‡å®šä½¿ç”¨ CMS + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆï¼›</li><li>-XX:+PrintGCï¼šå¼€å¯æ‰“å° gc ä¿¡æ¯ï¼›</li><li>-XX:+PrintGCDetailsï¼šæ‰“å° gc è¯¦ç»†ä¿¡æ¯ã€‚</li></ul><figure><img src="https://tvax4.sinaimg.cn/large/007F3CC8ly1h11l3rzpgsj30mb0883ze.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h2 id="kafka" tabindex="-1"><a class="header-anchor" href="#kafka"><span>Kafka</span></a></h2><p>åœ¨é¢è¯•kafkaä¸­ï¼Œä¸€å®šè¦äº†è§£ä¸ºä»€ä¹ˆè¦ç”¨kafkaã€åŠkafkaçš„æ¶æ„ç­‰åŸºæœ¬æ¦‚å¿µï¼Œæ‰èƒ½å¯¹é¢è¯•ä¸­çš„é—®é¢˜å¾—å¿ƒåº”æ‰‹ã€‚</p><h2 id="æœ¯è¯­0-kafkaä¸­çš„isrã€aråˆä»£è¡¨ä»€ä¹ˆ-isrçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#æœ¯è¯­0-kafkaä¸­çš„isrã€aråˆä»£è¡¨ä»€ä¹ˆ-isrçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆ"><span>æœ¯è¯­0. Kafkaä¸­çš„ISRã€ARåˆä»£è¡¨ä»€ä¹ˆï¼ŸISRçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆ</span></a></h2><p><strong>ISR</strong>:In-Sync Replicas å‰¯æœ¬åŒæ­¥é˜Ÿåˆ—</p><p><strong>AR</strong>:Assigned Replicas æ‰€æœ‰å‰¯æœ¬</p><p>ISRæ˜¯ç”±leaderç»´æŠ¤ï¼Œfollowerä»leaderåŒæ­¥æ•°æ®æœ‰ä¸€äº›å»¶è¿Ÿï¼ˆåŒ…æ‹¬å»¶è¿Ÿæ—¶é—´replica.lag.time.max.mså’Œå»¶è¿Ÿæ¡æ•°replica.lag.max.messagesä¸¤ä¸ªç»´åº¦, å½“å‰æœ€æ–°çš„ç‰ˆæœ¬0.10.xä¸­åªæ”¯æŒreplica.lag.time.max.msè¿™ä¸ªç»´åº¦ï¼‰ï¼Œä»»æ„ä¸€ä¸ªè¶…è¿‡é˜ˆå€¼éƒ½ä¼šæŠŠfollowerå‰”é™¤å‡ºISR, å­˜å…¥OSRï¼ˆOutof-Sync Replicasï¼‰åˆ—è¡¨ï¼Œæ–°åŠ å…¥çš„followerä¹Ÿä¼šå…ˆå­˜æ”¾åœ¨OSRä¸­ã€‚AR=ISR+OSRã€‚</p><h2 id="æœ¯è¯­0-kafkaä¸­çš„hwã€leoã€lsoã€lwç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#æœ¯è¯­0-kafkaä¸­çš„hwã€leoã€lsoã€lwç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆ"><span>æœ¯è¯­0. Kafkaä¸­çš„HWã€LEOã€LSOã€LWç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ</span></a></h2><p><strong>HW</strong>:High Watermark é«˜æ°´ä½ï¼Œå–ä¸€ä¸ªpartitionå¯¹åº”çš„ISRä¸­æœ€å°çš„LEOä½œä¸ºHWï¼Œconsumeræœ€å¤šåªèƒ½æ¶ˆè´¹åˆ°HWæ‰€åœ¨çš„ä½ç½®ä¸Šä¸€æ¡ä¿¡æ¯ã€‚</p><p><strong>LEO</strong>:LogEndOffset å½“å‰æ—¥å¿—æ–‡ä»¶ä¸­ä¸‹ä¸€æ¡å¾…å†™ä¿¡æ¯çš„offset HW/LEOè¿™ä¸¤ä¸ªéƒ½æ˜¯æŒ‡æœ€åä¸€æ¡çš„ä¸‹ä¸€æ¡çš„ä½ç½®è€Œä¸æ˜¯æŒ‡æœ€åä¸€æ¡çš„ä½ç½®ã€‚</p><p><strong>LSO</strong>:Last Stable Offset å¯¹æœªå®Œæˆçš„äº‹åŠ¡è€Œè¨€ï¼ŒLSO çš„å€¼ç­‰äºäº‹åŠ¡ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯çš„ä½ç½®(firstUnstableOffset)ï¼Œå¯¹å·²å®Œæˆçš„äº‹åŠ¡è€Œè¨€ï¼Œå®ƒçš„å€¼åŒ HW ç›¸åŒ</p><p><strong>LW</strong>:Low Watermark ä½æ°´ä½, ä»£è¡¨ AR é›†åˆä¸­æœ€å°çš„ logStartOffset å€¼</p><hr><h3 id="_1-kafka-æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_1-kafka-æ˜¯ä»€ä¹ˆ-æœ‰ä»€ä¹ˆä½œç”¨"><span>1. kafka æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</span></a></h3><p>Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¼å¤„ç†å¹³å°ï¼Œå®ƒä»¥é«˜ååã€å¯æŒä¹…åŒ–ã€å¯æ°´å¹³æ‰©å±•ã€æ”¯æŒæµæ•°æ®å¤„ç†ç­‰å¤šç§ç‰¹æ€§è€Œè¢«å¹¿æ³›ä½¿ç”¨</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093217.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä¸»è¦åŠŸèƒ½ä½“ç°äºä¸‰ç‚¹ï¼š</p><ul><li><p><strong>æ¶ˆæ¯ç³»ç»Ÿ</strong>ï¼škafkaä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶éƒ½å…·å¤‡<strong>ç³»ç»Ÿè§£è€¦ã€å†—ä½™å­˜å‚¨ã€æµé‡å‰Šå³°ã€ç¼“å†²ã€å¼‚æ­¥é€šä¿¡ã€æ‰©å±•æ€§ã€å¯æ¢å¤æ€§</strong>ç­‰åŠŸèƒ½ã€‚ä¸æ­¤åŒæ—¶ï¼Œkafkaè¿˜æä¾›äº†å¤§å¤šæ•°æ¶ˆæ¯ç³»ç»Ÿéš¾ä»¥å®ç°çš„æ¶ˆæ¯é¡ºåºæ€§ä¿éšœåŠå›æº¯æ€§æ¶ˆè´¹çš„åŠŸèƒ½ã€‚</p></li><li><p><strong>å­˜å‚¨ç³»ç»Ÿ</strong>ï¼škafkaæŠŠ<strong>æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜</strong>ï¼Œç›¸æ¯”äºå…¶ä»–åŸºäºå†…å­˜å­˜å‚¨çš„ç³»ç»Ÿè€Œè¨€ï¼Œæœ‰æ•ˆçš„é™ä½äº†æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚è¿™å¾—ç›Šäºå…¶æ¶ˆæ¯æŒä¹…åŒ–å’Œå¤šå‰¯æœ¬æœºåˆ¶ã€‚ä¹Ÿå¯ä»¥å°†kafkaä½œä¸ºé•¿æœŸçš„å­˜å‚¨ç³»ç»Ÿæ¥ä½¿ç”¨ï¼Œåªéœ€è¦æŠŠå¯¹åº”çš„æ•°æ®ä¿ç•™ç­–ç•¥è®¾ç½®ä¸ºâ€œæ°¸ä¹…â€æˆ–å¯ç”¨ä¸»é¢˜æ—¥å¿—å‹ç¼©åŠŸèƒ½ã€‚</p></li><li><p><strong>æµå¼å¤„ç†å¹³å°</strong>ï¼škafkaä¸ºæµè¡Œçš„æµå¼å¤„ç†æ¡†æ¶æä¾›äº†å¯é çš„æ•°æ®æ¥æºï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æµå¼å¤„ç†æ¡†æ¶ï¼Œæ¯”å¦‚çª—å£ã€è¿æ¥ã€å˜æ¢å’Œèšåˆç­‰å„ç±»æ“ä½œã€‚</p></li></ul><h3 id="_2-kafka-çš„æ¶æ„æ˜¯æ€ä¹ˆæ ·çš„" tabindex="-1"><a class="header-anchor" href="#_2-kafka-çš„æ¶æ„æ˜¯æ€ä¹ˆæ ·çš„"><span>2. kafka çš„æ¶æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</span></a></h3><blockquote><p>è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µçš„é¢˜ç›®ï¼Œä¸€å®šè¦æŒæ¡ã€‚</p></blockquote><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093220.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä¸€ä¸ªå…¸å‹çš„ kafka ä½“ç³»æ¶æ„åŒ…æ‹¬è‹¥å¹² Producerã€è‹¥å¹² Consumerã€ä»¥åŠä¸€ä¸ª Zookeeper é›†ç¾¤ï¼ˆåœ¨2.8.0ç‰ˆæœ¬ä¸­ç§»ï¼Œé™¤äº† Zookeeper,é€šè¿‡ KRaft è¿›è¡Œè‡ªå·±çš„é›†ç¾¤ç®¡ç†ï¼‰</p><p>Producer å°†æ¶ˆæ¯å‘é€åˆ° Brokerï¼ŒBroker è´Ÿè´£å°†å—åˆ°çš„æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œè€Œ Consumer è´Ÿè´£ä» Broker è®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><p>Kafka åŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><p><strong>Producer</strong> ï¼šç”Ÿäº§è€…ï¼Œè´Ÿè´£å°†æ¶ˆæ¯å‘é€åˆ° Broker</p></li><li><p><strong>Consumer</strong> ï¼šæ¶ˆè´¹è€…ï¼Œä» Broker æ¥æ”¶æ¶ˆæ¯</p></li><li><p><strong>Consumer Group</strong> ï¼šæ¶ˆè´¹è€…ç»„ï¼Œç”±å¤šä¸ª Consumer ç»„æˆã€‚æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œ<strong>ä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªç»„å†…æ¶ˆè´¹è€…æ¶ˆè´¹</strong>ï¼Œæ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ã€‚</p></li><li><p><strong>Broker</strong> ï¼šå¯ä»¥çœ‹åšä¸€ä¸ªç‹¬ç«‹çš„ <strong>Kafka æœåŠ¡èŠ‚ç‚¹æˆ– Kafka æœåŠ¡å®ä¾‹</strong>ã€‚å¦‚æœä¸€å°æœåŠ¡å™¨ä¸Šåªéƒ¨ç½²äº†ä¸€ä¸ª Kafka å®ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† Broker çœ‹åšä¸€å° Kafka æœåŠ¡å™¨ã€‚</p></li><li><p><strong>Topic</strong> ï¼šä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼ŒåŒ…å«å¾ˆå¤š Partitionï¼Œ<strong>åŒä¸€ä¸ª Topic ä¸‹çš„ Partiton çš„æ¶ˆæ¯å†…å®¹æ˜¯ä¸ç›¸åŒçš„</strong>ã€‚</p></li><li><p><strong>Partition</strong> ï¼šä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„ topic <strong>å¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ª broker ä¸Šï¼Œä¸€ä¸ª topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª partition</strong>ï¼Œæ¯ä¸ª partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚</p></li><li><p><strong>Replica</strong> ï¼šå‰¯æœ¬ï¼Œ<strong>åŒä¸€åˆ†åŒºçš„ä¸åŒå‰¯æœ¬ä¿å­˜çš„æ˜¯ç›¸åŒçš„æ¶ˆæ¯</strong>ï¼Œä¸ºä¿è¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„ partition æ•°æ®ä¸ä¸¢å¤±ï¼Œä¸” kafka ä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œï¼Œ- kafka æä¾›äº†å‰¯æœ¬æœºåˆ¶ï¼Œä¸€ä¸ª topic çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ª leader å’Œè‹¥å¹²ä¸ª followerã€‚</p></li><li><p><strong>Leader</strong> ï¼šæ¯ä¸ªåˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬ä¸­çš„&quot;ä¸»å‰¯æœ¬&quot;ï¼Œ<strong>ç”Ÿäº§è€…ä»¥åŠæ¶ˆè´¹è€…åªä¸ Leader äº¤äº’</strong>ã€‚</p></li><li><p><strong>Follower</strong> ï¼šæ¯ä¸ªåˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬ä¸­çš„&quot;ä»å‰¯æœ¬&quot;ï¼Œ<strong>è´Ÿè´£å®æ—¶ä» Leader ä¸­åŒæ­¥æ•°æ®ï¼Œä¿æŒå’Œ Leader æ•°æ®çš„åŒæ­¥</strong>ã€‚Leader å‘ç”Ÿæ•…éšœæ—¶ï¼Œä» Follower å‰¯æœ¬ä¸­é‡æ–°é€‰ä¸¾æ–°çš„ Leader å‰¯æœ¬å¯¹å¤–æä¾›æœåŠ¡ã€‚</p></li></ul><h3 id="_3-kafka-replicasæ˜¯æ€ä¹ˆç®¡ç†çš„" tabindex="-1"><a class="header-anchor" href="#_3-kafka-replicasæ˜¯æ€ä¹ˆç®¡ç†çš„"><span>3. Kafka Replicasæ˜¯æ€ä¹ˆç®¡ç†çš„ï¼Ÿ</span></a></h3><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093223.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>AR:åˆ†åŒºä¸­çš„<strong>æ‰€æœ‰ Replica ç»Ÿç§°ä¸º AR</strong></li><li>ISR:æ‰€æœ‰ä¸ Leader å‰¯æœ¬<strong>ä¿æŒä¸€å®šç¨‹åº¦åŒæ­¥</strong>çš„Replica(åŒ…æ‹¬ Leader å‰¯æœ¬åœ¨å†…)ç»„æˆ ISR</li><li>OSR:ä¸ Leader å‰¯æœ¬<strong>åŒæ­¥æ»åè¿‡å¤šçš„</strong> Replica ç»„æˆäº† OSR</li></ul><p>Leader è´Ÿè´£ç»´æŠ¤å’Œè·Ÿè¸ª ISR é›†åˆä¸­æ‰€æœ‰ Follower å‰¯æœ¬çš„æ»åçŠ¶æ€ï¼Œå½“ Follower å‰¯æœ¬è½åè¿‡å¤šæ—¶ï¼Œå°±ä¼šå°†å…¶æ”¾å…¥ OSR é›†åˆï¼Œå½“ Follower å‰¯æœ¬è¿½ä¸Šäº† Leader çš„è¿›åº¦æ—¶ï¼Œå°±ä¼šå°†å…¶æ”¾å…¥ ISR é›†åˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰ <strong>ISR ä¸­çš„å‰¯æœ¬æ‰æœ‰èµ„æ ¼æ™‹å‡ä¸º Leader</strong>ã€‚</p><h3 id="_4-å¦‚ä½•ç¡®å®šå½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_4-å¦‚ä½•ç¡®å®šå½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯"><span>4. å¦‚ä½•ç¡®å®šå½“å‰èƒ½è¯»åˆ°å“ªä¸€æ¡æ¶ˆæ¯ï¼Ÿ</span></a></h3><blockquote><p>è¿™ä¸ªé—®é¢˜è¦å…ˆäº†è§£ä¸Šä¸€ä¸ªé—®é¢˜çš„æ¦‚å¿µ</p></blockquote><p>åˆ†åŒºç›¸å½“äºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬å…ˆç®€å•ä»‹ç»å‡ ä¸ªæ¦‚å¿µ</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093225.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚ä¸Šå›¾æ˜¯ä¸€ä¸ªåˆ†åŒºæ—¥å¿—æ–‡ä»¶</p><ul><li>æ ‡è¯†<strong>å…±æœ‰7æ¡æ¶ˆæ¯</strong>ï¼Œoffset (æ¶ˆæ¯åç§»é‡)åˆ†åˆ«æ˜¯0~6</li><li>0 ä»£è¡¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶çš„<strong>å¼€å§‹</strong></li><li>HW(High Watermark) ä¸º4ï¼Œ0~3 ä»£è¡¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶<strong>å¯ä»¥æ¶ˆè´¹çš„åŒºé—´</strong>ï¼Œæ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹åˆ°è¿™å››æ¡æ¶ˆæ¯</li><li>LEO ä»£è¡¨å³å°†è¦å†™å…¥æ¶ˆæ¯çš„åç§»é‡ offset</li></ul><p><strong>åˆ†åŒº ISR é›†åˆä¸­çš„æ¯ä¸ªå‰¯æœ¬éƒ½ä¼šç»´æŠ¤è‡ªå·±çš„ LEOï¼Œè€Œ ISR é›†åˆä¸­æœ€å°çš„LEO å³ä¸ºåˆ†åŒºçš„ HW</strong></p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093228.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚ä¸Šå›¾: ä¸‰ä¸ªåˆ†åŒºå‰¯æœ¬éƒ½æ˜¯ ISRé›†åˆå½“ä¸­çš„ï¼Œæœ€å°çš„ LEO ä¸º 3ï¼Œå°±ä»£è¡¨åˆ†åŒºçš„ HW ä¸º3ï¼Œæ‰€ä»¥å½“å‰åˆ†åŒºåªèƒ½æ¶ˆè´¹åˆ° 0~2 ä¹‹é—´çš„ä¸‰æ¡æ•°æ®ï¼Œå¦‚ä¸‹å›¾</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093230.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_5-å‘é€æ¶ˆæ¯çš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_5-å‘é€æ¶ˆæ¯çš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›"><span>5. å‘é€æ¶ˆæ¯çš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</span></a></h3><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093232.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>1.è½®è¯¢ï¼š<strong>ä¾æ¬¡</strong>å°†æ¶ˆæ¯å‘é€è¯¥topicä¸‹çš„æ‰€æœ‰åˆ†åŒºï¼Œå¦‚æœåœ¨åˆ›å»ºæ¶ˆæ¯çš„æ—¶å€™ key ä¸º nullï¼ŒKafka é»˜è®¤é‡‡ç”¨è¿™ç§ç­–ç•¥ã€‚</p></li><li><p>2.key æŒ‡å®šåˆ†åŒºï¼šåœ¨åˆ›å»ºæ¶ˆæ¯æ˜¯ key ä¸ä¸ºç©ºï¼Œå¹¶ä¸”ä½¿ç”¨é»˜è®¤åˆ†åŒºå™¨ï¼ŒKafka ä¼šå°† key è¿›è¡Œ hashï¼Œç„¶å<strong>æ ¹æ®hashå€¼æ˜ å°„åˆ°æŒ‡å®šçš„åˆ†åŒºä¸Š</strong>ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ key ç›¸åŒçš„æ¶ˆæ¯ä¼šåœ¨ä¸€ä¸ªåˆ†åŒºä¸‹ï¼ŒKafka å¹¶ä¸èƒ½ä¿è¯å…¨å±€æœ‰åºï¼Œä½†æ˜¯åœ¨æ¯ä¸ªåˆ†åŒºä¸‹çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼ŒæŒ‰ç…§é¡ºåºå­˜å‚¨ï¼ŒæŒ‰ç…§é¡ºåºæ¶ˆè´¹ã€‚åœ¨ä¿è¯åŒä¸€ä¸ª key çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œè¿™æ ·åŸºæœ¬èƒ½æ»¡è¶³æ¶ˆæ¯çš„é¡ºåºæ€§çš„éœ€æ±‚ã€‚ä½†æ˜¯<strong>å¦‚æœ partation æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œé‚£å°±å¾ˆéš¾ä¿è¯ key ä¸åˆ†åŒºä¹‹é—´çš„æ˜ å°„å…³ç³»äº†</strong>ã€‚</p></li><li><p>3.è‡ªå®šä¹‰ç­–ç•¥ï¼šå®ç° Partitioner æ¥å£å°±èƒ½è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ã€‚</p></li><li><p>4.æŒ‡å®š Partiton å‘é€</p></li></ul><h3 id="_6-kafka-çš„å¯é æ€§æ˜¯æ€ä¹ˆä¿è¯çš„" tabindex="-1"><a class="header-anchor" href="#_6-kafka-çš„å¯é æ€§æ˜¯æ€ä¹ˆä¿è¯çš„"><span>6. Kafka çš„å¯é æ€§æ˜¯æ€ä¹ˆä¿è¯çš„ï¼Ÿ</span></a></h3><p><strong>1.acks</strong></p><p>è¿™ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šåˆ†åŒºä¸­æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ”¶åˆ°è¿™æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºè¿™æ¡æ¶ˆæ¯æ˜¯å†™å…¥æˆåŠŸçš„ï¼Œè¿™ä¸ªå‚æ•°æœ‰ä¸‰ä¸ªå€¼ï¼š</p><ul><li>1.acks = 1ï¼Œé»˜è®¤ä¸º1ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œ<strong>åªè¦ leader å‰¯æœ¬æˆåŠŸå†™å…¥æ¶ˆæ¯ï¼Œå°±ä»£è¡¨æˆåŠŸ</strong>ã€‚è¿™ç§æ–¹æ¡ˆçš„é—®é¢˜åœ¨äºï¼Œå½“è¿”å›æˆåŠŸåï¼Œå¦‚æœ leader å‰¯æœ¬å’Œ follower å‰¯æœ¬<strong>è¿˜æ²¡æœ‰æ¥å¾—åŠåŒæ­¥</strong>ï¼Œleader å°±å´©æºƒäº†ï¼Œé‚£ä¹ˆåœ¨é€‰ä¸¾åæ–°çš„ leader å°±æ²¡æœ‰è¿™æ¡<strong>æ¶ˆæ¯ï¼Œä¹Ÿå°±ä¸¢å¤±äº†</strong>ã€‚</li><li>2.acks = 0ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åç›´æ¥ç®—å†™å…¥æˆåŠŸï¼Œä¸éœ€è¦ç­‰å¾…å“åº”ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜å¾ˆæ˜æ˜¾ï¼Œ<strong>åªè¦æœåŠ¡ç«¯å†™æ¶ˆæ¯æ—¶å‡ºç°ä»»ä½•é—®é¢˜ï¼Œéƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±</strong>ã€‚</li><li>3.acks = -1 æˆ– acks = allã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œéœ€è¦ç­‰å¾… ISR ä¸­çš„æ‰€æœ‰å‰¯æœ¬éƒ½æˆåŠŸå†™å…¥æ¶ˆæ¯åæ‰èƒ½æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”ã€‚æ¯«æ— ç–‘é—®è¿™ç§æ–¹æ¡ˆçš„<strong>å¯é æ€§æ˜¯æœ€é«˜çš„</strong>ï¼Œä½†æ˜¯å¦‚æœ ISR ä¸­åªæœ‰leader å‰¯æœ¬ï¼Œé‚£ä¹ˆå°±å’Œ acks = 1 æ¯«æ— å·®åˆ«äº†ã€‚</li></ul><p><strong>2.æ¶ˆæ¯å‘é€çš„æ–¹å¼</strong></p><p>ç¬¬6é—®ä¸­æˆ‘ä»¬æåˆ°äº†ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœ‰ä¸‰ç§æ–¹å¼ï¼Œå‘å®Œå³å¿˜ï¼ŒåŒæ­¥å’Œå¼‚æ­¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åŒæ­¥æˆ–è€…å¼‚æ­¥è·å–å“åº”ç»“æœï¼Œ<strong>å¤±è´¥åšé‡è¯•</strong>æ¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ã€‚</p><p><strong>3.æ‰‹åŠ¨æäº¤ä½ç§»</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°æ¶ˆæ¯åï¼Œå°±ä¼šè‡ªåŠ¨æäº¤ä½ç§»ã€‚ä½†æ˜¯å¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹å‡ºé”™ï¼Œæ²¡æœ‰è¿›å…¥çœŸæ­£çš„ä¸šåŠ¡å¤„ç†ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå¯¼è‡´è¿™æ¡æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œä»è€Œä¸¢å¤±ã€‚æˆ‘ä»¬å¯ä»¥å¼€å¯æ‰‹åŠ¨æäº¤ä½ç§»ï¼Œç­‰å¾…ä¸šåŠ¡æ­£å¸¸å¤„ç†å®Œæˆåï¼Œå†æäº¤offsetã€‚</p><p><strong>4.é€šè¿‡å‰¯æœ¬ LEO æ¥ç¡®å®šåˆ†åŒº HW</strong></p><p>å¯å‚è€ƒç¬¬å››é—®</p><h3 id="_7-åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„-è§£å†³äº†ä»€ä¹ˆé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_7-åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„-è§£å†³äº†ä»€ä¹ˆé—®é¢˜"><span>7. åˆ†åŒºå†åˆ†é…æ˜¯åšä»€ä¹ˆçš„ï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</span></a></h3><p>åˆ†åŒºå†åˆ†é…ä¸»è¦æ˜¯ç”¨æ¥ç»´æŠ¤ kafka é›†ç¾¤çš„è´Ÿè½½å‡è¡¡</p><p>æ—¢ç„¶æ˜¯åˆ†åŒºå†åˆ†é…ï¼Œé‚£ä¹ˆ kafka åˆ†åŒºæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093235.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>é—®é¢˜1</strong>ï¼šå½“é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸‹çº¿äº†</p><ul><li>å¦‚æœè¯¥èŠ‚ç‚¹çš„åˆ†åŒºæ˜¯å•å‰¯æœ¬çš„,é‚£ä¹ˆåˆ†åŒºå°†ä¼šå˜å¾—ä¸å¯ç”¨</li><li>å¦‚æœæ˜¯å¤šå‰¯æœ¬çš„ï¼Œå°±ä¼šè¿›è¡Œ leader é€‰ä¸¾ï¼Œåœ¨å…¶ä»–æœºå™¨ä¸Šé€‰ä¸¾å‡ºæ–°çš„ leader</li></ul><p><strong>kafka å¹¶ä¸ä¼šå°†è¿™äº›å¤±æ•ˆçš„åˆ†åŒºè¿ç§»åˆ°å…¶ä»–å¯ç”¨çš„ broker ä¸Š</strong>ï¼Œè¿™æ ·å°±ä¼šå½±å“é›†ç¾¤çš„è´Ÿè½½å‡è¡¡ï¼Œç”šè‡³ä¹Ÿä¼šå½±å“æœåŠ¡çš„å¯é æ€§å’Œå¯ç”¨æ€§</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093237.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>é—®é¢˜2</strong>ï¼šé›†ç¾¤æ–°å¢ broker æ—¶ï¼Œåªæœ‰æ–°çš„ä¸»é¢˜åˆ†åŒºä¼šåˆ†é…åœ¨è¯¥ broker ä¸Šï¼Œè€Œè€çš„ä¸»é¢˜åˆ†åŒºä¸ä¼šåˆ†é…åœ¨è¯¥ broker ä¸Šï¼Œå°±é€ æˆäº†<strong>è€èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹ä¹‹é—´çš„è´Ÿè½½ä¸å‡è¡¡</strong>ã€‚</p><p>ä¸ºäº†è§£å†³è¯¥é—®é¢˜å°±å‡ºç°äº†åˆ†åŒºå†åˆ†é…ï¼Œå®ƒå¯ä»¥åœ¨é›†ç¾¤æ‰©å®¹ï¼Œbroker å¤±æ•ˆçš„åœºæ™¯ä¸‹è¿›è¡Œåˆ†åŒºè¿ç§»ã€‚</p><p><strong>åˆ†åŒºå†åˆ†é…çš„åŸç†å°±æ˜¯é€šåŒ–æ§åˆ¶å™¨ç»™åˆ†åŒºæ–°å¢æ–°çš„å‰¯æœ¬ï¼Œç„¶åé€šè¿‡ç½‘ç»œæŠŠæ—§çš„å‰¯æœ¬æ•°æ®å¤åˆ¶åˆ°æ–°çš„å‰¯æœ¬ä¸Šï¼Œåœ¨å¤åˆ¶å®Œæˆåï¼Œå°†æ—§å‰¯æœ¬æ¸…é™¤</strong>ã€‚ å½“ç„¶ï¼Œä¸ºäº†ä¸å½±å“é›†ç¾¤æ­£å¸¸çš„æ€§èƒ½ï¼Œåœ¨æ­¤å¤åˆ¶æœŸé—´è¿˜ä¼šæœ‰ä¸€ç³»åˆ—ä¿è¯æ€§èƒ½çš„æ“ä½œï¼Œæ¯”å¦‚<strong>å¤åˆ¶é™æµ</strong>ã€‚</p><h3 id="_8-kafka-partition-å‰¯æœ¬-leader-æ˜¯æ€ä¹ˆé€‰ä¸¾çš„" tabindex="-1"><a class="header-anchor" href="#_8-kafka-partition-å‰¯æœ¬-leader-æ˜¯æ€ä¹ˆé€‰ä¸¾çš„"><span>8. Kafka Partition å‰¯æœ¬ leader æ˜¯æ€ä¹ˆé€‰ä¸¾çš„ï¼Ÿ</span></a></h3><blockquote><p>è¿™ä¸ªé—®é¢˜è®¾è®¡çš„ç‚¹æ¯”è¾ƒå¤šï¼Œæ‹“å±•çš„ä¹Ÿæ›´å¤šä¸€ç‚¹ï¼Œå»ºè®®è€å¿ƒé˜…è¯»ã€‚</p></blockquote><p><strong>å¸¸ç”¨é€‰ä¸»æœºåˆ¶çš„ç¼ºç‚¹ï¼š</strong></p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">split-brain (è„‘è£‚):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">â€‹è¿™æ˜¯ç”±ZooKeeperçš„ç‰¹æ€§å¼•èµ·çš„ï¼Œè™½ç„¶ZooKeeperèƒ½ä¿è¯æ‰€æœ‰WatchæŒ‰é¡ºåºè§¦å‘ï¼Œä½†æ˜¯ç½‘ç»œå»¶è¿Ÿï¼Œå¹¶ä¸èƒ½ä¿è¯åŒä¸€æ—¶åˆ»æ‰€æœ‰Replicaâ€œçœ‹â€åˆ°çš„çŠ¶æ€æ˜¯ä¸€æ ·çš„ï¼Œè¿™å°±å¯èƒ½é€ æˆä¸åŒReplicaçš„å“åº”ä¸ä¸€è‡´ï¼Œå¯èƒ½é€‰å‡ºå¤šä¸ªé¢†å¯¼â€œå¤§è„‘â€ï¼Œå¯¼è‡´â€œè„‘è£‚â€ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">herd effect (ç¾Šç¾¤æ•ˆåº”):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">â€‹å¦‚æœå®•æœºçš„é‚£ä¸ªBrokerä¸Šçš„Partitionæ¯”è¾ƒå¤šï¼Œ ä¼šé€ æˆå¤šä¸ªWatchè¢«è§¦å‘ï¼Œé€ æˆé›†ç¾¤å†…å¤§é‡çš„è°ƒæ•´ï¼Œå¯¼è‡´å¤§é‡ç½‘ç»œé˜»å¡ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ZooKeeperè´Ÿè½½è¿‡é‡:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">â€‹æ¯ä¸ªReplicaéƒ½è¦ä¸ºæ­¤åœ¨ZooKeeperä¸Šæ³¨å†Œä¸€ä¸ªWatchï¼Œå½“é›†ç¾¤è§„æ¨¡å¢åŠ åˆ°å‡ åƒä¸ªPartitionæ—¶ZooKeeperè´Ÿè½½ä¼šè¿‡é‡ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¼˜åŠ¿ï¼š</strong></p><p>Kafkaçš„Leader Electionæ–¹æ¡ˆè§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œå®ƒåœ¨æ‰€æœ‰brokerä¸­é€‰å‡ºä¸€ä¸ªcontrollerï¼Œæ‰€æœ‰Partitionçš„Leaderé€‰ä¸¾éƒ½ç”±controllerå†³å®šã€‚ controllerä¼šå°†Leaderçš„æ”¹å˜ç›´æ¥é€šè¿‡RPCçš„æ–¹å¼(æ¯”ZooKeeper Queueçš„æ–¹å¼æ›´é«˜æ•ˆ)é€šçŸ¥éœ€ä¸ºæ­¤ä½œä¸ºå“åº”çš„Brokerã€‚</p><p>æ²¡æœ‰ä½¿ç”¨ zkï¼Œæ‰€ä»¥æ—  2.3 é—®é¢˜ï¼›ä¹Ÿæ²¡æœ‰æ³¨å†Œ watchæ—  2.2 é—®é¢˜ leader å¤±è´¥äº†ï¼Œå°±é€šè¿‡ controller ç»§ç»­é‡æ–°é€‰ä¸¾å³å¯ï¼Œæ‰€ä»¥å…‹æœæ‰€æœ‰é—®é¢˜ã€‚</p><p><strong>Kafka partition leaderçš„é€‰ä¸¾ï¼š</strong></p><p>ç”± controller æ‰§è¡Œï¼š</p><ul><li>ä»Zookeeperä¸­è¯»å–å½“å‰åˆ†åŒºçš„æ‰€æœ‰ISR(in-sync replicas)é›†åˆ</li><li>è°ƒç”¨é…ç½®çš„åˆ†åŒºé€‰æ‹©ç®—æ³•é€‰æ‹©åˆ†åŒºçš„leader</li></ul><figure><img src="https://tvax1.sinaimg.cn/large/007F3CC8ly1h3dl7rqe24j313c0nm7ik.jpg" alt="åˆ†åŒºé€‰æ‹©ç®—æ³•" tabindex="0" loading="lazy"><figcaption>åˆ†åŒºé€‰æ‹©ç®—æ³•</figcaption></figure><p>ä¸Šé¢äº”ç§åˆ†åŒºç®—æ³•éƒ½æ˜¯é€‰æ‹©PreferredReplica(ä¼˜å…ˆå‰¯æœ¬é€‰ä¸¾)ä½œä¸ºå½“å‰Partitionçš„leaderã€‚åŒºåˆ«ä»…ä»…æ˜¯é€‰æ‹©leaderä¹‹åçš„æ“ä½œæœ‰æ‰€ä¸åŒã€‚</p><h3 id="_9-åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—-ååé‡å°±ä¼šè¶Šé«˜å—" tabindex="-1"><a class="header-anchor" href="#_9-åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—-ååé‡å°±ä¼šè¶Šé«˜å—"><span>9. åˆ†åŒºæ•°è¶Šå¤šè¶Šå¥½å—ï¼Ÿååé‡å°±ä¼šè¶Šé«˜å—ï¼Ÿ</span></a></h3><p>èˆ¬ç±»ä¼¼äºè¿™ç§é—®é¢˜çš„ç­”æ¡ˆï¼Œéƒ½æ˜¯æŒå¦å®šæ€åº¦çš„ã€‚</p><p>ä½†æ˜¯å¯ä»¥è¯´ï¼Œ<strong>åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œåˆ†åŒºæ•°çš„æ•°é‡æ˜¯å’Œååé‡æˆæ­£æ¯”çš„ï¼Œåˆ†åŒºæ•°å’Œæ€§èƒ½ä¹Ÿæ˜¯æˆæ­£æ¯”çš„</strong>ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´è¶…è¿‡äº†ä¸€å®šé™åº¦ï¼Œå°±ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“å‘¢ï¼ŸåŸå› å¦‚ä¸‹:</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093240.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>1.å®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯éœ€è¦ä½¿ç”¨çš„å†…å­˜å°±è¶Šå¤š</strong></p><p>æœåŠ¡ç«¯åœ¨å¾ˆå¤šç»„ä»¶ä¸­éƒ½ç»´æŠ¤äº†åˆ†åŒºçº§åˆ«çš„ç¼“å­˜ï¼Œåˆ†åŒºæ•°è¶Šå¤§ï¼Œç¼“å­˜æˆæœ¬ä¹Ÿå°±è¶Šå¤§ã€‚ æ¶ˆè´¹ç«¯çš„æ¶ˆè´¹çº¿ç¨‹æ•°æ˜¯å’Œåˆ†åŒºæ•°æŒ‚é’©çš„ï¼Œåˆ†åŒºæ•°è¶Šå¤§æ¶ˆè´¹çº¿ç¨‹æ•°ä¹Ÿå°±è¶Šå¤šï¼Œçº¿ç¨‹çš„å¼€é”€æˆæœ¬ä¹Ÿå°±è¶Šå¤§ ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æœ‰ç¼“å­˜çš„æ¦‚å¿µï¼Œä¼šä¸ºæ¯ä¸ªåˆ†åŒºç¼“å­˜æ¶ˆæ¯ï¼Œå½“ç§¯ç´¯åˆ°ä¸€å®šç¨‹åº¦æˆ–è€…æ—¶é—´æ—¶ä¼šå°†æ¶ˆæ¯å‘é€åˆ°åˆ†åŒºï¼Œåˆ†åŒºè¶Šå¤šï¼Œè¿™éƒ¨åˆ†çš„ç¼“å­˜ä¹Ÿå°±è¶Šå¤§</p><p><strong>2.æ–‡ä»¶å¥æŸ„çš„å¼€é”€</strong></p><p>æ¯ä¸ª partition éƒ½ä¼šå¯¹åº”ç£ç›˜æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªç›®å½•ã€‚åœ¨ Kafka çš„æ•°æ®æ—¥å¿—æ–‡ä»¶ç›®å½•ä¸­ï¼Œæ¯ä¸ªæ—¥å¿—æ•°æ®æ®µéƒ½ä¼šåˆ†é…ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªç´¢å¼•æ–‡ä»¶å’Œä¸€ä¸ªæ•°æ®æ–‡ä»¶ã€‚æ¯ä¸ª broker ä¼šä¸ºæ¯ä¸ªæ—¥å¿—æ®µæ–‡ä»¶æ‰“å¼€ä¸€ä¸ª index æ–‡ä»¶å¥æŸ„å’Œä¸€ä¸ªæ•°æ®æ–‡ä»¶å¥æŸ„ã€‚å› æ­¤ï¼Œéšç€ partition çš„å¢å¤šï¼Œæ‰€éœ€è¦ä¿æŒæ‰“å¼€çŠ¶æ€çš„æ–‡ä»¶å¥æŸ„æ•°ä¹Ÿå°±è¶Šå¤šï¼Œæœ€ç»ˆå¯èƒ½è¶…è¿‡åº•å±‚æ“ä½œç³»ç»Ÿé…ç½®çš„æ–‡ä»¶å¥æŸ„æ•°é‡é™åˆ¶ã€‚</p><p><strong>3.è¶Šå¤šçš„åˆ†åŒºå¯èƒ½å¢åŠ ç«¯å¯¹ç«¯çš„å»¶è¿Ÿ</strong></p><p>Kafka ä¼šå°†åˆ†åŒº HW ä¹‹å‰çš„æ¶ˆæ¯æš´éœ²ç»™æ¶ˆè´¹è€…ã€‚åˆ†åŒºè¶Šå¤šåˆ™å‰¯æœ¬ä¹‹é—´çš„åŒæ­¥æ•°é‡å°±è¶Šå¤šï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª broker ä»å…¶ä»– broker èŠ‚ç‚¹è¿›è¡Œæ•°æ®å‰¯æœ¬å¤åˆ¶æ—¶ï¼Œè¯¥ broker èŠ‚ç‚¹åªä¼šä¸ºæ­¤å·¥ä½œåˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹éœ€è¦å®Œæˆè¯¥ broker æ‰€æœ‰ partition æ•°æ®çš„å¤åˆ¶ã€‚</p><p><strong>4.é™ä½é«˜å¯ç”¨æ€§</strong></p><p>åœ¨ç¬¬ 7 é—®æˆ‘ä»¬æåˆ°äº†åˆ†åŒºå†åˆ†é…ï¼Œä¼šå°†æ•°æ®å¤åˆ¶åˆ°å¦ä¸€ä»½å‰¯æœ¬å½“ä¸­ï¼Œ<strong>åˆ†åŒºæ•°é‡è¶Šå¤šï¼Œé‚£ä¹ˆæ¢å¤æ—¶é—´ä¹Ÿå°±è¶Šé•¿</strong>ï¼Œè€Œå¦‚æœå‘ç”Ÿå®•æœºçš„ broker æ°å¥½æ˜¯ controller èŠ‚ç‚¹æ—¶ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–° leader èŠ‚ç‚¹çš„é€‰ä¸¾è¿‡ç¨‹åœ¨ controller èŠ‚ç‚¹æ¢å¤åˆ°æ–°çš„ broker ä¹‹å‰ä¸ä¼šå¯åŠ¨ã€‚controller èŠ‚ç‚¹çš„é”™è¯¯æ¢å¤å°†ä¼šè‡ªåŠ¨åœ°è¿›è¡Œï¼Œä½†æ˜¯æ–°çš„ controller èŠ‚ç‚¹éœ€è¦ä» zookeeper ä¸­è¯»å–æ¯ä¸€ä¸ª partition çš„å…ƒæ•°æ®ä¿¡æ¯ç”¨äºåˆå§‹åŒ–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªKafka é›†ç¾¤å­˜åœ¨ 10000ä¸ªpartitionï¼Œä» zookeeper ä¸­æ¢å¤å…ƒæ•°æ®æ—¶æ¯ä¸ª partition å¤§çº¦èŠ±è´¹ 2 msï¼Œåˆ™ controller çš„æ¢å¤å°†ä¼šå¢åŠ çº¦ 20 ç§’çš„ä¸å¯ç”¨æ—¶é—´çª—å£ã€‚</p><h3 id="_10-kafka-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" tabindex="-1"><a class="header-anchor" href="#_10-kafka-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><span>10. kafka ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</span></a></h3><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093244.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>1.<strong>é¡ºåºè¯»å†™</strong>ç£ç›˜åˆ†ä¸ºé¡ºåºè¯»å†™ä¸éšæœºè¯»å†™ï¼ŒåŸºäºç£ç›˜çš„éšæœºè¯»å†™ç¡®å®å¾ˆæ…¢ï¼Œä½†ç£ç›˜çš„é¡ºåºè¯»å†™æ€§èƒ½å´å¾ˆé«˜ï¼Œkafka è¿™é‡Œé‡‡ç”¨çš„å°±æ˜¯é¡ºåºè¯»å†™ã€‚</p></li><li><p>2.<strong>Page Cache</strong>ä¸ºäº†ä¼˜åŒ–è¯»å†™æ€§èƒ½ï¼ŒKafka åˆ©ç”¨äº†<strong>æ“ä½œç³»ç»Ÿæœ¬èº«çš„ Page Cache</strong>ï¼Œå°±æ˜¯åˆ©ç”¨æ“ä½œç³»ç»Ÿè‡ªèº«çš„å†…å­˜è€Œä¸æ˜¯JVMç©ºé—´å†…å­˜ã€‚</p></li><li><p>3.<strong>é›¶æ‹·è´</strong>Kafkaä½¿ç”¨äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯<strong>ç›´æ¥å°†æ•°æ®ä»å†…æ ¸ç©ºé—´çš„è¯»ç¼“å†²åŒºç›´æ¥æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„ socket ç¼“å†²åŒº</strong>ï¼Œç„¶åå†å†™å…¥åˆ° NIC ç¼“å†²åŒºï¼Œé¿å…äº†åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´ç©¿æ¢­ã€‚</p></li><li><p>4.<strong>åˆ†åŒºåˆ†æ®µ+ç´¢å¼•</strong>Kafka çš„ message æ˜¯æŒ‰ topicåˆ† ç±»å­˜å‚¨çš„ï¼Œtopic ä¸­çš„æ•°æ®åˆæ˜¯æŒ‰ç…§ä¸€ä¸ªä¸€ä¸ªçš„ partition å³åˆ†åŒºå­˜å‚¨åˆ°ä¸åŒ broker èŠ‚ç‚¹ã€‚æ¯ä¸ª partition å¯¹åº”äº†æ“ä½œç³»ç»Ÿä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œpartition å®é™…ä¸Šåˆæ˜¯æŒ‰ç…§segmentåˆ†æ®µå­˜å‚¨çš„ã€‚é€šè¿‡è¿™ç§åˆ†åŒºåˆ†æ®µçš„è®¾è®¡ï¼ŒKafka çš„ message æ¶ˆæ¯å®é™…ä¸Šæ˜¯åˆ†å¸ƒå¼å­˜å‚¨åœ¨ä¸€ä¸ªä¸€ä¸ªå°çš„ segment ä¸­çš„ï¼Œæ¯æ¬¡æ–‡ä»¶æ“ä½œä¹Ÿæ˜¯ç›´æ¥æ“ä½œçš„ segmentã€‚ä¸ºäº†è¿›ä¸€æ­¥çš„æŸ¥è¯¢ä¼˜åŒ–ï¼ŒKafka åˆé»˜è®¤ä¸ºåˆ†æ®µåçš„æ•°æ®æ–‡ä»¶å»ºç«‹äº†ç´¢å¼•æ–‡ä»¶ï¼Œå°±æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸Šçš„.indexæ–‡ä»¶ã€‚è¿™ç§åˆ†åŒºåˆ†æ®µ+ç´¢å¼•çš„è®¾è®¡ï¼Œä¸ä»…æå‡äº†æ•°æ®è¯»å–çš„æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†æ•°æ®æ“ä½œçš„å¹¶è¡Œåº¦ã€‚</p></li><li><p>5.<strong>æ‰¹é‡è¯»å†™Kafka æ•°æ®è¯»å†™ä¹Ÿæ˜¯æ‰¹é‡çš„è€Œä¸æ˜¯å•æ¡çš„</strong>,è¿™æ ·å¯ä»¥é¿å…åœ¨ç½‘ç»œä¸Šé¢‘ç¹ä¼ è¾“å•ä¸ªæ¶ˆæ¯å¸¦æ¥çš„å»¶è¿Ÿå’Œå¸¦å®½å¼€é”€ã€‚å‡è®¾ç½‘ç»œå¸¦å®½ä¸º10MB/Sï¼Œä¸€æ¬¡æ€§ä¼ è¾“10MBçš„æ¶ˆæ¯æ¯”ä¼ è¾“1KBçš„æ¶ˆæ¯10000ä¸‡æ¬¡æ˜¾ç„¶è¦å¿«å¾—å¤šã€‚</p></li><li><p>6.<strong>æ‰¹é‡å‹ç¼©</strong>Kafka æŠŠæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å˜æˆä¸€ä¸ª<strong>æ‰¹é‡çš„æ–‡ä»¶</strong>ï¼Œå¹¶ä¸”è¿›è¡Œåˆç†çš„<strong>æ‰¹é‡å‹ç¼©</strong>ï¼Œå‡å°‘ç½‘ç»œ IO æŸè€—ï¼Œé€šè¿‡ mmap æé«˜ I/O é€Ÿåº¦ï¼Œå†™å…¥æ•°æ®çš„æ—¶å€™ç”±äºå•ä¸ªPartionæ˜¯æœ«å°¾æ·»åŠ æ‰€ä»¥é€Ÿåº¦æœ€ä¼˜ï¼›è¯»å–æ•°æ®çš„æ—¶å€™é…åˆ sendfile è¿›è¡Œç›´æ¥è¯»å–ã€‚</p></li></ul><p>ä½è°·è“„åŠ›</p><h2 id="mybatis" tabindex="-1"><a class="header-anchor" href="#mybatis"><span>MyBatis</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯mybatis" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯mybatis"><span>1. ä»€ä¹ˆæ˜¯MyBatis</span></a></h3><blockquote><p>è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯å¯¹æ¯”JDBCæ¥çœ‹</p></blockquote><ol><li><p>MyBatisæ˜¯ä¸€ä¸ªORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº†JDBC,å¼€å‘æ—¶åªéœ€è¦å…³æ³¨SQLè¯­å¥æœ¬èº«ï¼Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ï¼Œåˆ›å»ºè¿æ¥ï¼Œåˆ›å»ºstatementç­‰å¤æ‚çš„è¿‡ç¨‹ã€‚å¼€å‘äººå‘˜ä¸éœ€è¦ç¼–å†™åŸç”Ÿæ€sqlï¼Œå¯ä»¥ä¸¥æ ¼æ§åˆ¶sqlæ‰§è¡Œæ€§èƒ½ï¼Œçµæ´»åº¦é«˜ã€‚</p></li><li><p>MyBatiså¯ä»¥ä½¿ç”¨xmlæˆ–è€…æ³¨è§£æ¥é…ç½®æ˜ å°„åŸç”Ÿä¿¡æ¯ï¼Œå°†POJOæ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œé¿å…äº†å‡ ä¹æ‰€æœ‰çš„JDBCä»£ç å’Œæ‰‹åŠ¨è®¾ç½®çš„å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚</p></li></ol><h3 id="_2-mybatisçš„ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-mybatisçš„ä¼˜ç‚¹"><span>2. MyBatisçš„ä¼˜ç‚¹</span></a></h3><ol><li><p>åŸºäºSQLè¯­å¥ç¼–ç¨‹ï¼Œç›¸å¯¹çµæ´»ï¼ˆç›¸å¯¹äºhibernateï¼‰ï¼Œæ”¯æŒå†™åŠ¨æ€sqlè¯­å¥å¹¶å¯é‡å¤ä½¿ç”¨ã€‚</p></li><li><p>å‡å°‘ä»£ç é‡ï¼Œæ¶ˆé™¤äº†å†—ä½™ä»£ç ã€‚ï¼ˆç±»ä¼¼äºJDBCçš„å°è£…ï¼‰</p></li><li><p>ä¸Springå®Œç¾é›†æˆã€‚</p></li><li><p>æä¾›æ˜ å°„æ ‡ç­¾æ”¯æŒå­—æ®µå…³ç³»æ˜ å°„ã€‚</p></li></ol><h3 id="_3-å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_3-å’Œ-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><span>3. #{}å’Œ${}çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><ol><li><p><code>#{}</code>é¢„ç¼–è¯‘å¤„ç†ã€æ˜¯å ä½ç¬¦ï¼Œ<code>${}</code>æ˜¯å­—ç¬¦ä¸²æ›¿æ¢ã€æ˜¯æ‹¼æ¥ç¬¦ã€‚</p></li><li><p>ä½¿ç”¨<code>#{}</code>å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢sqlæ³¨å…¥ï¼Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p></li></ol><p>Mybatisåœ¨å¤„ç† <code>#{}</code> çš„æ—¶å€™ä¼šå°†sqlä¸­çš„ <code>#{}</code> æ›¿æ¢æˆï¼Ÿå·ï¼Œè°ƒç”¨PreparedStatementæ¥èµ‹å€¼</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* SQL */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">å¦‚ï¼š</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> #{userName}ï¼›è®¾userName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">javapub</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">çœ‹æ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è§£ææ—¶å°†#{userName}æ›¿æ¢æˆäº† ï¼Ÿ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ?;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ç„¶åå†æŠŠ javapub æ”¾è¿›å»ï¼Œå¤–é¢åŠ ä¸Šå•å¼•å·</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mybatisåœ¨å¤„ç† <code>${}</code> çš„æ—¶å€™å°±æ˜¯æŠŠ <code>${}</code> æ›¿æ¢æˆå˜é‡çš„å€¼ï¼Œè°ƒç”¨Statementæ¥èµ‹å€¼</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* SQL */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">å¦‚ï¼š</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> #{userName}ï¼›è®¾userName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">javapub</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">çœ‹æ—¥å¿—å¯ä»¥å‘ç°å°±æ˜¯ç›´æ¥æŠŠå€¼æ‹¼æ¥ä¸Šå»äº†</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> user </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> javapub;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">è¿™ææœ‰å¯èƒ½å‘ç”Ÿsqlæ³¨å…¥ï¼Œä¸‹é¢ä¸¾äº†ä¸€ä¸ªç®€å•çš„sqlæ³¨å…¥æ¡ˆä¾‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-ä¸€ä¸ª-xml-æ˜ å°„æ–‡ä»¶-éƒ½ä¼šå†™ä¸€ä¸ª-dao-æ¥å£ä¸ä¹‹å¯¹åº”-è¿™ä¸ª-dao-æ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_4-ä¸€ä¸ª-xml-æ˜ å°„æ–‡ä»¶-éƒ½ä¼šå†™ä¸€ä¸ª-dao-æ¥å£ä¸ä¹‹å¯¹åº”-è¿™ä¸ª-dao-æ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ"><span>4. ä¸€ä¸ª Xml æ˜ å°„æ–‡ä»¶ï¼Œéƒ½ä¼šå†™ä¸€ä¸ª Dao æ¥å£ä¸ä¹‹å¯¹åº”ï¼Œè¿™ä¸ª Dao æ¥å£çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆ?</span></a></h3><p>Dao æ¥å£å°±æ˜¯äººä»¬å¸¸è¯´çš„ Mapper æ¥å£ï¼Œæ¥å£çš„å…¨é™åï¼Œå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­çš„ namespace çš„å€¼ï¼Œæ¥å£çš„æ–¹æ³•åå°±æ˜¯æ˜ å°„æ–‡ä»¶ä¸­ <strong>MappedStatement</strong> çš„ id å€¼ï¼Œæ¥å£æ–¹æ³•å†…çš„å‚æ•°å°±æ˜¯ä¼ é€’ç»™ sql çš„å‚æ•°ã€‚</p><p>æ¥å£é‡Œçš„æ–¹æ³•æ˜¯<strong>ä¸èƒ½é‡è½½</strong>çš„ï¼Œå› ä¸ºæ˜¯<strong>å…¨é™å+æ–¹æ³•å</strong>çš„ä¿å­˜å’Œå¯»æ‰¾ç­–ç•¥ã€‚</p><p>Daoæ¥å£çš„å·¥ä½œåŸç†æ˜¯JDKåŠ¨æ€ä»£ç†ï¼ŒMybatisè¿è¡Œæ—¶ä¼š<strong>ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ä¸ºDaoæ¥å£ç”Ÿæˆä»£ç†proxyå¯¹è±¡ï¼Œä»£ç†å¯¹è±¡proxyä¼šæ‹¦æˆªæ¥å£æ–¹æ³•ï¼Œè½¬è€Œæ‰§è¡Œæ¥å£æ–¹æ³•æ‰€å¯¹åº”çš„MappedStatementæ‰€ä»£è¡¨çš„sql</strong>ï¼Œç„¶åå°†sqlæ‰§è¡Œç»“æœè¿”å›ã€‚</p><p>MappedStatementï¼šMappedStatementç»´æŠ¤äº†ä¸€æ¡ &lt;select|update|delete|insert&gt;èŠ‚ç‚¹çš„å°è£…,åŒ…æ‹¬äº†ä¼ å…¥å‚æ•°æ˜ å°„é…ç½®ã€æ‰§è¡Œçš„SQLè¯­å¥ã€ç»“æœæ˜ å°„é…ç½®ç­‰ä¿¡æ¯ã€‚</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;selectAuthorLinkedHashMap&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> resultType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;java.util.LinkedHashMap&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        select id, username from author where id = #{value}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„-ä¸»-é”®å€¼" tabindex="-1"><a class="header-anchor" href="#_5-å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„-ä¸»-é”®å€¼"><span>5. å¦‚ä½•è·å–è‡ªåŠ¨ç”Ÿæˆçš„(ä¸»)é”®å€¼?</span></a></h3><p><strong>ç”¨æ³•ï¼š</strong></p><p>åœ¨ <code>&lt;insert /&gt;</code> æ ‡ç­¾ä¸­æ·»åŠ  <code>useGeneratedKeys=&quot;true&quot;</code> ç­‰å±æ€§</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">insert</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;insert&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> useGeneratedKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> keyProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> keyColumn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;id&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;">        parameterType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;person&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    INSERT INTO person(name, pswd)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    VALUE (#{name}, #{pswd})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">insert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ Mybatis è§£æ xmlèŠ‚ç‚¹æ—¶ï¼Œè¯»åˆ° <code>insert</code> æœ‰é…ç½®æ—¶ï¼Œä¼šåˆ¤æ–­æ˜¯å¦ æœ‰é…ç½® <code>useGeneratedKeys</code>ï¼Œå¦‚æœæœ‰åˆ™ä¼šä½¿ç”¨ <code>Jdbc3KeyGenerator</code> ä½œä¸ºsqlå›æ˜¾ï¼Œå¦åˆ™ä¼šä»¥ <code>NoKeyGenerator</code> ä½œä¸ºä¸»é”®å›æ˜¾ã€‚</p><p>åº•å±‚å°è£…äº†JDBCè·å–è‡ªå¢ä¸»é”®ï¼Œå³å½“ä½¿ç”¨ prepareStatement æˆ–è€… Statementæ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ <code>getGeneratedKeys</code> è·å–è¿™æ¡æ’å…¥è¯­å¥çš„è‡ªå¢è€Œæˆçš„ä¸»é”®ã€‚ä¾‹å­</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> conn </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> DriverManager</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(url, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;root&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;123456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">[] columnNames </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    PreparedStatement</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stmt </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> conn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">prepareStatement</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(sql, columnNames);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    stmt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;jack wang&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    stmt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">executeUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    ResultSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> rs </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stmt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getGeneratedKeys</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        id </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> rs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getInt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;----------&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-mybatis-åŠ¨æ€-sql-æœ‰ä»€ä¹ˆç”¨-æœ‰å“ªäº›åŠ¨æ€-sql-æ‰§è¡ŒåŸç†" tabindex="-1"><a class="header-anchor" href="#_6-mybatis-åŠ¨æ€-sql-æœ‰ä»€ä¹ˆç”¨-æœ‰å“ªäº›åŠ¨æ€-sql-æ‰§è¡ŒåŸç†"><span>6. Mybatis åŠ¨æ€ sql æœ‰ä»€ä¹ˆç”¨ï¼Ÿæœ‰å“ªäº›åŠ¨æ€ sqlï¼Ÿæ‰§è¡ŒåŸç†ï¼Ÿ</span></a></h3><p>Mybatis åŠ¨æ€ sql å¯ä»¥è®©æˆ‘ä»¬åœ¨ Xml æ˜ å°„æ–‡ä»¶å†…ï¼Œä»¥æ ‡ç­¾çš„å½¢å¼ç¼–å†™åŠ¨æ€ sqlï¼Œå®Œæˆé€»è¾‘åˆ¤æ–­å’ŒåŠ¨æ€æ‹¼æ¥ sql çš„åŠŸèƒ½ã€‚</p><p>Mybatis æä¾›äº†9ç§åŠ¨æ€sqlæ ‡ç­¾ï¼š <strong>trim | where | set | foreach | if | choose | when | otherwise | bind</strong>ã€‚</p><p>å…¶æ‰§è¡ŒåŸç†ä¸ºï¼Œä½¿ç”¨ OGNL ä» sql å‚æ•°å¯¹è±¡ä¸­è®¡ç®—è¡¨è¾¾å¼çš„å€¼ï¼Œæ ¹æ®è¡¨è¾¾å¼çš„å€¼åŠ¨æ€æ‹¼æ¥ sqlï¼Œä»¥æ­¤æ¥å®ŒæˆåŠ¨æ€ sql çš„åŠŸèƒ½ã€‚</p><p>æ˜¯ä¸æ˜¯æœ‰ç‚¹æ‡µï¼Œç»§ç»­é˜…è¯»ï¼š</p><p><strong>ç§‘æ™®ï¼š</strong></p><p>OGNL æ˜¯ Object-Graph Navigation Language çš„ç¼©å†™ï¼Œå¯¹è±¡å›¾å¯¼èˆªè¯­è¨€ã€‚ä¾‹å¦‚ <code>#{}</code> è¯­æ³•ã€‚</p><p>OGNL ä½œç”¨æ˜¯åœ¨å¯¹è±¡å’Œè§†å›¾ä¹‹é—´åšæ•°æ®çš„äº¤äº’ï¼Œå¯ä»¥å­˜å–å¯¹è±¡çš„å±æ€§å’Œè°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œé€šè¿‡è¡¨è¾¾å¼å¯ä»¥è¿­ä»£å‡ºæ•´ä¸ªå¯¹è±¡çš„ç»“æ„å›¾ã€‚</p><p>å‚è€ƒä¸€ä¸ªå¾ˆå½¢è±¡çš„ä¾‹å­ã€‚</p><p>æœ‰ä¸€ä¸ªå­¦ç”Ÿå¯¹è±¡ studentï¼Œå±æ€§åˆ†åˆ«æœ‰ id = 10ï¼Œname = &#39;å°æ˜&#39; å’Œ è¯¾ç¨‹å¯¹è±¡ courseï¼Œå…¶ä¸­ course å¯¹è±¡ä¸­å±æ€§æœ‰ï¼šåˆ†æ•° score = 88ï¼Œæ’å rank = 5ã€‚</p><p>å¯¹è±¡å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">student</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    idï¼š10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    nameï¼šå°æ˜</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    courseï¼š</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        scoreï¼š88</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        rankï¼š5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¸Šä¸‹æ–‡ï¼ˆç¯å¢ƒï¼‰ä¸­çš„å¯¹è±¡ä¸º student çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åœ¨ Mybatis ä¸­æŸ¥è¯¢æ—¶ä¼ å…¥çš„å‚æ•°å¯¹è±¡ä¸º student çš„æ—¶å€™ï¼š</p><p>é€šè¿‡ OGNL è¡¨è¾¾å¼ç›´æ¥è·å–ä¸Šä¸‹æ–‡ä¸­å¯¹è±¡çš„å±æ€§å€¼ï¼Œæ¯”å¦‚ï¼š</p><p>#{id} â€”&gt; 10ï¼Œç›¸å¯¹äºå½“å‰ä¸Šä¸‹æ–‡å¯¹è±¡.getId()ï¼Œå³ student.getId() ã€‚</p><p>#{name} â€”&gt; å°æ˜ã€‚</p><p>#{course.score} â€”&gt; 88ï¼Œç›¸å½“äº student.getCourse().getScore()ã€‚</p><p>æ‰€ä»¥ï¼Œé€šè¿‡ OGNL è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿­ä»£å‡ºæ•´ä¸ªå¯¹è±¡çš„ç»“æ„å›¾ã€‚</p><p>å‘å¸ƒ <a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzNDUyOTY0Nw==&amp;action=getalbum&amp;album_id=2344061143381508097#wechat_redirect" target="_blank" rel="noopener noreferrer">ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹</a></p><h3 id="_7-ä»€ä¹ˆæ˜¯mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_7-ä»€ä¹ˆæ˜¯mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜"><span>7. ä»€ä¹ˆæ˜¯Mybatisçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜?</span></a></h3><p><strong>ä¸€çº§ç¼“å­˜</strong>: åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Sessionï¼Œå½“ Session flush æˆ– close ä¹‹åï¼Œè¯¥ Session ä¸­çš„æ‰€æœ‰ Cache å°±å°†æ¸…ç©ºï¼Œé»˜è®¤ä¸€çº§ç¼“å­˜æ˜¯å¼€å¯çš„ã€‚</p><p>å½“Mybaitsä¸Springæ•´åˆçš„æ—¶å€™ï¼Œä¸å¸¦Springäº‹åŠ¡çš„æ–¹æ³•å†…ï¼Œæ¯æ¬¡è¯·æ±‚æ•°æ®åº“ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªSqlSessionï¼Œè¿™æ—¶å€™æ˜¯ä½¿ç”¨ä¸åˆ°ä¸€çº§ç¼“å­˜çš„ã€‚é™¤äº†äº‹åŠ¡é—®é¢˜ï¼Œè¿˜æœ‰è°ƒç”¨äº†Sqlsessionçš„ä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤ã€commit()ã€close()ç­‰æ–¹æ³•æ—¶ï¼Œä¸€çº§ç¼“å­˜ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚</p><p><strong>äºŒçº§ç¼“å­˜</strong>ä¸ä¸€çº§ç¼“å­˜å…¶æœºåˆ¶ç›¸åŒï¼Œé»˜è®¤ä¹Ÿæ˜¯é‡‡ç”¨ PerpetualCacheï¼ŒHashMap å­˜å‚¨ï¼Œä¸åŒåœ¨äºå…¶å­˜å‚¨ä½œç”¨åŸŸä¸º Mapper(Namespace)ã€‚å³ä½¿å¼€å¯äº†äºŒçº§ç¼“å­˜ï¼Œä¸åŒçš„sqlsessionä¹‹é—´çš„ç¼“å­˜æ•°æ®ä¹Ÿä¸æ˜¯æƒ³äº’è®¿å°±èƒ½äº’è®¿çš„ï¼Œå¿…é¡»ç­‰åˆ°sqlsessionå…³é—­äº†ä»¥åï¼Œæ‰ä¼šæŠŠå…¶ä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®å†™å…¥äºŒçº§ç¼“å­˜ã€‚é»˜è®¤ä¸æ‰“å¼€äºŒçº§ç¼“å­˜ã€‚</p><p>ç°åœ¨å¤§å¤šæ•°åº”ç”¨éƒ½æ˜¯æ”¯æŒåˆ†å¸ƒå¼çš„ï¼Œä¸€èˆ¬æƒ…å†µéƒ½æ˜¯ç”¨ä¸­é—´ä»¶ä½œä¸ºç¼“å­˜å±‚ï¼Œæ¯”å¦‚redisã€‚å¼€å¯ MyBatis çš„äºŒçº§ç¼“å­˜ä¹Ÿä¼šå¤šä¸€æ­¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå½±å“æœåŠ¡æ€§èƒ½ã€‚</p><h3 id="_8-mybatisçš„å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#_8-mybatisçš„å·¥ä½œåŸç†"><span>8. MyBatisçš„å·¥ä½œåŸç†</span></a></h3><p>ä¸€å›¾èƒœåƒæ–‡</p><figure><img src="https://tvax2.sinaimg.cn/large/007F3CC8ly1h3i5df8ddbj30l90ir0uj.jpg" alt="æ¥æºç½‘ç»œ" tabindex="0" loading="lazy"><figcaption>æ¥æºç½‘ç»œ</figcaption></figure><ol><li><p>è¯»å– MyBatis é…ç½®æ–‡ä»¶ï¼šmybatis-config.xml ä¸º MyBatis çš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œé…ç½®äº† MyBatis çš„è¿è¡Œç¯å¢ƒç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚</p></li><li><p>åŠ è½½æ˜ å°„æ–‡ä»¶ã€‚æ˜ å°„æ–‡ä»¶å³ SQL æ˜ å°„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­é…ç½®äº†æ“ä½œæ•°æ®åº“çš„ SQL è¯­å¥ï¼Œéœ€è¦åœ¨ MyBatis é…ç½®æ–‡ä»¶ mybatis-config.xml ä¸­åŠ è½½ã€‚mybatis-config.xml æ–‡ä»¶å¯ä»¥åŠ è½½å¤šä¸ªæ˜ å°„æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚</p></li><li><p>æ„é€ ä¼šè¯å·¥å‚ï¼šé€šè¿‡ MyBatis çš„ç¯å¢ƒç­‰é…ç½®ä¿¡æ¯æ„å»ºä¼šè¯å·¥å‚ SqlSessionFactoryã€‚</p></li><li><p>åˆ›å»ºä¼šè¯å¯¹è±¡ï¼šç”±ä¼šè¯å·¥å‚åˆ›å»º SqlSession å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†æ‰§è¡Œ SQL è¯­å¥çš„æ‰€æœ‰æ–¹æ³•ã€‚</p></li><li><p>Executor æ‰§è¡Œå™¨ï¼šMyBatis åº•å±‚å®šä¹‰äº†ä¸€ä¸ª Executor æ¥å£æ¥æ“ä½œæ•°æ®åº“ï¼Œå®ƒå°†æ ¹æ® SqlSession ä¼ é€’çš„å‚æ•°åŠ¨æ€åœ°ç”Ÿæˆéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼ŒåŒæ—¶è´Ÿè´£æŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ã€‚</p></li><li><p>MappedStatement å¯¹è±¡ï¼šåœ¨ Executor æ¥å£çš„æ‰§è¡Œæ–¹æ³•ä¸­æœ‰ä¸€ä¸ª MappedStatement ç±»å‹çš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯å¯¹æ˜ å°„ä¿¡æ¯çš„å°è£…ï¼Œç”¨äºå­˜å‚¨è¦æ˜ å°„çš„ SQL è¯­å¥çš„ idã€å‚æ•°ç­‰ä¿¡æ¯ã€‚</p></li><li><p>è¾“å…¥å‚æ•°æ˜ å°„ï¼šè¾“å…¥å‚æ•°ç±»å‹å¯ä»¥æ˜¯ Mapã€List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å…¥å‚æ•°æ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ preparedStatement å¯¹è±¡è®¾ç½®å‚æ•°çš„è¿‡ç¨‹ã€‚</p></li><li><p>è¾“å‡ºç»“æœæ˜ å°„ï¼šè¾“å‡ºç»“æœç±»å‹å¯ä»¥æ˜¯ Mapã€ List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å‡ºç»“æœæ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ç»“æœé›†çš„è§£æè¿‡ç¨‹ã€‚</p></li></ol><h3 id="_9-ä»€ä¹ˆæ˜¯mybatisçš„æ¥å£ç»‘å®š-æœ‰å“ªäº›å®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_9-ä»€ä¹ˆæ˜¯mybatisçš„æ¥å£ç»‘å®š-æœ‰å“ªäº›å®ç°æ–¹å¼"><span>9. ä»€ä¹ˆæ˜¯MyBatisçš„æ¥å£ç»‘å®šï¼Ÿæœ‰å“ªäº›å®ç°æ–¹å¼ï¼Ÿ</span></a></h3><p>æ¥å£ç»‘å®šï¼Œå°±æ˜¯åœ¨ MyBatis ä¸­ä»»æ„å®šä¹‰æ¥å£ï¼Œç„¶åæŠŠæ¥å£é‡Œé¢çš„æ–¹æ³•å’ŒSQLè¯­å¥ç»‘å®šï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨æ¥å£æ–¹æ³•å°±å¯ä»¥ï¼Œè¿™æ ·æ¯”èµ·åŸæ¥çš„SqlSessionæä¾›çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥æœ‰æ›´åŠ çµæ´»çš„é€‰æ‹©å’Œè®¾ç½®ã€‚</p><p>æ¥å£ç»‘å®šæœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><ul><li><p>é€šè¿‡<strong>æ³¨è§£ç»‘å®š</strong>ï¼Œå°±æ˜¯åœ¨æ¥å£çš„æ–¹æ³•ä¸Šé¢åŠ ä¸Š @Selectã€@Update ç­‰æ³¨è§£ï¼Œé‡Œé¢åŒ…å«Sqlè¯­å¥æ¥ç»‘å®šï¼›</p></li><li><p>é€šè¿‡<strong>xml</strong>é‡Œé¢å†™SQLæ¥ç»‘å®šï¼Œ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦æŒ‡å®šxmlæ˜ å°„æ–‡ä»¶é‡Œé¢çš„ namespace å¿…é¡»ä¸ºæ¥å£çš„å…¨è·¯å¾„åã€‚å½“Sqlè¯­å¥æ¯”è¾ƒç®€å•æ—¶å€™ï¼Œç”¨æ³¨è§£ç»‘å®šï¼Œ å½“SQLè¯­å¥æ¯”è¾ƒå¤æ‚æ—¶å€™ï¼Œç”¨xmlç»‘å®šï¼Œä¸€èˆ¬ç”¨xmlç»‘å®šçš„æ¯”è¾ƒå¤šã€‚</p></li></ul><h3 id="_10-mybatisçš„åˆ†é¡µåŸç†" tabindex="-1"><a class="header-anchor" href="#_10-mybatisçš„åˆ†é¡µåŸç†"><span>10. Mybatisçš„åˆ†é¡µåŸç†</span></a></h3><p>Mybatis ä½¿ç”¨ RowBounds å¯¹è±¡è¿›è¡Œåˆ†é¡µï¼Œå®ƒæ˜¯é’ˆå¯¹ResultSetç»“æœé›†æ‰§è¡Œçš„å†…å­˜åˆ†é¡µï¼Œè€Œéç‰©ç†åˆ†é¡µï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ã€‚å¯ä»¥åœ¨sqlå†…ç›´æ¥ä¹¦å†™å¸¦æœ‰ç‰©ç†åˆ†é¡µçš„å‚æ•°æ¥å®Œæˆç‰©ç†åˆ†é¡µåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶æ¥å®Œæˆç‰©ç†åˆ†é¡µã€‚</p><p>åˆ†é¡µæ’ä»¶çš„åŸç†å°±æ˜¯ä½¿ç”¨ MyBatis æä¾›çš„æ’ä»¶æ¥å£ï¼Œå®ç°è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ’ä»¶çš„æ‹¦æˆªæ–¹æ³•å†…ï¼Œæ‹¦æˆªå¾…æ‰§è¡Œçš„SQLï¼Œç„¶åæ ¹æ®è®¾ç½®çš„ dialectï¼ˆæ–¹è¨€ï¼‰ï¼Œå’Œè®¾ç½®çš„åˆ†é¡µå‚æ•°ï¼Œé‡å†™SQL ï¼Œç”Ÿæˆå¸¦æœ‰åˆ†é¡µè¯­å¥çš„SQLï¼Œæ‰§è¡Œé‡å†™åçš„SQLï¼Œä»è€Œå®ç°åˆ†é¡µã€‚</p><p>ä¸¾ä¾‹ï¼š<code>select * from student</code>ï¼Œæ‹¦æˆªsqlåé‡å†™ä¸ºï¼š<code>select t.* from ï¼ˆselect * from studentï¼‰t limit 0ï¼Œ10</code>ã€‚</p><h2 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql"><span>MySQL</span></a></h2><p>æ¨èä¸€ç¯‡éå¸¸ä¸é”™çš„æ–‡ç« ï¼Œé˜…è¯»åæ›´æœ‰åˆ©äºäº†è§£MySQLã€Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ã€‘ï¼š <a href="https://mp.weixin.qq.com/s/RWkc2lNarKnn8Dc0HrP58g" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/RWkc2lNarKnn8Dc0HrP58g</a></p><hr><h3 id="_1-mysqlæœ‰å“ªå‡ ç§log" tabindex="-1"><a class="header-anchor" href="#_1-mysqlæœ‰å“ªå‡ ç§log"><span>1. mysqlæœ‰å“ªå‡ ç§log</span></a></h3><p>é‡åšæ—¥å¿—(redo log)ã€å›æ»šæ—¥å¿—(undo log)ã€äºŒè¿›åˆ¶æ—¥å¿—(binlog)ã€é”™è¯¯æ—¥å¿—(errorlog)ã€æ…¢æŸ¥è¯¢æ—¥å¿—(slow query log)ã€ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—(general log)ï¼Œä¸­ç»§æ—¥å¿—(relay log)</p><p>é”™è¯¯æ—¥å¿—ï¼šè®°å½•å‡ºé”™ä¿¡æ¯ï¼Œä¹Ÿè®°å½•ä¸€äº›è­¦å‘Šä¿¡æ¯æˆ–è€…æ­£ç¡®çš„ä¿¡æ¯ã€‚</p><p>æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰å¯¹æ•°æ®åº“è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¸è®ºè¿™äº›è¯·æ±‚æ˜¯å¦å¾—åˆ°äº†æ­£ç¡®çš„æ‰§è¡Œã€‚</p><p>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šè®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå°†è¿è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼çš„æ‰€æœ‰SQLè¯­å¥éƒ½è®°å½•åˆ°æ…¢æŸ¥è¯¢çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p><p>äºŒè¿›åˆ¶æ—¥å¿—ï¼šè®°å½•å¯¹æ•°æ®åº“æ‰§è¡Œæ›´æ”¹çš„æ‰€æœ‰æ“ä½œã€‚</p><p>ä¸­ç»§æ—¥å¿—ï¼šä¸­ç»§æ—¥å¿—ä¹Ÿæ˜¯äºŒè¿›åˆ¶æ—¥å¿—ï¼Œç”¨æ¥ç»™slave åº“æ¢å¤</p><p>äº‹åŠ¡æ—¥å¿—ï¼šé‡åšæ—¥å¿—redoå’Œå›æ»šæ—¥å¿—undo</p><hr><h3 id="_2-mysqlçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-mysqlçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹"><span>2. MySQLçš„å¤åˆ¶åŸç†ä»¥åŠæµç¨‹</span></a></h3><ol><li>ä¸»ï¼šbinlogçº¿ç¨‹â€”â€”è®°å½•ä¸‹æ‰€æœ‰æ”¹å˜äº†æ•°æ®åº“æ•°æ®çš„è¯­å¥ï¼Œæ”¾è¿›masterä¸Šçš„binlogä¸­ã€‚</li><li>ä»ï¼šioçº¿ç¨‹â€”â€”åœ¨ä½¿ç”¨start slave ä¹‹åï¼Œè´Ÿè´£ä»masterä¸Šæ‹‰å– binlog å†…å®¹ï¼Œæ”¾è¿› è‡ªå·±çš„relay logä¸­ã€‚</li><li>ä»ï¼šsqlæ‰§è¡Œçº¿ç¨‹â€”â€”æ‰§è¡Œrelay logä¸­çš„è¯­å¥ã€‚</li></ol><hr><h3 id="_3-äº‹ç‰©çš„4ç§éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#_3-äº‹ç‰©çš„4ç§éš”ç¦»çº§åˆ«"><span>3. äº‹ç‰©çš„4ç§éš”ç¦»çº§åˆ«</span></a></h3><p>éš”ç¦»å¼ºåº¦é€æ¸å¢å¼ºï¼Œæ€§èƒ½é€æ¸å˜å·®ã€‚</p><ul><li>è¯»æœªæäº¤(RU) READ UNCOMMITTED</li><li>è¯»å·²æäº¤(RC) READ COMMITT</li><li>å¯é‡å¤è¯»(RR) REPEATABLE READ</li><li>ä¸²è¡ŒåŒ– SERIALIZABLE</li></ul><p>äº‹åŠ¡å…·æœ‰åŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰å››ä¸ªç‰¹æ€§ï¼Œç®€ç§° ACIDï¼Œç¼ºä¸€ä¸å¯ã€‚</p><hr><h3 id="_4-ç›¸å…³æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_4-ç›¸å…³æ¦‚å¿µ"><span>4. ç›¸å…³æ¦‚å¿µ</span></a></h3><p><strong>è„è¯»</strong></p><p>è„è¯»æŒ‡çš„æ˜¯è¯»åˆ°äº†å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œæœªæäº¤æ„å‘³ç€è¿™äº›æ•°æ®å¯èƒ½ä¼šå›æ»šï¼Œä¹Ÿå°±æ˜¯å¯èƒ½æœ€ç»ˆä¸ä¼šå­˜åˆ°æ•°æ®åº“ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨çš„æ•°æ®ã€‚è¯»åˆ°äº†å¹¶ä¸€å®šæœ€ç»ˆå­˜åœ¨çš„æ•°æ®ï¼Œè¿™å°±æ˜¯è„è¯»ã€‚</p><p><strong>å¯é‡å¤è¯»</strong></p><p>å¯é‡å¤è¯»æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ï¼Œæœ€å¼€å§‹è¯»åˆ°çš„æ•°æ®å’Œäº‹åŠ¡ç»“æŸå‰çš„ä»»æ„æ—¶åˆ»è¯»åˆ°çš„åŒä¸€æ‰¹æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚é€šå¸¸é’ˆå¯¹æ•°æ®æ›´æ–°ï¼ˆUPDATEï¼‰æ“ä½œã€‚</p><p><strong>ä¸å¯é‡å¤è¯»</strong></p><p>å¯¹æ¯”å¯é‡å¤è¯»ï¼Œä¸å¯é‡å¤è¯»æŒ‡çš„æ˜¯åœ¨åŒä¸€äº‹åŠ¡å†…ï¼Œä¸åŒçš„æ—¶åˆ»è¯»åˆ°çš„åŒä¸€æ‰¹æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯èƒ½ä¼šå—åˆ°å…¶ä»–äº‹åŠ¡çš„å½±å“ï¼Œæ¯”å¦‚å…¶ä»–äº‹åŠ¡æ”¹äº†è¿™æ‰¹æ•°æ®å¹¶æäº¤äº†ã€‚é€šå¸¸é’ˆå¯¹æ•°æ®æ›´æ–°ï¼ˆUPDATEï¼‰æ“ä½œã€‚</p><p><strong>å¹»è¯»</strong></p><p>å¹»è¯»æ˜¯é’ˆå¯¹æ•°æ®æ’å…¥ï¼ˆINSERTï¼‰æ“ä½œæ¥è¯´çš„ã€‚å‡è®¾äº‹åŠ¡ A å¯¹æŸäº›è¡Œçš„å†…å®¹ä½œäº†æ›´æ”¹ï¼Œä½†æ˜¯è¿˜æœªæäº¤ï¼Œæ­¤æ—¶äº‹åŠ¡ B æ’å…¥äº†ä¸äº‹åŠ¡ A æ›´æ”¹å‰çš„è®°å½•ç›¸åŒçš„è®°å½•è¡Œï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡ A æäº¤ä¹‹å‰å…ˆæäº¤äº†ï¼Œè€Œè¿™æ—¶ï¼Œåœ¨äº‹åŠ¡ A ä¸­æŸ¥è¯¢ï¼Œä¼šå‘ç°å¥½åƒåˆšåˆšçš„æ›´æ”¹å¯¹äºæŸäº›æ•°æ®æœªèµ·ä½œç”¨ï¼Œä½†å…¶å®æ˜¯äº‹åŠ¡ B åˆšæ’å…¥è¿›æ¥çš„ï¼Œè®©ç”¨æˆ·æ„Ÿè§‰å¾ˆé­”å¹»ï¼Œæ„Ÿè§‰å‡ºç°äº†å¹»è§‰ï¼Œè¿™å°±å«å¹»è¯»ã€‚</p><hr><h3 id="_5-mysqlæ•°æ®åº“å‡ ä¸ªåŸºæœ¬çš„ç´¢å¼•ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_5-mysqlæ•°æ®åº“å‡ ä¸ªåŸºæœ¬çš„ç´¢å¼•ç±»å‹"><span>5. MySQLæ•°æ®åº“å‡ ä¸ªåŸºæœ¬çš„ç´¢å¼•ç±»å‹</span></a></h3><p>æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€ä¸»é”®ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•</p><hr><h3 id="_6-dropã€deleteä¸truncateçš„åŒº" tabindex="-1"><a class="header-anchor" href="#_6-dropã€deleteä¸truncateçš„åŒº"><span>6. dropã€deleteä¸truncateçš„åŒº</span></a></h3><p>SQLä¸­çš„dropã€deleteã€truncateéƒ½è¡¨ç¤ºåˆ é™¤ï¼Œä½†æ˜¯ä¸‰è€…æœ‰ä¸€äº›å·®åˆ«</p><p>1ã€deleteå’Œtruncateåªåˆ é™¤è¡¨çš„æ•°æ®ä¸åˆ é™¤è¡¨çš„ç»“æ„ 2ã€é€Ÿåº¦,ä¸€èˆ¬æ¥è¯´: drop&gt; truncate &gt;delete 3ã€deleteè¯­å¥æ˜¯dml,è¿™ä¸ªæ“ä½œä¼šæ”¾åˆ°rollback segementä¸­,äº‹åŠ¡æäº¤ä¹‹åæ‰ç”Ÿæ•ˆ; 4ã€å¦‚æœæœ‰ç›¸åº”çš„trigger,æ‰§è¡Œçš„æ—¶å€™å°†è¢«è§¦å‘. truncate,dropæ˜¯ddl, æ“ä½œç«‹å³ç”Ÿæ•ˆ,åŸæ•°æ®ä¸æ”¾åˆ°rollback segmentä¸­,ä¸èƒ½å›æ»š. æ“ä½œä¸è§¦å‘trigger.</p><hr><h3 id="_7-æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_7-æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆ"><span>7. æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p><strong>æ‚²è§‚é”</strong>çš„ç‰¹ç‚¹æ˜¯å…ˆè·å–é”ï¼Œå†è¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œå³ â€œæ‚²è§‚â€ çš„è®¤ä¸ºè·å–é”æ˜¯éå¸¸æœ‰å¯èƒ½å¤±è´¥çš„ï¼Œå› æ­¤è¦å…ˆç¡®ä¿è·å–é”æˆåŠŸå†è¿›è¡Œä¸šåŠ¡æ“ä½œã€‚é€šå¸¸æ‰€è¯´çš„ â€œä¸€é”äºŒæŸ¥ä¸‰æ›´æ–°â€ å³æŒ‡çš„æ˜¯ä½¿ç”¨æ‚²è§‚é”ã€‚</p><p>é€šå¸¸æ¥è®²åœ¨æ•°æ®åº“ä¸Šçš„æ‚²è§‚é”éœ€è¦æ•°æ®åº“æœ¬èº«æä¾›æ”¯æŒï¼Œå³é€šè¿‡å¸¸ç”¨çš„ select â€¦ for update æ“ä½œæ¥å®ç°æ‚²è§‚é”ã€‚ã€€å½“æ•°æ®åº“æ‰§è¡Œ select for update æ—¶ä¼šè·å–è¢« select ä¸­çš„æ•°æ®è¡Œçš„è¡Œé”ï¼Œå› æ­¤å…¶ä»–å¹¶å‘æ‰§è¡Œçš„ select for update å¦‚æœè¯•å›¾é€‰ä¸­åŒä¸€è¡Œåˆ™ä¼šå‘ç”Ÿæ’æ–¥ï¼ˆéœ€è¦ç­‰å¾…è¡Œé”è¢«é‡Šæ”¾ï¼‰ï¼Œå› æ­¤è¾¾åˆ°é”çš„æ•ˆæœã€‚select for update è·å–çš„è¡Œé”ä¼šåœ¨å½“å‰äº‹åŠ¡ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œå› æ­¤å¿…é¡»åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ã€‚</p><p>mysql è¿˜æœ‰ä¸ªé—®é¢˜æ˜¯ selectâ€¦ for update è¯­å¥æ‰§è¡Œä¸­ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰æ·»åŠ ç´¢å¼•æˆ–ä¸»é”®ï¼Œæ‰€æœ‰æ‰«æè¿‡çš„è¡Œéƒ½ä¼šè¢«é”ä¸Šï¼Œè¿™ä¸€ç‚¹å¾ˆå®¹æ˜“é€ æˆé—®é¢˜ã€‚å› æ­¤å¦‚æœåœ¨ mysql ä¸­ç”¨æ‚²è§‚é”åŠ¡å¿…è¦ç¡®å®šèµ°äº†ç´¢å¼•ï¼Œè€Œä¸æ˜¯å…¨è¡¨æ‰«æã€‚</p><p><strong>ä¹è§‚é”</strong>çš„ç‰¹ç‚¹å…ˆè¿›è¡Œä¸šåŠ¡æ“ä½œï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ä¸å»æ‹¿é”ã€‚å³â€œä¹è§‚â€çš„è®¤ä¸ºæ‹¿é”å¤šåŠæ˜¯ä¼šæˆåŠŸçš„ï¼Œå› æ­¤åœ¨è¿›è¡Œå®Œä¸šåŠ¡æ“ä½œéœ€è¦å®é™…æ›´æ–°æ•°æ®çš„æœ€åä¸€æ­¥å†å»æ‹¿ä¸€ä¸‹é”å°±å¥½ã€‚</p><p>ä¹è§‚é”åœ¨æ•°æ®åº“ä¸Šçš„å®ç°å®Œå…¨æ˜¯é€»è¾‘çš„ï¼Œä¸éœ€è¦æ•°æ®åº“æä¾›ç‰¹æ®Šçš„æ”¯æŒã€‚ä¸€èˆ¬çš„åšæ³•æ˜¯åœ¨éœ€è¦é”çš„æ•°æ®ä¸Šå¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæˆ–è€…æ—¶é—´æˆ³ã€‚</p><p><strong>ä¹è§‚é”çš„ä¸¤ç§å®ç°æ–¹å¼ï¼š</strong></p><ol><li><p>ä½¿ç”¨æ•°æ®ç‰ˆæœ¬ï¼ˆVersionï¼‰è®°å½•æœºåˆ¶å®ç°ï¼Œè¿™æ˜¯ä¹è§‚é”æœ€å¸¸ç”¨çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ä½•è°“æ•°æ®ç‰ˆæœ¬ï¼Ÿå³ä¸ºæ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸ºæ•°æ®åº“è¡¨å¢åŠ ä¸€ä¸ªæ•°å­—ç±»å‹çš„ â€œversionâ€ å­—æ®µæ¥å®ç°ã€‚å½“è¯»å–æ•°æ®æ—¶ï¼Œå°† version å­—æ®µçš„å€¼ä¸€åŒè¯»å‡ºï¼Œæ•°æ®æ¯æ›´æ–°ä¸€æ¬¡ï¼Œå¯¹æ­¤ version å€¼åŠ ä¸€ã€‚å½“æˆ‘ä»¬æäº¤æ›´æ–°çš„æ—¶å€™ï¼Œåˆ¤æ–­æ•°æ®åº“è¡¨å¯¹åº”è®°å½•çš„å½“å‰ç‰ˆæœ¬ä¿¡æ¯ä¸ç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„ version å€¼è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ•°æ®åº“è¡¨å½“å‰ç‰ˆæœ¬å·ä¸ç¬¬ä¸€æ¬¡å–å‡ºæ¥çš„ version å€¼ç›¸ç­‰ï¼Œåˆ™äºˆä»¥æ›´æ–°ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯è¿‡æœŸæ•°æ®ã€‚</p></li><li><p>ä¹è§‚é”å®šçš„ç¬¬äºŒç§å®ç°æ–¹å¼å’Œç¬¬ä¸€ç§å·®ä¸å¤šï¼ŒåŒæ ·æ˜¯åœ¨éœ€è¦ä¹è§‚é”æ§åˆ¶çš„tableä¸­å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œåç§°æ— æ‰€è°“ï¼Œå­—æ®µç±»å‹ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰,å’Œä¸Šé¢çš„ version ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™æ£€æŸ¥å½“å‰æ•°æ®åº“ä¸­æ•°æ®çš„æ—¶é—´æˆ³å’Œè‡ªå·±æ›´æ–°å‰å–åˆ°çš„æ—¶é—´æˆ³è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´åˆ™ OKï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚</p></li></ol><hr><h3 id="_8-sqlä¼˜åŒ–æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_8-sqlä¼˜åŒ–æ–¹å¼"><span>8. SQLä¼˜åŒ–æ–¹å¼</span></a></h3><ol><li>å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚æœç´¢å¼•æ˜¯æ•´å½¢ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç´¢å¼•ä¸Šè®¾ç½®é»˜è®¤å€¼ 0ï¼Œç¡®ä¿è¡¨ä¸­åˆ—æ²¡æœ‰ null å€¼ã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ != æˆ– &lt;&gt; æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚</li><li>like â€˜%abc%â€™ ä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>åœ¨ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæ¡ä»¶æ—¶ï¼Œå¦‚æœè¯¥ç´¢å¼•æ˜¯å¤åˆç´¢å¼•ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨åˆ°è¯¥ç´¢å¼•ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µä½œä¸ºæ¡ä»¶æ—¶æ‰èƒ½ä¿è¯ç³»ç»Ÿä½¿ç”¨è¯¥ç´¢å¼•ï¼Œå¦åˆ™è¯¥ç´¢å¼•å°†ä¸ä¼šè¢«ä½¿ç”¨ï¼Œå¹¶ä¸”åº”å°½å¯èƒ½çš„è®©å­—æ®µé¡ºåºä¸ç´¢å¼•é¡ºåºç›¸ä¸€è‡´ã€‚</li><li>å¾ˆå¤šæ—¶å€™ç”¨ exists ä»£æ›¿ in æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</li></ol><hr><h3 id="_9-ä»é”çš„ç±»åˆ«ä¸Šåˆ†mysqléƒ½æœ‰å“ªäº›é”å‘¢" tabindex="-1"><a class="header-anchor" href="#_9-ä»é”çš„ç±»åˆ«ä¸Šåˆ†mysqléƒ½æœ‰å“ªäº›é”å‘¢"><span>9. ä»é”çš„ç±»åˆ«ä¸Šåˆ†MySQLéƒ½æœ‰å“ªäº›é”å‘¢ï¼Ÿ</span></a></h3><p>ä»é”çš„ç±»åˆ«ä¸Šæ¥è®²ï¼Œæœ‰å…±äº«é”å’Œæ’ä»–é”ã€‚</p><p><strong>å…±äº«é”</strong>: åˆå«åšè¯»é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„è¯»å–æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šå…±äº«é”ã€‚å…±äº«é”å¯ä»¥åŒæ—¶åŠ ä¸Šå¤šä¸ªã€‚</p><p><strong>æ’ä»–é”</strong>: åˆå«åšå†™é”ã€‚ å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„å†™å…¥æ—¶ï¼Œå¯¹æ•°æ®åŠ ä¸Šæ’ä»–é”ã€‚æ’ä»–é”åªå¯ä»¥åŠ ä¸€ä¸ªï¼Œä»–å’Œå…¶ä»–çš„æ’ä»–é”ï¼Œå…±äº«é”éƒ½ç›¸æ–¥ã€‚</p><hr><p>å‚è€ƒï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>1. https://haicoder.net/note/mysql-interview/mysql-interview-optimistic-pessimism-lock.html</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="redis" tabindex="-1"><a class="header-anchor" href="#redis"><span>Redis</span></a></h2><h3 id="_1-redisæ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1-redisæ˜¯ä»€ä¹ˆ"><span>1. Redisæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><blockquote><p>ä¸€èˆ¬é—®è¿™ä¸ªé—®é¢˜ä½ æœ€å°‘è¦ç­”å‡ºä»¥ä¸‹å‡ ç‚¹</p></blockquote><p>Redis æ˜¯ä¸€ä¸ª<strong>åŸºäºå†…å­˜çš„ key-value</strong> å­˜å‚¨ç³»ç»Ÿï¼Œæ•°æ®ç»“æ„åŒ…æ‹¬<strong>å­—ç¬¦ä¸²ã€listã€setã€zsetï¼ˆsorted set --æœ‰åºé›†åˆï¼‰å’Œhash</strong>ï¼Œbitmapï¼ŒGeoHash(åæ ‡)ï¼ŒHyperLogLogï¼ŒStreamsï¼ˆ5.xç‰ˆæœ¬ä»¥åï¼‰</p><h3 id="_2-ä½ åœ¨å“ªäº›åœºæ™¯ä½¿ç”¨redis" tabindex="-1"><a class="header-anchor" href="#_2-ä½ åœ¨å“ªäº›åœºæ™¯ä½¿ç”¨redis"><span>2. ä½ åœ¨å“ªäº›åœºæ™¯ä½¿ç”¨redis</span></a></h3><blockquote><p>ä½ æœ‰å®æˆ˜ç»éªŒï¼Œé‚£å°±ç›´æ¥è¡¨æ¼”ã€‚å¦‚æœæ²¡æœ‰ï¼Œé€‰å‡ ä¸ªä¸‹é¢çš„ç»å…¸åœºæ™¯</p></blockquote><ol><li>ä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨ï¼Œï¼ˆå› ä¸ºæ˜¯åŸºäºå†…å­˜ã€ä¸€èˆ¬ä¸ä¼šä½œä¸ºæ¶ˆè´¹é˜Ÿåˆ—ã€ä½œä¸ºå¾ªç¯é˜Ÿåˆ—å¿…è¦é€‚ç”¨ï¼‰ï¼›</li><li>æ¨¡æ‹Ÿç±»ä¼¼äºtokenè¿™ç§éœ€è¦è®¾ç½®è¿‡æœŸæ—¶é—´çš„åœºæ™¯ï¼Œç™»å½•å¤±æ•ˆï¼›</li><li>åˆ†å¸ƒå¼ç¼“å­˜ï¼Œé¿å…å¤§é‡è¯·æ±‚åº•å±‚å…³ç³»å‹æ•°æ®åº“ï¼Œå¤§å¤§é™ä½æ•°æ®åº“å‹åŠ›ï¼›</li><li>åˆ†å¸ƒå¼é”ï¼›</li><li>åŸºäº bitmap å®ç°å¸ƒéš†è¿‡æ»¤å™¨ï¼›</li><li>æ’è¡Œæ¦œ-åŸºäºzsetï¼ˆæœ‰åºé›†åˆæ•°æ®ç±»å‹ï¼‰ï¼›</li><li>è®¡æ•°å™¨-å¯¹äºæµè§ˆé‡ã€æ’­æ”¾é‡ç­‰å¹¶å‘è¾ƒé«˜ï¼Œä½¿ç”¨ redis incr å®ç°è®¡æ•°å™¨åŠŸèƒ½ï¼›</li><li>åˆ†å¸ƒå¼ä¼šè¯ï¼›</li><li>æ¶ˆæ¯ç³»ç»Ÿï¼›</li></ol><h3 id="_3-ä¸ºä»€ä¹ˆredisæ˜¯å•çº¿ç¨‹çš„" tabindex="-1"><a class="header-anchor" href="#_3-ä¸ºä»€ä¹ˆredisæ˜¯å•çº¿ç¨‹çš„"><span>3. ä¸ºä»€ä¹ˆRedisæ˜¯å•çº¿ç¨‹çš„?</span></a></h3><p>è¿™ä¸ªé—®é¢˜ç»™ä¸€ä¸ªå®˜æ–¹ç­”æ¡ˆ</p><p>å› ä¸ºRedisæ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPUä¸æ˜¯Redisçš„ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚</p><h3 id="_4-redisæŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_4-redisæŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼"><span>4. RedisæŒä¹…åŒ–æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</span></a></h3><p>redis æä¾›äº†ä¸¤ç§æŒä¹…åŒ–çš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯<strong>å¿«ç…§æ–¹å¼ï¼ˆRDB Redis DataBaseï¼‰å’Œæ–‡ä»¶è¿½åŠ ï¼ˆAOF Append Only Fileï¼‰</strong>ã€‚</p><p>æ˜¾è€Œæ˜“è§ï¼Œå¿«ç…§æ–¹å¼é‡å¯æ¢å¤å¿«ã€ä½†æ˜¯æ•°æ®æ›´å®¹æ˜“ä¸¢å¤±ï¼Œæ–‡ä»¶è¿½åŠ æ•°æ®æ›´å®Œæ•´ã€é‡å¯æ¢å¤æ…¢ã€‚</p><p><strong>æ··åˆæŒä¹…åŒ–æ–¹å¼</strong>ï¼ŒRedis 4.0ä¹‹åæ–°å¢çš„æ–¹å¼ï¼Œæ··åˆæŒä¹…åŒ–æ˜¯ç»“åˆRDBå’ŒAOFçš„ä¼˜ç‚¹ï¼Œåœ¨å†™å…¥çš„æ—¶å€™å…ˆæŠŠå½“å‰çš„æ•°æ®ä»¥RDBçš„å½¢å¼å†™å…¥åˆ°æ–‡ä»¶çš„å¼€å¤´ï¼Œå†å°†åç»­çš„æ“ä½œä»¥AOFçš„æ ¼å¼å­˜å…¥æ–‡ä»¶å½“ä¸­ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯é‡å¯æ—¶çš„é€Ÿåº¦ï¼Œåˆèƒ½é™ä½æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</p><p>åœ¨æ¢å¤æ—¶ï¼Œå…ˆæ¢å¤å¿«ç…§æ–¹å¼ä¿å­˜çš„æ–‡ä»¶ï¼Œç„¶åå†æ¢å¤è¿½åŠ æ–‡ä»¶ä¸­çš„å¢é‡æ•°æ®ã€‚</p><h3 id="_5-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€-æ€ä¹ˆè§£å†³" tabindex="-1"><a class="header-anchor" href="#_5-ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€-æ€ä¹ˆè§£å†³"><span>5. ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</span></a></h3><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨å³æ²¡æœ‰å‘½ä¸­ï¼ŒåŒæ—¶åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œå¯¼è‡´ç”¨æˆ·æ¯æ¬¡è¯·æ±‚è¯¥æ•°æ®éƒ½è¦å»æ•°æ®åº“ä¸­æŸ¥è¯¢ä¸€éï¼Œç„¶åè¿”å›ç©ºã€‚</p><p>å¦‚æœæœ‰æ¶æ„æ”»å‡»è€…ä¸æ–­è¯·æ±‚ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¼šå¯¼è‡´çŸ­æ—¶é—´å¤§é‡è¯·æ±‚è½åœ¨æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å‡»å®æ•°æ®åº“ç³»ç»Ÿã€‚</p><p>è¿™å°±å«åšç¼“å­˜ç©¿é€ã€‚</p><p><strong>æ€ä¹ˆè§£å†³ï¼Ÿ</strong></p><ul><li><p>å¯¹æŸ¥è¯¢ç»“æœä¸ºç©ºçš„æƒ…å†µä¹Ÿè¿›è¡Œç¼“å­˜ï¼Œç¼“å­˜æ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹ï¼Œæˆ–è€…è¯¥keyå¯¹åº”çš„æ•°æ®insertä¹‹åæ¸…ç†ç¼“å­˜ã€‚</p></li><li><p>å¯¹ä¸€å®šä¸å­˜åœ¨çš„keyè¿›è¡Œè¿‡æ»¤ã€‚å¯ä»¥æŠŠæ‰€æœ‰çš„å¯èƒ½å­˜åœ¨çš„keyæ”¾åˆ°ä¸€ä¸ªå¤§çš„Bitmapä¸­ï¼ŒæŸ¥è¯¢æ—¶é€šè¿‡è¯¥Bitmapè¿‡æ»¤ã€‚(ä¹Ÿå°±æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzUzNDUyOTY0Nw==&amp;mid=2247483968&amp;idx=1&amp;sn=0251e9eed08ca688cc4442cf8223b643&amp;chksm=fa921140cde5985647e8b5a98b0e0270d59f962a2daba6784b26546a892677e5d7965811b402&amp;token=529078779&amp;lang=zh_CN#rd" target="_blank" rel="noopener noreferrer">å¤§ç™½è¯è®²è§£å¸ƒéš†è¿‡æ»¤å™¨</a>)</p></li></ul><h3 id="_6-ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#_6-ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©"><span>6. ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©?</span></a></h3><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜ä¸­æ•°æ®å¤§æ‰¹é‡åˆ°è¿‡æœŸæ—¶é—´ï¼Œè€ŒæŸ¥è¯¢æ•°æ®é‡å·¨å¤§ï¼Œè¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“ä¸Šï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³å®•æœºã€‚å’Œç¼“å­˜å‡»ç©¿ä¸åŒçš„æ˜¯ï¼Œç¼“å­˜å‡»ç©¿æŒ‡å¹¶å‘æŸ¥åŒä¸€æ¡æ•°æ®ï¼Œç¼“å­˜é›ªå´©æ˜¯ä¸åŒæ•°æ®éƒ½è¿‡æœŸäº†ï¼Œå¾ˆå¤šæ•°æ®éƒ½æŸ¥ä¸åˆ°ä»è€ŒæŸ¥æ•°æ®åº“ã€‚</p><p><strong>æ€ä¹ˆè§£å†³ï¼Ÿ</strong></p><p>å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæœ‰ï¼š</p><ul><li>å‡åŒ€è¿‡æœŸ</li><li>åŠ äº’æ–¥é”</li><li>ç¼“å­˜æ°¸ä¸è¿‡æœŸ</li><li>åŒå±‚ç¼“å­˜ç­–ç•¥</li></ul><p><strong>å‡åŒ€è¿‡æœŸ</strong>ï¼šè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚é€šå¸¸å¯ä»¥ä¸ºæœ‰æ•ˆæœŸå¢åŠ éšæœºå€¼æˆ–è€…ç»Ÿä¸€è§„åˆ’æœ‰æ•ˆæœŸã€‚</p><p><strong>åŠ äº’æ–¥é”</strong>ï¼šè·Ÿç¼“å­˜å‡»ç©¿è§£å†³æ€è·¯ä¸€è‡´ï¼ŒåŒä¸€æ—¶é—´åªè®©ä¸€ä¸ªçº¿ç¨‹æ„å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹é˜»å¡æ’é˜Ÿã€‚</p><p><strong>ç¼“å­˜æ°¸ä¸è¿‡æœŸ</strong>ï¼šè·Ÿç¼“å­˜å‡»ç©¿è§£å†³æ€è·¯ä¸€è‡´ï¼Œç¼“å­˜åœ¨ç‰©ç†ä¸Šæ°¸è¿œä¸è¿‡æœŸï¼Œç”¨ä¸€ä¸ªå¼‚æ­¥çš„çº¿ç¨‹æ›´æ–°ç¼“å­˜ã€‚</p><p><strong>åŒå±‚ç¼“å­˜ç­–ç•¥</strong>ï¼šä½¿ç”¨ä¸»å¤‡ä¸¤å±‚ç¼“å­˜ï¼š</p><p>ä¸»ç¼“å­˜ï¼šæœ‰æ•ˆæœŸæŒ‰ç…§ç»éªŒå€¼è®¾ç½®ï¼Œè®¾ç½®ä¸ºä¸»è¯»å–çš„ç¼“å­˜ï¼Œä¸»ç¼“å­˜å¤±æ•ˆåä»æ•°æ®åº“åŠ è½½æœ€æ–°å€¼ã€‚</p><p>å¤‡ä»½ç¼“å­˜ï¼šæœ‰æ•ˆæœŸé•¿ï¼Œè·å–é”å¤±è´¥æ—¶è¯»å–çš„ç¼“å­˜ï¼Œä¸»ç¼“å­˜æ›´æ–°æ—¶éœ€è¦åŒæ­¥æ›´æ–°å¤‡ä»½ç¼“å­˜ã€‚</p><h3 id="_7-redisä½¿ç”¨ä¸Šå¦‚ä½•åšå†…å­˜ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_7-redisä½¿ç”¨ä¸Šå¦‚ä½•åšå†…å­˜ä¼˜åŒ–"><span>7. Redisä½¿ç”¨ä¸Šå¦‚ä½•åšå†…å­˜ä¼˜åŒ–ï¼Ÿ</span></a></h3><ol><li><strong>ç¼©çŸ­é”®å€¼çš„é•¿åº¦</strong></li></ol><ul><li>ç¼©çŸ­å€¼çš„é•¿åº¦æ‰æ˜¯å…³é”®ï¼Œå¦‚æœå€¼æ˜¯ä¸€ä¸ªå¤§çš„ä¸šåŠ¡å¯¹è±¡ï¼Œå¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–æˆäºŒè¿›åˆ¶æ•°ç»„ï¼›</li><li>é¦–å…ˆåº”è¯¥åœ¨ä¸šåŠ¡ä¸Šè¿›è¡Œç²¾ç®€ï¼Œå»æ‰ä¸å¿…è¦çš„å±æ€§ï¼Œé¿å…å­˜å‚¨ä¸€äº›æ²¡ç”¨çš„æ•°æ®ï¼›</li><li>å…¶æ¬¡æ˜¯åºåˆ—åŒ–çš„å·¥å…·é€‰æ‹©ä¸Šï¼Œåº”è¯¥é€‰æ‹©æ›´é«˜æ•ˆçš„åºåˆ—åŒ–å·¥å…·æ¥é™ä½å­—èŠ‚æ•°ç»„å¤§å°ï¼›</li><li>ä»¥JAVAä¸ºä¾‹ï¼Œå†…ç½®çš„åºåˆ—åŒ–æ–¹å¼æ— è®ºä»é€Ÿåº¦è¿˜æ˜¯å‹ç¼©æ¯”éƒ½ä¸å°½å¦‚äººæ„ï¼Œè¿™æ—¶å¯ä»¥é€‰æ‹©æ›´é«˜æ•ˆçš„åºåˆ—åŒ–å·¥å…·ï¼Œå¦‚: protostuffï¼Œkryoç­‰</li></ul><ol start="2"><li><strong>å…±äº«å¯¹è±¡æ± </strong></li></ol><p>å¯¹è±¡å…±äº«æ± æŒ‡Rediså†…éƒ¨ç»´æŠ¤[0-9999]çš„æ•´æ•°å¯¹è±¡æ± ã€‚åˆ›å»ºå¤§é‡çš„æ•´æ•°ç±»å‹redisObjectå­˜åœ¨å†…å­˜å¼€é”€ï¼Œæ¯ä¸ªredisObjectå†…éƒ¨ç»“æ„è‡³å°‘å 16å­—èŠ‚ï¼Œç”šè‡³è¶…è¿‡äº†æ•´æ•°è‡ªèº«ç©ºé—´æ¶ˆè€—ã€‚æ‰€ä»¥Rediså†…å­˜ç»´æŠ¤ä¸€ä¸ª[0-9999]çš„æ•´æ•°å¯¹è±¡æ± ï¼Œç”¨äºèŠ‚çº¦å†…å­˜ã€‚ é™¤äº†æ•´æ•°å€¼å¯¹è±¡ï¼Œå…¶ä»–ç±»å‹å¦‚list,hash,set,zsetå†…éƒ¨å…ƒç´ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•´æ•°å¯¹è±¡æ± ã€‚å› æ­¤å¼€å‘ä¸­åœ¨æ»¡è¶³éœ€æ±‚çš„å‰æä¸‹ï¼Œå°½é‡ä½¿ç”¨æ•´æ•°å¯¹è±¡ä»¥èŠ‚çœå†…å­˜ã€‚</p><ol start="3"><li><strong>å­—ç¬¦ä¸²ä¼˜åŒ–</strong></li></ol><p>å› ä¸ºredisçš„æƒ°æ€§åˆ é™¤æœºåˆ¶ï¼Œå­—ç¬¦ä¸²ç¼©å‡åçš„ç©ºé—´ä¸é‡Šæ”¾ï¼Œä½œä¸ºé¢„åˆ†é…ç©ºé—´ä¿ç•™ã€‚å°½é‡åšæ–°å¢ä¸åšæ›´æ–°ã€‚</p><ol start="4"><li><strong>ç¼–ç ä¼˜åŒ–</strong></li></ol><p>æ‰€è°“ç¼–ç å°±æ˜¯å…·ä½“ä½¿ç”¨å“ªç§åº•å±‚æ•°æ®ç»“æ„æ¥å®ç°ã€‚ç¼–ç ä¸åŒå°†ç›´æ¥å½±å“æ•°æ®çš„å†…å­˜å ç”¨å’Œè¯»å†™æ•ˆç‡ã€‚</p><p>è¿™ä¸ªéœ€è¦æŒæ¡redisåº•å±‚çš„æ•°æ®ç»“æ„ã€‚ä¸‹å›¾ä½œä¸ºå‚è€ƒï¼š</p><figure><img src="https://tvax3.sinaimg.cn/large/007F3CC8ly1h391syfw1qj30hs0c2t9m.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><ol start="5"><li><strong>æ§åˆ¶keyçš„æ•°é‡</strong></li></ol><h3 id="_8-ä½ ä»¬redisä½¿ç”¨å“ªç§éƒ¨ç½²æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_8-ä½ ä»¬redisä½¿ç”¨å“ªç§éƒ¨ç½²æ–¹å¼"><span>8. ä½ ä»¬redisä½¿ç”¨å“ªç§éƒ¨ç½²æ–¹å¼ï¼Ÿ</span></a></h3><p>rediséƒ¨ç½²åˆ†ä¸ºå•èŠ‚ç‚¹ã€ä¸»ä»éƒ¨ç½²ï¼ˆmaster-slaveï¼‰ã€å“¨å…µéƒ¨ç½²ï¼ˆSentinelï¼‰ã€é›†ç¾¤éƒ¨ç½²ï¼ˆclusterï¼‰ã€‚</p><p>å•èŠ‚ç‚¹ï¼šä¹Ÿå°±æ˜¯å•æœºéƒ¨ç½²ï¼›</p><p>ä¸»ä»éƒ¨ç½²ï¼šåˆ†ä¸ºä¸€ä¸»ä¸€ä»æˆ–ä¸€ä¸»å¤šä»ï¼Œä¸»ä»ä¹‹é—´åŒæ­¥åˆ†ä¸ºå…¨é‡æˆ–å¢é‡ã€‚é‡åŒæ­¥ï¼šmaster èŠ‚ç‚¹é€šè¿‡ BGSAVE ç”Ÿæˆå¯¹åº”çš„RDBæ–‡ä»¶ï¼Œç„¶åå‘é€ç»™slaveèŠ‚ç‚¹ï¼ŒslaveèŠ‚ç‚¹æ¥æ”¶åˆ°å†™å…¥å‘½ä»¤åå°†masterå‘é€è¿‡æ¥çš„æ–‡ä»¶åŠ è½½å¹¶å†™å…¥ï¼›å¢é‡åŒæ­¥ï¼šå³åœ¨ master-slave å…³ç³»å»ºç«‹å¼€å§‹ï¼Œmasteræ¯æ‰§è¡Œä¸€æ¬¡æ•°æ®å˜æ›´çš„å‘½ä»¤å°±ä¼šåŒæ­¥è‡³slaveèŠ‚ç‚¹ã€‚ä¸€èˆ¬ä¼šå°†å†™è¯·æ±‚è½¬å‘åˆ°masterï¼Œè¯»è¯·æ±‚è½¬å‘åˆ°slaveã€‚æé«˜äº†redisçš„æ€§èƒ½ã€‚</p><p>å“¨å…µéƒ¨ç½²ï¼šåˆ†åˆ«æœ‰å“¨å…µé›†ç¾¤ä¸Redisçš„ä¸»ä»é›†ç¾¤ï¼Œå“¨å…µä½œä¸ºæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªç›‘æ§è¿›ç¨‹ï¼Œå¯¹åº”ç›‘æ§æ¯ä¸€ä¸ªRediså®ä¾‹ï¼Œå¦‚æœmasteræœåŠ¡å¼‚å¸¸ï¼ˆping pongå…¶ä¸­èŠ‚ç‚¹æ²¡æœ‰å›å¤ä¸”è¶…è¿‡äº†ä¸€å®šæ—¶é—´ï¼‰ï¼Œå°±ä¼šå¤šä¸ªå“¨å…µä¹‹é—´è¿›è¡Œç¡®è®¤ï¼Œå¦‚æœè¶…è¿‡ä¸€åŠç¡®è®¤æœåŠ¡å¼‚å¸¸ï¼Œåˆ™å¯¹masteræœåŠ¡è¿›è¡Œä¸‹çº¿å¤„ç†ï¼Œå¹¶ä¸”é€‰ä¸¾å‡ºå½“å‰ä¸€ä¸ªslaveèŠ‚ç‚¹æ¥è½¬æ¢æˆmasterèŠ‚ç‚¹ï¼›å¦‚æœslaveèŠ‚ç‚¹æœåŠ¡å¼‚å¸¸ï¼Œä¹Ÿæ˜¯ç»è¿‡å¤šä¸ªå“¨å…µç¡®è®¤åï¼Œè¿›è¡Œä¸‹çº¿å¤„ç†ã€‚æé«˜äº†redisé›†ç¾¤é«˜å¯ç”¨çš„ç‰¹æ€§ï¼ŒåŠæ¨ªå‘æ‰©å±•èƒ½åŠ›çš„å¢å¼ºã€‚</p><figure><img src="https://tvax4.sinaimg.cn/large/007F3CC8ly1h3923wycklj30oq0hwtbl.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>é›†ç¾¤éƒ¨ç½²ï¼šå±äº**â€œå»ä¸­å¿ƒåŒ–â€**çš„ä¸€ç§æ–¹å¼ï¼Œå¤šä¸ª master èŠ‚ç‚¹ä¿å­˜æ•´ä¸ªé›†ç¾¤ä¸­çš„å…¨éƒ¨æ•°æ®ï¼Œè€Œæ•°æ®æ ¹æ® key è¿›è¡Œ crc-16 æ ¡éªŒç®—æ³•è¿›è¡Œæ•£åˆ—ï¼Œå°† key æ•£åˆ—æˆå¯¹åº” 16383 ä¸ª slotï¼Œè€Œ Redis cluster é›†ç¾¤ä¸­æ¯ä¸ª master èŠ‚ç‚¹è´Ÿè´£ä¸åŒçš„slotèŒƒå›´ã€‚æ¯ä¸ª master èŠ‚ç‚¹ä¸‹è¿˜å¯ä»¥é…ç½®å¤šä¸ª slave èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨é›†ç¾¤ä¸­å†ä½¿ç”¨ sentinel å“¨å…µæå‡æ•´ä¸ªé›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p><figure><img src="https://tvax3.sinaimg.cn/large/007F3CC8ly1h39277u34pj30py0nojxa.jpg" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="_9-rediså®ç°åˆ†å¸ƒå¼é”è¦æ³¨æ„ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_9-rediså®ç°åˆ†å¸ƒå¼é”è¦æ³¨æ„ä»€ä¹ˆ"><span>9. rediså®ç°åˆ†å¸ƒå¼é”è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</span></a></h3><ol><li>åŠ é”è¿‡ç¨‹è¦ä¿è¯åŸå­æ€§ï¼›</li><li>ä¿è¯è°åŠ çš„é”åªèƒ½è¢«è°è§£é”ï¼Œå³RedisåŠ é”çš„valueï¼Œè§£é”æ—¶éœ€è¦ä¼ å…¥ç›¸åŒçš„valueæ‰èƒ½æˆåŠŸï¼Œä¿è¯valueå”¯ä¸€æ€§ï¼›</li><li>è®¾ç½®é”è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢åŠ é”æ–¹å¼‚å¸¸æ— æ³•é‡Šæ”¾é”æ—¶å…¶ä»–å®¢æˆ·ç«¯æ— æ³•è·å–é”ï¼ŒåŒæ—¶ï¼Œè¶…æ—¶æ—¶é—´è¦å¤§äºä¸šåŠ¡å¤„ç†æ—¶é—´ï¼›</li></ol><p>ä½¿ç”¨Rediså‘½ä»¤ <code>SET lock_key unique_value NX EX seconds</code> è¿›è¡ŒåŠ é”ï¼Œå•å‘½ä»¤æ“ä½œï¼ŒRedisæ˜¯ä¸²è¡Œæ‰§è¡Œå‘½ä»¤ï¼Œæ‰€ä»¥èƒ½ä¿è¯åªæœ‰ä¸€ä¸ªèƒ½åŠ é”æˆåŠŸã€‚</p><h2 id="spring" tabindex="-1"><a class="header-anchor" href="#spring"><span>Spring</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯-spring-æ¡†æ¶-spring-æ¡†æ¶æœ‰å“ªäº›ä¸»è¦æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯-spring-æ¡†æ¶-spring-æ¡†æ¶æœ‰å“ªäº›ä¸»è¦æ¨¡å—"><span>1. ä»€ä¹ˆæ˜¯ Spring æ¡†æ¶ï¼ŸSpring æ¡†æ¶æœ‰å“ªäº›ä¸»è¦æ¨¡å—ï¼Ÿ</span></a></h3><p>Springæ˜¯é’ˆå¯¹beançš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œç®¡ç†çš„è½»é‡çº§å®¹å™¨ï¼Œä¸€ä¸ªæ§åˆ¶åè½¬å’Œé¢å‘åˆ‡é¢çš„å®¹å™¨æ¡†æ¶</p><p>Springæœ‰ä¸ƒå¤§åŠŸèƒ½æ¨¡å—ï¼š</p><p>1ã€Core</p><p>Coreæ¨¡å—æ˜¯Springçš„æ ¸å¿ƒç±»åº“ï¼ŒCoreå®ç°äº†IOCåŠŸèƒ½ã€‚</p><p>2ã€AOP</p><p>Apring AOPæ¨¡å—æ˜¯Springçš„AOPåº“ï¼Œæä¾›äº†AOPï¼ˆæ‹¦æˆªå™¨ï¼‰æœºåˆ¶ï¼Œå¹¶æä¾›å¸¸è§çš„æ‹¦æˆªå™¨ï¼Œä¾›ç”¨æˆ·è‡ªå®šä¹‰å’Œé…ç½®ã€‚</p><p>3ã€orm</p><p>æä¾›å¯¹å¸¸ç”¨ORMæ¡†æ¶çš„ç®¡ç†å’Œæ”¯æŒï¼Œhibernateã€mybatisç­‰ã€‚</p><p>4ã€Dao</p><p>Springæä¾›å¯¹JDBCçš„æ”¯æŒï¼Œå¯¹JDBCè¿›è¡Œå°è£…ã€‚</p><p>5ã€Web</p><p>å¯¹Struts2çš„æ”¯æŒã€‚</p><p>6ã€Context</p><p>Contextæ¨¡å—æä¾›æ¡†æ¶å¼çš„Beançš„è®¿é—®æ–¹å¼ï¼Œå…¶å®ƒç¨‹åºå¯ä»¥é€šè¿‡Contextè®¿é—®Springçš„Beanèµ„æºï¼Œç›¸å½“äºèµ„æºæ³¨å…¥ã€‚</p><p>7ã€MVC</p><p>MVCæ¨¡å—ä¸ºspringæä¾›äº†ä¸€å¥—è½»é‡çº§çš„MVCå®ç°ï¼Œå³Spring MVCã€‚</p><h3 id="_2-spring-iocã€aopä¸¾ä¾‹è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_2-spring-iocã€aopä¸¾ä¾‹è¯´æ˜"><span>2. Spring IOCã€AOPä¸¾ä¾‹è¯´æ˜</span></a></h3><blockquote><p>è¿™æ˜¯ä¸€ä¸ªåŸºç¡€é—®é¢˜ï¼Œå¦‚æœç†è§£æœ‰éš¾åº¦ã€å»ºè®®å…ˆè¯»äº”éã€‚</p></blockquote><p>1ã€IOCç†è®ºçš„èƒŒæ™¯</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨é‡‡ç”¨é¢å‘å¯¹è±¡æ–¹æ³•è®¾è®¡çš„è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œå®ƒçš„åº•å±‚å®ç°éƒ½æ˜¯ç”±Nä¸ªå¯¹è±¡ç»„æˆçš„ï¼Œæ‰€æœ‰çš„å¯¹è±¡é€šè¿‡å½¼æ­¤çš„åˆä½œï¼Œæœ€ç»ˆå®ç°ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘ã€‚</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093254.jpeg" alt="å›¾1ï¼šè½¯ä»¶ç³»ç»Ÿä¸­è€¦åˆçš„å¯¹è±¡" tabindex="0" loading="lazy"><figcaption>å›¾1ï¼šè½¯ä»¶ç³»ç»Ÿä¸­è€¦åˆçš„å¯¹è±¡</figcaption></figure><p>å¦‚æœæˆ‘ä»¬æ‰“å¼€æœºæ¢°å¼æ‰‹è¡¨çš„åç›–ï¼Œå°±ä¼šçœ‹åˆ°ä¸ä¸Šé¢ç±»ä¼¼çš„æƒ…å½¢ï¼Œå„ä¸ªé½¿è½®åˆ†åˆ«å¸¦åŠ¨æ—¶é’ˆã€åˆ†é’ˆå’Œç§’ é’ˆé¡ºæ—¶é’ˆæ—‹è½¬ï¼Œä»è€Œåœ¨è¡¨ç›˜ä¸Šäº§ç”Ÿæ­£ç¡®çš„æ—¶é—´ã€‚å›¾1ä¸­æè¿°çš„å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªé½¿è½®ç»„ï¼Œå®ƒæ‹¥æœ‰å¤šä¸ªç‹¬ç«‹çš„é½¿è½®ï¼Œè¿™äº›é½¿è½®ç›¸äº’å•®åˆåœ¨ä¸€èµ·ï¼ŒååŒå·¥ä½œï¼Œå…±åŒå®ŒæˆæŸé¡¹ ä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™æ ·çš„é½¿è½®ç»„ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªé½¿è½®å‡ºäº†é—®é¢˜ï¼Œå°±å¯èƒ½ä¼šå½±å“åˆ°æ•´ä¸ªé½¿è½®ç»„çš„æ­£å¸¸è¿è½¬ã€‚ é½¿è½®ç»„ä¸­é½¿è½®ä¹‹é—´çš„å•®åˆå…³ç³»,ä¸è½¯ä»¶ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´çš„è€¦åˆå…³ç³»éå¸¸ç›¸ä¼¼ã€‚å¯¹è±¡ä¹‹é—´çš„è€¦åˆå…³ç³»æ˜¯æ— æ³•é¿å…çš„ï¼Œä¹Ÿæ˜¯å¿…è¦çš„ï¼Œè¿™æ˜¯ååŒå·¥ä½œçš„åŸºç¡€ã€‚ç°åœ¨ï¼Œä¼´éšç€ å·¥ä¸šçº§åº”ç”¨çš„è§„æ¨¡è¶Šæ¥è¶Šåºå¤§ï¼Œå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œç»å¸¸ä¼šå‡ºç°å¯¹è±¡ä¹‹é—´çš„å¤šé‡ä¾èµ–æ€§å…³ç³»ï¼Œå› æ­¤ï¼Œæ¶æ„å¸ˆå’Œè®¾è®¡å¸ˆå¯¹äºç³»ç»Ÿçš„åˆ†æå’Œè®¾è®¡ï¼Œå°†é¢ä¸´ æ›´å¤§çš„æŒ‘æˆ˜ã€‚å¯¹è±¡ä¹‹é—´è€¦åˆåº¦è¿‡é«˜çš„ç³»ç»Ÿï¼Œå¿…ç„¶ä¼šå‡ºç°ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«çš„æƒ…å½¢ã€‚</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093256.jpeg" alt="å›¾2ï¼šå¯¹è±¡ä¹‹é—´å¤æ‚çš„ä¾èµ–å…³ç³»" tabindex="0" loading="lazy"><figcaption>å›¾2ï¼šå¯¹è±¡ä¹‹é—´å¤æ‚çš„ä¾èµ–å…³ç³»</figcaption></figure><p>è€¦åˆå…³ç³»ä¸ä»…ä¼šå‡ºç°åœ¨å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´ï¼Œä¹Ÿä¼šå‡ºç°åœ¨è½¯ä»¶ç³»ç»Ÿçš„å„æ¨¡å—ä¹‹é—´ï¼Œä»¥åŠè½¯ä»¶ç³»ç»Ÿå’Œç¡¬ä»¶ç³»ç»Ÿä¹‹é—´ã€‚å¦‚ä½•é™ä½ç³»ç»Ÿä¹‹é—´ã€æ¨¡å—ä¹‹é—´å’Œå¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæ˜¯è½¯ä»¶å·¥ç¨‹æ°¸è¿œè¿½æ±‚çš„ç›®æ ‡ä¹‹ä¸€ã€‚<strong>ä¸ºäº†è§£å†³å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦è¿‡é«˜çš„é—®é¢˜ï¼Œè½¯ä»¶ä¸“å®¶Michael Mattsonæå‡ºäº†IOCç†è®ºï¼Œç”¨æ¥å®ç°å¯¹è±¡ä¹‹é—´çš„â€œè§£è€¦â€ï¼Œç›®å‰è¿™ä¸ªç†è®ºå·²ç»è¢«æˆåŠŸåœ°åº”ç”¨åˆ°å®è·µå½“ä¸­ï¼Œå¾ˆå¤šçš„J2EEé¡¹ç›®å‡é‡‡ç”¨äº†IOCæ¡†æ¶äº§å“Springã€‚</strong></p><p>2ã€ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬(IoC)</p><p>IOCæ˜¯Inversion of Controlçš„ç¼©å†™ï¼Œå¤šæ•°ä¹¦ç±ç¿»è¯‘æˆâ€œæ§åˆ¶åè½¬â€ï¼Œè¿˜æœ‰äº›ä¹¦ç±ç¿»è¯‘æˆä¸ºâ€œæ§åˆ¶åå‘â€æˆ–è€…â€œæ§åˆ¶å€’ç½®â€ã€‚ 1996å¹´ï¼ŒMichael Mattsonåœ¨ä¸€ç¯‡æœ‰å…³æ¢è®¨é¢å‘å¯¹è±¡æ¡†æ¶çš„æ–‡ç« ä¸­ï¼Œé¦–å…ˆæå‡ºäº†IOC è¿™ä¸ªæ¦‚å¿µã€‚å¯¹äºé¢å‘å¯¹è±¡è®¾è®¡åŠç¼–ç¨‹çš„åŸºæœ¬æ€æƒ³ï¼Œå‰é¢æˆ‘ä»¬å·²ç»è®²äº†å¾ˆå¤šäº†ï¼Œä¸å†èµ˜è¿°ï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠå¤æ‚ç³»ç»Ÿåˆ†è§£æˆç›¸äº’åˆä½œçš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ç±»é€šè¿‡å°è£…ä»¥ åï¼Œå†…éƒ¨å®ç°å¯¹å¤–éƒ¨æ˜¯é€æ˜çš„ï¼Œä»è€Œé™ä½äº†è§£å†³é—®é¢˜çš„å¤æ‚åº¦ï¼Œè€Œä¸”å¯ä»¥çµæ´»åœ°è¢«é‡ç”¨å’Œæ‰©å±•ã€‚IOCç†è®ºæå‡ºçš„è§‚ç‚¹å¤§ä½“æ˜¯è¿™æ ·çš„ï¼šå€ŸåŠ©äºâ€œç¬¬ä¸‰æ–¹â€å®ç°å…·æœ‰ä¾ èµ–å…³ç³»çš„å¯¹è±¡ä¹‹é—´çš„è§£è€¦ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093300.jpeg" alt="å›¾3ï¼šIOCè§£è€¦è¿‡ç¨‹" tabindex="0" loading="lazy"><figcaption>å›¾3ï¼šIOCè§£è€¦è¿‡ç¨‹</figcaption></figure><p>å¤§å®¶çœ‹åˆ°äº†å§ï¼Œç”±äºå¼•è¿›äº†ä¸­é—´ä½ç½®çš„â€œç¬¬ä¸‰æ–¹â€ï¼Œä¹Ÿå°±æ˜¯IOCå®¹å™¨ï¼Œä½¿å¾—Aã€Bã€Cã€Dè¿™4ä¸ªå¯¹è±¡æ²¡æœ‰äº†è€¦åˆå…³ç³»ï¼Œé½¿è½®ä¹‹é—´çš„ä¼ åŠ¨å…¨éƒ¨ä¾é â€œç¬¬ä¸‰ æ–¹â€äº†ï¼Œå…¨éƒ¨å¯¹è±¡çš„æ§åˆ¶æƒå…¨éƒ¨ä¸Šç¼´ç»™â€œç¬¬ä¸‰æ–¹â€IOCå®¹å™¨ï¼Œæ‰€ä»¥ï¼ŒIOCå®¹å™¨æˆäº†æ•´ä¸ªç³»ç»Ÿçš„å…³é”®æ ¸å¿ƒï¼Œå®ƒèµ·åˆ°äº†ä¸€ç§ç±»ä¼¼â€œç²˜åˆå‰‚â€çš„ä½œç”¨ï¼ŒæŠŠç³»ç»Ÿä¸­çš„æ‰€æœ‰ å¯¹è±¡ç²˜åˆåœ¨ä¸€èµ·å‘æŒ¥ä½œç”¨ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªâ€œç²˜åˆå‰‚â€ï¼Œå¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´ä¼šå½¼æ­¤å¤±å»è”ç³»ï¼Œè¿™å°±æ˜¯æœ‰äººæŠŠIOCå®¹å™¨æ¯”å–»æˆâ€œç²˜åˆå‰‚â€çš„ç”±æ¥ã€‚ æˆ‘ä»¬å†æ¥åšä¸ªè¯•éªŒï¼šæŠŠä¸Šå›¾ä¸­é—´çš„IOCå®¹å™¨æ‹¿æ‰ï¼Œç„¶åå†æ¥çœ‹çœ‹è¿™å¥—ç³»ç»Ÿï¼š</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093302.jpeg" alt="å›¾4ï¼šæ‹¿æ‰IoCå®¹å™¨åçš„ç³»ç»Ÿ" tabindex="0" loading="lazy"><figcaption>å›¾4ï¼šæ‹¿æ‰IoCå®¹å™¨åçš„ç³»ç»Ÿ</figcaption></figure><p>æˆ‘ä»¬ç°åœ¨çœ‹åˆ°çš„ç”»é¢ï¼Œå°±æ˜¯æˆ‘ä»¬è¦å®ç°æ•´ä¸ªç³»ç»Ÿæ‰€éœ€è¦å®Œæˆçš„å…¨éƒ¨å†…å®¹ã€‚è¿™æ—¶å€™ï¼ŒAã€Bã€Cã€Dè¿™4ä¸ªå¯¹è±¡ä¹‹é—´å·²ç»æ²¡æœ‰äº†è€¦åˆå…³ç³»ï¼Œå½¼æ­¤æ¯«æ— è”ç³»ï¼Œè¿™æ · çš„è¯ï¼Œå½“ä½ åœ¨å®ç°Açš„æ—¶å€™ï¼Œæ ¹æœ¬æ— é¡»å†å»è€ƒè™‘Bã€Cå’ŒDäº†ï¼Œå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å·²ç»é™ä½åˆ°äº†æœ€ä½ç¨‹åº¦ã€‚æ‰€ä»¥ï¼Œå¦‚æœçœŸèƒ½å®ç°IOCå®¹å™¨ï¼Œå¯¹äºç³»ç»Ÿå¼€å‘è€Œè¨€ï¼Œ è¿™å°†æ˜¯ä¸€ä»¶å¤šä¹ˆç¾å¥½çš„äº‹æƒ…ï¼Œå‚ä¸å¼€å‘çš„æ¯ä¸€æˆå‘˜åªè¦å®ç°è‡ªå·±çš„ç±»å°±å¯ä»¥äº†ï¼Œè·Ÿåˆ«äººæ²¡æœ‰ä»»ä½•å…³ç³»ï¼ æˆ‘ä»¬å†æ¥çœ‹çœ‹ï¼Œæ§åˆ¶åè½¬(IOC)åˆ°åº•ä¸ºä»€ä¹ˆè¦èµ·è¿™ä¹ˆä¸ªåå­—ï¼Ÿæˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ï¼š è½¯ä»¶ç³»ç»Ÿåœ¨æ²¡æœ‰å¼•å…¥IOCå®¹å™¨ä¹‹å‰ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼Œå¯¹è±¡Aä¾èµ–äºå¯¹è±¡Bï¼Œé‚£ä¹ˆå¯¹è±¡Aåœ¨åˆå§‹åŒ–æˆ–è€…è¿è¡Œåˆ°æŸä¸€ç‚¹çš„æ—¶å€™ï¼Œè‡ªå·±å¿…é¡»ä¸»åŠ¨å»åˆ›å»ºå¯¹è±¡Bæˆ–è€…ä½¿ç”¨å·²ç»åˆ›å»ºçš„å¯¹è±¡Bã€‚æ— è®ºæ˜¯åˆ›å»ºè¿˜æ˜¯ä½¿ç”¨å¯¹è±¡Bï¼Œæ§åˆ¶æƒéƒ½åœ¨è‡ªå·±æ‰‹ä¸Šã€‚ è½¯ä»¶ç³»ç»Ÿåœ¨å¼•å…¥IOCå®¹å™¨ä¹‹åï¼Œè¿™ç§æƒ…å½¢å°±å®Œå…¨æ”¹å˜äº†ï¼Œå¦‚å›¾3æ‰€ç¤ºï¼Œç”±äºIOCå®¹å™¨çš„åŠ å…¥ï¼Œå¯¹è±¡Aä¸å¯¹è±¡Bä¹‹é—´å¤±å»äº†ç›´æ¥è”ç³»ï¼Œæ‰€ä»¥ï¼Œå½“å¯¹è±¡Aè¿è¡Œåˆ°éœ€è¦å¯¹è±¡Bçš„æ—¶å€™ï¼ŒIOCå®¹å™¨ä¼šä¸»åŠ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡Bæ³¨å…¥åˆ°å¯¹è±¡Aéœ€è¦çš„åœ°æ–¹ã€‚ é€šè¿‡å‰åçš„å¯¹æ¯”ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºæ¥ï¼šå¯¹è±¡Aè·å¾—ä¾èµ–å¯¹è±¡Bçš„è¿‡ç¨‹,ç”±ä¸»åŠ¨è¡Œä¸ºå˜ä¸ºäº†è¢«åŠ¨è¡Œä¸ºï¼Œæ§åˆ¶æƒé¢ å€’è¿‡æ¥äº†ï¼Œè¿™å°±æ˜¯â€œæ§åˆ¶åè½¬â€è¿™ä¸ªåç§°çš„ç”±æ¥ã€‚</p><p>å‚è€ƒèµ„æ–™ï¼šhttps://www.cnblogs.com/jianmang/articles/4947615.html</p><h3 id="_3-ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬-ioc-ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥-di" tabindex="-1"><a class="header-anchor" href="#_3-ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬-ioc-ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥-di"><span>3. ä»€ä¹ˆæ˜¯æ§åˆ¶åè½¬(IOC)ï¼Ÿä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ï¼Ÿ</span></a></h3><p>IoC(Inversion of Control) â€“ æ§åˆ¶åè½¬ã€‚å®ƒä¸æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§æ€æƒ³ã€‚</p><p>IOCï¼šå°±æ˜¯å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ç”±å®¹å™¨æ¥åˆ›å»ºï¼Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»æœ¬æ¥æ˜¯ç”±æˆ‘ä»¬å¼€å‘è€…è‡ªå·±åˆ›å»ºå’Œç»´æŠ¤çš„ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨Springæ¡†æ¶åï¼Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ç”±å®¹å™¨æ¥åˆ›å»ºå’Œç»´æŠ¤ï¼Œå°†å¼€å‘è€…åšçš„äº‹è®©å®¹å™¨åšï¼Œè¿™å°±æ˜¯æ§åˆ¶åè½¬ã€‚BeanFactoryæ¥å£æ˜¯Spring Iocå®¹å™¨çš„æ ¸å¿ƒæ¥å£ã€‚</p><p>DIï¼šæˆ‘ä»¬åœ¨ä½¿ç”¨Springå®¹å™¨çš„æ—¶å€™ï¼Œå®¹å™¨é€šè¿‡è°ƒç”¨setæ–¹æ³•æˆ–è€…æ˜¯æ„é€ å™¨æ¥å»ºç«‹å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ æ§åˆ¶åè½¬æ˜¯ç›®æ ‡ï¼Œä¾èµ–æ³¨å…¥æ˜¯æˆ‘ä»¬å®ç°æ§åˆ¶åè½¬çš„ä¸€ç§æ‰‹æ®µã€‚</p><h3 id="_4-æè¿°ä¸€ä¸‹-spring-bean-çš„ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#_4-æè¿°ä¸€ä¸‹-spring-bean-çš„ç”Ÿå‘½å‘¨æœŸ"><span>4. æè¿°ä¸€ä¸‹ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</span></a></h3><blockquote><p>è¿™é“é¢˜æ˜¯springä¸€é“æ ‡å‡†é¢˜ç›®</p></blockquote><p>æŒ‰ç…§é˜¶æ®µç†è§£Springä¸­çš„beançš„ç”Ÿå‘½å‘¨æœŸä¸»è¦åŒ…å«å››ä¸ªé˜¶æ®µï¼š<code>å®ä¾‹åŒ–Bean --ï¼ Beanå±æ€§å¡«å…… --ï¼ åˆå§‹åŒ–Bean --ï¼é”€æ¯Bean</code></p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093306.png" alt="Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ" tabindex="0" loading="lazy"><figcaption>Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ</figcaption></figure><ol><li><p>Springä¸­çš„beançš„ç”Ÿå‘½å‘¨æœŸä¸»è¦åŒ…å«å››ä¸ªé˜¶æ®µï¼šå®ä¾‹åŒ–Bean --ï¼ Beanå±æ€§å¡«å…… --ï¼ åˆå§‹åŒ–Bean --ï¼é”€æ¯Bean</p></li><li><p>é¦–å…ˆæ˜¯å®ä¾‹åŒ–Beanï¼Œå½“å®¢æˆ·å‘å®¹å™¨è¯·æ±‚ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„beanæ—¶ï¼Œæˆ–åˆå§‹åŒ–beançš„æ—¶å€™éœ€è¦æ³¨å…¥å¦ä¸€ä¸ªå°šæœ«åˆå§‹åŒ–çš„ä¾èµ–æ—¶ï¼Œå®¹å™¨å°±ä¼šè°ƒç”¨doCreateBean()æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡åå°„çš„æ–¹å¼åˆ›å»ºå‡ºä¸€ä¸ªbeanå¯¹è±¡</p></li><li><p>Beanå®ä¾‹åˆ›å»ºå‡ºæ¥åï¼Œæ¥ç€å°±æ˜¯ç»™è¿™ä¸ªBeanå¯¹è±¡è¿›è¡Œå±æ€§å¡«å……ï¼Œä¹Ÿå°±æ˜¯æ³¨å…¥è¿™ä¸ªBeanä¾èµ–çš„å…¶å®ƒbeanå¯¹è±¡</p></li><li><p>å±æ€§å¡«å……å®Œæˆåï¼Œè¿›è¡Œåˆå§‹åŒ–Beanæ“ä½œï¼Œåˆå§‹åŒ–é˜¶æ®µåˆå¯ä»¥åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼š</p></li></ol><p>a. æ‰§è¡ŒAwareæ¥å£çš„æ–¹æ³•</p><blockquote><p>Springä¼šæ£€æµ‹è¯¥å¯¹è±¡æ˜¯å¦å®ç°äº†xxxAwareæ¥å£ï¼Œé€šè¿‡Awareç±»å‹çš„æ¥å£ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ‹¿åˆ°Springå®¹å™¨çš„äº›èµ„æºã€‚å¦‚å®ç°BeanNameAwareæ¥å£å¯ä»¥è·å–åˆ°BeanNameï¼Œå®ç°BeanFactoryAwareæ¥å£å¯ä»¥è·å–åˆ°å·¥å‚å¯¹è±¡BeanFactoryç­‰</p></blockquote><p>b. æ‰§è¡ŒBeanPostProcessorçš„å‰ç½®å¤„ç†æ–¹æ³•postProcessBeforelnitialization()ï¼Œå¯¹Beanè¿›è¡Œä¸€äº›è‡ªå®šä¹‰çš„å‰ç½®å¤„ç†</p><p>c. åˆ¤æ–­Beanæ˜¯å¦å®ç°äº†InitializingBeanæ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œå°†ä¼šæ‰§è¡ŒlnitializingBeançš„afeterPropertiesSet()åˆå§‹åŒ–æ–¹æ³•ï¼›</p><p>d. æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚init-methodç­‰ï¼›</p><p>e. æ‰§è¡ŒBeanPostProcessorçš„åç½®å¤„ç†æ–¹æ³•postProcessAfterinitialization()</p><ol start="5"><li>åˆå§‹åŒ–å®Œæˆåï¼ŒBeanå°±æˆåŠŸåˆ›å»ºäº†ï¼Œä¹‹åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªBeanï¼Œ å½“Beanä¸å†éœ€è¦æ—¶ï¼Œä¼šè¿›è¡Œé”€æ¯æ“ä½œï¼Œ</li></ol><p>a. é¦–å…ˆåˆ¤æ–­Beanæ˜¯å¦å®ç°äº†DestructionAwareBeanPostProcessoræ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œåˆ™ä¼šæ‰§è¡ŒDestructionAwareBeanPostProcessoråç½®å¤„ç†å™¨çš„é”€æ¯å›è°ƒæ–¹æ³• b. å…¶æ¬¡ä¼šåˆ¤æ–­Beanæ˜¯å¦å®ç°äº†DisposableBeanæ¥å£ï¼Œå¦‚æœå®ç°äº†å°†ä¼šè°ƒç”¨å…¶å®ç°çš„destroy()æ–¹æ³• c. æœ€ååˆ¤æ–­è¿™ä¸ªBeanæ˜¯å¦é…ç½®äº†dlestroy-methodç­‰è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨å…¶é…ç½®çš„é”€æ¯æ–¹æ³•ï¼›</p><h3 id="_5-spring-bean-çš„ä½œç”¨åŸŸä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_5-spring-bean-çš„ä½œç”¨åŸŸä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«"><span>5. Spring Bean çš„ä½œç”¨åŸŸä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><p><strong>Springå™¨ä¸­çš„beanå¯ä»¥åˆ†ä¸º5ä¸ªèŒƒå›´ï¼š</strong></p><ol><li>singletonï¼šè¿™ç§beanèŒƒå›´æ˜¯é»˜è®¤çš„ï¼Œè¿™ç§èŒƒå›´ç¡®ä¿ä¸ç®¡æ¥å—å¤šå°‘è¯·æ±‚ï¼Œæ¯ä¸ªå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªbeançš„å®ä¾‹ï¼Œå•ä¾‹æ¨¡å¼ï¼›</li><li>prototypeï¼šä¸ºæ¯ä¸€ä¸ªbeanæä¾›ä¸€ä¸ªå®ä¾‹ï¼›</li><li>requestï¼šåœ¨è¯·æ±‚beanèŒƒå›´å†…ä¸ºæ¯ä¸€ä¸ªæ¥è‡ªå®¢æˆ·ç«¯çš„ç½‘ç»œè¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œåœ¨è¯·æ±‚å®Œæ¯•åï¼Œbeanä¼šå¤±æ•ˆå¹¶è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼›</li><li>sessionï¼šä¸ºæ¯ä¸ªsessionåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œsessionè¿‡æœŸåï¼Œbeanä¼šéšä¹‹æ¶ˆå¤±ï¼›</li><li>global-sessionï¼šglobal-sessionå’ŒPortletåº”ç”¨ç›¸å…³ã€‚å½“ä½ çš„åº”ç”¨éƒ¨ç½²åœ¨Portletå®¹å™¨ä¸­å·¥ä½œæ—¶ï¼Œå®ƒåŒ…å«å¾ˆå¤športletã€‚å¦‚æœä½ æƒ³è¦å£°æ˜è®©æ‰€æœ‰çš„portletå…¬ç”¨å…¨å±€çš„å­˜å‚¨å˜é‡çš„è¯ï¼Œé‚£ä¹ˆå…¨å±€å˜é‡éœ€è¦å­˜å‚¨åœ¨global-sessionä¸­ã€‚</li></ol><h3 id="_6-springä¸­éƒ½åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_6-springä¸­éƒ½åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼"><span>6. Springä¸­éƒ½åº”ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼</span></a></h3><p>1ã€ç®€å•å·¥å‚æ¨¡å¼</p><p>ç®€å•å·¥å‚æ¨¡å¼çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå·¥å‚ç±»æ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼ŒåŠ¨æ€çš„å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚</p><p>Springä¸­çš„BeanFactoryå°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„ä½“ç°ï¼Œæ ¹æ®ä¼ å…¥ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†æ¥è·å¾—beanå¯¹è±¡ã€‚</p><p>2ã€å·¥å‚æ–¹æ³•æ¨¡å¼</p><p>åº”ç”¨ç¨‹åºå°†å¯¹è±¡çš„åˆ›å»ºåŠåˆå§‹åŒ–èŒè´£äº¤ç»™å·¥å‚å¯¹è±¡ï¼Œå·¥å‚Beanã€‚</p><p>å®šä¹‰å·¥å‚æ–¹æ³•ï¼Œç„¶åé€šè¿‡config.xmlé…ç½®æ–‡ä»¶ï¼Œå°†å…¶çº³å…¥Springå®¹å™¨æ¥ç®¡ç†ï¼Œéœ€è¦é€šè¿‡factory-methodæŒ‡å®šé™æ€æ–¹æ³•åç§°ã€‚</p><p>3ã€å•ä¾‹æ¨¡å¼</p><p>Springç”¨çš„æ˜¯åŒé‡åˆ¤æ–­åŠ é”çš„å•ä¾‹æ¨¡å¼ï¼Œé€šè¿‡getSingletonæ–¹æ³•ä»singletonObjectsä¸­è·å–beanã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * Return the (raw) singleton object registered under the given name.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * &lt;p&gt;Checks already instantiated singletons and also allows for an early</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * reference to a currently created singleton (resolving a circular reference).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> beanName</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> the name of the bean to look for</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> allowEarlyReference</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> whether early references should be created or not</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> the registered singleton object, or {@code null} if none found</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getSingleton</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> beanName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> allowEarlyReference) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> singletonObject </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">singletonObjects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (singletonObject </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> isSingletonCurrentlyInCreation</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(beanName)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">singletonObjects</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                singletonObject </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">earlySingletonObjects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (singletonObject </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> allowEarlyReference) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                    ObjectFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> singletonFactory </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">singletonFactories</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (singletonFactory </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                        singletonObject </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> singletonFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getObject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">                        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">earlySingletonObjects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(beanName, singletonObject);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">                        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">singletonFactories</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(beanName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> (singletonObject </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NULL_OBJECT </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> singletonObject </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4ã€ä»£ç†æ¨¡å¼</p><p>Springçš„AOPä¸­ï¼Œä½¿ç”¨çš„Adviceï¼ˆé€šçŸ¥ï¼‰æ¥å¢å¼ºè¢«ä»£ç†ç±»çš„åŠŸèƒ½ã€‚Springå®ç°AOPåŠŸèƒ½çš„åŸç†å°±æ˜¯ä»£ç†æ¨¡å¼ï¼ˆâ‘  JDKåŠ¨æ€ä»£ç†ï¼Œâ‘¡ CGLIBå­—èŠ‚ç ç”ŸæˆæŠ€æœ¯ä»£ç†ã€‚ï¼‰å¯¹ç±»è¿›è¡Œæ–¹æ³•çº§åˆ«çš„åˆ‡é¢å¢å¼ºã€‚</p><p>5ã€è£…é¥°å™¨æ¨¡å¼</p><p>è£…é¥°å™¨æ¨¡å¼ï¼šåŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚</p><p>Springçš„ApplicationContextä¸­é…ç½®æ‰€æœ‰çš„DataSourceã€‚è¿™äº›DataSourceå¯èƒ½æ˜¯ä¸åŒçš„æ•°æ®åº“ï¼Œç„¶åSessionFactoryæ ¹æ®ç”¨æˆ·çš„æ¯æ¬¡è¯·æ±‚ï¼Œå°†DataSourceè®¾ç½®æˆä¸åŒçš„æ•°æ®æºï¼Œä»¥è¾¾åˆ°åˆ‡æ¢æ•°æ®æºçš„ç›®çš„ã€‚</p><p>åœ¨Springä¸­æœ‰ä¸¤ç§è¡¨ç°ï¼š</p><p>ä¸€ç§æ˜¯ç±»åä¸­å«æœ‰Wrapperï¼Œå¦ä¸€ç§æ˜¯ç±»åä¸­å«æœ‰Decoratorã€‚</p><p>6ã€è§‚å¯Ÿè€…æ¨¡å¼</p><p>å®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚</p><p>Springä¸­è§‚å¯Ÿè€…æ¨¡å¼ä¸€èˆ¬ç”¨åœ¨listenerçš„å®ç°ã€‚</p><p>7ã€ç­–ç•¥æ¨¡å¼</p><p>ç­–ç•¥æ¨¡å¼æ˜¯è¡Œä¸ºæ€§æ¨¡å¼ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œé€‚åº”è¡Œä¸ºçš„å˜åŒ– ï¼Œå¼ºè°ƒçˆ¶ç±»çš„è°ƒç”¨å­ç±»çš„ç‰¹æ€§ ã€‚</p><p>getHandleræ˜¯HandlerMappingæ¥å£ä¸­çš„å”¯ä¸€æ–¹æ³•ï¼Œç”¨äºæ ¹æ®è¯·æ±‚æ‰¾åˆ°åŒ¹é…çš„å¤„ç†å™¨ã€‚</p><p>8ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼</p><p>Spring JdbcTemplateçš„queryæ–¹æ³•æ€»ä½“ç»“æ„æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•+å›è°ƒå‡½æ•°ï¼Œqueryæ–¹æ³•ä¸­è°ƒç”¨çš„execute()æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œè€Œé¢„æœŸçš„å›è°ƒdoInStatement(Statement state)æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚</p><h3 id="_7-spring-aopé‡Œé¢çš„å‡ ä¸ªåè¯çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_7-spring-aopé‡Œé¢çš„å‡ ä¸ªåè¯çš„æ¦‚å¿µ"><span>7. Spring AOPé‡Œé¢çš„å‡ ä¸ªåè¯çš„æ¦‚å¿µ</span></a></h3><p>ï¼ˆ1ï¼‰è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰ï¼šæŒ‡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ‰€æ‰§è¡Œçš„æ–¹æ³•ã€‚åœ¨Spring AOPä¸­ï¼Œä¸€ä¸ªè¿æ¥ç‚¹æ€»ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚</p><p>ï¼ˆ2ï¼‰åˆ‡é¢ï¼ˆAspectï¼‰ï¼šè¢«æŠ½å–å‡ºæ¥çš„å…¬å…±æ¨¡å—ï¼Œå¯ä»¥ç”¨æ¥ä¼šæ¨ªåˆ‡å¤šä¸ªå¯¹è±¡ã€‚Aspectåˆ‡é¢å¯ä»¥çœ‹æˆ Pointcutåˆ‡ç‚¹ å’Œ Adviceé€šçŸ¥ çš„ç»“åˆï¼Œä¸€ä¸ªåˆ‡é¢å¯ä»¥ç”±å¤šä¸ªåˆ‡ç‚¹å’Œé€šçŸ¥ç»„æˆã€‚</p><blockquote><p>åœ¨Spring AOPä¸­ï¼Œåˆ‡é¢å¯ä»¥åœ¨ç±»ä¸Šä½¿ç”¨ @AspectJ æ³¨è§£æ¥å®ç°ã€‚</p></blockquote><p>ï¼ˆ3ï¼‰åˆ‡ç‚¹ï¼ˆPointcutï¼‰ï¼šåˆ‡ç‚¹ç”¨äºå®šä¹‰ è¦å¯¹å“ªäº›Join pointè¿›è¡Œæ‹¦æˆªã€‚</p><blockquote><p>åˆ‡ç‚¹åˆ†ä¸ºexecutionæ–¹å¼å’Œannotationæ–¹å¼ã€‚executionæ–¹å¼å¯ä»¥ç”¨è·¯å¾„è¡¨è¾¾å¼æŒ‡å®šå¯¹å“ªäº›æ–¹æ³•æ‹¦æˆªï¼Œæ¯”å¦‚æŒ‡å®šæ‹¦æˆªadd*ã€search*ã€‚annotationæ–¹å¼å¯ä»¥æŒ‡å®šè¢«å“ªäº›æ³¨è§£ä¿®é¥°çš„ä»£ç è¿›è¡Œæ‹¦æˆªã€‚</p></blockquote><p>ï¼ˆ4ï¼‰é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šæŒ‡è¦åœ¨è¿æ¥ç‚¹ï¼ˆJoin Pointï¼‰ä¸Šæ‰§è¡Œçš„åŠ¨ä½œï¼Œå³å¢å¼ºçš„é€»è¾‘ï¼Œæ¯”å¦‚æƒé™æ ¡éªŒå’Œã€æ—¥å¿—è®°å½•ç­‰ã€‚é€šçŸ¥æœ‰å„ç§ç±»å‹ï¼ŒåŒ…æ‹¬Aroundã€Beforeã€Afterã€After returningã€After throwingã€‚</p><p>ï¼ˆ5ï¼‰ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰ï¼šåŒ…å«è¿æ¥ç‚¹çš„å¯¹è±¡ï¼Œä¹Ÿç§°ä½œè¢«é€šçŸ¥ï¼ˆAdviceï¼‰çš„å¯¹è±¡ã€‚ ç”±äºSpring AOPæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå¯¹è±¡æ°¸è¿œæ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p><p>ï¼ˆ6ï¼‰ç»‡å…¥ï¼ˆWeavingï¼‰ï¼šé€šè¿‡åŠ¨æ€ä»£ç†ï¼Œåœ¨ç›®æ ‡å¯¹è±¡ï¼ˆTargetï¼‰çš„æ–¹æ³•ï¼ˆå³è¿æ¥ç‚¹Join pointï¼‰ä¸­æ‰§è¡Œå¢å¼ºé€»è¾‘ï¼ˆAdviceï¼‰çš„è¿‡ç¨‹ã€‚</p><p>ï¼ˆ7ï¼‰å¼•å…¥ï¼ˆIntroductionï¼‰ï¼šæ·»åŠ é¢å¤–çš„æ–¹æ³•æˆ–è€…å­—æ®µåˆ°è¢«é€šçŸ¥çš„ç±»ã€‚Springå…è®¸å¼•å…¥æ–°çš„æ¥å£ï¼ˆä»¥åŠå¯¹åº”çš„å®ç°ï¼‰åˆ°ä»»ä½•è¢«ä»£ç†çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¼•å…¥æ¥ä½¿beanå®ç° IsModified æ¥å£ï¼Œä»¥ä¾¿ç®€åŒ–ç¼“å­˜æœºåˆ¶ã€‚</p><p>å‡ ä¸ªæ¦‚å¿µçš„å…³ç³»å›¾å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093328.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç½‘ä¸Šæœ‰å¼ éå¸¸å½¢è±¡çš„å›¾ï¼Œæè¿°äº†å„ä¸ªæ¦‚å¿µæ‰€å¤„çš„åœºæ™¯å’Œä½œç”¨ï¼Œè´´åœ¨è¿™é‡Œä¾›å¤§å®¶ç†è§£ï¼š</p><figure><img src="https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F15%2F20240615-093313.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_8-beanfactoryå’Œapplicationcontextæœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_8-beanfactoryå’Œapplicationcontextæœ‰ä»€ä¹ˆåŒºåˆ«"><span>8. BeanFactoryå’ŒApplicationContextæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><p>BeanFactoryå’ŒApplicationContextæ˜¯Springçš„ä¸¤å¤§æ ¸å¿ƒæ¥å£ï¼Œéƒ½å¯ä»¥å½“åšSpringçš„å®¹å™¨ã€‚</p><ol><li>BeanFactoryæ˜¯Springé‡Œé¢æœ€åº•å±‚çš„æ¥å£ï¼Œæ˜¯IoCçš„æ ¸å¿ƒï¼Œå®šä¹‰äº†IoCçš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…å«äº†å„ç§Beançš„å®šä¹‰ã€åŠ è½½ã€å®ä¾‹åŒ–ï¼Œä¾èµ–æ³¨å…¥å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ApplicationContextæ¥å£ä½œä¸ºBeanFactoryçš„å­ç±»ï¼Œé™¤äº†æä¾›BeanFactoryæ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›äº†æ›´å®Œæ•´çš„æ¡†æ¶åŠŸèƒ½ï¼š</li></ol><ul><li>ç»§æ‰¿MessageSourceï¼Œå› æ­¤æ”¯æŒå›½é™…åŒ–ã€‚</li><li>èµ„æºæ–‡ä»¶è®¿é—®ï¼Œå¦‚URLå’Œæ–‡ä»¶ï¼ˆResourceLoaderï¼‰ã€‚</li><li>è½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ï¼ˆå³åŒæ—¶åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ï¼‰ ï¼Œä½¿å¾—æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡éƒ½ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„å±‚æ¬¡ï¼Œæ¯”å¦‚åº”ç”¨çš„webå±‚ã€‚</li><li>æä¾›åœ¨ç›‘å¬å™¨ä¸­æ³¨å†Œbeançš„äº‹ä»¶ã€‚</li></ul><ol start="2"><li>a. BeanFactroyé‡‡ç”¨çš„æ˜¯å»¶è¿ŸåŠ è½½å½¢å¼æ¥æ³¨å…¥Beançš„ï¼Œåªæœ‰åœ¨ä½¿ç”¨åˆ°æŸä¸ªBeanæ—¶(è°ƒç”¨getBean())ï¼Œæ‰å¯¹è¯¥Beanè¿›è¡ŒåŠ è½½å®ä¾‹åŒ–ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸èƒ½æå‰å‘ç°ä¸€äº›å­˜åœ¨çš„Springçš„é…ç½®é—®é¢˜ã€‚å¦‚æœBeançš„æŸä¸€ä¸ªå±æ€§æ²¡æœ‰æ³¨å…¥ï¼ŒBeanFacotryåŠ è½½åï¼Œç›´è‡³ç¬¬ä¸€æ¬¡ä½¿ç”¨è°ƒç”¨getBeanæ–¹æ³•æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li></ol><p>b. ApplicationContextï¼Œå®ƒæ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§åˆ›å»ºäº†æ‰€æœ‰çš„Beanã€‚è¿™æ ·ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ç°Springä¸­å­˜åœ¨çš„é…ç½®é”™è¯¯ï¼Œè¿™æ ·æœ‰åˆ©äºæ£€æŸ¥æ‰€ä¾èµ–å±æ€§æ˜¯å¦æ³¨å…¥ã€‚</p><p>c. ApplicationContextå¯åŠ¨åé¢„è½½å…¥æ‰€æœ‰çš„å•å®ä¾‹Beanï¼Œæ‰€ä»¥åœ¨è¿è¡Œçš„æ—¶å€™é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åˆ›å»ºå¥½äº†ã€‚ç›¸å¯¹äºBeanFactoryï¼ŒApplicationContext å”¯ä¸€çš„ä¸è¶³æ˜¯å ç”¨å†…å­˜ç©ºé—´ï¼Œå½“åº”ç”¨ç¨‹åºé…ç½®Beanè¾ƒå¤šæ—¶ï¼Œç¨‹åºå¯åŠ¨è¾ƒæ…¢ã€‚</p><ol start="3"><li><p>BeanFactoryå’ŒApplicationContextéƒ½æ”¯æŒBeanPostProcessorã€BeanFactoryPostProcessorçš„ä½¿ç”¨ï¼Œä½†ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼šBeanFactoryéœ€è¦æ‰‹åŠ¨æ³¨å†Œï¼Œè€ŒApplicationContextåˆ™æ˜¯è‡ªåŠ¨æ³¨å†Œã€‚</p></li><li><p>BeanFactoryé€šå¸¸ä»¥ç¼–ç¨‹çš„æ–¹å¼è¢«åˆ›å»ºï¼ŒApplicationContextè¿˜èƒ½ä»¥å£°æ˜çš„æ–¹å¼åˆ›å»ºï¼Œå¦‚ä½¿ç”¨ContextLoaderã€‚</p></li></ol><h3 id="_9-springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_9-springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜"><span>9. Springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼š</span></a></h3><p>è§ï¼šhttps://javapub.blog.csdn.net/</p><p>å¾ªç¯ä¾èµ–é—®é¢˜åœ¨Springä¸­ä¸»è¦æœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>ï¼ˆ1ï¼‰é€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li>ï¼ˆ2ï¼‰é€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å¤šä¾‹ï¼ˆåŸå‹ï¼‰æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li>ï¼ˆ3ï¼‰é€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å•ä¾‹æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li></ul><p>åœ¨Springä¸­ï¼Œåªæœ‰ç¬¬ï¼ˆ3ï¼‰ç§æ–¹å¼çš„å¾ªç¯ä¾èµ–é—®é¢˜è¢«è§£å†³äº†ï¼Œå…¶ä»–ä¸¤ç§æ–¹å¼åœ¨é‡åˆ°å¾ªç¯ä¾èµ–é—®é¢˜æ—¶éƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚è¿™æ˜¯å› ä¸ºï¼š</p><ul><li>ç¬¬ä¸€ç§æ„é€ æ–¹æ³•æ³¨å…¥çš„æƒ…å†µä¸‹ï¼Œåœ¨newå¯¹è±¡çš„æ—¶å€™å°±ä¼šå µå¡ä½äº†ï¼Œå…¶å®ä¹Ÿå°±æ˜¯â€å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹â€œçš„å†å²éš¾é¢˜ã€‚</li><li>ç¬¬äºŒç§setteræ–¹æ³•ï¼ˆå¤šä¾‹ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ¬¡getBean()æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„Beanï¼Œå¦‚æ­¤åå¤ä¸‹å»å°±ä¼šæœ‰æ— ç©·æ— å°½çš„Beanäº§ç”Ÿäº†ï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´OOMé—®é¢˜çš„å‡ºç°ã€‚</li></ul><p>Springåœ¨å•ä¾‹æ¨¡å¼ä¸‹çš„setteræ–¹æ³•ä¾èµ–æ³¨å…¥å¼•èµ·çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä¸»è¦æ˜¯é€šè¿‡äºŒçº§ç¼“å­˜å’Œä¸‰çº§ç¼“å­˜æ¥è§£å†³çš„ï¼Œå…¶ä¸­ä¸‰çº§ç¼“å­˜æ˜¯ä¸»è¦åŠŸè‡£ã€‚è§£å†³çš„æ ¸å¿ƒåŸç†å°±æ˜¯ï¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–ä¹‹åï¼Œä¾èµ–æ³¨å…¥ä¹‹å‰ï¼ŒSpringæå‰æš´éœ²çš„Beanå®ä¾‹çš„å¼•ç”¨åœ¨ç¬¬ä¸‰çº§ç¼“å­˜ä¸­è¿›è¡Œå­˜å‚¨ã€‚</p><p><strong>ç¬¬ä¸€ç§æ„é€ æ–¹æ³•æ³¨å…¥çš„æƒ…å†µï¼š</strong></p><blockquote><p>ä¾‹å¦‚ï¼šç±»Aé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥éœ€è¦ç±»Bçš„å®ä¾‹ï¼Œè€Œç±»Bé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥éœ€è¦ç±»Açš„å®ä¾‹ã€‚å¦‚æœå°†Aç±»å’ŒBç±»çš„beané…ç½®ä¸ºç›¸äº’æ³¨å…¥ï¼Œåˆ™Spring IoCå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹æ­¤å¾ªç¯å¼•ç”¨ï¼Œå¹¶æŠ›å‡ºa <code>BeanCurrentlyInCreationException</code>ã€‚ ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ç¼–è¾‘ç”±setterè€Œä¸æ˜¯æ„é€ å‡½æ•°é…ç½®çš„æŸäº›ç±»çš„æºä»£ç ã€‚æˆ–è€…ï¼Œé¿å…æ„é€ å‡½æ•°æ³¨å…¥å¹¶ä»…ä½¿ç”¨setteræ³¨å…¥ã€‚æ¢å¥è¯è¯´ï¼Œå°½ç®¡ä¸æ¨èä½¿ç”¨ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨setteræ³¨å…¥é…ç½®å¾ªç¯ä¾èµ–å…³ç³»ã€‚ ä¸å…¸å‹æƒ…å†µï¼ˆæ²¡æœ‰å¾ªç¯ä¾èµ–ï¼‰ä¸åŒï¼Œbean Aå’Œbean Bä¹‹é—´çš„å¾ªç¯ä¾èµ–å¼ºåˆ¶å…¶ä¸­ä¸€ä¸ªbeanåœ¨å®Œå…¨åˆå§‹åŒ–ä¹‹å‰è¢«æ³¨å…¥å¦ä¸€ä¸ªbeanï¼ˆç»å…¸çš„é¸¡ä¸é¸¡è›‹åœºæ™¯ï¼‰ã€‚</p></blockquote><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;person&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pojo.Person&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">constructor-arg</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å°æ˜&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">constructor-arg</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;12&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">constructor-arg</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;2&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;student&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;student&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pojo.Student&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">constructor-arg</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å°ç‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">constructor-arg</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;13&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">constructor-arg</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;2&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;person&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-springäº‹åŠ¡çš„å®ç°æ–¹å¼å’Œå®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_10-springäº‹åŠ¡çš„å®ç°æ–¹å¼å’Œå®ç°åŸç†"><span>10. Springäº‹åŠ¡çš„å®ç°æ–¹å¼å’Œå®ç°åŸç†ï¼š</span></a></h3><p>Springäº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼Œspringæ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ã€‚Springåªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œå…·ä½“å®ç°éƒ½æ˜¯ç”±å„æ•°æ®åº“è‡ªå·±å®ç°ï¼Œæ•°æ®åº“äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ˜¯é€šè¿‡ redo log å’Œ undo logå®ç°çš„ã€‚Springä¼šåœ¨äº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ ¹æ®å½“å‰ç¯å¢ƒä¸­è®¾ç½®çš„éš”ç¦»çº§åˆ«ï¼Œè°ƒæ•´æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼Œç”±æ­¤ä¿æŒä¸€è‡´ã€‚</p><p><strong>1. Springäº‹åŠ¡çš„ç§ç±»ï¼š</strong></p><p>springæ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å’Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†ä¸¤ç§æ–¹å¼ï¼š</p><p>a. ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ä½¿ç”¨ TransactionTemplateã€‚</p><p>b. å£°æ˜å¼äº‹åŠ¡ç®¡ç†å»ºç«‹åœ¨AOPä¹‹ä¸Šçš„ã€‚å…¶æœ¬è´¨æ˜¯é€šè¿‡AOPåŠŸèƒ½ï¼Œå¯¹æ–¹æ³•å‰åè¿›è¡Œæ‹¦æˆªï¼Œå°†äº‹åŠ¡å¤„ç†çš„åŠŸèƒ½ç¼–ç»‡åˆ°æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æ–¹æ³•å¼€å§‹ä¹‹å‰å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•ä¹‹åæ ¹æ®æ‰§è¡Œæƒ…å†µæäº¤æˆ–è€…å›æ»šäº‹åŠ¡ã€‚</p><blockquote><p>å£°æ˜å¼äº‹åŠ¡æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ä¸éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­æºæ‚äº‹åŠ¡ç®¡ç†çš„ä»£ç ï¼Œåªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­åšç›¸å…³çš„äº‹åŠ¡è§„åˆ™å£°æ˜æˆ–é€šè¿‡@Transactionalæ³¨è§£çš„æ–¹å¼ï¼Œä¾¿å¯ä»¥å°†äº‹åŠ¡è§„åˆ™åº”ç”¨åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œå‡å°‘ä¸šåŠ¡ä»£ç çš„æ±¡æŸ“ã€‚å”¯ä¸€ä¸è¶³åœ°æ–¹æ˜¯ï¼Œæœ€ç»†ç²’åº¦åªèƒ½ä½œç”¨åˆ°æ–¹æ³•çº§åˆ«ï¼Œæ— æ³•åšåˆ°åƒç¼–ç¨‹å¼äº‹åŠ¡é‚£æ ·å¯ä»¥ä½œç”¨åˆ°ä»£ç å—çº§åˆ«ã€‚</p></blockquote><p><strong>2. springçš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼š</strong></p><p>springäº‹åŠ¡çš„ä¼ æ’­æœºåˆ¶è¯´çš„æ˜¯ï¼Œå½“å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œspringå¦‚ä½•å¤„ç†è¿™äº›äº‹åŠ¡çš„è¡Œä¸ºã€‚äº‹åŠ¡ä¼ æ’­æœºåˆ¶å®é™…ä¸Šæ˜¯ä½¿ç”¨ç®€å•çš„ThreadLocalå®ç°çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè°ƒç”¨çš„æ–¹æ³•æ˜¯åœ¨æ–°çº¿ç¨‹è°ƒç”¨çš„ï¼Œäº‹åŠ¡ä¼ æ’­å®é™…ä¸Šæ˜¯ä¼šå¤±æ•ˆçš„ã€‚</p><blockquote><p>â‘  PROPAGATION_REQUIREDï¼šï¼ˆé»˜è®¤ä¼ æ’­è¡Œä¸ºï¼‰å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼›å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ã€‚</p><p>â‘¡ PROPAGATION_REQUIRES_NEWï¼šæ— è®ºå½“å‰å­˜ä¸å­˜åœ¨äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡è¿›è¡Œæ‰§è¡Œã€‚</p><p>â‘¢ PROPAGATION_SUPPORTSï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ‰§è¡Œã€‚â€˜</p><p>â‘£ PROPAGATION_NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</p><p>â‘¤ PROPAGATION_NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŒ‰REQUIREDå±æ€§æ‰§è¡Œã€‚</p><p>â‘¥ PROPAGATION_MANDATORYï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰ä¸å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>â‘¦ PROPAGATION_NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p></blockquote><p>äº‹åŠ¡ä¸åªé™äºè„è¯»ã€å¹»è¯»ç­‰åè¯ã€‚</p><p><strong>3. Springä¸­çš„éš”ç¦»çº§åˆ«ï¼š</strong></p><blockquote><p>â‘  ISOLATION_DEFAULTï¼šè¿™æ˜¯ä¸ª PlatfromTransactionManager é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p><p>â‘¡ ISOLATION_READ_UNCOMMITTEDï¼šè¯»æœªæäº¤ï¼Œå…è®¸äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯»å–å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚</p><p>â‘¢ ISOLATION_READ_COMMITTEDï¼šè¯»å·²æäº¤ï¼Œå…è®¸äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯»å–å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚</p><p>â‘£ ISOLATION_REPEATABLE_READï¼šå¯é‡å¤è¯»ï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…ï¼Œä»»æ„æ—¶åˆ»çš„æŸ¥è¯¢ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚</p><p>â‘¤ ISOLATION_SERIALIZABLEï¼šæ‰€æœ‰äº‹åŠ¡é€ä¸ªä¾æ¬¡æ‰§è¡Œã€‚</p></blockquote><p>ä½è°·è“„åŠ›</p><h2 id="springboot" tabindex="-1"><a class="header-anchor" href="#springboot"><span>SpringBoot</span></a></h2><h3 id="_1-ä¸ºä»€ä¹ˆè¦ç”¨-spring-boot" tabindex="-1"><a class="header-anchor" href="#_1-ä¸ºä»€ä¹ˆè¦ç”¨-spring-boot"><span>1. ä¸ºä»€ä¹ˆè¦ç”¨ spring bootï¼Ÿ</span></a></h3><p>é€šè¿‡è‡ªåŠ¨é…ç½®æ–¹å¼ç®€åŒ– Spring åº”ç”¨çš„å¼€å‘ï¼Œå¼±åŒ–é…ç½®ï¼Œéµå¾ª <strong>çº¦å®šå¤§äºé…ç½®çš„åŸåˆ™</strong> ï¼Œä½¿å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡å¼€å‘è€Œæ— éœ€è¿‡å¤šè€ƒè™‘é…ç½®ç›¸å…³æ“ä½œï¼Œé€šè¿‡å¯åŠ¨ç±»çš„ main æ–¹æ³•ä¸€é”®å¯åŠ¨åº”ç”¨ã€‚</p><h3 id="_2-spring-boot-æœ‰å“ªäº›ä¼˜ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-spring-boot-æœ‰å“ªäº›ä¼˜ç‚¹"><span>2. spring boot æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</span></a></h3><ol><li><p>ç‹¬ç«‹è¿è¡Œã€‚ å†…åµŒäº† servletï¼Œtomat ç­‰ï¼Œä¸éœ€è¦æ‰“æˆ war åŒ…éƒ¨ç½²åˆ°å®¹å™¨ä¸­ï¼Œåªéœ€è¦å°† SpringBoot é¡¹ç›®æ‰“æˆjaråŒ…å°±èƒ½ç‹¬ç«‹è¿è¡Œã€‚</p></li><li><p>ç®€åŒ–é…ç½®ã€‚ å¯åŠ¨å™¨è‡ªåŠ¨ä¾èµ–å…¶ä»–ç»„ä»¶ï¼Œç®€å°‘äº† maven çš„é…ç½®ã€‚å„ç§å¸¸ç”¨ç»„ä»¶åŠé…ç½®å·²ç»é»˜è®¤é…ç½®å®Œæˆï¼Œæ— éœ€è¿‡å¤šå¹²é¢„ã€‚</p></li><li><p>é¿å…å¤§é‡çš„ Maven å¯¼å…¥å’Œå„ç§ç‰ˆæœ¬å†²çªã€‚</p></li><li><p>åº”ç”¨ç›‘æ§ã€‚ Spring Boot æä¾›ä¸€ç³»åˆ—ç«¯ç‚¹å¯ä»¥ç›‘æ§æœåŠ¡åŠåº”ç”¨ã€‚</p></li></ol><h3 id="_3-spring-boot-æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_3-spring-boot-æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆ"><span>3. spring boot æ ¸å¿ƒé…ç½®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>springboot æ ¸å¿ƒçš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><ul><li><p>bootstrap (. yml æˆ–è€… . properties)ï¼šboostrap ç”±çˆ¶ ApplicationContext åŠ è½½çš„ï¼Œ æ¯” applicaton ä¼˜å…ˆåŠ è½½ï¼Œé…ç½®åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µç”Ÿæ•ˆï¼Œä¸” bootstrap é‡Œé¢çš„å±æ€§ä¸èƒ½è¢«è¦†ç›–ï¼›ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬åœ¨ SpringCloud Config æˆ–è€… Nacos ä¸­ä¼šç”¨åˆ°å®ƒã€‚</p></li><li><p>application (. yml æˆ–è€… . properties)ï¼šç”¨äº springboot é¡¹ç›®çš„è‡ªåŠ¨åŒ–é…ç½®</p></li></ul><h3 id="_4-spring-bootçš„æ ¸å¿ƒæ³¨è§£æ˜¯ä»€ä¹ˆ-ç”±é‚£äº›æ³¨è§£ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#_4-spring-bootçš„æ ¸å¿ƒæ³¨è§£æ˜¯ä»€ä¹ˆ-ç”±é‚£äº›æ³¨è§£ç»„æˆ"><span>4. spring bootçš„æ ¸å¿ƒæ³¨è§£æ˜¯ä»€ä¹ˆï¼Ÿç”±é‚£äº›æ³¨è§£ç»„æˆï¼Ÿ</span></a></h3><p>æ ¸å¿ƒæ³¨è§£ä¸ºï¼š<strong>@SpringBootApplication</strong></p><p>è¯¥æ³¨è§£ä¸»è¦ç”±ä¸‰ä¸ªæ³¨è§£ç»„æˆï¼š</p><p>â€‹ <code>@SpringBootConfiguration()</code>:ä»£è¡¨å½“å‰æ˜¯ä¸€ä¸ªé…ç½®ç±» â€‹ <code>@EnableAutoConfiguration()</code>: å¯åŠ¨è‡ªåŠ¨é…ç½® â€‹ <code>@ComponentScan()</code>ï¼šæŒ‡å®šæ‰«æå“ªäº› Spring æ³¨è§£</p><h3 id="_5-è¯´ä¸€ä¸‹springbootçš„è‡ªåŠ¨è£…é…åŸç†" tabindex="-1"><a class="header-anchor" href="#_5-è¯´ä¸€ä¸‹springbootçš„è‡ªåŠ¨è£…é…åŸç†"><span>5. è¯´ä¸€ä¸‹springbootçš„è‡ªåŠ¨è£…é…åŸç†</span></a></h3><ol><li><p>SpringBootå¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸»é…ç½®ç±»ï¼Œå¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½@EnableAutoConfigurationã€‚</p></li><li><p>æŸ¥çœ‹@EnableAutoConfigurationï¼Œå…¶ä½œç”¨æ˜¯åˆ©ç”¨AutoConfigurationImportSelectorç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶ã€‚</p></li><li><p>æŸ¥çœ‹AutoConfigurationImportSelectorï¼Œå…¶ä¸­public String[] selectImports(AnnotationMetadata annotationMetadata)æ–¹æ³•å†… æœ€ç»ˆè°ƒç”¨getCandidateConfigurations()æ–¹æ³•</p></li><li><p>æŸ¥çœ‹ getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes)ï¼Œè·å–å€™é€‰çš„é…ç½®ï¼Œè¿™ä¸ªæ˜¯æ‰«ææ‰€æœ‰jaråŒ…ç±»è·¯å¾„ä¸‹&quot;META-INF/spring.factories&quot;</p></li><li><p>ç„¶åæŠŠæ‰«æåˆ°çš„è¿™äº›æ–‡ä»¶åŒ…è£…æˆPropertieså¯¹è±¡ã€‚</p></li><li><p>ä»propertiesä¸­è·å–åˆ°EnableAutoConfiguration.classç±»åå¯¹åº”çš„å€¼ï¼Œç„¶åæŠŠä»–ä»¬æ·»åŠ åœ¨å®¹å™¨ä¸­ã€‚</p></li></ol><p><strong>ç®€è€Œè¨€ä¹‹ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±æ˜¯å°†ç±»è·¯å¾„ä¸‹ &quot;META-INF/spring.factories&quot; é‡Œé¢é…ç½®çš„æ‰€æœ‰ EnableAutoConfiguration çš„å€¼åŠ å…¥åˆ°å®¹å™¨ä¸­ã€‚</strong></p><h3 id="_6-springbootã€spring-mvcå’Œspringæœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_6-springbootã€spring-mvcå’Œspringæœ‰ä»€ä¹ˆåŒºåˆ«"><span>6. SpringBootã€Spring MVCå’ŒSpringæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><p><strong>Spring</strong>ï¼šä¸»è¦ç”¨æ¥åˆ›å»ºIOCå®¹å™¨ï¼Œä¾èµ–æ³¨å…¥ï¼Œå®ç°ç¨‹åºé—´çš„æ¾è€¦åˆ</p><p><strong>SpringMVC</strong>: ä¸»è¦æ˜¯ç”¨æ¥åšWEBå¼€å‘ï¼Œé€šè¿‡å„ç§ç»„ä»¶çš„åè°ƒé…åˆï¼Œç®€åŒ–Webåº”ç”¨çš„å¼€å‘</p><p><strong>SpringBoot</strong>: SpringBootæ›´åƒæ˜¯ä¸€ä¸ªç®¡å®¶ï¼Œå½“ä½¿ç”¨åˆ°å¯¹åº”åŠŸèƒ½æ—¶ï¼Œåªéœ€è¦å¯¼å…¥æŒ‡å®šåº”ç”¨å¯åŠ¨å™¨ï¼ŒSpringBootå°±èƒ½å¤Ÿåœ¨åº•å±‚é»˜è®¤å…¶é…ç½®ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘æ‰€éœ€çš„ç¹æ‚é…ç½®</p><h3 id="_7-springbootå¯åŠ¨æ—¶éƒ½åšäº†ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_7-springbootå¯åŠ¨æ—¶éƒ½åšäº†ä»€ä¹ˆ"><span>7. SpringBootå¯åŠ¨æ—¶éƒ½åšäº†ä»€ä¹ˆ?</span></a></h3><p>Springboot çš„å¯åŠ¨ï¼Œä¸»è¦åˆ›å»ºäº†é…ç½®ç¯å¢ƒ (environment)ã€äº‹ä»¶ç›‘å¬ (listeners)ã€åº”ç”¨ä¸Šä¸‹æ–‡(applicationContext)ï¼Œå¹¶åŸºäºä»¥ä¸Šæ¡ä»¶ï¼Œåœ¨å®¹å™¨ä¸­å¼€å§‹å®ä¾‹åŒ–æˆ‘ä»¬éœ€è¦çš„ Beanï¼Œè‡³æ­¤ï¼Œé€šè¿‡ SpringBoot å¯åŠ¨çš„ç¨‹åºå·²ç»æ„é€ å®Œæˆã€‚</p><h3 id="_8-springboot-ä¸­çš„ç›‘è§†å™¨æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_8-springboot-ä¸­çš„ç›‘è§†å™¨æ˜¯ä»€ä¹ˆ"><span>8. SpringBoot ä¸­çš„ç›‘è§†å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>SpringBoot Actuator æ˜¯ SpringBoot ä¸€é¡¹é‡è¦åŠŸèƒ½ï¼Œå…¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ï¼Œå¯¹è¿è¡Œæ—¶æŒ‡æ ‡è¿›è¡Œæ£€æŸ¥å’Œç›‘æ§ï¼Œç›‘è§†å™¨æä¾›äº†ä¸€ç»„å¯ä»¥ç›´æ¥ä½œä¸º httpurl è®¿é—®çš„ rest ç«¯ç‚¹æ¥è®¿é—®æŸ¥çœ‹æŒ‡å®šåŠŸèƒ½çŠ¶æ€ã€‚</p><h3 id="_9-springboot-ä¸­çš„starteråˆ°åº•æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_9-springboot-ä¸­çš„starteråˆ°åº•æ˜¯ä»€ä¹ˆ"><span>9. SpringBoot ä¸­çš„starteråˆ°åº•æ˜¯ä»€ä¹ˆ ?</span></a></h3><p>é¦–å…ˆï¼Œè¿™ä¸ª Starter å¹¶éä»€ä¹ˆæ–°çš„æŠ€æœ¯ç‚¹ï¼ŒåŸºæœ¬ä¸Šè¿˜æ˜¯åŸºäº Spring å·²æœ‰åŠŸèƒ½æ¥å®ç°çš„ã€‚é¦–å…ˆå®ƒæä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œä¸€èˆ¬å‘½åä¸º XXXAutoConfiguration ï¼Œåœ¨è¿™ä¸ªé…ç½®ç±»ä¸­é€šè¿‡æ¡ä»¶æ³¨è§£æ¥å†³å®šä¸€ä¸ªé…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼ˆæ¡ä»¶æ³¨è§£å°±æ˜¯ Spring ä¸­åŸæœ¬å°±æœ‰çš„ï¼‰ï¼Œç„¶åå®ƒè¿˜ä¼šæä¾›ä¸€ç³»åˆ—çš„é»˜è®¤é…ç½®ï¼Œä¹Ÿå…è®¸å¼€å‘è€…æ ¹æ®å®é™…æƒ…å†µè‡ªå®šä¹‰ç›¸å…³é…ç½®ï¼Œç„¶åé€šè¿‡ç±»å‹å®‰å…¨çš„å±æ€§æ³¨å…¥å°†è¿™äº›é…ç½®å±æ€§æ³¨å…¥è¿›æ¥ï¼Œæ–°æ³¨å…¥çš„å±æ€§ä¼šä»£æ›¿æ‰é»˜è®¤å±æ€§ã€‚</p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¾èµ–å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚å½“ç„¶ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Starter</p><p><strong>æ‹“å±•ï¼šå¦‚ä½•è‡ªå®šä¹‰starter?</strong></p><ol><li><p>åˆ›å»ºé¡¹ç›®ï¼Œåˆ›å»ºä¸¤ä¸ªæ¨¡å—åˆ†åˆ«ä¸º <code>spring-boot-starter-*</code>ï¼Œ<code>spring-boot-starter-*-autoconfiguration</code></p></li><li><p><code>spring-boot-starter-*</code> pom å¼•å…¥ <code>spring-boot-starter-*-autoconfiguration</code></p></li><li><p><code>spring-boot-starter-*-autoconfiguration</code> åˆ›å»ºåŠŸèƒ½æ–¹æ³•ï¼Œåˆ›å»º *propertiesç±»ï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®ç±»å°†åŠŸèƒ½æ–¹æ³•ç±»æ·»åŠ åˆ° spring å®¹å™¨ï¼Œåœ¨ resouces ä¸‹åˆ›å»º <code>META-INF/spring.factories</code> é…ç½® ã€€ã€€ã€€ã€€<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</code> ã€€ã€€ã€€ã€€<code>org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration</code></p></li><li><p>æ‰“åŒ…å®‰è£…è¿™ä¸¤ä¸ªæ¨¡å—åˆ°æœ¬åœ° maven ä»“åº“ï¼Œå³å¯åœ¨å…¶ä»–é¡¹ç›®å¼•å…¥ <code>spring-boot-starter-*</code> æ³¨å…¥åŠŸèƒ½ç±»è¿›è¡Œæ–¹æ³•è°ƒç”¨</p></li></ol><h3 id="_10-å¾®æœåŠ¡ä¸­å¦‚ä½•å®ç°-session-å…±äº«" tabindex="-1"><a class="header-anchor" href="#_10-å¾®æœåŠ¡ä¸­å¦‚ä½•å®ç°-session-å…±äº«"><span>10. å¾®æœåŠ¡ä¸­å¦‚ä½•å®ç° session å…±äº«?</span></a></h3><p>åœ¨å¾®æœåŠ¡ä¸­ï¼Œä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®è¢«æ‹†åˆ†æˆå¤šä¸ªä¸ç›¸åŒçš„ç‹¬ç«‹çš„æœåŠ¡ï¼Œå„ä¸ªæœåŠ¡ç‹¬ç«‹éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå„è‡ªçš„ session è¢«ä»ç‰©ç†ç©ºé—´ä¸Šéš”ç¦»å¼€äº†ï¼Œä½†æ˜¯ç»å¸¸ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸åŒå¾®æœåŠ¡ä¹‹é—´å…±äº« session ï¼Œå¸¸è§çš„æ–¹æ¡ˆå°±æ˜¯ Spring Session + Redis æ¥å®ç° session å…±äº«ã€‚å°†æ‰€æœ‰å¾®æœåŠ¡çš„ session ç»Ÿä¸€ä¿å­˜åœ¨ Redis ä¸Šï¼Œå½“å„ä¸ªå¾®æœåŠ¡å¯¹ session æœ‰ç›¸å…³çš„è¯»å†™æ“ä½œæ—¶ï¼Œéƒ½å»æ“ä½œ Redis ä¸Šçš„ session ã€‚ è¿™æ ·å°±å®ç°äº† session å…±äº«ï¼ŒSpring Session åŸºäº Spring ä¸­çš„ä»£ç†è¿‡æ»¤å™¨å®ç°ï¼Œä½¿å¾— session çš„åŒæ­¥æ“ä½œå¯¹å¼€å‘äººå‘˜è€Œè¨€æ˜¯é€æ˜çš„ï¼Œéå¸¸ç®€ä¾¿ã€‚</p><h2 id="zookeeper" tabindex="-1"><a class="header-anchor" href="#zookeeper"><span>Zookeeper</span></a></h2><h3 id="_1-ä»€ä¹ˆæ˜¯-zookeeper" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯-zookeeper"><span>1. ä»€ä¹ˆæ˜¯ Zookeeper</span></a></h3><p>ZooKeeper æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäº Zookeeper å®ç°è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Master é€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚</p><p>Zookeeper ä»è®¾è®¡æ¨¡å¼è§’åº¦æ¥ç†è§£ï¼Œ æ˜¯ä¸€ä¸ªåŸºäº<strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒ<strong>è´Ÿè´£å­˜å‚¨å’Œç®¡ç†å¤§å®¶éƒ½å…³å¿ƒçš„æ•°æ®</strong>ï¼Œç„¶å<strong>æ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œ</strong>ï¼Œä¸€æ—¦è¿™äº›æ•°æ®çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒZookeeperå°±å°†<strong>è´Ÿè´£é€šçŸ¥å·²ç»åœ¨Zookeeperä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…</strong>åšå‡ºååº”ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä»€ä¹ˆï¼š<a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzNDUyOTY0Nw==&amp;action=getalbum&amp;album_id=1969202758012436483#wechat_redirect" target="_blank" rel="noopener noreferrer">è®¾è®¡æ¨¡å¼</a></p><p>å¯ä»¥è¿™æ ·ç†è§£ï¼š</p><p><code>ZooKeeper=æ–‡ä»¶ç³»ç»Ÿ+é€šçŸ¥æœºåˆ¶</code></p><h3 id="_2-zk-çš„èŠ‚ç‚¹ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_2-zk-çš„èŠ‚ç‚¹ç±»å‹"><span>2. ZK çš„èŠ‚ç‚¹ç±»å‹</span></a></h3><blockquote><p>è¿™é“é¢˜ç›¸ä¿¡å¤§å®¶éƒ½æœ‰æ‰€äº†è§£ï¼Œzookeeper v3.6.2 ç‰ˆæœ¬åï¼Œæ”¯æŒ7ç§èŠ‚ç‚¹ç±»å‹ã€‚æŒä¹…ï¼›æŒä¹…é¡ºåºï¼›ä¸´æ—¶ï¼›ä¸´æ—¶é¡ºåºï¼›å®¹å™¨ï¼›æŒä¹… TTLï¼›æŒä¹…é¡ºåº TTLã€‚</p></blockquote><p>è¯´å‡ºè¿™å‡ ç§ç±»å‹å½“ç„¶å·²ç»å›ç­”äº†é—®é¢˜ï¼Œä½†æ˜¯ç»†èŠ‚çš„æè¿°æ›´èƒ½ä½“ç°ä½ çš„çŸ¥è¯†åº•è•´ã€‚</p><p><strong>æŒä¹… TTLã€æŒä¹…é¡ºåº TTL</strong></p><p>å…³äºæŒä¹…å’Œé¡ºåºè¿™ä¸¤ä¸ªå…³é”®å­—ï¼Œä¸ç”¨æˆ‘å†è§£é‡Šäº†ï¼Œè¿™ä¸¤ç§ç±»å‹çš„èŠ‚ç‚¹é‡ç‚¹æ˜¯åé¢çš„ TTLï¼ŒTTL æ˜¯ <code>time to live</code> çš„ç¼©å†™ï¼ŒæŒ‡å¸¦æœ‰å­˜æ´»æ—¶é—´ï¼Œç®€å•æ¥è¯´å°±æ˜¯å½“è¯¥èŠ‚ç‚¹ä¸‹é¢æ²¡æœ‰å­èŠ‚ç‚¹çš„è¯ï¼Œè¶…è¿‡äº† TTL æŒ‡å®šæ—¶é—´åå°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä½†æ˜¯ TTL å¯ç”¨æ˜¯éœ€è¦é¢å¤–çš„é…ç½®(è¿™ä¸ªä¹‹å‰ä¹Ÿæœ‰æè¿‡)é…ç½®æ˜¯ zookeeper.extendedTypesEnabled éœ€è¦é…ç½®æˆ trueï¼Œå¦åˆ™çš„è¯åˆ›å»º TTL æ—¶ä¼šæ”¶åˆ° Unimplemented çš„æŠ¥é”™ã€‚</p><h3 id="_3-zookeeper-ä¸‹-server-å·¥ä½œçŠ¶æ€æœ‰å“ªäº›" tabindex="-1"><a class="header-anchor" href="#_3-zookeeper-ä¸‹-server-å·¥ä½œçŠ¶æ€æœ‰å“ªäº›"><span>3. Zookeeper ä¸‹ Server å·¥ä½œçŠ¶æ€æœ‰å“ªäº›ï¼Ÿ</span></a></h3><p>æœåŠ¡å™¨å…·æœ‰å››ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ LOOKINGã€FOLLOWINGã€LEADINGã€OBSERVINGã€‚</p><ul><li><p><strong>LOOKING</strong>ï¼šå¯» æ‰¾ Leader çŠ¶æ€ã€‚å½“æœåŠ¡å™¨å¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œå®ƒä¼šè®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰Leaderï¼Œå› æ­¤éœ€è¦è¿›å…¥ Leader é€‰ä¸¾çŠ¶æ€ã€‚</p></li><li><p><strong>FOLLOWING</strong>ï¼šè·Ÿéšè€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Followerã€‚</p></li><li><p><strong>LEADING</strong>ï¼šé¢†å¯¼è€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Leaderã€‚</p></li><li><p><strong>OBSERVING</strong>ï¼šè§‚å¯Ÿè€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯ Observerã€‚ï¼ˆObserverè§’è‰²é™¤äº†ä¸èƒ½æŠ•ç¥¨(ä»¥åŠå’ŒæŠ•ç¥¨ç›¸å…³çš„èƒ½åŠ›)å’Œè¿‡åŠå†™æˆåŠŸç­–ç•¥å¤–ï¼Œå…¶å®ƒå’ŒfolloweråŠŸèƒ½ä¸€æ ·ã€‚observerè§’è‰²å‡è½»äº†æŠ•ç¥¨çš„å‹åŠ›ï¼Œåœ¨ä»¥å‰é€šè¿‡å¢ã€å‡followerçš„æ•°é‡æé«˜ä¼¸ç¼©æ€§ã€‚æŠ•ç¥¨æ¥è¯´ï¼Œfolloweræ˜¯æœ‰çŠ¶æ€çš„ï¼Œéƒ½ç›´æ¥å½±å“æŠ•ç¥¨ç»“æœï¼Œç‰¹åˆ«æ˜¯followerçš„æ•°é‡è¶Šå¤šï¼ŒæŠ•ç¥¨è¿‡ç¨‹çš„æ€§èƒ½å°±è¶Šå·®ã€‚ï¼‰</p></li></ul><h3 id="_4-zookeeperæ˜¯cpè¿˜æ˜¯ap" tabindex="-1"><a class="header-anchor" href="#_4-zookeeperæ˜¯cpè¿˜æ˜¯ap"><span>4. zookeeperæ˜¯cpè¿˜æ˜¯ap?</span></a></h3><p>zkéµå¾ªçš„æ˜¯CPåŸåˆ™ï¼Œå³ä¿è¯ä¸€è‡´æ€§å’Œç½‘ç»œåˆ†åŒºå®¹é”™æ€§ï¼Œä½†ä¸ä¿è¯å¯ç”¨æ€§ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯cap?</strong></p><p>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªä¸»æœºä¹‹é—´æ˜¯å¦èƒ½å¤Ÿä¿æŒæ•°æ®ä¸€è‡´æ€§çš„ç‰¹æ€§ã€‚å³å½“ç³»ç»Ÿæ•°æ®å‘ç”Ÿæ›´æ–°æ“ä½œä¹‹åï¼Œå„ä¸ªä¸»æœºä¸­çš„æ•°æ®æ˜¯å¦ä»ç„¶å¤„äºä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ï¼šç³»ç»Ÿæä¾›çš„æœåŠ¡å¿…é¡»ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå³å¯¹äºçš„æ¯ä¸€ä¸ªè¯·æ±‚ï¼Œç³»ç»Ÿæ€»æ˜¯å¯ä»¥åœ¨<strong>æœ‰é™çš„æ—¶é—´</strong>å†…å¯¹ç”¨æˆ·åšå‡ºå“åº”ã€‚</p><p>Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœæ—¶å€™ï¼Œä»ç„¶ä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ã€‚</p><h3 id="_5-è¯´å‡ ä¸ª-zookeeper-å¸¸ç”¨çš„å‘½ä»¤ã€‚" tabindex="-1"><a class="header-anchor" href="#_5-è¯´å‡ ä¸ª-zookeeper-å¸¸ç”¨çš„å‘½ä»¤ã€‚"><span>5. è¯´å‡ ä¸ª zookeeper å¸¸ç”¨çš„å‘½ä»¤ã€‚</span></a></h3><p>å¸¸ç”¨å‘½ä»¤ï¼šls get set create delete ç­‰ã€‚</p><h3 id="_6-ä»‹ç»ä¸€ä¸‹zabåè®®" tabindex="-1"><a class="header-anchor" href="#_6-ä»‹ç»ä¸€ä¸‹zabåè®®"><span>6. ä»‹ç»ä¸€ä¸‹ZABåè®®ï¼Ÿ</span></a></h3><p>ZABåè®®æ˜¯ä¸ºåˆ†å¸ƒå¼åè°ƒæœåŠ¡Zookeeperä¸“é—¨è®¾è®¡çš„ä¸€ç§æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®ã€‚</p><p>ZABåè®®åŒ…æ‹¬ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼š</p><ol><li><p>å´©æºƒæ¢å¤</p></li><li><p>æ¶ˆæ¯å¹¿æ’­</p></li></ol><p>å½“æ•´ä¸ª zookeeper é›†ç¾¤åˆšåˆšå¯åŠ¨æˆ–è€…LeaderæœåŠ¡å™¨å®•æœºã€é‡å¯æˆ–è€…ç½‘ç»œæ•…éšœå¯¼è‡´ä¸å­˜åœ¨è¿‡åŠçš„æœåŠ¡å™¨ä¸ Leader æœåŠ¡å™¨ä¿æŒæ­£å¸¸é€šä¿¡æ—¶ï¼Œæ‰€æœ‰è¿›ç¨‹ï¼ˆæœåŠ¡å™¨ï¼‰è¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼ï¼Œé¦–å…ˆé€‰ä¸¾äº§ç”Ÿæ–°çš„ Leader æœåŠ¡å™¨ï¼Œç„¶åé›†ç¾¤ä¸­ Follower æœåŠ¡å™¨å¼€å§‹ä¸æ–°çš„ Leader æœåŠ¡å™¨è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå½“é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°æœºå™¨ä¸è¯¥ Leader æœåŠ¡å™¨å®Œæˆæ•°æ®åŒæ­¥ä¹‹åï¼Œé€€å‡ºæ¢å¤æ¨¡å¼è¿›å…¥æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ï¼ŒLeader æœåŠ¡å™¨å¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚ç”Ÿæˆäº‹ç‰©ææ¡ˆæ¥è¿›è¡Œäº‹åŠ¡è¯·æ±‚å¤„ç†ã€‚</p><h3 id="_7-zab-å’Œ-paxos-ç®—æ³•çš„è”ç³»ä¸åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_7-zab-å’Œ-paxos-ç®—æ³•çš„è”ç³»ä¸åŒºåˆ«"><span>7. ZAB å’Œ Paxos ç®—æ³•çš„è”ç³»ä¸åŒºåˆ«ï¼Ÿ</span></a></h3><p><strong>ç›¸åŒç‚¹ï¼š</strong></p><ol><li><p>ä¸¤è€…éƒ½å­˜åœ¨ä¸€ä¸ªç±»ä¼¼äº Leader è¿›ç¨‹çš„è§’è‰²ï¼Œç”±å…¶è´Ÿè´£åè°ƒå¤šä¸ª Follower è¿›ç¨‹çš„è¿è¡Œ</p></li><li><p>Leader è¿›ç¨‹éƒ½ä¼šç­‰å¾…è¶…è¿‡åŠæ•°çš„ Follower åšå‡ºæ­£ç¡®çš„åé¦ˆåï¼Œæ‰ä¼šå°†ä¸€ä¸ªææ¡ˆè¿›è¡Œæäº¤</p></li><li><p>ZAB åè®®ä¸­ï¼Œæ¯ä¸ª Proposal ä¸­éƒ½åŒ…å«ä¸€ä¸ª epoch å€¼æ¥ä»£è¡¨å½“å‰çš„ Leader å‘¨æœŸï¼ŒPaxos ä¸­åå­—ä¸º Ballot</p></li></ol><p><strong>ä¸åŒç‚¹ï¼š</strong></p><p>ZAB(ZooKeeper Atomic Broadcast) ç”¨æ¥æ„å»ºé«˜å¯ç”¨çš„åˆ†å¸ƒå¼æ•°æ®ä¸»å¤‡ç³»ç»Ÿï¼ˆZookeeperï¼‰ï¼ŒPaxos æ˜¯ç”¨æ¥æ„å»ºåˆ†å¸ƒå¼ä¸€è‡´æ€§çŠ¶æ€æœºç³»ç»Ÿã€‚</p><p>è€Œ Paxos ç®—æ³•ä¸ ZAB åè®®ä¸åŒçš„æ˜¯ï¼ŒPaxos ç®—æ³•çš„å‘èµ·è€…å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªã€‚å½“é›†ç¾¤ä¸­çš„ Acceptor æœåŠ¡å™¨ä¸­çš„å¤§å¤šæ•°å¯ä»¥æ‰§è¡Œä¼šè¯è¯·æ±‚åï¼Œæè®®è€…æœåŠ¡å™¨åªè´Ÿè´£å‘é€æäº¤æŒ‡ä»¤ï¼Œäº‹åŠ¡çš„æ‰§è¡Œå®é™…å‘ç”Ÿåœ¨ Acceptor æœåŠ¡å™¨ã€‚è¿™ä¸ ZooKeeper æœåŠ¡å™¨ä¸Šäº‹åŠ¡çš„æ‰§è¡Œå‘ç”Ÿåœ¨ Leader æœåŠ¡å™¨ä¸Šä¸åŒã€‚Paxos ç®—æ³•åœ¨æ•°æ®åŒæ­¥é˜¶æ®µï¼Œæ˜¯å¤šå° Acceptor æœåŠ¡å™¨ä½œä¸ºæ•°æ®æºåŒæ­¥ç»™é›†ç¾¤ä¸­çš„å¤šå° Learner æœåŠ¡å™¨ï¼Œè€Œ ZooKeeper åˆ™æ˜¯å•å° Leader æœåŠ¡å™¨ä½œä¸ºæ•°æ®æºåŒæ­¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»–è§’è‰²æœåŠ¡å™¨ã€‚</p><p>æ³¨æ„ï¼š</p><p>ZABæ˜¯åœ¨Paxosçš„åŸºç¡€ä¸Šæ”¹è¿›å’Œæ¼”å˜è¿‡æ¥çš„ã€‚</p><p>æè®®è€…ï¼ˆProposerï¼‰ã€å†³ç­–è€…ï¼ˆAcceptorï¼‰ã€å†³ç­–å­¦ä¹ è€…ï¼ˆLearnerï¼‰</p><h3 id="_8-zookeeper-çš„å…¸å‹åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_8-zookeeper-çš„å…¸å‹åº”ç”¨åœºæ™¯"><span>8. Zookeeper çš„å…¸å‹åº”ç”¨åœºæ™¯</span></a></h3><ol><li>æ•°æ®å‘å¸ƒ/è®¢é˜…</li><li>è´Ÿè½½å‡è¡¡</li><li>å‘½åæœåŠ¡</li><li>åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥</li><li>é›†ç¾¤ç®¡ç†</li><li>Master é€‰ä¸¾</li><li>åˆ†å¸ƒå¼é”</li><li>åˆ†å¸ƒå¼é˜Ÿåˆ—</li></ol><p><strong>æ•°æ®å‘å¸ƒ/è®¢é˜…ç³»ç»Ÿ</strong>ï¼Œå³æ‰€è°“çš„é…ç½®ä¸­å¿ƒï¼Œç›®çš„ï¼šåŠ¨æ€è·å–æ•°æ®ï¼ˆé…ç½®ä¿¡æ¯ï¼‰ï¼Œå®ç°æ•°æ®ï¼ˆé…ç½®ä¿¡æ¯ï¼‰çš„é›†ä¸­å¼ç®¡ç†å’Œæ•°æ®çš„åŠ¨æ€æ›´æ–°</p><p><strong>Zookeeper åˆ†å¸ƒå¼é”</strong></p><p>æœ‰äº† zookeeper çš„ä¸€è‡´æ€§æ–‡ä»¶ç³»ç»Ÿï¼Œé”çš„é—®é¢˜å˜å¾—å®¹æ˜“ã€‚é”æœåŠ¡å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ä¸ªæ˜¯ä¿æŒç‹¬å ï¼Œå¦ä¸€ä¸ªæ˜¯æ§åˆ¶æ—¶åºã€‚</p><p>å¯¹äºç¬¬ä¸€ç±»ï¼Œæˆ‘ä»¬å°† zookeeper ä¸Šçš„ä¸€ä¸ª znode çœ‹ä½œæ˜¯ä¸€æŠŠé”ï¼Œé€šè¿‡ createznodeçš„æ–¹å¼æ¥å®ç°ã€‚æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å»åˆ›å»º /task_lock èŠ‚ç‚¹ï¼Œæœ€ç»ˆæˆåŠŸåˆ›å»ºçš„é‚£ä¸ªå®¢æˆ·ç«¯ä¹Ÿå³æ‹¥æœ‰äº†è¿™æŠŠé”ã€‚ç”¨å®Œåˆ é™¤æ‰è‡ªå·±åˆ›å»ºçš„ task_lock èŠ‚ç‚¹å°±é‡Šæ”¾å‡ºé”ã€‚</p><p>å¯¹äºç¬¬äºŒç±»ï¼Œ /task_lock å·²ç»é¢„å…ˆå­˜åœ¨ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯åœ¨å®ƒä¸‹é¢åˆ›å»ºä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼Œå’Œé€‰ master ä¸€æ ·ï¼Œç¼–å·æœ€å°çš„è·å¾—é”ï¼Œç”¨å®Œåˆ é™¤ï¼Œä¾æ¬¡æ–¹ä¾¿ã€‚</p><p><strong>Zookeeper é˜Ÿåˆ—ç®¡ç†</strong></p><blockquote><p>ä¸€èˆ¬å¾ˆå°‘ç”¨åˆ°ï¼Œå¯ç®€å•äº†è§£</p></blockquote><p>ä¸¤ç§ç±»å‹çš„é˜Ÿåˆ—ï¼š</p><ol><li><p>åŒæ­¥é˜Ÿåˆ—ï¼Œå½“ä¸€ä¸ªé˜Ÿåˆ—çš„æˆå‘˜éƒ½èšé½æ—¶ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ‰å¯ç”¨ï¼Œå¦åˆ™ä¸€ç›´ç­‰å¾…æ‰€æœ‰æˆå‘˜åˆ°è¾¾ã€‚</p></li><li><p>é˜Ÿåˆ—æŒ‰ç…§ FIFO æ–¹å¼è¿›è¡Œå…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œã€‚</p></li></ol><p>ç¬¬ä¸€ç±»ï¼Œåœ¨çº¦å®šç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶ç›®å½•èŠ‚ç‚¹ï¼Œç›‘å¬èŠ‚ç‚¹æ•°ç›®æ˜¯å¦æ˜¯æˆ‘ä»¬è¦æ±‚çš„æ•°ç›®ã€‚</p><p>ç¬¬äºŒç±»ï¼Œå’Œåˆ†å¸ƒå¼é”æœåŠ¡ä¸­çš„æ§åˆ¶æ—¶åºåœºæ™¯åŸºæœ¬åŸç†ä¸€è‡´ï¼Œå…¥åˆ—æœ‰ç¼–å·ï¼Œå‡ºåˆ—æŒ‰ç¼–å·ã€‚åœ¨ç‰¹å®šçš„ç›®å½•ä¸‹åˆ›å»º PERSISTENT_SEQUENTIAL èŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸæ—¶Watcher é€šçŸ¥ç­‰å¾…çš„é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—åˆ é™¤åºåˆ—å·æœ€å°çš„èŠ‚ç‚¹ç”¨ä»¥æ¶ˆè´¹ã€‚æ­¤åœºæ™¯ä¸‹Zookeeper çš„ znode ç”¨äºæ¶ˆæ¯å­˜å‚¨ï¼Œznode å­˜å‚¨çš„æ•°æ®å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å†…å®¹ï¼ŒSEQUENTIAL åºåˆ—å·å°±æ˜¯æ¶ˆæ¯çš„ç¼–å·ï¼ŒæŒ‰åºå–å‡ºå³å¯ã€‚ç”±äºåˆ›å»ºçš„èŠ‚ç‚¹æ˜¯æŒä¹…åŒ–çš„ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒé˜Ÿåˆ—æ¶ˆæ¯çš„ä¸¢å¤±é—®é¢˜ã€‚</p><h3 id="_9-chrootç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_9-chrootç‰¹æ€§"><span>9. Chrootç‰¹æ€§</span></a></h3><p>zookeeper v3.2.0 ç‰ˆæœ¬åï¼Œæ·»åŠ äº† Chroot ç‰¹æ€§ï¼Œè¯¥ç‰¹æ€§å…è®¸æ¯ä¸ªå®¢æˆ·ç«¯ä¸ºè‡ªå·±è®¾ç½®ä¸€ä¸ªå‘½åç©ºé—´ã€‚å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯è®¾ç½®äº† Chrootï¼Œé‚£ä¹ˆè¯¥å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨çš„ä»»ä½•æ“ä½œï¼Œéƒ½å°†ä¼šè¢«é™åˆ¶åœ¨å…¶è‡ªå·±çš„å‘½åç©ºé—´ä¸‹ã€‚</p><p>é€šè¿‡è®¾ç½® Chrootï¼Œèƒ½å¤Ÿå°†ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨äº Zookeeper æœåŠ¡ç«¯çš„ä¸€é¢—å­æ ‘ç›¸å¯¹åº”ï¼Œåœ¨é‚£äº›å¤šä¸ªåº”ç”¨å…±ç”¨ä¸€ä¸ª Zookeeper è¿›ç¾¤çš„åœºæ™¯ä¸‹ï¼Œå¯¹å®ç°ä¸åŒåº”ç”¨é—´çš„ç›¸äº’éš”ç¦»éå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="æ‹“å±•" tabindex="-1"><a class="header-anchor" href="#æ‹“å±•"><span>æ‹“å±•</span></a></h3><p>ZooKeeperä»¥Fast Paxosç®—æ³•ä¸ºåŸºç¡€ï¼ŒPaxos ç®—æ³•å­˜åœ¨æ´»é”çš„é—®é¢˜ï¼Œå³å½“æœ‰å¤šä¸ª proposer äº¤é”™æäº¤æ—¶æœ‰å¯èƒ½äº’ç›¸æ’æ–¥å¯¼è‡´æ²¡æœ‰ä¸€ä¸ªproposerèƒ½æäº¤æˆåŠŸï¼Œè€ŒFast Paxosåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œé€šè¿‡é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªé¢†å¯¼è€…ï¼Œåªæœ‰leaderæ‰èƒ½æäº¤proposerå…·ä½“ç®—æ³•å¯è§Fast Paxosã€‚</p><p>ä½è°·è“„åŠ›</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzUzNDUyOTY0Nw==&amp;action=getalbum&amp;album_id=2344061143381508097#wechat_redirect" target="_blank" rel="noopener noreferrer">ç‚¹å‡»åœ¨çº¿é˜…è¯»ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹</a></p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/Rodert/JavaPub/edit/main/src/posts/special/havato/ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹ç¬¬ä¸€ç‰ˆ.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: iswangshiyu@foxmail.com">wangshiyu</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link route-link-active auto-link prev" href="/posts/special/havato/" aria-label="ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>ã€Šæœ€å°‘å¿…è¦é¢è¯•é¢˜ã€‹</div></a><a class="route-link auto-link next" href="/posts/special/havato/docker-interview-must.html" aria-label="10é“ä¸å¾—ä¸ä¼šçš„ Docker é¢è¯•é¢˜"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">10é“ä¸å¾—ä¸ä¼šçš„ Docker é¢è¯•é¢˜<span class="font-icon icon fa-fw fa-sm fas fa-page" style=""></span></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">äº¬ICPå¤‡2021007111å·-2</a></div><div class="vp-copyright">Copyright Â© 2026 Mr.Wang </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BqsiRDZw.js" defer></script>
  </body>
</html>
