---
title: JavaNIO
icon: laptop-code
category:
  - ã€Šé¢è¯•1v1ã€‹
---



**æˆ‘æ˜¯ javapubï¼Œä¸€å `Markdown` ç¨‹åºå‘˜ä»ğŸ‘¨â€ğŸ’»ï¼Œå…«è‚¡æ–‡ç§å­é€‰æ‰‹ã€‚**




**<font color=blue>é¢è¯•å®˜</font>ï¼š ä½ å¥½ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹ä½ å¯¹ Java NIO çš„äº†è§£ã€‚**

**<font color=red>å€™é€‰äººï¼š</font>** å½“ç„¶ï¼ŒJava NIO æ˜¯ Java çš„ä¸€ç§ I/O æ¨¡å‹ï¼Œå®ƒæä¾›äº†ä¸€ç§åŸºäºç¼“å†²åŒºå’Œé€šé“çš„ I/O æ“ä½œæ–¹å¼ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„ I/O æ¨¡å‹ï¼ŒJava NIO å…·æœ‰æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¥½çš„æ‰©å±•æ€§ã€‚

**<font color=blue>é¢è¯•å®˜</font>ï¼š é‚£ä½ èƒ½å…·ä½“è¯´ä¸€ä¸‹ Java NIO çš„ç‰¹ç‚¹å—ï¼Ÿ**

**<font color=red>å€™é€‰äººï¼š</font>** å½“ç„¶å¯ä»¥ã€‚Java NIO çš„ç‰¹ç‚¹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

1. éé˜»å¡å¼ I/Oï¼šJava NIO æ”¯æŒéé˜»å¡å¼ I/O æ“ä½œï¼Œå¯ä»¥åœ¨ç­‰å¾… I/O æ“ä½œå®Œæˆçš„åŒæ—¶ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚

2. ç¼“å†²åŒºï¼šJava NIO ä½¿ç”¨ç¼“å†²åŒºæ¥å¤„ç†æ•°æ®ï¼Œå¯ä»¥æé«˜æ•°æ®çš„è¯»å†™æ•ˆç‡ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒéšæœºè®¿é—®ã€‚

3. é€šé“ï¼šJava NIO ä½¿ç”¨é€šé“æ¥è¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œï¼Œé€šé“å¯ä»¥æ”¯æŒåŒå‘æ•°æ®ä¼ è¾“ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚

4. é€‰æ‹©å™¨ï¼šJava NIO æä¾›äº†é€‰æ‹©å™¨æ¥å®ç°å¤šè·¯å¤ç”¨ï¼Œå¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªé€šé“çš„ I/O äº‹ä»¶ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚

**<font color=blue>é¢è¯•å®˜</font>ï¼š é‚£ä½ èƒ½è¯´ä¸€ä¸‹ Java NIO çš„åº”ç”¨åœºæ™¯å—ï¼Ÿ**

**<font color=red>å€™é€‰äººï¼š</font>** å½“ç„¶å¯ä»¥ã€‚Java NIO çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ç½‘ç»œç¼–ç¨‹ã€æ–‡ä»¶æ“ä½œã€å†…å­˜æ˜ å°„ç­‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒJava NIO å¯ä»¥å®ç°é«˜æ€§èƒ½çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œå¯ä»¥æ”¯æŒå¤§é‡çš„å¹¶å‘è¿æ¥ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨é€‰æ‹©å™¨æ¥å®ç°å¤šè·¯å¤ç”¨ã€‚åœ¨æ–‡ä»¶æ“ä½œä¸­ï¼ŒJava NIO å¯ä»¥å®ç°é«˜æ•ˆçš„æ–‡ä»¶è¯»å†™æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨å†…å­˜æ˜ å°„æ¥æé«˜æ–‡ä»¶çš„è¯»å–é€Ÿåº¦ã€‚åœ¨å†…å­˜æ˜ å°„ä¸­ï¼ŒJava NIO å¯ä»¥å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œä»è€Œå¯ä»¥ç›´æ¥è®¿é—®æ–‡ä»¶çš„å†…å®¹ï¼Œè€Œæ— éœ€è¿›è¡Œç¹ççš„è¯»å†™æ“ä½œã€‚

**<font color=blue>é¢è¯•å®˜</font>ï¼š é‚£ä½ èƒ½è¯´ä¸€ä¸‹ Java NIO çš„æ ¸å¿ƒç»„ä»¶å—ï¼Ÿ**

**<font color=red>å€™é€‰äººï¼š</font>** å½“ç„¶å¯ä»¥ã€‚Java NIO çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ç¼“å†²åŒºï¼ˆBufferï¼‰ã€é€šé“ï¼ˆChannelï¼‰ã€é€‰æ‹©å™¨ï¼ˆSelectorï¼‰å’Œå­—èŠ‚ç¼–è§£ç å™¨ï¼ˆCharsetï¼‰ã€‚ç¼“å†²åŒºç”¨äºå­˜å‚¨æ•°æ®ï¼Œé€šé“ç”¨äºè¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œï¼Œé€‰æ‹©å™¨ç”¨äºå®ç°å¤šè·¯å¤ç”¨ï¼Œå­—èŠ‚ç¼–è§£ç å™¨ç”¨äºå°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµã€‚è¿™äº›ç»„ä»¶å…±åŒæ„æˆäº† Java NIO çš„åŸºç¡€æ¶æ„ï¼Œå¯ä»¥æ”¯æŒé«˜æ•ˆçš„ I/O æ“ä½œã€‚

**<font color=blue>é¢è¯•å®˜</font>ï¼š é‚£ä½ èƒ½ç»™æˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œè¯´æ˜ Java NIO åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨å—ï¼Ÿ**

**<font color=red>å€™é€‰äººï¼š</font>** å½“ç„¶å¯ä»¥ã€‚åœ¨ä¸€ä¸ªèŠå¤©å®¤åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Java NIO æ¥å®ç°å¤šä¸ªå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ã€‚æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€šé“æ¥è¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œï¼Œè€ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨æ¥ç›‘æ§æ‰€æœ‰çš„é€šé“ï¼Œä»è€Œå®ç°å¤šè·¯å¤ç”¨ã€‚è¿™æ ·å¯ä»¥å¤§å¤§æé«˜æœåŠ¡å™¨çš„å¹¶å‘æ€§èƒ½ï¼Œæ”¯æŒå¤§é‡çš„å¹¶å‘è¿æ¥ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œç”¨äºå®ç°ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤åº”ç”¨ï¼š

```java
import java.io.IOException;
import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.SelectionKey;
import java.nio.channels.Selector;
import java.nio.channels.ServerSocketChannel;
import java.nio.channels.SocketChannel;
import java.util.Iterator;

public class ChatRoomServer {
    private static final int PORT = 8888;
    private static final int BUFFER_SIZE = 1024;
    private static final String CHARSET = "UTF-8";

    public static void main(String[] args) throws IOException {
        // åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨
        Selector selector = Selector.open();

        // åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨é€šé“ï¼Œå¹¶ç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£
        ServerSocketChannel serverChannel = ServerSocketChannel.open();
        serverChannel.socket().bind(new InetSocketAddress(PORT));
        serverChannel.configureBlocking(false);

        // å°†æœåŠ¡å™¨é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œå¹¶ç›‘å¬è¿æ¥äº‹ä»¶
        serverChannel.register(selector, SelectionKey.OP_ACCEPT);

        System.out.println("Server started on port " + PORT);

        while (true) {
            // é˜»å¡ç­‰å¾…äº‹ä»¶å‘ç”Ÿ
            selector.select();

            // è·å–æ‰€æœ‰å·²ç»å°±ç»ªçš„äº‹ä»¶
            Iterator<SelectionKey> iterator = selector.selectedKeys().iterator();

            while (iterator.hasNext()) {
                SelectionKey key = iterator.next();
                iterator.remove();

                if (key.isAcceptable()) {
                    // å¤„ç†è¿æ¥äº‹ä»¶
                    ServerSocketChannel channel = (ServerSocketChannel) key.channel();
                    SocketChannel clientChannel = channel.accept();
                    clientChannel.configureBlocking(false);
                    clientChannel.register(selector, SelectionKey.OP_READ);
                    System.out.println("Client connected: " + clientChannel.getRemoteAddress());
                } else if (key.isReadable()) {
                    // å¤„ç†è¯»äº‹ä»¶
                    SocketChannel channel = (SocketChannel) key.channel();
                    ByteBuffer buffer = ByteBuffer.allocate(BUFFER_SIZE);
                    int len = channel.read(buffer);
                    if (len > 0) {
                        buffer.flip();
                        String message = new String(buffer.array(), 0, len, CHARSET);
                        System.out.println("Received message: " + message);
                        broadcast(selector, channel, message);
                    } else if (len == -1) {
                        channel.close();
                    }
                }
            }
        }
    }

    private static void broadcast(Selector selector, SocketChannel sender, String message) throws IOException {
        for (SelectionKey key : selector.keys()) {
            if (key.isValid() && key.channel() instanceof SocketChannel) {
                SocketChannel channel = (SocketChannel) key.channel();
                if (!channel.equals(sender)) {
                    ByteBuffer buffer = ByteBuffer.wrap(message.getBytes(CHARSET));
                    channel.write(buffer);
                }
            }
        }
    }
}
```

è¿™ä¸ªç¤ºä¾‹ä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤åº”ç”¨ï¼Œä½¿ç”¨ Java NIO æ¥å®ç°å¤šä¸ªå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ã€‚æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€šé“æ¥è¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œï¼Œè€ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨æ¥ç›‘æ§æ‰€æœ‰çš„é€šé“ï¼Œä»è€Œå®ç°å¤šè·¯å¤ç”¨ã€‚è¿™æ ·å¯ä»¥å¤§å¤§æé«˜æœåŠ¡å™¨çš„å¹¶å‘æ€§èƒ½ï¼Œæ”¯æŒå¤§é‡çš„å¹¶å‘è¿æ¥ã€‚


**<font color=blue>é¢è¯•å®˜</font>ï¼š ä»£ç å†™çš„å¾ˆå¥½ï¼Œä¸‹æ¬¡å¸¦ç¬”è®°æœ¬è¿‡æ¥ã€‚**





![](https://ghproxy.com/https://raw.githubusercontent.com/Rodert/javapub_oss/main/other/joshua-rawson-harris-ouEe9842WRg-unsplash.jpg?raw=true)



æœ€è¿‘æˆ‘åœ¨æ›´æ–°ã€Šé¢è¯•1v1ã€‹ç³»åˆ—æ–‡ç« ï¼Œä¸»è¦ä»¥åœºæ™¯åŒ–çš„æ–¹å¼ï¼Œè®²è§£æˆ‘ä»¬åœ¨é¢è¯•ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè‡´åŠ›äºè®©æ¯ä¸€ä½å·¥ç¨‹å¸ˆæ‹¿åˆ°è‡ªå·±å¿ƒä»ªçš„offerï¼Œæ„Ÿå…´è¶£å¯ä»¥å…³æ³¨**å…¬ä¼—å·JavaPub**è¿½æ›´ï¼


![](https://ghproxy.com/https://raw.githubusercontent.com/Rodert/javapub_oss/main/common/javapub-qr-code.png?raw=true)




ğŸç›®å½•åˆé›†ï¼š

Giteeï¼š`https://gitee.com/rodert/JavaPub`

GitHubï¼š`https://github.com/Rodert/JavaPub`



<http://javapub.net.cn>
