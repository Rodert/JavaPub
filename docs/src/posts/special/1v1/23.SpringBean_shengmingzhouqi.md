---
title: SpringBeanç”Ÿå‘½å‘¨æœŸ
icon: laptop-code
category:
  - ã€Šé¢è¯•1v1ã€‹
---




**æˆ‘æ˜¯ javapubï¼Œä¸€å `Markdown` ç¨‹åºå‘˜ä»ğŸ‘¨â€ğŸ’»ï¼Œå…«è‚¡æ–‡ç§å­é€‰æ‰‹ã€‚**



**<font color=blue>é¢è¯•å®˜</font>ï¼š å°ä¼™å­,å¬è¯´ä½ å¯¹ Spring Bean ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒç†Ÿæ‚‰,æˆ‘ä»¬èŠèŠå§ã€‚Spring Bean éƒ½æœ‰å“ªäº›ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ?**

**<font color=red>å€™é€‰äººï¼š</font>** Spring Bean çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸º 5 ä¸ªé˜¶æ®µ:

1. å®ä¾‹åŒ–(Instantiation):Spring ä½¿ç”¨ BeanDefinition ä¸­çš„ä¿¡æ¯å®ä¾‹åŒ– Beanã€‚
2. å±æ€§èµ‹å€¼(Dependency injection):Spring å°† BeanDefinition ä¸­é…ç½®çš„å±æ€§å€¼æ³¨å…¥åˆ° Bean ä¸­ã€‚
3. åˆå§‹åŒ–å‰é˜¶æ®µ(Post-Construct):å¦‚æœ Bean å®ç°äº† InitializingBean æ¥å£,ä¼šè°ƒç”¨ afterPropertiesSet() æ–¹æ³•ã€‚
4. åˆå§‹åŒ–é˜¶æ®µ(Initialization):å¦‚æœåœ¨ BeanDefinition ä¸­é…ç½®äº† init-method,ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚ 
5. é”€æ¯é˜¶æ®µ(Destruction):å¦‚æœ Bean å®ç°äº† DisposableBean æ¥å£,ä¼šè°ƒç”¨ destroy() æ–¹æ³•ã€‚å¦‚æœé…ç½®äº† destroy-method,ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚

**<font color=blue>é¢è¯•å®˜</font>ï¼š èªæ˜!åˆå§‹åŒ–æ–¹æ³•æœ‰å“ªäº›?åœ¨æºç å±‚é¢,Spring æ˜¯å¦‚ä½•è°ƒç”¨è¿™äº›æ–¹æ³•çš„?**

**<font color=red>å€™é€‰äººï¼š</font>** Spring Bean æä¾›äº† 3 ç§åˆå§‹åŒ–æ–¹æ³•:

1. @PostConstruct:è¿™æ˜¯ JSR-250 æ³¨è§£,Spring ä¼šåœ¨ Bean åˆå§‹åŒ–åè‡ªåŠ¨è°ƒç”¨è¢«æ­¤æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ã€‚
2. InitializingBean æ¥å£:è¿™ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• afterPropertiesSet(),Spring ä¼šåœ¨ Bean åˆå§‹åŒ–åè°ƒç”¨è¯¥æ–¹æ³•ã€‚
3. è‡ªå®šä¹‰ init-method:åœ¨ BeanDefinition ä¸­é…ç½® init-method å±æ€§,æŒ‡å‘ Bean ä¸­çš„æŸä¸ªæ–¹æ³•å,Spring ä¼šåœ¨ Bean åˆå§‹åŒ–åè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚

åœ¨æºç å±‚é¢,è¿™äº›æ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨ `AbstractAutowireCapableBeanFactory` çš„ `initializeBean` æ–¹æ³•ä¸­å®ç°çš„:

```java
protected Object initializeBean(final String beanName, final Object bean, @Nullable RootBeanDefinition mbd) {
    // ...
        
    // 1. å¤„ç† PostConstruct æ³¨è§£
    if (mbd == null || !mbd.isExternallyManagedInitMethod("afterPropertiesSet")) {
        // 2. å®ç°äº† InitializingBean æ¥å£çš„ Bean ä¼šè°ƒç”¨ afterPropertiesSet() æ–¹æ³•
        if (bean instanceof InitializingBean) {
            ((InitializingBean) bean).afterPropertiesSet();
        }
    }

    // 3. è°ƒç”¨è‡ªå®šä¹‰çš„ init-method 
    if (mbd != null && bean.getClass() != NullBean.class) {
        String initMethodName = mbd.getInitMethodName();
        if (StringUtils.hasLength(initMethodName) && 
            !(bean instanceof InitializingBean && "afterPropertiesSet".equals(initMethodName)) &&
            !mbd.isExternallyManagedInitMethod(initMethodName)) {
                Method initMethod = bean.getClass().getMethod(initMethodName);
                initMethod.invoke(bean);
        }
    }
}
```

**<font color=blue>é¢è¯•å®˜</font>ï¼š ä¸é”™,ä½ å¯¹ Spring Bean çš„åˆå§‹åŒ–è¿‡ç¨‹å¾ˆæ¸…æ¥š!é‚£é”€æ¯æ–¹æ³•å“ªäº›?åŸç†åˆæ˜¯ä»€ä¹ˆ?**


**<font color=red>å€™é€‰äººï¼š</font>** Spring Bean æä¾›äº† 2 ç§é”€æ¯æ–¹æ³•:

1. DisposableBean æ¥å£:å®ç°è¿™ä¸ªæ¥å£çš„ Bean ä¼šè°ƒç”¨ destroy() æ–¹æ³•ã€‚
2. è‡ªå®šä¹‰ destroy-method:åœ¨ BeanDefinition ä¸­é…ç½® destroy-method å±æ€§,æŒ‡å‘ Bean ä¸­çš„æŸä¸ªæ–¹æ³•å,Spring ä¼šåœ¨ Bean é”€æ¯å‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚

åœ¨æºç å±‚é¢,è¿™äº›æ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨ `AbstractAutowireCapableBeanFactory` çš„ `destroyBean` æ–¹æ³•ä¸­å®ç°çš„:

```java
protected void destroyBean(String beanName, @Nullable DisposableBean bean) {
    // 1. å®ç°äº† DisposableBean æ¥å£çš„ Bean ä¼šè°ƒç”¨ destroy() æ–¹æ³•
    if (bean != null) { 
        bean.destroy();
    }

    // 2. è°ƒç”¨è‡ªå®šä¹‰çš„ destroy-method
    String destroyMethodName = getDestroyMethodName(beanName);
    if (destroyMethodName != null) {
        Method destroyMethod = null;
        try {
            // è·å– destroy-method æ–¹æ³•å¯¹è±¡
            destroyMethod = bean.getClass().getMethod(destroyMethodName); 
        } catch (NoSuchMethodException ex) {
            throw new BeanDefinitionStoreException(...);
        }
        
        // è°ƒç”¨æ–¹æ³•
        try {
            if (destroyMethod != null) {
                destroyMethod.invoke(bean);
            }
        } catch (...) {
            throw new BeanCreationException(...); 
        }
    } 
    
}
```

**<font color=blue>é¢è¯•å®˜</font>ï¼š æ£’!æœ€å,Spring Bean çš„ä½œç”¨åŸŸéƒ½æœ‰å“ªäº›?å¦‚ä½•æ§åˆ¶ Bean çš„ç”Ÿå‘½å‘¨æœŸ?**

**<font color=red>å€™é€‰äººï¼š</font>** Spring Bean çš„ä½œç”¨åŸŸæœ‰ 5 ç§:

1. singleton:å•ä¾‹,æ•´ä¸ª Spring å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ª Bean å®ä¾‹ã€‚
2. prototype:åŸå‹,æ¯æ¬¡è·å– Bean éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚
3. request:æ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚
4. session:æ¯ä¸ª HTTP ä¼šè¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚
5. global-session:æ¯ä¸ªå…¨å±€ HTTP ä¼šè¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `scope` å±æ€§æ§åˆ¶ Bean çš„ä½œç”¨åŸŸ,ä»è€Œå½±å“å…¶ç”Ÿå‘½å‘¨æœŸ:

```xml
<bean id="..." class="..." scope="prototype"/>
```

æ­¤å¤–,æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ Bean çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•,åœ¨ Bean ä½œç”¨åŸŸå¼€å§‹å’Œç»“æŸæ—¶è§¦å‘:

```xml
<bean id="..." class="..." scope="prototype" 
    init-method="start" destroy-method="end">
</bean>
```

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ `start()` æ–¹æ³•ä¸­æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘,åœ¨ `end()` æ–¹æ³•ä¸­æ‰§è¡Œæ¸…ç†å·¥ä½œ,ä»è€Œç²¾ç¡®æ§åˆ¶ Bean çš„ç”Ÿå‘½å‘¨æœŸã€‚

**<font color=blue>é¢è¯•å®˜</font>ï¼š å¾ˆå…¨é¢,ä½©æœä½©æœ!å¦‚æœå†ç»™ä½ ä¸€ä¸ªæœºä¼š,ä½ è§‰å¾—è¿˜å¯ä»¥åœ¨å“ªäº›æ–¹é¢åŠ æ·±å¯¹ Spring Bean ç”Ÿå‘½å‘¨æœŸçš„ç†è§£?**


**<font color=red>å€™é€‰äººï¼š</font>** è¿™é‡Œæœ‰å‡ ä¸ªæ–¹é¢å¯ä»¥è¿›ä¸€æ­¥åŠ æ·±å¯¹ Spring Bean ç”Ÿå‘½å‘¨æœŸçš„ç†è§£:

1. BeanPostProcessor:è¿™ä¸ªæ¥å£å¯ä»¥ç›‘å¬ Bean çš„åˆå§‹åŒ–å‰å,æä¾›äº†æ‰©å±•ç‚¹å¯ä»¥åœ¨ Bean åˆå§‹åŒ–å‰åè¿›è¡Œä¸€äº›å¤„ç†ã€‚è¿™ä¹Ÿæ˜¯ Spring AOP çš„åº•å±‚åŸç†ä¹‹ä¸€ã€‚
2. äº†è§£ BeanFactoryPostProcessor:è¿™ä¸ªæ¥å£å¯ä»¥ç›‘å¬ BeanDefinition çš„åŠ è½½,å¯ä»¥åœ¨ Bean å®ä¾‹åŒ–å‰ä¿®æ”¹ BeanDefinition çš„å±æ€§ã€‚
3. ç†è§£ Bean çš„åŠ è½½æ—¶æœº:åœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶,é»˜è®¤ä¼šç«‹å³åŠ è½½ singleton ä½œç”¨åŸŸçš„ Bean,è€Œå…¶ä»–ä½œç”¨åŸŸçš„ Bean ä¼šå»¶è¿ŸåŠ è½½, singleton ä½œç”¨åŸŸçš„ Bean ä¹Ÿæ”¯æŒå»¶è¿ŸåŠ è½½ã€‚è¿™å°±è¦æ¶‰åŠåˆ°Spring çš„ `lazy-init` å±æ€§è®¾ç½®ã€‚
4. äº†è§£ Bean ä¸ºä»€ä¹ˆè¦æœ‰ä¸åŒçš„ä½œç”¨åŸŸ:æ¯ä¸ªä½œç”¨åŸŸé€‚åˆçš„åœºæ™¯æ˜¯ä»€ä¹ˆ,é€‰æ‹©ä¸åŒä½œç”¨åŸŸä¼šå¯¹ Bean çš„ç”Ÿå‘½å‘¨æœŸäº§ç”Ÿæ€æ ·çš„å½±å“ã€‚
5. äº†è§£ Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»å¯¹ç”Ÿå‘½å‘¨æœŸçš„å½±å“:æ¯”å¦‚ A  Bean çš„åˆå§‹åŒ–ä¾èµ– B Bean,é‚£ä¹ˆ A Bean çš„åˆå§‹åŒ–ä¹Ÿä¼šå»¶è¿Ÿåˆ° B Bean åˆå§‹åŒ–å®Œæ¯•åã€‚è¿™æ¶‰åŠåˆ° Spring çš„ `depends-on` å±æ€§é…ç½®ã€‚ 
6. äº†è§£è‡ªå®šä¹‰åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•çš„å…·ä½“åº”ç”¨åœºæ™¯:ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦è‡ªå®šä¹‰è¿™äº›æ–¹æ³•,èƒ½åœ¨æ–¹æ³•ä¸­å®Œæˆä»€ä¹ˆæ ·çš„é€»è¾‘å¤„ç†ã€‚
7. æ¢ç´¢ BeanPostProcessor å’Œ BeanFactoryPostProcessor çš„å…·ä½“åº”ç”¨:æ¯”å¦‚ Spring AOPã€Spring äº‹ä»¶å‘å¸ƒè€…ç­‰æœºåˆ¶çš„å®ç°ã€‚
ç»¼ä¸Š,è¦å…¨é¢ç†è§£ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ,é™¤äº†çŸ¥é“æ¯ä¸ªé˜¶æ®µçš„è°ƒç”¨å¤–,è¿˜éœ€è¦å¯¹å¾ˆå¤šè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°çš„å…¶ä»–çŸ¥è¯†ç‚¹è¿›è¡Œæ·±å…¥å­¦ä¹ å’Œç†è§£,è¿™éœ€è¦ä¸æ–­å®è·µå’Œæ€»ç»“ã€‚ä½†åªè¦æŠŠè¿™äº›è¦ç‚¹éƒ½ä¸²è”èµ·æ¥,å¯¹ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å°±ä¼šå¾ˆå¾—å¿ƒåº”æ‰‹äº†ã€‚

**<font color=blue>é¢è¯•å®˜</font>ï¼š éå¸¸æ£’,è¿™äº›ç‚¹ç²¾å½©æäº†!ä½ çš„å›ç­”å·²ç»å¾ˆå…¨é¢å’Œæ·±å…¥,å¯¹ Spring Bean ç”Ÿå‘½å‘¨æœŸæœ‰æ¸…æ™°ç†è§£,è¿™äº›åˆæ˜¯å¸¸è§çš„é¢è¯•é‡ç‚¹,æˆ‘ç›¸ä¿¡é¢è¯•ä¸€å®šä¼šå–å¾—å¾ˆå¥½çš„è¡¨ç°,åŠ æ²¹!æˆ‘ä»¬å°±èŠåˆ°è¿™é‡Œ,å¾ˆé«˜å…´ä¸ä½ çš„äº¤æµ,è°¢è°¢!**






![](https://ghproxy.com/https://raw.githubusercontent.com/Rodert/javapub_oss/main/other/23.jpg?raw=true)


æœ€è¿‘æˆ‘åœ¨æ›´æ–°ã€Šé¢è¯•1v1ã€‹ç³»åˆ—æ–‡ç« ï¼Œä¸»è¦ä»¥åœºæ™¯åŒ–çš„æ–¹å¼ï¼Œè®²è§£æˆ‘ä»¬åœ¨é¢è¯•ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œè‡´åŠ›äºè®©æ¯ä¸€ä½å·¥ç¨‹å¸ˆæ‹¿åˆ°è‡ªå·±å¿ƒä»ªçš„offerï¼Œæ„Ÿå…´è¶£å¯ä»¥å…³æ³¨**å…¬ä¼—å·JavaPub**è¿½æ›´ï¼


![](https://javapub-common-oss.oss-cn-beijing.aliyuncs.com/javapub/2024%2F06%2F06%2F20240606-225632.png)


ğŸç›®å½•åˆé›†ï¼š

Giteeï¼š`https://gitee.com/rodert/JavaPub`

GitHubï¼š`https://github.com/Rodert/JavaPub`


<http://javapub.net.cn>


